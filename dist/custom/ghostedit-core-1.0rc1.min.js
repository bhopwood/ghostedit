/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2012 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0rc1
Release Date:      2012-12-13
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/
(function(e,t){var n={version:"1.0rc1",enabledplugins:[],uicontext:"",active:!1,isEditing:!0,blockElemId:0,editorchrome:null,debug:!1};n.api={},n.plugins={},e.ghostedit=n})(window),function(e,t){var n={};n.init=function(){n.paste.init(),n.cut.init()},_paste={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},_paste.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"paste",function(e){_paste.handle(e)})},"clipboard")},_paste.handle=function(e){return ghostedit.history.saveUndoState(),_paste.savedundodata=ghostedit.history.undoData,_paste.savedundopoint=ghostedit.history.undoPoint,_paste.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(_paste.triedpasteimage=!0),/text\/html/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):ghostedit.editdiv.innerHTML="",_paste.waitfordata(),ghostedit.util.cancelEvent(e)):(ghostedit.editdiv.innerHTML="",_paste.waitfordata(),!0)},_paste.waitfordata=function(){var e=ghostedit.editdiv;e.childNodes&&e.childNodes.length>0?_paste.process():setTimeout(_paste.waitfordata,20)},_paste.process=function(){var e,t,n,r,i,s,o,u,a,f="",l,c,h="",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;A=document.createElement("div"),console.log("raw paste content"),console.log(ghostedit.editdiv.cloneNode(!0)),A=ghostedit.plugins.container.inout.importHTML(ghostedit.editdiv),console.log("processed content"),console.log(A.innerHTML),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),console.log(ghostedit.selection.saved),ghostedit.selection.deleteContents(),ghostedit.selection.save(),console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A);if(!E)return;ghostedit.selection.saved.data.isCollapsed()?(O=!0,ghostedit.selection.saved.data.saveToDOM("ghostedit_paste_start")):(O=!1,ghostedit.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),ghostedit.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),console.log("test--------------------------------"),w=!1,_paste.trycounter=0,ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b){M=!1;break}y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;x={isfirst:!0,islast:ghostedit.dom.getFirstChildGhostBlock(A)===E?!0:!1,collapsed:O},console.log("Call handler: (first)"+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,x),console.log("result: "+w);if(w){M=!0,E.parentNode.removeChild(E);break}w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1)}E=ghostedit.dom.getLastChildGhostBlock(A);if(E&&(O===!1||M===!1)){_paste.trycounter=0,w=!1,ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler (last): "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!0,collapsed:O}),console.log("result: "+w);if(w){E.parentNode.removeChild(E);break}w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1);if(_paste.trycounter++>20)return}}console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A),_paste.trycounter=0;while(E){w=!1;while(!w){ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),lasso().isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.setEndToRangeEnd(lasso().restoreFromDOM("ghostedit_paste_end",!1)),ghostedit.selection.saved.data.select(),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler: "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!1,collapsed:O}),console.log("result: "+w);if(_paste.trycounter++>20)return}E=ghostedit.dom.getNextSiblingGhostBlock(E)}ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),ghostedit.selection.save(),ghostedit.event.trigger("postpaste"),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.saveUndoState(),_paste.triedpasteimage&&(ghostedit.ui.message.show("You cannot paste images into the editor, please use the add image button instead",2,"warn"),ghostedit.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}))},_cut={savedcontent:null,savedundodata:null,savedundopoint:null},_cut.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"cut",function(e){_cut.handle(e)})},"clipboard")},_cut.handle=function(e){return ghostedit.history.saveUndoState(),_cut.savedundodata=ghostedit.history.undoData,_cut.savedundopoint=ghostedit.history.undoPoint,setTimeout(_cut.cleanup,20),!0},_cut.cleanup=function(){ghostedit.history.undoData=_cut.savedundodata,ghostedit.history.undoPoint=_cut.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),ghostedit.selection.deleteContents(),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.paste=_paste,n.cut=_cut,e.ghostedit.clipboard=n}(window),function(e,t){_container={},_container.ghostevent=function(e,n,r,s){var o=!1,u,a=!1;switch(e){case"deletebehind":childblocks=n.childNodes;for(i=childblocks.length-1;i>=0;i-=1)if(childblocks[i].getAttribute("data-ghostedit-elemtype")!==t&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==!1&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==null)if(o===!0){u=childblocks[i].getAttribute("data-ghostedit-elemtype");if(ghostedit.plugins[u].ghostevent("deletefromahead",childblocks[i],s)){a=!0;break}}else childblocks[i]===s.sourceblock&&(o=!0);!a;break;case"deleteahead":childblocks=n.childNodes;for(i=0;i<childblocks.length;i+=1)if(childblocks[i].getAttribute("data-ghostedit-elemtype")!==t&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==!1&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==null)if(o===!0){u=childblocks[i].getAttribute("data-ghostedit-elemtype");if(ghostedit.plugins[u].ghostevent("deletefrombehind",childblocks[i],s)){a=!0;break}}else childblocks[i]===s.sourceblock&&(o=!0);!a}},_container.dom={addchild:function(e,t,n,r){return t==="before"?e.insertBefore(r,n):n.nextSibling!=null?e.insertBefore(r,n.nextSibling):e.appendChild(r),!0},removechild:function(e,t){return!e||!t?!1:(e.removeChild(t),!0)}},_container.selection={deleteContents:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=!1,k=!1,L,A,O,M,_,D,P,H;if(ghostedit.selection.saved.type!=="textblock")return!1;N=ghostedit.selection.saved.data,f=e.childNodes,L=ghostedit.dom.getFirstChildGhostBlock(e),A=ghostedit.dom.getLastChildGhostBlock(e),x=lasso().setCaretToStart(L),T=lasso().setCaretToEnd(A),N.compareEndPoints("StartToStart",x)!==1?(C=!0,s=L):(s=N.getStartNode(),ghostedit.dom.isGhostBlock(s)||(s=ghostedit.dom.getParentGhostBlock(s))),N.compareEndPoints("EndToEnd",T)!==-1?(k=!0,o=A):(o=N.getEndNode(),ghostedit.dom.isGhostBlock(o)||(o=ghostedit.dom.getParentGhostBlock(o))),u=s;while(!ghostedit.dom.isChildGhostBlock(u,e))u=ghostedit.dom.getParentGhostBlock(u);a=o;while(!ghostedit.dom.isChildGhostBlock(a,e))a=ghostedit.dom.getParentGhostBlock(a);d=!1;for(n=0;n<f.length;n+=1){cblock=f[n];if(!ghostedit.dom.isGhostBlock(cblock))continue;P=cblock.getAttribute("data-ghostedit-handler");if(cblock.id===u.id){ghostedit.plugins[P].selection.deleteContents(cblock),d=!0;continue}if(cblock.id===a.id){ghostedit.plugins[P].selection.deleteContents(cblock),d=!1;break}d&&(e.removeChild(f[n]),n--)}return u.getAttribute("data-ghostedit-elemtype")===a.getAttribute("data-ghostedit-elemtype")&&(ghostedit.plugins[u.getAttribute("data-ghostedit-elemtype")].merge(u,a,t),ghostedit.dom.getParentGhostBlock(a)||lasso().setToSelection().collapseToStart().select()),ghostedit.dom.getFirstChildGhostBlock(e)||e.appendChild(ghostedit.textblock.create("p")),!0}},_container.inout={importHTML:function(e){var t,n,r,i,s;if(!e||e.childNodes.length<1)return!1;t=_container.create();for(i=0;i<e.childNodes.length;i+=1){elem=e.childNodes[i];if(elem.nodeType!==1&&elem.nodeType!==3)continue;tagname=elem.nodeType===3?"#textnode":elem.tagName.toLowerCase(),ghostedit.inout.importhandlers[tagname]?(r=ghostedit.inout.importhandlers[tagname].call(this,elem),r&&ghostedit.dom.isGhostBlock(r)&&t.appendChild(r)):elem.childNodes.length>0&&(s=elem.childNodes.length,elem.parentNode.insertBefore(ghostedit.dom.extractContent(elem),elem),elem.parentNode.removeChild(elem),i-=1)}return ghostedit.dom.getFirstChildGhostBlock(t)||t.appendChild(ghostedit.plugins.textblock.create("p")),t},exportHTML:function(e,t){if(!e||!ghostedit.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="container")return!1;var n=0,r,i,s="",o,u,a=0,f,l,c=!1;for(n=0;n<e.childNodes.length;n+=1){r=ghostedit.dom.isGhostBlock(e.childNodes[n])?e.childNodes[n]:!1;if(!r)continue;l=r.getAttribute("data-ghostedit-handler");if(!l||!ghostedit.plugins[l])continue;blockreturn=ghostedit.plugins[l].inout.exportHTML(r),blockreturn&&(s+=blockreturn.content,a++),a<=3&&(f=s)}return{content:s,snippet:f}}},_container.paste={handle:function(e,t,n){var r,i,s,o;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isGhostBlock(t))return!0;if(n.isfirst||n.islast)return!1;r=ghostedit.selection.saved.data,i=r.clone().collapseToStart().getParentElement(),r.saveToDOM("ghostedit_paste_start"),i===e&&(o=document.getElementById("ghostedit_paste_start_range_start"),i=ghostedit.dom.getPreviousSiblingGhostBlock(o)||o);while(i.parentNode!==e){i=i.parentNode;if(i===null||!i.parentNode)return!0}return s=t.cloneNode(!0),lasso().removeDOMmarkers("ghostedit_paste_start"),s.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t3'>&#x200b;</span>",_container.dom.addchild(e,"after",i,s),o&&o.parentNode&&o.parentNode.removeChild(o),!0}},_container.isChildGhostBlock=function(e,n){if(!e)return!1;if(e.nodeType!=1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;for(i=0;i<n.length;i+=1)if(e===n[i])return!0;return!1},_container.create=function(){return newElem=document.createElement("div"),ghostedit.blockElemId+=1,newElem.id="ghostedit_container_"+ghostedit.blockElemId,newElem.setAttribute("data-ghostedit-iselem","true"),newElem.setAttribute("data-ghostedit-elemtype","container"),newElem.setAttribute("data-ghostedit-handler","container"),newElem},_container.focus=function(e){var t,n;return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="container"?!1:(t=ghostedit.dom.getFirstChildGhostBlock(e),t?(n=t.getAttribute("data-ghostedit-handler"),ghostedit.plugins[n].focus(t),!0):!1)},ghostedit.api.plugin.register("container",_container)}(window),function(e,t){var n={};n.init=function(){n.paste.init(),n.cut.init()},_paste={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},_paste.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"paste",function(e){_paste.handle(e)})},"clipboard")},_paste.handle=function(e){return ghostedit.history.saveUndoState(),_paste.savedundodata=ghostedit.history.undoData,_paste.savedundopoint=ghostedit.history.undoPoint,_paste.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(_paste.triedpasteimage=!0),/text\/html/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):ghostedit.editdiv.innerHTML="",_paste.waitfordata(),ghostedit.util.cancelEvent(e)):(ghostedit.editdiv.innerHTML="",_paste.waitfordata(),!0)},_paste.waitfordata=function(){var e=ghostedit.editdiv;e.childNodes&&e.childNodes.length>0?_paste.process():setTimeout(_paste.waitfordata,20)},_paste.process=function(){var e,t,n,r,i,s,o,u,a,f="",l,c,h="",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;A=document.createElement("div"),console.log("raw paste content"),console.log(ghostedit.editdiv.cloneNode(!0)),A=ghostedit.plugins.container.inout.importHTML(ghostedit.editdiv),console.log("processed content"),console.log(A.innerHTML),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),console.log(ghostedit.selection.saved),ghostedit.selection.deleteContents(),ghostedit.selection.save(),console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A);if(!E)return;ghostedit.selection.saved.data.isCollapsed()?(O=!0,ghostedit.selection.saved.data.saveToDOM("ghostedit_paste_start")):(O=!1,ghostedit.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),ghostedit.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),console.log("test--------------------------------"),w=!1,_paste.trycounter=0,ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;x={isfirst:!0,islast:ghostedit.dom.getFirstChildGhostBlock(A)===E?!0:!1,collapsed:O},console.log("Call handler: (first)"+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,x),w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),console.log("result: "+w)}E.parentNode.removeChild(E),E=ghostedit.dom.getLastChildGhostBlock(A);if(E){_paste.trycounter=0,w=!1,ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler (last): "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!0,collapsed:O}),w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),console.log("result: "+w);if(_paste.trycounter++>20)return}E.parentNode.removeChild(E)}ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),ghostedit.selection.save(),ghostedit.event.trigger("postpaste"),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.saveUndoState(),_paste.triedpasteimage&&(ghostedit.ui.message.show("You cannot paste images into the editor, please use the add image button instead",2,"warn"),ghostedit.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}))},_cut={savedcontent:null,savedundodata:null,savedundopoint:null},_cut.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"cut",function(e){_cut.handle(e)})},"clipboard")},_cut.handle=function(e){return ghostedit.history.saveUndoState(),_cut.savedundodata=ghostedit.history.undoData,_cut.savedundopoint=ghostedit.history.undoPoint,setTimeout(_cut.cleanup,20),!0},_cut.cleanup=function(){ghostedit.history.undoData=_cut.savedundodata,ghostedit.history.undoPoint=_cut.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),ghostedit.selection.deleteContents(),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.paste=_paste,n.cut=_cut,e.ghostedit.clipboard=n}(window),function(e,t){var n={};n.getNodeOffset=function(e){var t,n;if(!e||!e.parentNode)return;t=0,n=e.parentNode.childNodes;while(n[t]!==e)t+=1;return t},n.extractContent=function(e){var t=document.createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t},n.cloneContent=function(e){var t=document.createDocumentFragment(),n;for(i=0;i<e.childNodes.length;i++)n=e.childNodes[i],t.appendChild(n.cloneNode(!0));return t},n.parse=function(e,r){var i=!1,s,o,u,a,f,l,c,h,p,d,v;if(!e||!r||!e.nodeType)return!1;r.textnode=r.textnode||{},r.tags=r.tags||{};if(e.nodeType===3)return c=r.textnode.clean?e.nodeValue.replace(/[\n\r\t]/g,""):e.nodeValue,c.length>0?document.createTextNode(c):!1;if(e.nodeType!==1)return!1;h=e.tagName.toLowerCase(),p={contentsonly:!0};if(r.tags[h]){p=r.tags[h],typeof p.template=="string"&&(p=p.template),typeof p=="string"&&r.templates[p]&&(p=r.templates[p]);if(typeof p=="string")return!1}i=p.contentsonly?document.createDocumentFragment():document.createElement(e.tagName.toLowerCase());if(!p.ignorechildren){s=e.childNodes;for(a=0;a<s.length;a++)(o=n.parse(s[a],r))&&i.appendChild(o)}if(p.contentsonly)return i.childNodes.length>0?i:!1;if(p.attributes)for(a=0;a<p.attributes.length;a++){d=p.attributes[a],typeof d=="string"&&(d={name:d});if(typeof d.name!="string")break;l=d.value||d.name==="class"?e.className:e.getAttribute(d.name);if(l===t)break;d.copy=!0;if(d.allowedvalues){d.copy=!1;for(f=0;f<d.allowedvalues.length;f++)if(d.allowedvalues[a]===l){d.copy=!0;break}}d.copy&&(d.name==="class"?i.className=l:i.setAttribute(d.name,l))}if(p.styles)for(a=0;a<p.styles.length;a++){v=p.styles[a],typeof v=="string"&&(v={name:v});if(typeof v.name!="string")break;v.name==="float"&&(v.name=e.style.cssFloat?"cssFloat":"styleFloat"),l=v.value||e.style[v.name];if(l===t)break;v.copy=!0;if(v.allowedvalues){v.copy=!1;for(f=0;f<v.allowedvalues.length;f++)if(v.allowedvalues[f]===l){v.copy=!0;break}}v.copy&&(i.style[v.name]=l)}return i},n.isGhostBlock=function(e){if(!e||!e.nodeType||e.nodeType!==1)return!1;var n=e.getAttribute("data-ghostedit-elemtype");return n!==t&&n!==!1&&n!==null?!0:!1},n.isChildGhostBlock=function(e,n){if(!e||!n||!n.childNodes)return!1;if(e.nodeType!=1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;var r=n.childNodes;for(i=0;i<r.length;i+=1)if(e===r[i])return!0;return!1},n.isGhostToplevel=function(e){return e&&e.getAttribute("data-ghostedit-isrootnode")===!0?!0:!1},n.getParentGhostBlock=function(e){if(!e)return!1;do{e=e.parentNode;if(e==null)return!1}while(!n.isGhostBlock(e));return e},n.getFirstChildGhostBlock=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=0;i<t.length;i+=1)if(n.isGhostBlock(t[i]))return t[i];return!1},n.getLastChildGhostBlock=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=t.length-1;i>=0;i-=1)if(n.isGhostBlock(t[i]))return t[i];return!1},n.getPreviousSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)-1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r-=1}while(r>=0);return!1},n.getNextSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)+1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r+=1}while(r<i.length);return!1},n.getParentElement=function(e){if(e.nodeType!=1)while(e.nodeType!=1){e=e.parentNode;if(e==null)return null}return e},n.isDescendant=function(e,t){var n=t.parentNode;while(n!=null){if(n==e)return!0;n=n.parentNode}return!1},n.getFirstChildElement=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=0;i<t.length;i+=1)if(t[i].nodeType===1)return t[i];return!1},n.getCertainParent=function(e,t){var n=[].slice.call(arguments);n.shift();if(!e.apply(this,n))while(!e.apply(this,n)){t=t.parentNode,n[0]=t;if(t==null)return!1}return t},e.ghostedit.dom=n}(window),function(e,t){var n={listeners:[],listenerid:0,eventtypes:[],cancelKeypress:!1};n.keydown=function(t,r){var i,s,o,u;ghostedit.selection.save(!1),r=(!r||!r.istest)&&e.event!=null?e.event:r,i=r.keyCode!=null?r.keyCode:r.charCode,n.trigger("input:keydown",{event:event,keycode:i});switch(i){case 8:case 46:cancelKeypress=!1;if(ghostedit.selection.savedRange.isCollapsed()===!1)return ghostedit.history.saveUndoState(),ghostedit.selection.deleteContents(i===8?"collapsetostart":"collapsetoend"),ghostedit.history.saveUndoState(),n.cancelKeypress=!0,ghostedit.util.cancelEvent(r);break;case 83:if(r.ctrlKey)return ghostedit.api.save(),ghostedit.util.cancelEvent(r);break;case 66:if(r.ctrlKey)return ghostedit.textblock.format.bold(),ghostedit.util.cancelEvent(r);break;case 73:if(r.ctrlKey&&!r.shiftKey)return ghostedit.textblock.format.italic(),ghostedit.util.cancelEvent(r);break;case 85:if(r.ctrlKey)return ghostedit.textblock.format.underline(),ghostedit.util.cancelEvent(r);break;case 90:if(r.ctrlKey)return ghostedit.history.undo(),ghostedit.util.cancelEvent(r);break;case 89:if(r.ctrlKey)return ghostedit.history.redo(),ghostedit.util.cancelEvent(r)}s=ghostedit.selection.getContainingGhostBlock();for(;;){o=s.getAttribute("data-ghostedit-handler"),u=ghostedit.plugins[o].ghostevent("keydown",s,"self",{keycode:i,event:r});if(u===!0)break;s=ghostedit.dom.getParentGhostBlock(s);if(!s)break}return ghostedit.selection.save(),!0},n.keypress=function(r,i){var s,o,u,a,f,l;ghostedit.selection.save(),f=ghostedit.editdiv.innerHTML.length,l=ghostedit.history.undoData[ghostedit.history.undoPoint]!==t?ghostedit.history.undoData[ghostedit.history.undoPoint].content.string.length:0,i=(!i||!i.istest)&&e.event!=null?e.event:i,s=i.keyCode!=null?i.keyCode:i.charCode,n.trigger("input:keydown",{event:event,keycode:s}),ghostedit.selection.saved.type!=="none"&&!ghostedit.selection.savedRange.isCollapsed()&&!i.ctrlKey&&ghostedit.selection.deleteContents();switch(s){case 8:if(n.cancelKeypress==1)return n.cancelKeypress=!1,ghostedit.util.cancelEvent(i);break;case 13:ghostedit.util.cancelEvent(i)}o=ghostedit.selection.getContainingGhostBlock();for(;;){u=o.getAttribute("data-ghostedit-handler"),a=ghostedit.plugins[u].ghostevent("keypress",o,"self",{keycode:s,event:i});if(a===!0)break;o=ghostedit.dom.getParentGhostBlock(o);if(!o)break}return ghostedit.selection.save(),!0},n.addListener=function(e,t,r){var i,s,o,u;if(typeof t!="function")return!1;i=n.listeners;if(!i[e]||!typeof i[e]==="object"||!(i[e]instanceof Array))i[e]=[];s=n.eventtypes,o=!0;for(u=0;u<s.length;u++)if(s[u]===e){o=!1;break}return o&&s.push(e),n.listenerid++,i[e].push({id:n.listenerid,callback:t,revokekey:r}),n.listenerid},n.removeListener=function(e,t){var r=n.listeners,i,s=[];if(!r[e])return;for(i=0;i<r[e].length;i++)r[e].id!==t&&s.push(r[e][i]);r[e]=s},n.removeAllListeners=function(e){var t,r,i,s,o,u=[];if(!e)return;t=n.listeners,r=n.eventtypes;for(s=0;s<r.length;s++){i=r[s];for(o=0;o<t[i].length;o++)(!t[i][o].revokekey||t[i][o].revokekey!==e)&&u.push(t[i][o]);t[i]=ghostedit.util.cloneObject(u),u=[]}},n.trigger=function(e,r){var i=n.listeners,s;r===t&&(r={});if(!i[e]||!typeof i[e]==="object"||!(i[e]instanceof Array))return;ghostedit.debug&&(console.log(e),console.log(r));for(s=0;s<i[e].length;s++)i[e][s].callback.call(this,r)},n.sendBackwards=function(e,t,r){var i=!1,s,o,u=!1,a;r||(r={});if(!ghostedit.dom.isGhostBlock(t))return!1;s=t;for(;;){if(i=ghostedit.dom.getPreviousSiblingGhostBlock(s))direction="ahead";else if(i=ghostedit.dom.getParentGhostBlock(s))direction="top";a=n.send(e,i,direction,r);if(!a)return!1;if(a.handled===!0)return!0;s=i}},n.sendForwards=function(e,t,r){var i=!1,s,o,u=!1,a,f;r||(r={});if(!ghostedit.dom.isGhostBlock(t))return!1;s=t;for(;;){if(i=ghostedit.dom.getNextSiblingGhostBlock(s))f="behind";else if(i=ghostedit.dom.getParentGhostBlock(s))f="bottom";if(!(a=n.send(e,i,f,r)))return!1;if(a.handled===!0)return!0;s=i}},n.send=function(e,t,n,r){var i,s;return t?(i=t.getAttribute("data-ghostedit-handler"),!ghostedit.plugins[i]||!ghostedit.plugins[i].ghostevent?!1:(s=ghostedit.plugins[i].ghostevent(e,t,n,r),{handled:s})):!1},e.ghostedit.event=n}(window),function(e,t){var n={};n.init=function(){n.reset(),ghostedit.event.addListener("selection:change",function(){n.selectionchanged=!0}),ghostedit.api.undo=function(){return n.undo()},ghostedit.api.redo=function(){return n.redo()}},n.reset=function(){n.undoData=[],n.undoPoint=0,n.selectionchanged=!0},n.saveUndoState=function(e){var t=null,r,i,s=ghostedit.editdiv,o,u,a,f="",l="",c,h,p,d,v;e!==!0&&(e=!1),ghostedit.event.trigger("presaveundostate"),u=n.undoPoint,a=n.undoData,v=a[u],v||(e=!0),d={selection:{type:ghostedit.selection.saved.type,data:ghostedit.selection.saved.data},content:{string:s.innerHTML}},e||(h=v.content.string!==d.content.string,p=!ghostedit.selection.isSameAs(v.selection));if(e||p||h)d.content.dom=ghostedit.dom.extractContent(s.cloneNode(!0)),e||h?(u>0&&n.undoData.splice(0,u),n.undoData.unshift(d),n.undoPoint=0):n.undoData[u]=d;ghostedit.event.trigger("postsaveundostate")},n.restoreUndoPoint=function(e){var t=n.undoData,r,i;if(!t[e]||t[e].content.string.length<1)return!1;r=t[e],ghostedit.editdiv.innerHTML="",ghostedit.editdiv.appendChild(ghostedit.dom.cloneContent(r.content.dom)),ghostedit.selection.restore(r.selection.type,r.selection.data),ghostedit.selection.save()},n.undo=function(){var e=n.undoPoint,r=n.undoData,i=ghostedit.editdiv,s,o;r[e+1]!==t&&r[e+1].content.string.length>0&&(ghostedit.event.trigger("preundo"),r[e].content.string!==i.innerHTML?(n.saveUndoState(),e=1):(e===0&&n.saveUndoState(),e=n.undoPoint,e+=1),n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=r,ghostedit.event.trigger("postundo"))},n.redo=function(){var e=n.undoPoint,r=n.undoData,i=ghostedit.editdiv,s,o;e>0&&r[e-1]!==t&&r[e-1].content.string.length>0&&(ghostedit.event.trigger("preredo"),r[e].content.string!==i.innerHTML?n.saveUndoState(!0):(e-=1,n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=r),ghostedit.event.trigger("postredo"))},e.ghostedit.history=n}(window),function(e,t){e.ghostedit.init=function(e,t){typeof e=="string"&&(e=document.getElementById(e));var n,r,i,s,o,u,a,f,l,c,h,p,d=!1,v,m,g;ghostedit.options={},ghostedit.options=t||{},ghostedit.options.debug&&(ghostedit.debug=!0),ghostedit.browserEngine=ghostedit.util.detectEngines(),ghostedit.useMozBr=ghostedit.browserEngine.gecko!==0||ghostedit.browserEngine.webkit!==0||ghostedit.browserEngine.opera!==0,e.style.display="none",ghostedit.sourceelem=e,n=document.createElement("div"),n.className="ghostedit_wrapper",e.parentNode.insertBefore(n,e),ghostedit.wrapdiv=n,r=document.createElement("div"),r.id="ghostedit_workspace",r.className="ghostedit_workspace",n.appendChild(r),ghostedit.workspace=r,i=document.createElement("div"),i.id="ghostedit_uilayer",i.className="ghostedit_uilayer",i.innerHTML="<span style='position: absolute; display: none;left: 0; top: 0;line-height: 0'>ie bug fix</span>",r.appendChild(i),ghostedit.contextuallayer=i,ghostedit.history.init(),ghostedit.inout.init(),ghostedit.clipboard.init(),ghostedit.options.plugins=ghostedit.options.plugins||[],ghostedit.options.plugins.unshift("container","textblock");if(ghostedit.options.plugins)for(u=0;u<ghostedit.options.plugins.length;u++)ghostedit.api.plugin.enable(ghostedit.options.plugins[u]);ghostedit.event.trigger("init"),ghostedit.editdiv=ghostedit.inout.importHTML(ghostedit.sourceelem),r.appendChild(ghostedit.editdiv),g=ghostedit.editdiv.getAttribute("data-ghostedit-handler"),ghostedit.plugins[g].focus(ghostedit.editdiv);try{document.execCommand("styleWithCSS",!1,!1)}catch(y){}try{document.execCommand("enableObjectResizing",!1,!1)}catch(y){}ghostedit.selection.save(),ghostedit.history.reset(),ghostedit.history.saveUndoState(),v=document.getElementsByTagName("html")[0],ghostedit.util.addEvent(v,"dragenter",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"dragleave",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"dragover",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"drop",ghostedit.util.cancelEvent),ghostedit.util.addEvent(n,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(ghostedit.editdiv,"click",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"mouseup",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"keyup",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"keydown",function(e){ghostedit.event.keydown(this,e)}),ghostedit.util.addEvent(ghostedit.editdiv,"keypress",function(e){ghostedit.event.keypress(this,e)}),ghostedit.util.addEvent(ghostedit.editdiv,"dragenter",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"dragleave",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"dragover",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"drop",ghostedit.util.cancelEvent),ghostedit.event.addListener("ui:newcontext",function(e){ghostedit.uicontext=e.context}),ghostedit.editdiv.focus(),ghostedit.plugins.container.focus(ghostedit.editdiv),ghostedit.event.trigger("init:after")};var n=function(){ghostedit.active&&(ghostedit.active=!1,ghostedit.sourceelem.innerHTML=ghostedit.inout.exportHTML().full,ghostedit.wrapdiv.parentNode.removeChild(ghostedit.wrapdiv),ghostedit.selection.savedRange=null,ghostedit.selection.saved={type:"none",data:null},ghostedit.image.focusedimage=null,ghostedit.blockElemId=0,ghostedit.imgElemId=0,ghostedit.sourceelem.style.display="block",ghostedit.options.resetcallback&&ghostedit.options.resetcallback())}}(window),function(e,t){var n={};n.init=function(){n.reset(),ghostedit.event.addListener("selection:change",function(){ghostedit.history.selectionchanged=!0}),ghostedit.api.importHTML=function(e){return n.importHTML(e)},ghostedit.api.exportHTML=function(){return n.exportHTML()}},n.reset=function(){n.importhandlers=[]},n.importHTML=function(e){var t,n,r,i;return!e||e.childNodes.length<1?!1:(i=ghostedit.plugins.container.inout.importHTML(e),i.className="ghostedit_editdiv",i.setAttribute("data-ghostedit-isrootnode","true"),i.contentEditable="true",ghostedit.event.trigger("import:after",{editdiv:i}),i)},n.exportHTML=function(){var e=ghostedit.editdiv,t=0,n,r,i,s,o,u,a;return ghostedit.event.trigger("export:before"),e.contentEditable=!1,a=ghostedit.plugins.container.inout.exportHTML(e,!1),e.contentEditable=!0,ghostedit.event.trigger("export:after"),a},n.openPreview=function(){e.open(ghostedit.options.previewurl)},n.registerimporthandler=function(e){var t,r,i,s,o;if(typeof e!="function")return!1;if(arguments.length<2)return!1;i=Array.prototype.slice.call(arguments),i.shift();for(t=0;t<i.length;t++)s=i[t],n.importhandlers[s]=e},e.ghostedit.inout=n}(window),function(e,t){var n={};n.register=function(e,t){return ghostedit.plugins[e]?!1:(ghostedit.plugins[e]=t,!0)},n.enable=function(e){if(!ghostedit.plugins[e])return!1;ghostedit.enabledplugins[e]&&n.disable(e);var t=ghostedit.plugins[e];typeof t.enable=="function"&&t.enable(),ghostedit.enabledplugins[e]=!0},n.disable=function(e){if(!ghostedit.enabledplugins[e]||!ghostedit.plugins[e])return!1;var t=ghostedit.plugins[e];typeof t.disable=="function"&&t.disable(),ghostedit.enabledplugins[e]=!1},e.ghostedit.api.plugin=n}(window),function(e,t){var n={savedRange:null,nodepath:[],saved:{type:"none",data:null},archived:{type:"none",data:null}};n.save=function(e){var t;return e!==!1&&(e=!0),t=lasso().setToSelection(),n.isInEditdiv(t.getStartNode())?(n.saved.type="textblock",n.saved.data=t,n.savedRange=n.saved.data,ghostedit.event.trigger("selection:change"),n.updatePathInfo(),e&&ghostedit.event.trigger("ui:update"),!0):(n.saved.type="none",!1)},n.restore=function(e,t,r){if(!e||typeof e!="string")e=n.saved.type;t||(t=n.saved.data),e==="none"&&r&&(e=n.archived.type,t=n.archived.data);if(e==="none")return n.clear(),!0;if(ghostedit.plugins[e]&&ghostedit.plugins[e].selection.restore)return ghostedit.plugins[e].selection.restore(t)?!0:(n.clear(),!1)},n.restoreValid=function(e,t){return n.restore(e,t,!0)},n.deleteContents=function(e){e!=="collapsetostart"&&e!=="collapsetoend"&&(e=!1);var t,r,i;i=n.getContainingGhostBlock();for(;;){t=i.getAttribute("data-ghostedit-handler"),r=ghostedit.plugins[t].selection.deleteContents(i,e);if(r===!0)break;i=ghostedit.dom.getParentGhostBlock(i);if(!i)break}switch(e){case"collapsetostart":lasso().setToSelection().collapseToStart().select();break;case"collapsetoend":lasso().setToSelection().collapseToEnd().select()}n.save()},n.isSameAs=function(e){return!e||!e.type?!1:e.type!==n.saved.type?!1:e.type==="none"?!0:ghostedit.plugins[e.type]&&ghostedit.plugins[e.type].selection.compare?ghostedit.plugins[e.type].selection.compare(e.data,n.saved.data):!1},n.clear=function(){lasso().clearSelection(),n.saved={type:"none",data:null}},n.isInEditdiv=function(e){var e,t;if(e.nodeType!=1||e.getAttribute("data-ghostedit-isrootnode")!="true")while(e.nodeType!=1||e.getAttribute("data-ghostedit-isrootnode")!="true"){if(e==null)return!1;e=e.parentNode;if(e==null)return!1}return!0},n.updatePathInfo=function(e){var t=!1,r=!1,i=!1,s=!1,o,u;e||(e=n.savedRange.getParentNode()),n.nodepath=[];if(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!="true")while(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!="true"){if(e==null)return null;e.nodeType==1&&n.nodepath.push(e),e=e.parentNode;if(e==null)return!1}e&&e.getAttribute("data-ghostedit-isrootnode")=="true"&&n.nodepath.push(e)},n.getContainingGhostBlock=function(){var e=n.savedRange.getParentNode();if(!e)return!1;while(!ghostedit.dom.isGhostBlock(e)){e=e.parentNode;if(e==null)return!1}return e},e.ghostedit.selection=n}(window),function(e,t){var n={};n.enable=function(){return n.format.init(),ghostedit.inout.registerimporthandler(n.inout.importHTML,"p","h1","h2","h3","h4","h5","h6"),ghostedit.inout.registerimporthandler(n.inout.importHTML,"#textnode","b","strong","i","em","u","strike","span"),ghostedit.event.addListener("postsaveundostate",function(){ghostedit.selection.saved.type==="textblock"&&ghostedit.selection.saved.data.bookmarkify(ghostedit.editdiv)}),ghostedit.event.addListener("postsaveundostate",function(){ghostedit.selection.saved.type==="textblock"&&(ghostedit.selection.saved.data=ghostedit.selection.saved.data.clone())}),ghostedit.event.addListener("selection:change",function(){var e;for(i=0;i<ghostedit.selection.nodepath.length;i++)e=ghostedit.selection.nodepath[i],n.isTextBlock(e)&&ghostedit.event.trigger("ui:newcontext",{context:"textblock"})}),ghostedit.api.insert=ghostedit.api.insert||{},ghostedit.api.insert.character=function(e){return n.insert.character(e)},ghostedit.api.insert.br=function(){return n.insert.br},!0},n.ghostevent=function(e,t,r,i){var s=!1,o,u=!1;switch(e){case"delete":return n.event.textdelete(t,r,i);case"keydown":switch(i.keycode){case 8:return n.event.backspace(t,i.event);case 46:return n.event.deletekey(t,i.event)}break;case"keypress":switch(i.keycode){case 13:return n.event.enterkey(t,i.event)}}},n.event={textdelete:function(e,t,r){var i,s;switch(t){case"ahead":return ghostedit.history.saveUndoState(),n.isEmpty(e)?(i=ghostedit.dom.getParentGhostBlock(e),s=i.getAttribute("data-ghostedit-handler"),ghostedit.plugins[s].dom.removechild(i,e)):(e.innerHTML+="<span id='ghostedit_selection_marker'>&#x200b;</span>",r.merge&&r.merge.sourcecontent&&(r.merge.contenttype==="inlinehtml"||r.merge.contenttype==="text")&&(e.innerHTML+=r.merge.sourcecontent),n.mozBrs.tidy(e),r.merge.callback(),lasso().selectNode("ghostedit_selection_marker").select(),document.getElementById("ghostedit_selection_marker").parentNode.removeChild(document.getElementById("ghostedit_selection_marker")),ghostedit.selection.save()),ghostedit.history.saveUndoState(!0),!0;case"behind":var o=ghostedit.selection.getContainingGhostBlock(),r={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:ghostedit.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");ghostedit.plugins[n].dom.removechild(t,e)},!1,e)}};return ghostedit.event.sendBackwards("delete",e,r),!0}},backspace:function(e,t){if(n.selection.isAtStartOftextblock()!==!0)return!0;var r={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:ghostedit.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");ghostedit.plugins[n].dom.removechild(t,e)},!1,e)}};return ghostedit.event.sendBackwards("delete",e,r),ghostedit.event.cancelKeypress=!0,ghostedit.util.cancelEvent(t),!0},deletekey:function(e,t){return n.selection.isAtEndOftextblock()!==!0?!0:(ghostedit.event.sendForwards("delete",e),ghostedit.event.cancelKeypress=!0,ghostedit.util.cancelEvent(t),!0)},enterkey:function(e,t){var r;return ghostedit.history.saveUndoState(),t.shiftKey?(n.format.insert.br(),n.mozBrs.tidy(e)):n.split(e),ghostedit.history.saveUndoState(!0),ghostedit.util.cancelEvent(t),!0}},n.selection={compare:function(e,t){return!e||!e.isEqualTo?!1:e.isEqualTo(t)},restore:function(e){return!e||!e.unbookmarkify?!1:(e.unbookmarkify(ghostedit.editdiv),e.select(),!0)},deleteContents:function(e){var t,n,r;return r=ghostedit.selection.savedRange.clone(),t=lasso().setCaretToStart(e),n=lasso().setCaretToEnd(e),r.compareEndPoints("StartToStart",t)===-1&&r.setStartToRangeStart(t),r.compareEndPoints("EndToEnd",n)===1&&r.setEndToRangeEnd(n),r.deleteContents(),!0},getTextBlockNode:function(e){if(e.nodeType!=1||e.getAttribute("data-ghostedit-elemtype")!="textblock")while(e.nodeType!=1||e.getAttribute("data-ghostedit-elemtype")!="textblock"){e=e.parentNode;if(e==null)return!1}return e},getStartTextBlockNode:function(){return n.selection.getTextBlockNode(ghostedit.selection.savedRange.getStartNode())},getEndTextBlockNode:function(){return n.selection.getTextBlockNode(ghostedit.selection.savedRange.getEndNode())},isAtStartOftextblock:function(){var e=!1,t,r,i,s,o,u,a,f,l,c;if(document.createRange){ghostedit.selection.savedRange.isCollapsed()&&ghostedit.selection.savedRange.getNative().startOffset==0&&(e=!0,t=ghostedit.selection.savedRange.getStartNode());if(!t)return e;while(t.nodeType!==1||t.getAttribute("data-ghostedit-elemtype")!=="textblock"){if(t!==t.parentNode.childNodes[0]){u=!1;if(t.parentNode.childNodes[0].nodeType===3&&t.parentNode.childNodes[0].length===0||t.parentNode.childNodes[0].nodeType===1&&t.parentNode.childNodes[0].className==="moz_dirty")for(o=1;o<t.parentNode.childNodes.length;o+=1){if(t==t.parentNode.childNodes[o]){u=!0;break}if((t.parentNode.childNodes[0].nodeType!==3||t.parentNode.childNodes[0].length!==0)&&(t.parentNode.childNodes[0].nodeType!==1||t.parentNode.childNodes[0].className!=="moz_dirty"))break}if(u!==!0){e=!1;break}}t=t.parentNode}}else document.selection&&(i=ghostedit.selection.savedRange.clone().bookmarkify(),l=n.selection.getStartTextBlockNode(),c=lasso().selectNodeContents(l),i.unbookmarkify(),c.getHTML()===c.setStartToRangeStart(i).getHTML()&&(e=!0),ghostedit.selection.savedRange=i.select());return e},isAtEndOftextblock:function(){var e=!1,t,r,i,s,o,u,a,f,l,c,a,h,p,d;return ghostedit.selection.savedRange.isCollapsed()?(c=n.selection.getEndTextBlockNode(),document.createRange?(f=document.createElement("div"),f.appendChild(ghostedit.selection.savedRange.getNative().cloneContents()),i=ghostedit.selection.savedRange.getNative(),i.setEnd(c,c.childNodes.length),l=document.createElement("div"),f.appendChild(i.cloneContents()),n.mozBrs.clear(f),n.mozBrs.clear(l),f.innerHTML==l.innerHTML&&(e=!0)):document.selection&&(r=ghostedit.selection.savedRange.clone().bookmarkify(),c.innerHTML+='<span id="range_marker">&#x200b;</span>',p=lasso().selectNode("range_marker"),document.getElementById("range_marker").parentNode.removeChild(document.getElementById("range_marker")),r.unbookmarkify(),r.compareEndPoints("EndToEnd",p)===0&&(e=!0),ghostedit.selection.savedRange=r.select()),e):!1},extendtoword:function(e,t){var r,i;e=e.clone().getNative();if(document.createRange){r=n.selection.findwordstart(e.startContainer,e.startOffset),i=n.selection.findwordend(e.endContainer,e.endOffset);if(t){if(e.startContainer==r.node&&e.startOffset==r.offset)return e;if(e.endContainer==i.node&&e.endOffset==i.offset)return e}e.setStart(r.node,r.offset),e.setEnd(i.node,i.offset)}else e.expand("word"),e.htmlText.split().reverse()[0]==" "&&e.moveEnd("character",-1);return lasso().setFromNative(e)},findwordstart:function(e,t){var r,i,s,o,u,a,f=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){s=e.nodeValue.substring(0,t),o=s.search(f);if(o!==-1){u=o+1;while((o=s.substring(u).search(f))!==-1)u+=o+1;return{node:e,offset:u}}}else if(e.nodeType===1&&t>0)return n.selection.findwordstart(e.childNodes[t-1],e.childNodes[t-1].length);if(e.nodeType===1&&e.getAttribute("data-ghostedit-elemtype")=="textblock")return{node:e,offset:t};if(!(a=e.previousSibling))return n.selection.findwordstart(e.parentNode,ghostedit.dom.getNodeOffset(e));if(a.nodeType===3)return n.selection.findwordstart(a,a.nodeValue.length);if(a.nodeType===1)return n.selection.findwordstart(a,a.childNodes.length)},findwordend:function(e,t){var r,i,s,o,u,a,f=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){s=e.nodeValue.substring(t),o=s.search(f);if(o!==-1)return u=t+o,{node:e,offset:u}}else if(e.nodeType===1&&t<e.childNodes.length)return n.selection.findwordend(e.childNodes[t],0);return e.className&&e.getAttribute("data-ghostedit-elemtype")=="textblock"?{node:e,offset:t}:(nextnode=e.nextSibling)?n.selection.findwordend(nextnode,0):n.selection.findwordend(e.parentNode,ghostedit.dom.getNodeOffset(e)+1)}},n.inout={handledtags:{h1:"block",h2:"block",h3:"block",h4:"block",h5:"block",h6:"block",p:"block",b:"child",i:"child",u:"child",strong:"child",em:"child",strike:"child",br:"child",a:"contents",span:"contents"},parserules:{textnode:{clean:!0},tags:{h1:"textblock",h2:"textblock",h3:"textblock",h4:"textblock",h5:"textblock",h6:"textblock",p:"textblock",b:{},i:{},u:{},strong:{},em:{},strike:{},br:{attributes:[{name:"class",allowedvalues:["moz_dirty"]}]}},templates:{textblock:{attributes:["class"],styles:[{name:"textAlign",allowedvalues:["left","right","center","justified"]},{name:"clear",allowedvalues:["left","right"]}]}}},importHTML:function(e){var t,r,i,s,o,u;nodetype=n.inout.isHandleableNode(e);switch(nodetype){case"block":return r=e.tagName.toLowerCase(),t=ghostedit.dom.parse(e,n.inout.parserules),ghostedit.blockElemId+=1,t.id="ghostedit_textblock_"+ghostedit.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","textblock"),t.setAttribute("data-ghostedit-handler","textblock"),t.ondragenter=function(){return!1},t.ondragleave=function(){return!1},t.ondragover=function(){return!1},t.ondrop=function(e){elemid=e.dataTransfer.getData("Text")||e.srcElement.id,elem=document.getElementById(elemid),elem.parentNode.insertBefore(elem,this),ghostedit.image.focus(elem)},t.onresizestart=function(e){return ghostedit.util.cancelEvent(e)},n.mozBrs.tidy(t),t;case"child":case"contents":case"text":t=n.create("p"),t.setAttribute("data-ghostedit-importinfo","wasinline"),s=0,i=e;do parsednode=ghostedit.dom.parse(i,n.inout.parserules),parsednode&&(s+=1,t.appendChild(parsednode),o=i,i=i.nextSibling,s>1&&o.parentNode.removeChild(o));while(n.inout.isHandleableNode(i)&&n.inout.isHandleableNode(i)!=="block");return n.mozBrs.tidy(t),s>0?t:!1}return!1},exportHTML:function(e){if(!e||!ghostedit.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="textblock")return!1;var t="",r="",i;return i=e,n.mozBrs.clear(i),t+="<"+i.tagName.toLowerCase(),i.style.textAlign!=""&&(r+="text-align:"+i.style.textAlign+";"),i.style.clear!=""&&(r+="clear:"+i.style.clear+";"),r.length>0&&(t+=" style='"+r+"'"),i.className.length>0&&!/ghostedit/.test(i.className)&&(t+=" class='"+i.className+"'"),t+=">",t+=i.innerHTML,t+="</"+i.tagName.toLowerCase()+">",n.mozBrs.tidy(i),{content:t}},isHandleableNode:function(e){var t,r,i,s;return!e||!e.nodeType?!1:e.nodeType===3?e.nodeValue.replace(/[\n\r\t]/g,"").length>0?"text":!1:e.nodeType!==1?!1:e.getAttribute("data-ghostedit-elemtype")==="textblock"?"block":ghostedit.dom.isGhostBlock(e)?!1:(i=e.tagName.toLowerCase(),n.inout.handledtags[i]?n.inout.handledtags[i]:!1)},parse:function(e){var t=!1,r,i,s,o,u;if(!e||!e.nodeType)return!1;s=n.inout.isHandleableNode(e);switch(s){case"text":return u=e.nodeValue.replace(/[\n\r\t]/g,""),u.length>0?document.createTextNode(u):!1;case"block":case"child":t=document.createElement(e.tagName.toLowerCase());case"contents":default:t=t||document.createDocumentFragment(),r=e.childNodes;for(o=0;o<r.length;o++)(i=n.inout.parse(r[o]))&&t.appendChild(i);return t}return!1}},n.paste={handle:function(e,t,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isGhostBlock(t))return;return console.log(r),r.isfirst?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (first):"),n.mozBrs.clear(t),lasso().removeDOMmarkers("ghostedit_paste_start"),t.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t1'>&#x200b;</span>",document.createRange?ghostedit.selection.saved.data.collapseToStart().getNative().insertNode(ghostedit.dom.extractContent(t)):ghostedit.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:r.islast?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (last-noncollapsed):"),n.mozBrs.clear(t),lasso().removeDOMmarkers("ghostedit_paste_end"),t.innerHTML+="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>",document.createRange?ghostedit.selection.saved.data.collapseToStart().getNative().insertNode(ghostedit.dom.extractContent(t)):ghostedit.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:(n.mozBrs.clear(t),console.log("HEYHEYHEY"),ghostedit.selection.saved.data.collapseToStart().select(),lasso().removeDOMmarkers("ghostedit_paste_start"),p=n.split(e),p.block1.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t2'>&#x200b;</span>",n.mozBrs.tidy(p.block1),lasso().removeDOMmarkers("ghostedit_paste_end"),p.block2.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+p.block2.innerHTML,n.mozBrs.tidy(p.block2),!1)},clean:function(e){var t,r,s,o;if(!e||!e.nodeType)return!1;if(!e.childNodes)return e;s=document.createDocumentFragment();for(i=0;i<e.childNodes.length;i++)(o=n.paste.cleanChild(e.childNodes[i]))&&s.appendChild(o);return e=e.cloneNode(!1),e.appendChild(s),e},cleanNode:function(e){var t,r,s,o;if(!e||!e.nodeType)return!1;o=n.paste.isHandleableNode(e);switch(o){case"text":return e.nodeValue=e.nodeValue.replace(/[\n\r\t]/g,""),e;case"child":case"contents":t=o==="child"?e.cloneNode(!1):document.createDocumentFragment(),r=e.childNodes;for(i=0;i<r.length;i++)(s=n.paste.cleanNode(r[i]))&&t.appendChild(s);return t}return!1}},n.isTextBlock=function(e){return ghostedit.dom.isGhostBlock(e)?e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:!0:!1},n.isEmpty=function(e){var n,r,i,s;n=e.innerText||e.textContent;if(n&&n.length>1)return!1;i=e.getElementsByTagName("br"),r=e.getElementsByTagName("img");if(i.length===0&&r.length===0)return!0;for(s=0;s<i.length;s+=1)if(i[s].MozDirty===t&&!/moz_dirty/.test(i[s].className))return!1;return!0},n.isFirst=function(e){var t,n;t=ghostedit.editdiv;for(n=0;n<t.getElementsByTagName("*").length;n+=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.isLast=function(e){var t,n;t=ghostedit.editdiv;for(n=t.getElementsByTagName("*").length-1;n>0;n-=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.count=function(){var e,t,n;e=ghostedit.editdiv,t=0;for(n=0;n<e.getElementsByTagName("*").length;n+=1)e.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock"&&(t+=1);return t},n.create=function(e,t,r){var i;return r||(ghostedit.blockElemId+=1,r="ghostedit_textblock_"+ghostedit.blockElemId),t=t&&(t.length&&t.length>0||t.nodeType)?t:"",i=document.createElement(e),i.id=r,t.nodeType?(t=ghostedit.dom.parse(t,{textnode:{clean:!0},tags:{b:{},i:{},u:{},strong:{},em:{},strike:{},br:{}}}),t&&i.appendChild(t)):i.innerHTML=t,i.setAttribute("data-ghostedit-iselem","true"),i.setAttribute("data-ghostedit-elemtype","textblock"),i.setAttribute("data-ghostedit-handler","textblock"),i.ondragenter=function(){return!1},i.ondragleave=function(){return!1},i.ondragover=function(){return!1},i.ondrop=function(e){elemid=e.dataTransfer.getData("Text")||e.srcElement.id,elem=document.getElementById(elemid),elem.parentNode.insertBefore(elem,this),ghostedit.image.focus(elem)},i.onresizestart=function(e){return ghostedit.util.cancelEvent(e)},n.mozBrs.tidy(i),i},n.remove=function(e){var t,r,i,s,o,u,a,f,l,c;ghostedit.selection.save(),ghostedit.history.saveUndoState(),t="",t=e.innerHTML,r=ghostedit.editdiv,textblockelems=r.getElementsByTagName("*"),o=!1;for(s=textblockelems.length-1;s>=0;s-=1){if(o===!0&&textblockelems[s].getAttribute("data-ghostedit-elemtype")==="textblock"){i=textblockelems[s];break}textblockelems[s]===e&&(o=!0)}if(n.isEmpty(i)){r.removeChild(i),lasso().setCaretToStart(e).select(),ghostedit.selection.save(),ghostedit.history.saveUndoState();return}r.removeChild(e),lasso().setCaretToEnd(i).select(),ghostedit.selection.save(),i.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t,n.mozBrs.tidy(i),lasso().selectNode("ghostedit_marker").deleteContents().select(),document.getElementById("ghostedit_marker")&&document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.focus=function(e){return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:(lasso().setCaretToEnd(e).select(),ghostedit.selection.save(),!0)},n.merge=function(e,t,r){var i,s,o,u;return r===!1?e:e===t?e:(i=e.getAttribute("data-ghostedit-elemtype"),s=t.getAttribute("data-ghostedit-elemtype"),i!=="textblock"||s!=="textblock"?!1:(e.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t.innerHTML,o=t.parentNode,u=o.getAttribute("data-ghostedit-handler"),ghostedit.plugins[u].dom.removechild(o,t),n.mozBrs.tidy(e),lasso().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),e))},n.split=function(e){ghostedit.selection.save();var t,r,i,s,o,u,a,f,l,c;return r=n.selection.isAtStartOftextblock()===!0?!0:!1,i=n.selection.isAtEndOftextblock()===!0?!0:!1,t=r&&!i?"before":"after",s=t=="before"||i?"p":n.selection.getStartTextBlockNode().tagName,n.mozBrs.tidy(e),!r&&!i?document.createRange?(u=lasso().selectNodeContents(e).setStartToRangeStart(ghostedit.selection.savedRange),o=u.getHTML(),u.deleteContents()):document.selection&&(u=lasso().selectNode(e),u.setStartToRangeEnd(ghostedit.selection.savedRange),o=u.getHTML(),u.getNative().text=""):o="",f=n.create(s,o),f?(l=ghostedit.dom.getParentGhostBlock(e),c=l.getAttribute("data-ghostedit-handler"),a=ghostedit.plugins[c].dom.addchild(l,t,e,f,{contentlength:o.length}),a?(f.innerHTML="dummy",lasso().selectNode(f).select(),f.innerHTML=o,n.mozBrs.tidy(f),t==="before"?lasso().setCaretToBlockStart(e).select():lasso().setCaretToBlockStart(f).select(),ghostedit.selection.save(),{block1:t==="before"?f:e,block2:t==="before"?e:f}):!1):!1},n.mozBrs={checkifcontains:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t)return!0;return!1},insert:function(e){var t;t=document.createElement("br"),t.setAttribute("_moz_dirty",""),t.className="moz_dirty",e.appendChild(t)},clear:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t||/moz_dirty/.test(n[r].className))n[r].parentNode.removeChild(n[r]),r--},tidy:function(e){n.mozBrs.clear(e),ghostedit.useMozBr&&n.mozBrs.insert(e)}},n.insert={character:function(e){ghostedit.selection.saved.type==="textblock"&&(ghostedit.selection.restore(),ghostedit.selection.savedRange.pasteText(e))},br:function(){var t,n,r;e.getSelection?(t=e.getSelection(),t.getRangeAt(0).collapse(!1),n=document.createElement("br"),n.id="newBr",t.getRangeAt(0).insertNode(n),t.getRangeAt(0).selectNode(n.parentNode),r=document.createRange(),r.setStartAfter(n),r.setEndAfter(n),t.removeAllRanges(),t.addRange(r),document.getElementById("newBr").removeAttribute("id")):document.selection&&(r=document.selection.createRange(),r.collapse(!1),r.pasteHTML("<br id='newBr' />"),r.moveToElementText(document.getElementById("newBr")),r.collapse(!1),r.select(),document.getElementById("newBr").removeAttribute("id"))}},n.format={init:function(){ghostedit.api.format=ghostedit.api.format||{},ghostedit.api.format.setStyle=function(e,t){n.format.formatSelected(n.format.setTagType,{tagname:e,newclass:t})},ghostedit.api.format.alignText=function(e){if(!/left|right|center|justify/.test(e))return!1;document.getElementById("align"+e+"Button").className="current",n.format.formatSelected(n.format.alignText,{alignDirection:e})},ghostedit.api.format.bold=function(){n.format.formatSelected(n.format.bold)},ghostedit.api.format.italic=function(){n.format.formatSelected(n.format.italic)},ghostedit.api.format.underline=function(){n.format.formatSelected(n.format.underline)},ghostedit.api.format.strikethrough=function(){n.format.formatSelected(n.format.strikethrough)},ghostedit.api.format.textColor=function(e){n.format.formatSelected(n.format.textColor,{color:e})}},useCommand:function(e,t){document.execCommand(e,!1,t)},getNextNode:function(e){if(e.firstChild)return e.firstChild;while(e){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},getNodesInRange:function(e){var t=e.getStartNode(),r=e.getEndNode(),i=e.getParentNode(),s=[],o;for(o=t.parentNode;o;o=o.parentNode){s.push(o);if(o==i)break}s.reverse();for(o=t;o;o=n.format.getNextNode(o)){s.push(o);if(o==r)break}return s},useCommandOnWord:function(e){var t,r;ghostedit.selection.savedRange.isCollapsed()&&n.selection.getStartTextBlockNode()&&(t=ghostedit.selection.savedRange.clone(),document.createRange&&(r=document.createElement("span"),r.id="ghostedit_marker",t.getNative().insertNode(r)),!document.createRange&&document.selection&&t.getNative().pasteHTML("<span id='ghostedit_marker'>z</span>"),t.selectNode("ghostedit_marker"),t=n.selection.extendtoword(t,!0),t.select()),n.format.useCommand(e),document.getElementById("ghostedit_marker")&&(lasso().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker"))),ghostedit.selection.save()},bold:function(e){n.format.useCommand("bold")},italic:function(){n.format.useCommand("italic")},underline:function(){n.format.useCommand("underline")},strikethrough:function(){n.format.useCommand("strikethrough")},textColor:function(e){n.format.useCommand("foreColor",e)},formatSelected:function(e,t){ghostedit.selection.save(),ghostedit.history.saveUndoState();var r,i,s,o,u,a,f,l;i=n.selection.getStartTextBlockNode(),s=n.selection.getEndTextBlockNode();if(i&&s){r=i,a=!1;do{if(r===ghostedit.editdiv||r===null)break;if(n.isTextBlock(r)){r===s&&(a=!0),r=n.format.formatTextBlock(r,ghostedit.selection.saved.data.clone(),e,t);if(a)break;r=r.nextSibling?r.nextSibling:r.parentNode;continue}if(ghostedit.dom.isDescendant(r,s)){r=ghostedit.dom.getFirstChildElement(r);continue}u=r,r=r.nextSibling?r.nextSibling:r.parentNode,descendantblocks=u.getElementsByTagName("*");for(f=0;f<descendantblocks.length;f+=1)n.isTextBlock(descendantblocks[f])&&n.format.formatTextBlock(descendantblocks[f],ghostedit.selection.saved.data.clone(),e,t)}while(!0);ghostedit.selection.save(),ghostedit.history.saveUndoState()}ghostedit.history.saveUndoState()},formatTextBlock:function(e,n,r,i){var s,o,u,a;return i||(i={}),i.textblock=e,n=n.clone(),s=lasso().setCaretToStart(e),o=lasso().setCaretToEnd(e),n.compareEndPoints("EndToStart",s)===-1||n.compareEndPoints("StartToEnd",o)===1?!1:(n.compareEndPoints("StartToStart",s)===-1&&n.setStartToRangeStart(s),n.compareEndPoints("EndToEnd",o)===1&&n.setEndToRangeEnd(o),ghostedit.selection.saved.data.clone().saveToDOM("ghostedit_format"),n.select(),a=r(i),lasso().restoreFromDOM("ghostedit_format").select(),ghostedit.selection.save(),a&&a.nodeType!==t?a:e)},alignText:function(e){var t=lasso().setToSelection().getParentElement();while(!ghostedit.dom.isGhostBlock(t)){t=t.parentNode;if(t==null)return!1}if(!n.isTextBlock(t))return!1;t.style.textAlign=e.alignDirection},setTagType:function(e){var r,i,s,o,u,a,f;return r=e.textblock,i=e.tagname,s=e.newclass,n.isTextBlock(r)?(a="ghostedit_textblock_"+r.id.replace("ghostedit_textblock_",""),f=n.create(i),f.appendChild(ghostedit.dom.extractContent(r)),n.mozBrs.tidy(f),f.setAttribute("style",r.getAttribute("style")),s!==t&&(f.className=s),o=r.parentNode,r.id="",o.insertBefore(f,r),o.removeChild(r),f.id=a,f):!1}},ghostedit.api.plugin.register("textblock",n)}(window),function(e,t){var n={};n.trim=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},n.preparefunction=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var r=n.concat(Array.prototype.slice.call(arguments));return e.apply(t?t:this,r)}},n.isFunction=function(e){return e?typeof e!="function"?!1:!0:!1},n.cloneObject=function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){var t=[],r,i;for(i=0,r=e.length;i<r;++i)t[i]=n.cloneObject(e[i]);return t}if(e instanceof Object){var t={},s;for(s in e)e.hasOwnProperty(s)&&(t[s]=n.cloneObject(e[s]));return t}},n.addClass=function(e,t){e.className=n.trim(e.className)+" "+t},n.removeClass=function(e,t){var r=new RegExp(t,"g");e.className=n.trim(e.className.replace(r,""))},n.cancelEvent=function(e){return e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):e&&(e.returnValue=!1),!1},n.cancelAllEvents=function(t){return t&&t.preventDefault?(t.stopPropagation(),t.preventDefault()):e.event&&(e.event.cancelBubble=!0),!1},n.preventDefault=function(e){return e&&e.preventDefault&&e.preventDefault(),!1},n.preventBubble=function(t){t&&t.preventDefault&&t.stopPropagation(),e.event.cancelBubble=!0},n.addEvent=function(e,n,r){e.addEventListener!==t?e.addEventListener(n,r,!1):e.attachEvent("on"+n,r)},n.removeEvent=function(e,n,r){e.removeEventListener!==t?e.removeEventListener(n,r,!1):e.detachEvent("on"+n,r)},n.ajax=function(t,n,r,i,s){function l(){if(e.XMLHttpRequest&&(e.location.protocol!=="file:"||!e.ActiveXObject))return new e.XMLHttpRequest;try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){try{return new e.ActiveXObject("MSXML2.XMLHTTP")}catch(t){return!1}}}var n,o,u,a,f;if(!t||!n)return!1;if(!(f=l()))return!1;n=n.toUpperCase(),o=+(new Date),u,t.indexOf("?")!=-1?t.indexOf("?")==t.length-1?u="":u="&":u="?",n==="GET"?f.open(n,t+u+o+"&IsAjaxRequest=true&ajax=true&"+r,!0):f.open(n,t+u+o+"&IsAjaxRequest=true&ajax=true",!0),f.onreadystatechange=function(){if(f.readyState==4)return f.status=="200"?(a=s=="xml"?f.responseXML:f.responseText,i!=null&&i(!0,a),!0):(i!=null&&i(!1,a),!1)},f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r!=null&&n==="POST"?f.send(r):f.send()},n.detectEngines=function(){var t={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:null},n=navigator.userAgent;return e.opera?(t.ver=e.opera.version(),t.opera=parseFloat(t.ver)):/AppleWebKit\/(\S+)/.test(n)?(t.ver=RegExp.$1,t.webkit=parseFloat(t.ver)):/KHTML\/(\S+)/.test(n)||/Konqueror\/([^;]+)/.test(n)?(t.ver=RegExp.$1,t.khtml=parseFloat(t.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(n)?(t.ver=RegExp.$1,t.gecko=parseFloat(t.ver)):/MSIE ([^;]+)/.test(n)&&(t.ver=RegExp.$1,t.ie=parseFloat(t.ver)),t},e.ghostedit.util=n}(window);