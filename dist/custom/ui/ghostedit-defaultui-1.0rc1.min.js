/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2012 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0rc1
Release Date:      2012-12-13
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/
(function(){var e={aelem:!1,context:null,elemInEnglish:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",p:"Paragraph",div:"Generic Box",a:"Link",b:"Bold",strong:"Bold",i:"Italic",em:"Italic",u:"Underline",img:"Image",ul:"Bulletted list",ol:"Numbered list",li:"List Item",strike:"Strikethrough"},definition:{quickbuttons:[{label:"Save",icon:"save16.png",action:function(){ghostedit.api.save()}},{label:"Undo",icon:"undo16.png",action:function(){ghostedit.api.undo()}},{label:"Redo",icon:"redo16.png",action:function(){ghostedit.api.redo()}}],tabs:[{name:"textblock",label:"Format",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"bold",label:"Bold",icon:"format-bold.png",highlighttest:function(e){return e==="b"||e==="strong"},action:function(){ghostedit.api.format.bold()}},{type:"button",id:"italic",label:"Italic",icon:"format-italic.png",highlighttest:function(e){return e==="i"||e=="em"},action:function(){ghostedit.api.format.italic()}},{type:"button",id:"underline",label:"Underline",icon:"format-underline.png",highlighttest:function(e){return e==="u"},action:function(){ghostedit.api.format.underline()}},{type:"button",id:"strikethrough",label:"Strikethrough",icon:"format-strikethrough.png",highlighttest:function(e){return e==="strike"},action:function(){ghostedit.api.format.strikethrough()}},{type:"br"},{type:"button",id:"align-left",label:"Align Left",icon:"align-left.png",highlighttest:function(e,t,n){return n.style.textAlign==="left"||n.style.textAlign===""},action:function(){ghostedit.api.format.alignText("left")}},{type:"button",id:"align-center",label:"Align Center",icon:"align-center.png",highlighttest:function(e,t,n){return n.style.textAlign==="center"},action:function(){ghostedit.api.format.alignText("center")}},{type:"button",id:"align-right",label:"Align Right",icon:"align-right.png",highlighttest:function(e,t,n){return n.style.textAlign==="right"},action:function(){ghostedit.api.format.alignText("right")}},{type:"button",id:"align-justify",label:"Justify",icon:"align-justified.png",highlighttest:function(e,t,n){return n.style.textAlign==="justify"},action:function(){ghostedit.api.format.alignText("justify")}}]},{type:"seperator"},{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"list-unordered",label:"Bulleted List",icon:"list-unordered.png",action:function(){ghostedit.api.list.toggle("unordered")}},{type:"button",id:"list-ordered",label:"Numbered List",icon:"list-ordered.png",action:function(){ghostedit.api.list.toggle("ordered")}}]},{type:"seperator"},{type:"group",contents:[{type:"stylebox",label:"Paragraph",tagname:"p"},{type:"stylebox",label:"LeadPara",tagname:"p",classname:"LeadingParagraph"},{type:"stylebox",label:"Heading 1",tagname:"h1"},{type:"stylebox",label:"Heading 2",tagname:"h2"},{type:"stylebox",label:"Heading 3",tagname:"h3"}]}]},{name:"insert",label:"Insert",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"insert-link",label:"Insert Link",icon:"insert-link.png",action:function(){ghostedit.api.link.create()}},{type:"button",id:"insert-image",label:"Insert Image",icon:"insert-image.png",action:function(){ghostedit.api.image.insert()}}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"&#224;"},{type:"specialchar",character:"&#225;"},{type:"specialchar",character:"&#226;"},{type:"specialchar",character:"&#227;"},{type:"specialchar",character:"&#228;"},{type:"specialchar",character:"&#229;"},{type:"specialchar",character:"&#232;"},{type:"specialchar",character:"&#233;"},{type:"br"},{type:"specialchar",character:"&#234;"},{type:"specialchar",character:"&#235;"},{type:"specialchar",character:"&#236;"},{type:"specialchar",character:"&#237;"},{type:"specialchar",character:"&#238;"},{type:"specialchar",character:"&#239;"},{type:"specialchar",character:"&#242;"},{type:"specialchar",character:"&#243;"},{type:"br"},{type:"specialchar",character:"&#244;"},{type:"specialchar",character:"&#245;"},{type:"specialchar",character:"&#246;"},{type:"specialchar",character:"&#249;"},{type:"specialchar",character:"&#250;"},{type:"specialchar",character:"&#251;"},{type:"specialchar",character:"&#252;"}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"+"},{type:"specialchar",character:"&#8722;"},{type:"specialchar",character:"&#215;"},{type:"specialchar",character:"&#247;"},{type:"br"},{type:"specialchar",character:"&#8804;"},{type:"specialchar",character:"&#8805;"},{type:"specialchar",character:"&#177;"},{type:"specialchar",character:"&#8801;"},{type:"br"},{type:"specialchar",character:"&#189;"},{type:"specialchar",character:"&#188;"},{type:"specialchar",character:"&#190;"},{type:"specialchar",character:"&#960;"}]}]},{name:"save",label:"Save",enabled:!0,contents:[{type:"group",contents:[{type:"textfield",label:"Page Name",onkeyup:function(){ghostedit.plugins.save.updateparameter("name",this.value)}}]},{type:"group",contents:[{type:"textfield",label:"Page Url Slug",onkeyup:function(){ghostedit.plugins.save.updateparameter("url",this.value)}}]},{type:"group",contents:[{type:"button",id:"save",label:"Save",icon:"save.png",action:function(){ghostedit.api.save()}}]},{type:"seperator"},{type:"group",contents:[{type:"button",id:"about",label:"About GhostEdit & credits",icon:"about.png",action:function(){ghostedit.api.defaultui.showabout()}}]}]},{name:"link",label:"Link",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"linkurl",label:"Link URL",onkeyup:function(){ghostedit.api.link.updateurl(this.value)}}]},{type:"group",contents:[{type:"button",label:"Open link in new tab",icon:"openlink.png",action:function(){ghostedit.api.link.open()}}]}]},{name:"image",label:"Image",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"imagealttext",label:"Description / Alt text",onkeyup:function(){ghostedit.api.image.updatealttext(this.value)}}]}]}]}};e.el={},e.enable=function(){ghostedit.event.trigger("ui:replace"),ghostedit.event.addListener("ui:update",function(){e.update()},"defaultui"),ghostedit.event.addListener("ui:message",function(t){e.message.show(t)},"defaultui"),ghostedit.event.addListener("ui:replace",function(){ghostedit.api.plugin.disable("defaultui")},"defaultui"),ghostedit.event.addListener("ui:newcontext",function(t){if(!t.context)return;e.context&&!/textblock|format|insert|save/.test(e.context)&&e.toolbar.disabletab(e.context),typeof t.context=="string"&&(t.context=t.context.replace("textblock","textblock")),e.context=t.context;if(t.context==="image"&&ghostedit.selection.type==="image"){var n=ghostedit.selection.data;document.getElementById("ghostedit_toolbar_imagealttext").value=n.alt}e.toolbar.showtab(t.context)},"defaultui"),ghostedit.options.defaultui||(ghostedit.options.defaultui={}),ghostedit.options.defaultui.statusbar||(ghostedit.options.defaultui.statusbar=!0),ghostedit.options.defaultui.wordcount||(ghostedit.options.defaultui.wordcount=!0);var t,n,r,i,s,o,u,a,f,l,c;t=e.definition,n=document.createElement("div"),n.id="ghostedit_defaultui_toolbar",n.className="ghostedit_defaultui_toolbar",e.el.toolbar=n,u=document.createElement("div"),u.id="ghostedit_defaultui_messagearea",u.className="ghostedit_defaultui_messagearea",u.innerHTML="&nbsp;",n.appendChild(u),e.el.messagearea=u,r=document.createElement("div"),r.id="ghostedit_defaultui_quickbutton_insertanchor",r.style.cssText="float: left; position: relative; width: 3px;height: 16px",n.insertBefore(r,u),e.el.qbanchor=r;if(t.quickbuttons)for(f=0;f<t.quickbuttons.length;f++)e.toolbar.insert.quickbutton(t.quickbuttons[f]);s=r=document.createElement("div"),s.id="ghostedit_defaultui_tabselect",s.style.cssText="position: absolute;width: 100%;left: 0; bottom: -1px; height: 1px; line-height: 1px; font-size: 1px; background-color: #FFF",e.el.tabselect=s;if(t.tabs)for(f=0;f<t.tabs.length;f++)e.toolbar.insert.tab(t.tabs[f]);ghostedit.wrapdiv.insertBefore(n,ghostedit.wrapdiv.firstChild),ghostedit.util.addEvent(e.el.toolbar,"mouseup",function(t){e.toolbar.event.click(t)}),ghostedit.util.addEvent(e.el.toolbar,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(e.el.toolbar,"mousedown",function(e){ghostedit.util.preventBubble(e)});var h=document.createElement("div");h.id="ghostedit_defaultui_statusbar",h.className="ghostedit_defaultui_statusbar",h.innerHTML="<b>Path:</b>",ghostedit.wrapdiv.appendChild(h),e.el.statusbar=h,l=document.createElement("div"),l.id="ghostedit_defaultui_modal",l.className="ghostedit_defaultui_modal",ghostedit.wrapdiv.appendChild(l),e.el.modal=l,c=document.createElement("div"),c.id="ghostedit_defaultui_modalbg",c.className="ghostedit_defaultui_modalbg",ghostedit.util.addEvent(c,"click",function(){e.modal.hide()}),ghostedit.wrapdiv.appendChild(c),e.el.modalbg=c,e.toolbar.showtab("textblock")},e.disable=function(){ghostedit.event.removeAllListeners("defaultui"),ghostedit.wrapdiv.removeChild(e.el.toolbar),ghostedit.wrapdiv.removeChild(e.el.statusbar),ghostedit.wrapdiv.removeChild(e.el.modal),ghostedit.wrapdiv.removeChild(e.el.modalbg),e.toolbar.quickbuttons=[],e.toolbar.tabs=[],e.toolbar.enabledtabs=[],e.toolbar.panels=[]},e.update=function(){var t,n=!1,r,i,s,o,u,a,f,l="",c="N/A",h,p;p=e.toolbar.highlightmap;for(r=0;r<p.length;r++)ghostedit.util.removeClass(p[r].element,"current");for(r=0;r<ghostedit.selection.nodepath.length;r++){u=ghostedit.selection.nodepath[r],a=u.tagName.toLowerCase(),f=ghostedit.util.trim(u.className),console.log();for(i=0;i<p.length;i++)p[i].test.call(p[i].data,a,f,u)&&ghostedit.util.addClass(p[i].element,"current");r!==ghostedit.selection.nodepath.length-1&&(l=" > "+(e.elemInEnglish[u.tagName.toLowerCase()]||u.tagName.toUpperCase())+l)}e.el.statusbar.innerHTML="<b>Path</b>"+l,ghostedit.options.defaultui.wordcount&&(h=ghostedit.util.trim(ghostedit.editdiv.innerText||ghostedit.editdiv.textContent),c=h.split(/\s+/).length,e.el.statusbar.innerHTML+="<div style='position: absolute; right: 10px; top: 3px'>"+c+" words</div>")},e.modal={show:function(t){var n,r,i;n=e.el.modal,r=e.el.modalbg,n.innerHTML=t,i=document.createElement("a"),i.className="ghostedit_defaultui_modal_closebutton",i.innerHTML="&#215",ghostedit.util.addEvent(i,"click",e.modal.hide),n.appendChild(i),n.style.display="block",r.style.display="block"},hide:function(){var t,n;t=e.el.modal,n=e.el.modalbg,t.style.display="none",n.style.display="none",t.innerHTML="",ghostedit.selection.restore()},showabout:function(){e.modal.show("<h2>About GhostEdit</h2><p>GhostEdit is a WYSIWYG editor based on the concept that the editor should be transparent to use - i.e. you do no notice that you are using it. This manifests itself in two ways:</p><ul><li>GhostEdit has an incredibly simple user interface, which is designed for maximum usability</li><li>GhostEdit restricts input to known, safe content so as to be as reliable as possible</li></ul><h3>Credits</h3>GhostEdit was designed and coded by <a href='http://nicoburns.com'>Nico Burns</a>.<br />Icons licensed from <a href='http://www.gentleface.com/free_icon_set.html'>Gentleface</a> under a <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/'>CC BY-NC-ND 3.0</a> liscense.<br />version: "+ghostedit.version)}},e.message={div:"",show:function(t){msg=t.message,time=t.time,color=t.color;var n=document.getElementById("ghostedit_defaultui_messagearea");n.innerHTML=msg,color=color=="success"?"#bbff00":color,color=color=="error"?"#ff4949":color,color=color=="warn"?"#ffef49":color,n.style.backgroundColor=color,n.style.opacity=1,n.filters&&(n.filters.item(0).enabled=1),time!=0&&(clearTimeout(e.message.timer),e.message.timer=setTimeout(function(){e.message.clear()},time*1e3))},clear:function(){var t=document.getElementById("ghostedit_defaultui_messagearea");t.style.opacity>.1?(t.style.opacity=t.style.opacity-.05,t.filters&&(t.filters.item(0).Opacity=t.style.opacity*100),setTimeout(function(){e.message.clear()},20)):(t.innerHTML="&nbsp;",t.style.backgroundColor="transparent",t.opacity="1",t.filters&&(t.filters.item(0).Opacity=100))}},e.toolbar={div:"",quickbuttons:[],tabs:[],enabledtabs:["format","insert","save"],panels:[],styleboxes:[],highlightmap:[],event:{click:function(e){ghostedit.event.allowtoolbarclick||ghostedit.util.cancelAllEvents(e)}},clicktab:function(e){var t,n,r,i,s;typeof e=="string"&&(e=document.getElementById("ghostedit_defaultui_toolbartab_"+e.replace("ghostedit_defaultui_toolbartab_",""))),n=e.id.replace("ghostedit_defaultui_toolbartab_",""),t=document.getElementById("ghostedit_defaultui_toolbarpanel_"+n),ghostedit.selection.restore(),ghostedit.event.trigger("ui:newcontext",{context:n})},showtab:function(t){var n,r,i,s,o;typeof t=="string"&&(t=document.getElementById("ghostedit_defaultui_toolbartab_"+t.replace("ghostedit_defaultui_toolbartab_",""))),r=t.id.replace("ghostedit_defaultui_toolbartab_",""),n=document.getElementById("ghostedit_defaultui_toolbarpanel_"+r),i=e.el.toolbar.childNodes;for(s=0;s<i.length;s+=1)o=i[s],o.nodeType===1&&(/tab/.test(o.className)||/panel/.test(o.className))&&ghostedit.util.removeClass(o,"active");e.toolbar.enabledtabs[r]||e.toolbar.enabletab(r),ghostedit.util.addClass(t,"active"),ghostedit.util.addClass(n,"active"),t.appendChild(e.el.tabselect)},enabletab:function(t){var n,r;n=document.getElementById("ghostedit_defaultui_toolbartab_"+t),ghostedit.util.addClass(n,"enabled"),e.toolbar.enabledtabs.push(t)},disabletab:function(t){var n,r;n=document.getElementById("ghostedit_defaultui_toolbartab_"+t),ghostedit.util.removeClass(n,"enabled"),delete e.toolbar.enabledtabs[t]},insert:{quickbutton:function(t){var n;if(!t||!t.label||!t.icon||!ghostedit.util.isFunction(t.action))return!1;button=document.createElement("img"),button.className="ghostedit_defaultui_quickbutton",button.src=ghostedit.options.imageurl+"/defaultui/"+t.icon,button.title=t.label,button.alt=t.label,e.el.toolbar.insertBefore(button,e.el.qbanchor),e.toolbar.quickbuttons.push(button),button.onclick=t.action},tab:function(t){var n,r,i;n=document.createElement("div"),n.className=t.enabled?"ghostedit_defaultui_toolbartab enabled":"ghostedit_defaultui_toolbartab",n.id="ghostedit_defaultui_toolbartab_"+t.name,n.innerHTML=t.label,r=document.createElement("div"),ghostedit.util.addClass(r,"ghostedit_defaultui_toolbarpanel"),r.id="ghostedit_defaultui_toolbarpanel_"+t.name;if(t.contents)for(i=0;i<t.contents.length;i++)switch(t.contents[i].type){case"group":e.toolbar.insert.panelgroup(r,t.contents[i]);break;case"seperator":e.toolbar.insert.panelseperator(r)}e.el.toolbar.insertBefore(n,e.el.messagearea),e.el.toolbar.appendChild(r),e.toolbar.tabs.push(n),n.onclick=function(){e.toolbar.clicktab(this)}},panelseperator:function(e){var t;t=document.createElement("span"),t.className="ghostedit_defaultui_toolbarseperator",t.style.backgroundImage="URL("+ghostedit.options.imageurl+"/defaultui/toolbar_seperator.png)",e.appendChild(t)},panelgroup:function(t,n){var r,i;r=document.createElement("span"),r.className="ghostedit_defaultui_toolbarpanelgroup",n.style&&(r.style.cssTet=n.style);if(n.contents)for(i=0;i<n.contents.length;i++)switch(n.contents[i].type){case"button":e.toolbar.insert.button(r,n.contents[i]);break;case"stylebox":e.toolbar.insert.stylebox(r,n.contents[i]);break;case"specialchar":e.toolbar.insert.specialchar(r,n.contents[i]);break;case"textfield":e.toolbar.insert.textfield(r,n.contents[i]);break;case"br":r.appendChild(document.createElement("br"))}t.appendChild(r)},button:function(t,n){var r,i;r=document.createElement("img"),r.src=ghostedit.options.imageurl+"/defaultui/"+n.icon,r.title=n.label,r.alt=n.label,n.style&&(r.style.cssText=n.style),t.appendChild(r),n.highlighttest&&e.toolbar.highlightmap.push({element:r,test:n.highlighttest}),ghostedit.util.addEvent(r,"click",n.action)},specialchar:function(e,t){var n,r;n=document.createElement("a"),n.className="ghostedit_defaultui_specialchar",n.title="Insert Character",n.alt="Insert Character",n.innerHTML=t.character,e.appendChild(n),n.onclick=function(){ghostedit.api.insert.character(this)}},textfield:function(e,t){var n;n=document.createElement("input"),t.id&&(n.id="ghostedit_defaultui_textfield_"+t.id),n.style.width=t.width?t.width:"200px",t.label&&(e.innerHTML+=t.label+"<br />"),e.appendChild(n),ghostedit.util.addEvent(n,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keypress",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keydown",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keyup",t.onkeyup)},stylebox:function(t,n){var r,i;r=document.createElement("div"),r.className="ghostedit_defaultui_stylebox",r.id="ghostedit_defaultui_stylebox_"+n.tagname,n.classname&&(r.id=r.id+"_"+n.classname),r.innerHTML="<"+n.tagname+" class='ghostedit_defaultui_stylebox_preview'>AaBbCc</"+n.tagname+">",r.title=n.label,r.alt=n.label,i=document.createElement("div"),i.className="ghostedit_defaultui_stylebox_label",i.innerHTML=n.label,r.appendChild(i),t.appendChild(r),e.toolbar.styleboxes.push(r),e.toolbar.highlightmap.push({element:r,data:{tagname:n.tagname,classname:n.classname!==undefined?n.classname:""},test:function(e,t,n){return e===this.tagname&&t===this.classname}}),r.onclick=function(){ghostedit.api.format.setStyle(n.tagname,n.classname)}}}},ghostedit.api.plugin.register("defaultui",e)})();