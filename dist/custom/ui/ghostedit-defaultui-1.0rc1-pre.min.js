/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2012 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0rc1-pre
Release Date:      2012-12-15
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/
(function(){var e={aelem:!1,context:null,elemInEnglish:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",p:"Paragraph",div:"Generic Box",a:"Link",b:"Bold",strong:"Bold",i:"Italic",em:"Italic",u:"Underline",img:"Image",ul:"Bulletted list",ol:"Numbered list",li:"List Item",strike:"Strikethrough"},definition:{quickbuttons:[{label:"Save",icon:"save16.png",action:function(){t.api.save()}},{label:"Undo",icon:"undo16.png",action:function(){t.api.undo()}},{label:"Redo",icon:"redo16.png",action:function(){t.api.redo()}}],tabs:[{name:"textblock",label:"Format",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"bold",label:"Bold",icon:"format-bold.png",highlighttest:function(e){return e==="b"||e==="strong"},action:function(){t.api.format.bold()}},{type:"button",id:"italic",label:"Italic",icon:"format-italic.png",highlighttest:function(e){return e==="i"||e==="em"},action:function(){t.api.format.italic()}},{type:"button",id:"underline",label:"Underline",icon:"format-underline.png",highlighttest:function(e){return e==="u"},action:function(){t.api.format.underline()}},{type:"button",id:"strikethrough",label:"Strikethrough",icon:"format-strikethrough.png",highlighttest:function(e){return e==="strike"},action:function(){t.api.format.strikethrough()}},{type:"br"},{type:"button",id:"align-left",label:"Align Left",icon:"align-left.png",highlighttest:function(e,t,n){return n.style.textAlign==="left"||n.style.textAlign===""},action:function(){t.api.format.alignText("left")}},{type:"button",id:"align-center",label:"Align Center",icon:"align-center.png",highlighttest:function(e,t,n){return n.style.textAlign==="center"},action:function(){t.api.format.alignText("center")}},{type:"button",id:"align-right",label:"Align Right",icon:"align-right.png",highlighttest:function(e,t,n){return n.style.textAlign==="right"},action:function(){t.api.format.alignText("right")}},{type:"button",id:"align-justify",label:"Justify",icon:"align-justified.png",highlighttest:function(e,t,n){return n.style.textAlign==="justify"},action:function(){t.api.format.alignText("justify")}}]},{type:"seperator"},{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"list-unordered",label:"Bulleted List",icon:"list-unordered.png",action:function(){t.api.list.toggle("unordered")}},{type:"button",id:"list-ordered",label:"Numbered List",icon:"list-ordered.png",action:function(){t.api.list.toggle("ordered")}}]},{type:"seperator"},{type:"group",contents:[{type:"stylebox",label:"Paragraph",tagname:"p"},{type:"stylebox",label:"LeadPara",tagname:"p",classname:"LeadingParagraph"},{type:"stylebox",label:"Heading 1",tagname:"h1"},{type:"stylebox",label:"Heading 2",tagname:"h2"},{type:"stylebox",label:"Heading 3",tagname:"h3"}]}]},{name:"insert",label:"Insert",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"insert-link",label:"Insert Link",icon:"insert-link.png",action:function(){t.api.link.create()}},{type:"button",id:"insert-image",label:"Insert Image",icon:"insert-image.png",action:function(){t.api.image.insert()}}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"&#224;"},{type:"specialchar",character:"&#225;"},{type:"specialchar",character:"&#226;"},{type:"specialchar",character:"&#227;"},{type:"specialchar",character:"&#228;"},{type:"specialchar",character:"&#229;"},{type:"specialchar",character:"&#232;"},{type:"specialchar",character:"&#233;"},{type:"br"},{type:"specialchar",character:"&#234;"},{type:"specialchar",character:"&#235;"},{type:"specialchar",character:"&#236;"},{type:"specialchar",character:"&#237;"},{type:"specialchar",character:"&#238;"},{type:"specialchar",character:"&#239;"},{type:"specialchar",character:"&#242;"},{type:"specialchar",character:"&#243;"},{type:"br"},{type:"specialchar",character:"&#244;"},{type:"specialchar",character:"&#245;"},{type:"specialchar",character:"&#246;"},{type:"specialchar",character:"&#249;"},{type:"specialchar",character:"&#250;"},{type:"specialchar",character:"&#251;"},{type:"specialchar",character:"&#252;"}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"+"},{type:"specialchar",character:"&#8722;"},{type:"specialchar",character:"&#215;"},{type:"specialchar",character:"&#247;"},{type:"br"},{type:"specialchar",character:"&#8804;"},{type:"specialchar",character:"&#8805;"},{type:"specialchar",character:"&#177;"},{type:"specialchar",character:"&#8801;"},{type:"br"},{type:"specialchar",character:"&#189;"},{type:"specialchar",character:"&#188;"},{type:"specialchar",character:"&#190;"},{type:"specialchar",character:"&#960;"}]}]},{name:"save",label:"Save",enabled:!0,contents:[{type:"group",contents:[{type:"textfield",label:"Page Name",onkeyup:function(){t.plugins.save.updateparameter("name",this.value)}}]},{type:"group",contents:[{type:"textfield",label:"Page Url Slug",onkeyup:function(){t.plugins.save.updateparameter("url",this.value)}}]},{type:"group",contents:[{type:"button",id:"save",label:"Save",icon:"save.png",action:function(){t.api.save()}}]},{type:"seperator"},{type:"group",contents:[{type:"button",id:"about",label:"About GhostEdit & credits",icon:"about.png",action:function(){t.api.defaultui.showabout()}}]}]},{name:"link",label:"Link",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"linkurl",label:"Link URL",width:"400px",onkeyup:function(){t.api.link.updateurl(this.value)}}]},{type:"group",contents:[{type:"button",label:"Open link in new tab",icon:"openlink.png",action:function(){t.api.link.open()}}]}]},{name:"image",label:"Image",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"imagealt",label:"Description / Alt text",onkeyup:function(){t.api.image.updatealttext(this.value)}}]}]}]}},t=window.ghostedit;e.el={},e.enable=function(){t.event.trigger("ui:replace"),t.event.addListener("ui:update",function(){e.update()},"defaultui"),t.event.addListener("ui:message",function(t){e.message.show(t)},"defaultui"),t.event.addListener("ui:replace",function(){t.api.plugin.disable("defaultui")},"defaultui"),t.event.addListener("selection:change",function(){var e;for(a=0;a<t.selection.nodepath.length;a++){e=t.selection.nodepath[a];if(e.tagName&&e.tagName.toLowerCase()==="img"){t.selection.saved.type==="image"&&(document.getElementById("ghostedit_defaultui_textfield_imagealt").value=t.selection.saved.data.alt),t.event.trigger("ui:newcontext",{context:"image"});break}if(e.tagName&&e.tagName.toLowerCase()==="a"){t.plugins.link.focusedlink&&(document.getElementById("ghostedit_defaultui_textfield_linkurl").value=t.plugins.link.focusedlink.href==="http:"?"http://":t.plugins.link.focusedlink.href),t.event.trigger("ui:newcontext",{context:"link"});break}if(t.plugins.textblock.isTextBlock(e)){t.event.trigger("ui:newcontext",{context:"textblock"});break}}},"defaultui"),t.event.addListener("ui:newcontext",function(n){if(!n.context)return;e.context&&!/textblock|format|insert|save/.test(e.context)&&e.toolbar.disabletab(e.context),typeof n.context=="string"&&(n.context=n.context.replace("textblock","textblock")),e.context=n.context;if(n.context==="image"&&t.selection.type==="image"){var r=t.selection.data;document.getElementById("ghostedit_toolbar_imagealttext").value=r.alt}e.toolbar.showtab(n.context)},"defaultui"),t.options.defaultui||(t.options.defaultui={}),t.options.defaultui.statusbar||(t.options.defaultui.statusbar=!0),t.options.defaultui.wordcount||(t.options.defaultui.wordcount=!0);var n,r,i,s,o,u,a,f,l;n=e.definition,r=document.createElement("div"),r.id="ghostedit_defaultui_toolbar",r.className="ghostedit_defaultui_toolbar",e.el.toolbar=r,o=document.createElement("div"),o.id="ghostedit_defaultui_messagearea",o.className="ghostedit_defaultui_messagearea",o.innerHTML="&nbsp;",r.appendChild(o),e.el.messagearea=o,i=document.createElement("div"),i.id="ghostedit_defaultui_quickbutton_insertanchor",i.style.cssText="float: left; position: relative; width: 3px;height: 16px",r.insertBefore(i,o),e.el.qbanchor=i;if(n.quickbuttons)for(a=0;a<n.quickbuttons.length;a++)e.toolbar.insert.quickbutton(n.quickbuttons[a]);s=i=document.createElement("div"),s.id="ghostedit_defaultui_tabselect",s.style.cssText="position: absolute;width: 100%;left: 0; bottom: -1px; height: 1px; line-height: 1px; font-size: 1px; background-color: #FFF",e.el.tabselect=s;if(n.tabs)for(a=0;a<n.tabs.length;a++)e.toolbar.insert.tab(n.tabs[a]);t.wrapdiv.insertBefore(r,t.wrapdiv.firstChild),t.util.addEvent(e.el.toolbar,"mouseup",function(t){e.toolbar.event.click(t)}),t.util.addEvent(e.el.toolbar,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(e.el.toolbar,"mousedown",function(e){t.util.preventBubble(e)}),u=document.createElement("div"),u.id="ghostedit_defaultui_statusbar",u.className="ghostedit_defaultui_statusbar",u.innerHTML="<b>Path:</b>",t.wrapdiv.appendChild(u),e.el.statusbar=u,f=document.createElement("div"),f.id="ghostedit_defaultui_modal",f.className="ghostedit_defaultui_modal",t.wrapdiv.appendChild(f),e.el.modal=f,l=document.createElement("div"),l.id="ghostedit_defaultui_modalbg",l.className="ghostedit_defaultui_modalbg",t.util.addEvent(l,"click",function(){e.modal.hide()}),t.wrapdiv.appendChild(l),e.el.modalbg=l,e.toolbar.showtab("textblock")},e.disable=function(){t.event.removeAllListeners("defaultui"),t.wrapdiv.removeChild(e.el.toolbar),t.wrapdiv.removeChild(e.el.statusbar),t.wrapdiv.removeChild(e.el.modal),t.wrapdiv.removeChild(e.el.modalbg),e.toolbar.quickbuttons=[],e.toolbar.tabs=[],e.toolbar.enabledtabs=[],e.toolbar.panels=[]},e.update=function(){var n,r,i,s,o,u="",a="N/A",f,l;l=e.toolbar.highlightmap;for(n=0;n<l.length;n++)t.util.removeClass(l[n].element,"current");for(n=0;n<t.selection.nodepath.length;n++){i=t.selection.nodepath[n],s=i.tagName.toLowerCase(),o=t.util.trim(i.className);for(r=0;r<l.length;r++)l[r].test.call(l[r].data,s,o,i)&&t.util.addClass(l[r].element,"current");n!==t.selection.nodepath.length-1&&(u=" > "+(e.elemInEnglish[i.tagName.toLowerCase()]||i.tagName.toUpperCase())+u)}e.el.statusbar.innerHTML="<b>Path</b>"+u,t.options.defaultui.wordcount&&(f=t.util.trim(t.editdiv.innerText||t.editdiv.textContent),a=f.split(/\s+/).length,e.el.statusbar.innerHTML+="<div style='position: absolute; right: 10px; top: 3px'>"+a+" words</div>")},e.modal={show:function(n){var r,i,s;r=e.el.modal,i=e.el.modalbg,r.innerHTML=n,s=document.createElement("a"),s.className="ghostedit_defaultui_modal_closebutton",s.innerHTML="&#215",t.util.addEvent(s,"click",e.modal.hide),r.appendChild(s),r.style.display="block",i.style.display="block"},hide:function(){var n,r;n=e.el.modal,r=e.el.modalbg,n.style.display="none",r.style.display="none",n.innerHTML="",t.selection.restore()},showabout:function(){e.modal.show("<h2>About GhostEdit</h2><p>GhostEdit is a WYSIWYG editor based on the concept that the editor should be transparent to use - i.e. you do no notice that you are using it. This manifests itself in two ways:</p><ul><li>GhostEdit has an incredibly simple user interface, which is designed for maximum usability</li><li>GhostEdit restricts input to known, safe content so as to be as reliable as possible</li></ul><h3>Credits</h3>GhostEdit was designed and coded by <a href='http://nicoburns.com'>Nico Burns</a>.<br />Icons licensed from <a href='http://www.gentleface.com/free_icon_set.html'>Gentleface</a> under a <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/'>CC BY-NC-ND 3.0</a> liscense.<br />version: "+t.version)}},e.message={div:"",show:function(t){var n,r,i,s;n=t.message,r=t.time,i=t.color,s=e.el.messagearea,s.innerHTML=n,i=i==="success"?"#bbff00":i,i=i==="error"?"#ff4949":i,i=i==="warn"?"#ffef49":i,s.style.backgroundColor=i,s.style.opacity=1,s.filters&&(s.filters.item(0).enabled=1),r!==0&&(clearTimeout(e.message.timer),e.message.timer=setTimeout(function(){e.message.clear()},r*1e3))},clear:function(){var t=e.el.messagearea;t.style.opacity>.1?(t.style.opacity=t.style.opacity-.05,t.filters&&(t.filters.item(0).Opacity=t.style.opacity*100),setTimeout(function(){e.message.clear()},20)):(t.innerHTML="&nbsp;",t.style.backgroundColor="transparent",t.opacity="1",t.filters&&(t.filters.item(0).Opacity=100))}},e.toolbar={div:"",quickbuttons:[],tabs:[],enabledtabs:["format","insert","save"],panels:[],styleboxes:[],highlightmap:[],event:{click:function(e){t.event.allowtoolbarclick||t.util.cancelAllEvents(e)}},clicktab:function(e){var n,r;typeof e=="string"&&(e=document.getElementById("ghostedit_defaultui_toolbartab_"+e.replace("ghostedit_defaultui_toolbartab_",""))),r=e.id.replace("ghostedit_defaultui_toolbartab_",""),n=document.getElementById("ghostedit_defaultui_toolbarpanel_"+r),t.selection.restore(),t.event.trigger("ui:newcontext",{context:r})},showtab:function(n){var r,i,s,o,u;typeof n=="string"&&(n=document.getElementById("ghostedit_defaultui_toolbartab_"+n.replace("ghostedit_defaultui_toolbartab_",""))),i=n.id.replace("ghostedit_defaultui_toolbartab_",""),r=document.getElementById("ghostedit_defaultui_toolbarpanel_"+i),s=e.el.toolbar.childNodes;for(o=0;o<s.length;o+=1)u=s[o],u.nodeType===1&&(/tab/.test(u.className)||/panel/.test(u.className))&&t.util.removeClass(u,"active");e.toolbar.enabledtabs[i]||e.toolbar.enabletab(i),t.util.addClass(n,"active"),t.util.addClass(r,"active"),n.appendChild(e.el.tabselect)},enabletab:function(n){var r;r=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.addClass(r,"enabled"),e.toolbar.enabledtabs.push(n)},disabletab:function(n){var r;r=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.removeClass(r,"enabled"),delete e.toolbar.enabledtabs[n]},insert:{quickbutton:function(n){var r;if(!n||!n.label||!n.icon||!t.util.isFunction(n.action))return!1;r=document.createElement("img"),r.className="ghostedit_defaultui_quickbutton",r.src=t.options.imageurl+"/defaultui/"+n.icon,r.title=n.label,r.alt=n.label,e.el.toolbar.insertBefore(r,e.el.qbanchor),e.toolbar.quickbuttons.push(r),r.onclick=n.action},tab:function(n){var r,i,s;r=document.createElement("div"),r.className=n.enabled?"ghostedit_defaultui_toolbartab enabled":"ghostedit_defaultui_toolbartab",r.id="ghostedit_defaultui_toolbartab_"+n.name,r.innerHTML=n.label,i=document.createElement("div"),t.util.addClass(i,"ghostedit_defaultui_toolbarpanel"),i.id="ghostedit_defaultui_toolbarpanel_"+n.name;if(n.contents)for(s=0;s<n.contents.length;s++)switch(n.contents[s].type){case"group":e.toolbar.insert.panelgroup(i,n.contents[s]);break;case"seperator":e.toolbar.insert.panelseperator(i)}e.el.toolbar.insertBefore(r,e.el.messagearea),e.el.toolbar.appendChild(i),e.toolbar.tabs.push(r),r.onclick=function(){e.toolbar.clicktab(this)}},panelseperator:function(e){var n;n=document.createElement("span"),n.className="ghostedit_defaultui_toolbarseperator",n.style.backgroundImage="URL("+t.options.imageurl+"/defaultui/toolbar_seperator.png)",e.appendChild(n)},panelgroup:function(t,n){var r,i;r=document.createElement("span"),r.className="ghostedit_defaultui_toolbarpanelgroup",n.style&&(r.style.cssTet=n.style);if(n.contents)for(i=0;i<n.contents.length;i++)switch(n.contents[i].type){case"button":e.toolbar.insert.button(r,n.contents[i]);break;case"stylebox":e.toolbar.insert.stylebox(r,n.contents[i]);break;case"specialchar":e.toolbar.insert.specialchar(r,n.contents[i]);break;case"textfield":e.toolbar.insert.textfield(r,n.contents[i]);break;case"br":r.appendChild(document.createElement("br"))}t.appendChild(r)},button:function(n,r){var i;i=document.createElement("img"),i.src=t.options.imageurl+"/defaultui/"+r.icon,i.title=r.label,i.alt=r.label,r.style&&(i.style.cssText=r.style),n.appendChild(i),r.highlighttest&&e.toolbar.highlightmap.push({element:i,test:r.highlighttest}),t.util.addEvent(i,"click",r.action)},specialchar:function(e,n){var r;r=document.createElement("a"),r.className="ghostedit_defaultui_specialchar",r.title="Insert Character",r.alt="Insert Character",r.innerHTML=n.character,e.appendChild(r),r.onclick=function(){t.api.insert.character(this)}},textfield:function(e,n){var r;r=document.createElement("input"),n.id&&(r.id="ghostedit_defaultui_textfield_"+n.id),r.style.width=n.width?n.width:"200px",n.label&&(e.innerHTML+=n.label+"<br />"),e.appendChild(r),t.util.addEvent(r,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keypress",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keydown",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keyup",n.onkeyup)},stylebox:function(n,r){var i,s;i=document.createElement("div"),i.className="ghostedit_defaultui_stylebox",i.id="ghostedit_defaultui_stylebox_"+r.tagname,r.classname&&(i.id=i.id+"_"+r.classname),i.innerHTML="<"+r.tagname+" class='ghostedit_defaultui_stylebox_preview'>AaBbCc</"+r.tagname+">",i.title=r.label,i.alt=r.label,s=document.createElement("div"),s.className="ghostedit_defaultui_stylebox_label",s.innerHTML=r.label,i.appendChild(s),n.appendChild(i),e.toolbar.styleboxes.push(i),e.toolbar.highlightmap.push({element:i,data:{tagname:r.tagname,classname:r.classname!==undefined?r.classname:""},test:function(e,t){return e===this.tagname&&t===this.classname}}),i.onclick=function(){t.api.format.setStyle(r.tagname,r.classname)}}}},t.api.plugin.register("defaultui",e)})();