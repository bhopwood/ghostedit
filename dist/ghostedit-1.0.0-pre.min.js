/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2013 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0.0-pre
Release Date:      2013-03-05
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/window.lasso=function(){var e={saved:null,endpoint:null,startpoint:null,bookmark:null,textrange:!1,domrange:!1,isLassoObject:!0},t=window.lasso,n=window.console||{};return n.log=n.log||function(){},e.init=e.reset=e.create=function(){return document.createRange?(e.textrange=!1,e.saved=document.createRange()):document.selection&&(e.textrange=!0,e.saved=document.body.createTextRange()),e.bookmark=!1,e.domrange=!e.textrange,e},e.setToEmpty=function(){return e.domrange?e.saved=document.createRange():e.textrange&&(e.saved=document.body.createTextRange()),e},e.setFromNative=function(t){return e.saved=t,e},e.getNative=function(){return e.saved},e.setToSelection=function(){var t;return e.domrange?(t=window.getSelection(),t.rangeCount>0&&(e.saved=t.getRangeAt(0).cloneRange())):e.textrange&&(e.saved=document.selection.createRange()),e},e.select=function(){if(e.domrange){var t=window.getSelection();t.rangeCount>0&&t.removeAllRanges(),t.addRange(e.saved)}else e.textrange&&e.saved.select();return e},e.clearSelection=function(){if(e.domrange){var t=window.getSelection();t.rangeCount>0&&t.removeAllRanges()}else e.textrange&&document.selection.empty();return e},e.collapseToStart=function(){return e.saved.collapse(!0),e},e.collapseToEnd=function(){return e.saved.collapse(!1),e},e.setStartToRangeStart=function(t){return t&&t.saved&&(t=t.getNative()),e.domrange?e.saved.setStart(t.startContainer,t.startOffset):e.textrange&&e.saved.setEndPoint("StartToStart",t),e},e.setStartToRangeEnd=function(t){return t&&t.saved&&(t=t.getNative()),e.domrange?e.saved.setStart(t.endContainer,t.endOffset):e.textrange&&e.saved.setEndPoint("StartToEnd",t),e},e.setEndToRangeStart=function(t){return t&&t.saved&&(t=t.getNative()),e.domrange?e.saved.setStart(t.endContainer,t.endOffset):e.textrange&&e.saved.setEndPoint("EndToStart",t),e},e.setEndToRangeEnd=function(t){return t&&t.saved&&(t=t.getNative()),e.domrange?e.saved.setEnd(t.endContainer,t.endOffset):e.textrange&&e.saved.setEndPoint("EndToEnd",t),e},e.deleteContents=function(){return e.domrange?e.saved.deleteContents():e.textrange&&(e.saved.text=""),e},e.pasteText=function(t,n){if(n===void 0&&(n=!0),e.deleteContents(),e.domrange){var o=document.createTextNode(t);e.saved.insertNode(o),e.reset().selectNodeContents(o)}else e.textrange&&e.saved.pasteHTML(t);return n&&e.collapseToEnd(),e.select(),e},e.insertNode=function(t,n){var o;return n===void 0&&(n=!0),e.deleteContents(),e.domrange?(e.saved.insertNode(t),e.setToEmpty().selectNodeContents(t)):e.textrange&&(o=document.createNode("div"),o.appendChild(t),e.saved.pasteHTML(o.innerHTML)),n&&e.collapseToEnd(),e},e.getText=function(){return e.domrange?""+e.saved:e.textrange?e.saved.text:void 0},e.extractText=function(){var t=e.getText();return e.deleteContents(),t},e.getHTML=function(){var t,n;return e.domrange?(n=e.saved.cloneContents(),t=document.createElement("div"),t.appendChild(n),t.innerHTML):e.textrange?e.saved.htmlText:void 0},e.extractHTML=function(){var t=e.getHTML();return e.deleteContents(),t},e.actualSelectNode=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?e.saved.selectNode(t):e.textrange&&e.saved.moveToElementText(t),e},e.selectNode=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?e.saved.selectNodeContents(t):e.textrange&&e.saved.moveToElementText(t),e},e.selectNodeContents=function(n){"string"==typeof n&&(n=document.getElementById(n));var o,a;return e.domrange?e.saved.selectNodeContents(n):e.textrange&&(e.saved.moveToElementText(n),o=t().setCaretToStart(n).getNative(),a=t().setCaretToEnd(n).getNative(),e.saved.setEndPoint("StartToStart",o),e.saved.setEndPoint("EndToStart",a)),e},e.setCaretToStart=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?(e.saved.selectNodeContents(t),e.saved.collapse(!0)):e.textrange&&(e.saved.moveToElementText(t),e.saved.collapse(!0)),e},e.setCaretToBlockStart=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?(e.saved.selectNodeContents(t),e.saved.collapse(!0)):e.textrange&&(e.saved.moveToElementText(t),e.saved.collapse(!1),e.saved.move("character",-(t.innerText.length+1))),e},e.selectInlineStart=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?(e.saved.selectNodeContents(t),e.saved.collapse(!0).select()):e.textrange&&(t.innerHTML="a"+t.innerHTML,e.saved.moveToElementText(t),e.saved.collapse(!1),e.saved.move("character",-(t.innerText.length+1)),e.saved.moveEnd("character",1),e.saved.select(),e.saved.text=""),e},e.setCaretToEnd=function(t){return"string"==typeof t&&(t=document.getElementById(t)),e.domrange?(e.saved.selectNodeContents(t),e.saved.collapse(!1)):e.textrange&&(e.saved.moveToElementText(t),e.saved.collapse(!1)),e},e.isCollapsed=function(){return e.domrange?e.saved.collapsed:e.textrange?e.saved.isEqual(e.clone().collapseToStart().saved):void 0},e.compareEndPoints=function(t,n){var o;if(n&&n.saved&&(n=n.getNative()),e.domrange){o=window.Range;var a={StartToStart:o.START_TO_START,StartToEnd:o.END_TO_START,EndToStart:o.START_TO_END,EndToEnd:o.END_TO_END};return t=a[t],e.saved.compareBoundaryPoints(t,n)}return e.textrange?e.saved.compareEndPoints(t,n):void 0},e.isEqualTo=function(t){return t&&t.saved&&(t=t.getNative()),0!==e.compareEndPoints("StartToStart",t)?!1:0!==e.compareEndPoints("EndToEnd",t)?!1:!0},e.getStartNode=function(){if(e.domrange)return e.saved.startContainer;if(e.textrange){var t=e.saved.duplicate();return t.collapse(!0),t.parentElement()}},e.getEndNode=function(){if(e.domrange)return e.saved.endContainer;if(e.textrange){var t=e.saved.duplicate();return t.collapse(!1),t.parentElement()}},e.getParentNode=function(){return e.domrange?e.saved.commonAncestorContainer:e.textrange?e.saved.parentElement():void 0},e.getStartElement=function(){return e.util.getParentElement(e.getStartNode())},e.getEndElement=function(){return e.util.getParentElement(e.getEndNode())},e.getParentElement=function(){return e.domrange?e.util.getParentElement(e.saved.commonAncestorContainer):e.textrange?e.saved.parentElement():void 0},e.clone=function(){var n=t();return e.domrange?n.saved=e.saved.cloneRange():e.textrange&&(n.saved=e.saved.duplicate()),n.bookmark=e.cloneBookmark(),n},e.saveToDOM=function(t){var n,o,a,i,r;return t||(t="lasso"),e.removeDOMmarkers(t),r=e.isCollapsed(),n=e.clone().collapseToStart().getNative(),r||(o=e.clone().collapseToEnd().getNative()),e.domrange?(a=document.createElement("span"),a.innerHTML="&#x200b",a.id=t+"_range_start",n.insertNode(a),r||(i=document.createElement("span"),i.innerHTML="&#x200b",i.id=t+"_range_end",o.insertNode(i))):e.textrange&&(n.pasteHTML('<span id="'+t+'_range_start">&#x200b;</span>'),r||o.pasteHTML('<span id="'+t+'_range_end">&#x200b;</span>')),e=e.restoreFromDOM(t,!1)||e.reset()},e.restoreFromDOM=function(n,o){var a,i,r,s;return n&&""!==n&&n!==!0&&n!==!1||(n="lasso"),n===!0&&(o=!0),r=document.getElementById(n+"_range_start"),s=document.getElementById(n+"_range_end"),r?(a=t().actualSelectNode(r).collapseToEnd(),o!==!1&&r.parentNode.removeChild(r),s?(i=t().actualSelectNode(s).collapseToStart(),o!==!1&&s.parentNode.removeChild(s)):i=a,e=t().setStartToRangeStart(a).setEndToRangeEnd(i)):!1},e.isSavedRange=function(e){return e||(e="lasso"),document.getElementById(e+"_range_start")?!0:!1},e.removeDOMmarkers=function(e){var t,n;e||(e="lasso"),t=document.getElementById(e+"_range_start"),n=document.getElementById(e+"_range_end"),t&&t.parentNode.removeChild(t),n&&n.parentNode.removeChild(n)},e.bookmarkify=function(t){if(e.domrange){var n,o,a,i={};if(!t||!t.nodeType)return e;for(i.startoffset=e.saved.startOffset,i.endoffset=e.saved.endOffset,o=[],n=e.saved.startContainer;n!==t;)if(o.unshift(e.util.getNodeOffset(n)),n=n.parentNode,null===n)return e;for(a=[],n=e.saved.endContainer;n!==t;)if(a.unshift(e.util.getNodeOffset(n)),n=n.parentNode,null===n)return e;i.startnodeoffsets=o.join("-"),i.endnodeoffsets=a.join("-"),i.rootnode=t,e.bookmark=i}else e.textrange&&(e.bookmark=e.saved.getBookmark());return e},e.unbookmarkify=function(t){var n=e.bookmark;if(e.domrange){var o,a,i,r,s,l;if(!n.rootnode||!t)return e.setToEmpty();for(o=t,i=n.startnodeoffsets.split("-");i.length>0;){if(a=i.shift(),!o.childNodes||!o.childNodes[a])return e.setToEmpty();o=o.childNodes[a]}for(s=o,o=t,r=n.endnodeoffsets.split("-");r.length>0;){if(a=r.shift(),!o.childNodes||!o.childNodes[a])return e.setToEmpty();o=o.childNodes[a]}l=o,e.setToEmpty(),e.saved.setStart(s,n.startoffset),e.saved.setEnd(l,n.endoffset)}else e.textrange&&e.bookmark&&(e.reset().saved.moveToBookmark(n),e.bookmarkify());return e},e.clearBookmark=function(){return e.bookmark=!1,e},e.cloneBookmark=function(n){if(n||(n=e.bookmark),e.domrange)return n?{rootnode:n.rootnode,startnodeoffsets:n.startnodeoffsets,endnodeoffsets:n.endnodeoffsets,startoffset:n.startoffset,endoffset:n.endoffset}:!1;if(e.textrange){if(!n)return!1;var o=t().getNative();return o.moveToBookmark(n)?o.getBookmark():!1}},e.inspect=function(t){n.log({logid:t?t:"",startelement:e.getStartElement(),startnode:e.getStartNode(),endelement:e.getEndElement(),endnode:e.getEndNode(),text:e.getText(),html:e.getHTML(),parent:e.getParentNode()})},e.util={getParentElement:function(e){if(1!==e.nodeType)for(;1!==e.nodeType;)if(e=e.parentNode,null===e)return null;return e},getNodeOffset:function(e){if(e&&e.parentNode){for(var t=0;e.parentNode.childNodes[t]!==e;)t+=1;return t}}},e.init(),e},function(e){var t={version:"1.0pre",enabledplugins:[],ready:!1,active:!1,isEditing:!0,blockElemId:0,editorchrome:null,debug:!1};t.el={},t.api={},t.plugins={},e.ghostedit=t}(window),function(e){e.ghostedit.init=function(t,n){"string"==typeof t&&(t=document.getElementById(t));var o,a,i,r,s,l=e.ghostedit;if(l.options={},l.options=n||{},l.options.debug&&(l.debug=!0),l.browserEngine=l.util.detectEngines(),l.useMozBr=0!==l.browserEngine.gecko||0!==l.browserEngine.webkit||0!==l.browserEngine.opera,t.style.display="none",l.el.source=t,r=document.createElement("div"),r.id="ghostedit_uilayer",r.className="ghostedit_uilayer",r.innerHTML="<span style='position: absolute; display: none;left: 0; top: 0;line-height: 0'>ie bug fix</span>",t.parentNode.insertBefore(r,t),l.el.uilayer=r,l.history.init(),l.inout.init(),l.clipboard.init(),l.options.plugins=l.options.plugins||[],l.options.plugins.unshift("container","textblock"),l.options.plugins)for(o=0;l.options.plugins.length>o;o++)l.api.plugin.enable(l.options.plugins[o]);l.event.trigger("init"),i=l.inout.importHTML(t),t.parentNode.insertBefore(i,t),l.el.rootnode=i,a=i.getAttribute("data-ghostedit-handler"),l.plugins[a].focus(i);try{document.execCommand("styleWithCSS",!1,!1)}catch(d){}try{document.execCommand("enableObjectResizing",!1,!1)}catch(d){}l.selection.save(),l.history.reset(),l.history.saveUndoState(),s=document.getElementsByTagName("html")[0],l.util.addEvent(s,"dragenter",l.util.cancelEvent),l.util.addEvent(s,"dragleave",l.util.cancelEvent),l.util.addEvent(s,"dragover",l.util.cancelEvent),l.util.addEvent(s,"drop",l.util.cancelEvent),l.util.addEvent(i,"click",l.selection.save),l.util.addEvent(i,"mouseup",l.selection.save),l.util.addEvent(i,"keyup",l.selection.save),l.util.addEvent(i,"keydown",function(e){l.event.keydown(this,e)}),l.util.addEvent(i,"keypress",function(e){l.event.keypress(this,e)}),l.util.addEvent(i,"dragenter",l.util.cancelEvent),l.util.addEvent(i,"dragleave",l.util.cancelEvent),l.util.addEvent(i,"dragover",l.util.cancelEvent),l.util.addEvent(i,"drop",l.util.cancelEvent),i.focus(),l.plugins.container.focus(i),l.ready=!0,l.event.trigger("init:after")}}(window),function(e){var t={},n=e.ghostedit;t.register=function(e,t){return n.plugins[e]?!1:(n.plugins[e]=t,!0)},t.enable=function(e){if(!n.plugins[e])return!1;n.enabledplugins[e]&&t.disable(e);var o=n.plugins[e];"function"==typeof o.enable&&o.enable(),n.enabledplugins[e]=!0},t.disable=function(e){if(!n.enabledplugins[e]||!n.plugins[e])return!1;var t=n.plugins[e];"function"==typeof t.disable&&t.disable(),n.enabledplugins[e]=!1},e.ghostedit.api.plugin=t}(window),function(e,t){var n={};n.trim=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},n.preparefunction=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var o=n.concat(Array.prototype.slice.call(arguments));return e.apply(t?t:this,o)}},n.isFunction=function(e){return e?"function"!=typeof e?!1:!0:!1},n.cloneObject=function(e){var t,o,a,i;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){for(t=[],a=0,o=e.length;o>a;++a)t[a]=n.cloneObject(e[a]);return t}if(e instanceof Object){t={};for(i in e)e.hasOwnProperty(i)&&(t[i]=n.cloneObject(e[i]));return t}},n.addClass=function(e,t){e.className=n.trim(e.className)+" "+t},n.removeClass=function(e,t){var o=RegExp(t,"g");e.className=n.trim(e.className.replace(o,""))},n.cancelEvent=function(e){return e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):e&&(e.returnValue=!1),!1},n.cancelAllEvents=function(t){return t&&t.preventDefault?(t.stopPropagation(),t.preventDefault()):e.event&&(e.event.cancelBubble=!0),!1},n.preventDefault=function(e){return e&&e.preventDefault&&e.preventDefault(),!1},n.preventBubble=function(t){t&&t.stopPropagation&&t.stopPropagation(),e.event&&(e.event.cancelBubble=!0)},n.addEvent=function(e,n,o){e.addEventListener!==t?e.addEventListener(n,o,!1):e.attachEvent("on"+n,o)},n.removeEvent=function(e,n,o){e.removeEventListener!==t?e.removeEventListener(n,o,!1):e.detachEvent("on"+n,o)},n.ajax=function(n,o,a,i,r){var s,l,d;if(!n||!o)return!1;if(d=!1,!e.XMLHttpRequest||"file:"===e.location.protocol&&e.ActiveXObject)try{d=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(c){try{d=new e.ActiveXObject("MSXML2.XMLHTTP")}catch(u){}}else d=new e.XMLHttpRequest;return d?(o=o.toUpperCase(),s=(new Date).getTime(),n=n.replace(/(\?)+$/,""),l=-1===n.indexOf("?")?"?":"&","GET"===o?d.open(o,n+l+s+"&"+a,!0):d.open(o,n+l+s,!0),d.onreadystatechange=function(){var e;return 4===d.readyState?200===d.status?(e="xml"===r?d.responseXML:d.responseText,null!==i&&i(!0,e),!0):(null!==i&&i(!1,e),!1):t},d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),"POST"===o&&null!==a?d.send(a):d.send(),t):!1},n.detectEngines=function(){var t={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:null},n=navigator.userAgent;return e.opera?(t.ver=e.opera.version(),t.opera=parseFloat(t.ver)):/AppleWebKit\/(\S+)/.test(n)?(t.ver=RegExp.$1,t.webkit=parseFloat(t.ver)):/KHTML\/(\S+)/.test(n)||/Konqueror\/([^;]+)/.test(n)?(t.ver=RegExp.$1,t.khtml=parseFloat(t.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(n)?(t.ver=RegExp.$1,t.gecko=parseFloat(t.ver)):/MSIE ([^;]+)/.test(n)&&(t.ver=RegExp.$1,t.ie=parseFloat(t.ver)),t},e.ghostedit.util=n}(window),function(e,t){var n={listeners:[],listenerid:0,eventtypes:[],cancelKeypress:!1},o=e.ghostedit;n.keydown=function(t,a){var i,r,s,l;switch(o.selection.save(!1),a=a&&a.istest||!e.event?a:e.event,i=null!==a.keyCode?a.keyCode:a.charCode,n.trigger("input:keydown",{event:a,keycode:i}),i){case 8:case 46:if(n.cancelKeypress=!1,o.selection.savedRange.isCollapsed()===!1)return o.history.saveUndoState(),o.selection.deleteContents(8===i?"collapsetostart":"collapsetoend"),o.history.saveUndoState(),n.cancelKeypress=!0,o.util.cancelEvent(a);break;case 83:if(a.ctrlKey)return o.api.save(),o.util.cancelEvent(a);break;case 66:if(a.ctrlKey)return o.plugins.textblock.format.bold(),o.util.cancelEvent(a);break;case 73:if(a.ctrlKey&&!a.shiftKey)return o.plugins.textblock.format.italic(),o.util.cancelEvent(a);break;case 85:if(a.ctrlKey)return o.plugins.textblock.format.underline(),o.util.cancelEvent(a);break;case 90:if(a.ctrlKey)return o.history.undo(),o.util.cancelEvent(a);break;case 89:if(a.ctrlKey)return o.history.redo(),o.util.cancelEvent(a)}for(r=o.selection.getContainingGhostBlock();;){if(s=r.getAttribute("data-ghostedit-handler"),o.plugins[s]&&o.plugins[s].event&&o.plugins[s].event.keydown&&(l=o.plugins[s].event.keydown(r,i,a),l===!0))break;if(r=o.dom.getParentGhostBlock(r),!r)break}return o.selection.save(),!0},n.keypress=function(a,i){var r,s,l,d,c,u;switch(o.selection.save(),c=o.el.rootnode.innerHTML.length,u=o.history.undoData[o.history.undoPoint]!==t?o.history.undoData[o.history.undoPoint].content.string.length:0,i=i&&i.istest||!e.event?i:e.event,r=null!==i.keyCode?i.keyCode:i.charCode,n.trigger("input:keydown",{event:i,keycode:r}),"none"===o.selection.saved.type||o.selection.savedRange.isCollapsed()||i.ctrlKey||o.selection.deleteContents("collapsetostart"),r){case 8:if(n.cancelKeypress===!0)return n.cancelKeypress=!1,o.util.cancelEvent(i);break;case 13:o.util.cancelEvent(i)}for(s=o.selection.getContainingGhostBlock();;){if(l=s.getAttribute("data-ghostedit-handler"),o.plugins[l]&&o.plugins[l].event&&o.plugins[l].event.keypress&&(d=o.plugins[l].event.keypress(s,r,i),d===!0))break;if(s=o.dom.getParentGhostBlock(s),!s)break}return o.selection.save(),!0},n.addListener=function(e,t,o){var a,i,r,s;if("function"!=typeof t)return!1;for(a=n.listeners,a[e]&&"object"==typeof a[e]&&a[e]instanceof Array||(a[e]=[]),i=n.eventtypes,r=!0,s=0;i.length>s;s++)if(i[s]===e){r=!1;break}return r&&i.push(e),n.listenerid++,a[e].push({id:n.listenerid,callback:t,revokekey:o}),n.listenerid},n.removeListener=function(e,t){var o,a=n.listeners,i=[];if(a[e]){for(o=0;a[e].length>o;o++)a[e].id!==t&&i.push(a[e][o]);a[e]=i}},n.removeAllListeners=function(e){var t,a,i,r,s,l=[];if(e)for(t=n.listeners,a=n.eventtypes,r=0;a.length>r;r++){for(i=a[r],s=0;t[i].length>s;s++)t[i][s].revokekey&&t[i][s].revokekey===e||l.push(t[i][s]);t[i]=o.util.cloneObject(l),l=[]}},n.trigger=function(a,i){var r,s=n.listeners;if(i===t&&(i={}),s[a]&&"object"==typeof s[a]&&s[a]instanceof Array)for(o.debug&&(e.console.log(a),e.console.log(i)),r=0;s[a].length>r;r++)s[a][r].callback.call(this,i)},n.sendBackwards=function(e,t,a){var i,r,s,l=!1;if(a||(a={}),!o.dom.isGhostBlock(t))return!1;for(i=t;;){if((l=o.dom.getPreviousSiblingGhostBlock(i))?s="ahead":(l=o.dom.getParentGhostBlock(i))&&(s="top"),r=n.send(e,l,s,a),!r)return!1;if(r.handled===!0)return!0;i=l}},n.sendForwards=function(e,t,a){var i,r,s,l=!1;if(a||(a={}),!o.dom.isGhostBlock(t))return!1;for(i=t;;){if((l=o.dom.getNextSiblingGhostBlock(i))?s="behind":(l=o.dom.getParentGhostBlock(i))&&(s="bottom"),r=n.send(e,l,s,a),!r)return!1;if(r.handled===!0)return!0;i=l}},n.send=function(e,t,n,a){var i,r;return t?(i=t.getAttribute("data-ghostedit-handler"),o.plugins[i]&&o.plugins[i].dom&&o.plugins[i].dom.deleteevent?(r=o.plugins[i].dom.deleteevent(t,n,a),{handled:r}):{handled:!1}):!1},e.ghostedit.event=n}(window),function(e,t){var n={};n.getNodeOffset=function(e){var t,n;if(e&&e.parentNode){for(t=0,n=e.parentNode.childNodes;n[t]!==e;)t+=1;return t}},n.extractContent=function(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},n.cloneContent=function(e){var t,n,o=document.createDocumentFragment();for(n=0;e.childNodes.length>n;n++)t=e.childNodes[n],o.appendChild(t.cloneNode(!0));return o},n.parse=function(e,o){var a,i,r,s,l,d,c,u,g,f,p=!1;if(!e||!o||!e.nodeType)return!1;if(o.textnode=o.textnode||{},o.tags=o.tags||{},3===e.nodeType)return d=o.textnode.clean?e.nodeValue.replace(/[\n\r\t]/g,""):e.nodeValue,d.length>0?document.createTextNode(d):!1;if(1!==e.nodeType)return!1;if(c=e.tagName.toLowerCase(),u={contentsonly:!0},o.tags[c]&&(u=o.tags[c],"string"==typeof u.template&&(u=u.template),"string"==typeof u&&o.templates[u]&&(u=o.templates[u]),"string"==typeof u))return!1;if(p=u.contentsonly?document.createDocumentFragment():document.createElement(e.tagName.toLowerCase()),!u.ignorechildren)for(a=e.childNodes,r=0;a.length>r;r++)i=n.parse(a[r],o),i&&p.appendChild(i);if(u.contentsonly)return p.childNodes.length>0?p:!1;if(u.attributes)for(r=0;u.attributes.length>r&&(g=u.attributes[r],"string"==typeof g&&(g={name:g}),"string"==typeof g.name)&&(l=g.value||"class"===g.name?e.className:e.getAttribute(g.name),l!==t);r++){if(g.copy=!0,g.allowedvalues)for(g.copy=!1,s=0;g.allowedvalues.length>s;s++)if(g.allowedvalues[r]===l){g.copy=!0;break}g.copy&&("class"===g.name?p.className=l:p.setAttribute(g.name,l))}if(u.styles)for(r=0;u.styles.length>r&&(f=u.styles[r],"string"==typeof f&&(f={name:f}),"string"==typeof f.name)&&("float"===f.name&&(f.name=e.style.cssFloat?"cssFloat":"styleFloat"),l=f.value||e.style[f.name],l!==t);r++){if(f.copy=!0,f.allowedvalues)for(f.copy=!1,s=0;f.allowedvalues.length>s;s++)if(f.allowedvalues[s]===l){f.copy=!0;break}f.copy&&(p.style[f.name]=l)}return p},n.isGhostBlock=function(e){if(!e||!e.nodeType||1!==e.nodeType)return!1;var n=e.getAttribute("data-ghostedit-elemtype");return n!==t&&n!==!1&&null!==n?!0:!1},n.isChildGhostBlock=function(e,n){var o;if(!e||!n||!n.childNodes)return!1;if(1!==e.nodeType)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(null===e.getAttribute("data-ghostedit-elemtype"))return!1;var a=n.childNodes;for(o=0;a.length>o;o+=1)if(e===a[o])return!0;return!1},n.isGhostToplevel=function(e){return e&&e.getAttribute("data-ghostedit-isrootnode")===!0?!0:!1},n.getParentGhostBlock=function(e){if(!e)return!1;do if(e=e.parentNode,null===e)return!1;while(!n.isGhostBlock(e));return e},n.getFirstChildGhostBlock=function(e){var t,o;if(!e||!e.childNodes)return!1;for(t=e.childNodes,o=0;t.length>o;o+=1)if(n.isGhostBlock(t[o]))return t[o];return!1},n.getLastChildGhostBlock=function(e){var t,o;if(!e||!e.childNodes)return!1;for(t=e.childNodes,o=t.length-1;o>=0;o-=1)if(n.isGhostBlock(t[o]))return t[o];return!1},n.getPreviousSiblingGhostBlock=function(e){var t,o,a;if(!e||!e.parentNode)return!1;t=e.parentNode,o=n.getNodeOffset(e)-1,a=t.childNodes;do{if(n.isGhostBlock(a[o])===!0)return a[o];o-=1}while(o>=0);return!1},n.getNextSiblingGhostBlock=function(e){var t,o,a;if(!e||!e.parentNode)return!1;t=e.parentNode,o=n.getNodeOffset(e)+1,a=t.childNodes;do{if(n.isGhostBlock(a[o])===!0)return a[o];o+=1}while(a.length>o);return!1},n.getParentElement=function(e){if(1!==e.nodeType)for(;1!==e.nodeType;)if(e=e.parentNode,null===e)return null;return e},n.isDescendant=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},n.getFirstChildElement=function(e){var t,n;if(!e||!e.childNodes)return!1;for(t=e.childNodes,n=0;t.length>n;n+=1)if(1===t[n].nodeType)return t[n];return!1},n.getCertainParent=function(e,t){var n=[].slice.call(arguments);if(n.shift(),!e.apply(this,n))for(;!e.apply(this,n);)if(t=t.parentNode,n[0]=t,null===t)return!1;return t},e.ghostedit.dom=n}(window),function(e){var t={savedRange:null,nodepath:[],saved:{type:"none",data:null},archived:{type:"none",data:null}},n=e.ghostedit,o=e.lasso;t.save=function(e){var a;return e!==!1&&(e=!0),a=o().setToSelection(),t.isInEditdiv(a.getStartNode())?(t.saved.type="textblock",t.saved.data=a,t.savedRange=t.saved.data,n.event.trigger("selection:change"),t.updatePathInfo(),e&&n.event.trigger("ui:update"),!0):(t.saved.type="none",!1)},t.set=function(e,o,a){return a!==!1&&(a=!0),"string"==typeof e?(t.saved.type=e,t.saved.data=o,t.savedRange=t.saved.data,t.updatePathInfo(),n.event.trigger("selection:change"),a&&n.event.trigger("ui:update"),!0):undefined},t.restore=function(e,o,a){return e&&"string"==typeof e||(e=t.saved.type),o||(o=t.saved.data),"none"===e&&a&&(e=t.archived.type,o=t.archived.data),"none"===e?(t.clear(),!0):n.plugins[e]&&n.plugins[e].selection.restore?n.plugins[e].selection.restore(o)?!0:(t.clear(),!1):undefined},t.restoreValid=function(e,n){return t.restore(e,n,!0)},t.deleteContents=function(e){"collapsetostart"!==e&&"collapsetoend"!==e&&(e=!1);var a,i,r;for(r=t.getContainingGhostBlock();;){if(a=r.getAttribute("data-ghostedit-handler"),i=n.plugins[a].selection.deleteContents(r,e),i===!0)break;if(r=n.dom.getParentGhostBlock(r),!r)break}switch(e){case"collapsetostart":o().setToSelection().collapseToStart().select();break;case"collapsetoend":o().setToSelection().collapseToEnd().select()}t.save()},t.isSameAs=function(e){return e&&e.type?e.type!==t.saved.type?!1:"none"===e.type?!0:n.plugins[e.type]&&n.plugins[e.type].selection.compare?n.plugins[e.type].selection.compare(e.data,t.saved.data):!1:!1},t.clear=function(){o().clearSelection(),t.saved={type:"none",data:null}},t.isInEditdiv=function(e){if(1!==e.nodeType||"true"!==e.getAttribute("data-ghostedit-isrootnode"))for(;1!==e.nodeType||"true"!==e.getAttribute("data-ghostedit-isrootnode");){if(null===e)return!1;if(e=e.parentNode,null===e)return!1}return!0},t.updatePathInfo=function(e){if(e||(e=t.saved.data),e.nodeType||(e=e.getParentNode()),t.nodepath=[],1!==e.nodeType||"true"!==e.getAttribute("data-ghostedit-isrootnode"))for(;1!==e.nodeType||"true"!==e.getAttribute("data-ghostedit-isrootnode");){if(null===e)return null;if(1===e.nodeType&&t.nodepath.push(e),e=e.parentNode,null===e)return!1}e&&"true"===e.getAttribute("data-ghostedit-isrootnode")&&t.nodepath.push(e)},t.getContainingGhostBlock=function(){var e=t.saved.data;if(e.nodeType||(e=e.getParentNode()),!e)return!1;for(;!n.dom.isGhostBlock(e);)if(e=e.parentNode,null===e)return!1;return e},e.ghostedit.selection=t}(window),function(e){var t={},n=e.ghostedit;t.init=function(){t.reset(),n.event.addListener("selection:change",function(){n.history.selectionchanged=!0}),n.api.importHTML=function(e){return t.importHTML(e)},n.api.exportHTML=function(){return t.exportHTML()}},t.reset=function(){t.importhandlers=[]},t.importHTML=function(e){var t;return!e||1>e.childNodes.length?!1:(t=n.plugins.container.inout.importHTML(e),t.className="ghostedit_rootnode",t.setAttribute("data-ghostedit-isrootnode","true"),t.contentEditable="true",n.event.trigger("import:after",{rootnode:t}),t)},t.exportHTML=function(){var e,t=n.el.rootnode;return n.event.trigger("export:before"),t.contentEditable=!1,e=n.plugins.container.inout.exportHTML(t,!1),t.contentEditable=!0,n.event.trigger("export:after"),e},t.openPreview=function(){e.open(n.options.previewurl)},t.registerimporthandler=function(e){var n,o,a;if("function"!=typeof e)return!1;if(2>arguments.length)return!1;for(o=Array.prototype.slice.call(arguments),o.shift(),n=0;o.length>n;n++)a=o[n],t.importhandlers[a]=e},e.ghostedit.inout=t}(window),function(e,t){var n={},o=e.ghostedit;n.init=function(){n.reset(),o.event.addListener("selection:change",function(){n.selectionchanged=!0}),o.api.undo=function(){return n.undo()},o.api.redo=function(){return n.redo()}},n.reset=function(){n.undoData=[],n.undoPoint=0,n.selectionchanged=!0},n.saveUndoState=function(e){var t,a,i,r,s,l,d=o.el.rootnode;e!==!0&&(e=!1),o.event.trigger("history:save:before"),t=n.undoPoint,a=n.undoData,l=a[t],l||(e=!0),s={id:"",selection:{type:o.selection.saved.type,data:o.selection.saved.data},content:{string:d.innerHTML}},e||(i=l.content.string!==s.content.string?!0:!1,r=!o.selection.isSameAs(l.selection)),(e||r||i)&&(s.content.dom=o.dom.extractContent(d.cloneNode(!0)),e||i?(t>0&&n.undoData.splice(0,t),n.undoData.unshift(s),n.undoPoint=0):n.undoData[t]=s),o.event.trigger("history:save:after")},n.restoreUndoPoint=function(e){var a=n.undoData,i=a[e];return!i||1>i.content.string.length?!1:(o.event.trigger("history:restore:before"),o.el.rootnode.innerHTML="",o.el.rootnode.appendChild(o.dom.cloneContent(i.content.dom)),o.selection.restore(i.selection.type,i.selection.data),o.event.trigger("history:restore:after"),t)},n.undo=function(){var e=n.undoPoint,a=n.undoData,i=o.el.rootnode;a[e+1]===t||0>=a[e+1].content.string.length||(o.event.trigger("history:undo:before"),a[e].content.string!==i.innerHTML?(n.saveUndoState(),e=1):(0===e&&n.saveUndoState(),e=n.undoPoint,e+=1),n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=a,o.event.trigger("history:undo:after"))},n.redo=function(){var e=n.undoPoint,a=n.undoData,i=o.el.rootnode;e>0&&a[e-1]!==t&&a[e-1].content.string.length>0&&(o.event.trigger("history:redo:before"),a[e].content.string!==i.innerHTML?n.saveUndoState(!0):(e-=1,n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=a),o.event.trigger("history:redo:after"))},e.ghostedit.history=n}(window),function(e){var t,n,o={},a=e.lasso,i=e.ghostedit,r=e.console||{};r.log=r.log||function(){},o.init=function(){o.paste.init(),o.cut.init()},t={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},t.init=function(){i.event.addListener("init:after",function(){i.util.addEvent(i.el.rootnode,"paste",function(e){t.handle(e)})},"clipboard")},t.handle=function(e){return i.history.saveUndoState(),t.savedundodata=i.history.undoData,t.savedundopoint=i.history.undoPoint,t.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(t.triedpasteimage=!0),i.el.rootnode.innerHTML=/text\/html/.test(e.clipboardData.types)?e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)||i.browserEngine.opera?e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"",t.waitfordata(),i.util.cancelEvent(e)):(i.el.rootnode.innerHTML="",t.waitfordata(),!0)},t.waitfordata=function(){var e=i.el.rootnode;e.childNodes&&e.childNodes.length>0?t.process():setTimeout(t.waitfordata,20)},t.process=function(){var e,n,o,a;if(e=document.createElement("div"),e=i.plugins.container.inout.importHTML(i.el.rootnode),r.log("processed content"),r.log(e.cloneNode(!0)),i.history.undoData=t.savedundodata,i.history.undoPoint=t.savedundopoint,i.history.restoreUndoPoint(i.history.undoPoint),i.selection.save(),i.selection.deleteContents(),i.selection.save(),o=i.dom.getFirstChildGhostBlock(e)){for(i.selection.saved.data.isCollapsed()?i.selection.saved.data.saveToDOM("ghostedit_paste_start"):(i.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),i.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),n=function(){return i.selection.saved.data.getStartNode()},a={isfirst:!0,islast:i.dom.getLastChildGhostBlock(e)===o?!0:!1},n=t.callHandler(n,o,a),o=i.dom.getLastChildGhostBlock(e),o&&(n=function(){return i.selection.saved.data.getEndNode()},a={isfirst:!1,islast:!0},t.callHandler(n,o,a)),n=function(){return i.selection.saved.data.getParentNode()},a={isfirst:!1,islast:!1};o=i.dom.getFirstChildGhostBlock(e);)t.callHandler(n,o,a);i.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),i.selection.saved.data.isSavedRange("ghostedit_paste_end")&&i.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),i.selection.save(),i.history.undoData=t.savedundodata,i.history.undoPoint=t.savedundopoint,i.history.saveUndoState(),t.triedpasteimage&&i.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}),i.event.trigger("clipboard:paste:after")}},t.callHandler=function(e,t,n){var o,s,l;for(i.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),a().isSavedRange("ghostedit_paste_end")&&i.selection.saved.data.setEndToRangeEnd(a().restoreFromDOM("ghostedit_paste_end",!1)),o=e(),i.dom.isGhostBlock(o)||(o=i.dom.getParentGhostBlock(o));;){if(!o)break;if(s=o.getAttribute("data-ghostedit-handler"),!i.plugins[s]||!i.plugins[s].paste)break;if(r.log("Call handler: ("+(n.isfirst?"first":n.islast?"last":"normal")+")"+s),r.log(o.cloneNode(!0)),r.log(t.cloneNode(!0)),l=i.plugins[s].paste.handle(o,t,n),r.log("result: "+l),l){t.parentNode.removeChild(t);break}i.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),a().isSavedRange("ghostedit_paste_end")&&i.selection.saved.data.setEndToRangeEnd(a().restoreFromDOM("ghostedit_paste_end",!1)),o=i.dom.getParentGhostBlock(o)}},n={savedcontent:null,savedundodata:null,savedundopoint:null},n.init=function(){i.event.addListener("init:after",function(){i.util.addEvent(i.el.rootnode,"cut",function(e){n.handle(e)})},"clipboard")},n.handle=function(){return i.history.saveUndoState(),n.savedundodata=i.history.undoData,n.savedundopoint=i.history.undoPoint,setTimeout(n.cleanup,20),!0},n.cleanup=function(){i.history.undoData=n.savedundodata,i.history.undoPoint=n.savedundopoint,i.history.restoreUndoPoint(i.history.undoPoint),i.selection.save(),i.selection.deleteContents(),i.selection.save(),i.history.saveUndoState()
},o.paste=t,o.cut=n,e.ghostedit.clipboard=o}(window),function(e,t){var n={},o=e.lasso,a=e.ghostedit,i=e.console||{};i.log=i.log||function(){},n.enable=function(){return n.format.init(),a.inout.registerimporthandler(n.inout.importHTML,"p","h1","h2","h3","h4","h5","h6"),a.inout.registerimporthandler(n.inout.importHTML,"#textnode","b","strong","i","em","u","strike","span"),a.event.addListener("history:save:after",function(){"textblock"===a.selection.saved.type&&a.selection.saved.data.bookmarkify(a.el.rootnode)}),a.event.addListener("history:save:after",function(){"textblock"===a.selection.saved.type&&(a.selection.saved.data=a.selection.saved.data.clone())}),a.api.insert=a.api.insert||{},a.api.insert.character=function(e){return n.insert.character(e)},a.api.insert.br=function(){return n.insert.br},!0},n.event={keydown:function(e,t,o){switch(t){case 8:return n.event.backspace(e,o);case 46:return n.event.deletekey(e,o)}},keypress:function(e,o,a){return 13===o?n.event.enterkey(e,a):t},backspace:function(e,t){if(n.selection.isAtStartOfTextBlock()!==!0)return!0;var o={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:a.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");a.plugins[n].dom.removechild(t,e)},!1,e)}};return a.event.sendBackwards("delete",e,o),a.event.cancelKeypress=!0,a.util.cancelEvent(t),!0},deletekey:function(e,t){return n.selection.isAtEndOfTextBlock()!==!0?!0:(a.event.sendForwards("delete",e),a.event.cancelKeypress=!0,a.util.cancelEvent(t),!0)},enterkey:function(e,t){return a.history.saveUndoState(),t.shiftKey?(n.insert.br(),n.mozBrs.tidy(e)):n.split(e),a.history.saveUndoState(),a.util.cancelEvent(t),!0}},n.dom={deleteevent:function(e,t,i){var r,s,l;switch(t){case"ahead":return a.history.saveUndoState(),n.isEmpty(e)?(r=a.dom.getParentGhostBlock(e),s=r.getAttribute("data-ghostedit-handler"),a.plugins[s].dom.removechild(r,e)):(e.innerHTML+="<span id='ghostedit_selection_marker'>&#x200b;</span>",i.merge&&i.merge.sourcecontent&&("inlinehtml"===i.merge.contenttype||"text"===i.merge.contenttype)&&(e.innerHTML+=i.merge.sourcecontent),n.mozBrs.tidy(e),i.merge.callback(),o().selectNode("ghostedit_selection_marker").select(),document.getElementById("ghostedit_selection_marker").parentNode.removeChild(document.getElementById("ghostedit_selection_marker")),a.selection.save()),a.history.saveUndoState(),!0;case"behind":return l=a.selection.getContainingGhostBlock(),i={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:a.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");a.plugins[n].dom.removechild(t,e)},!1,e)}},a.event.sendBackwards("delete",e,i),!0}}},n.selection={compare:function(e,t){return e&&e.isEqualTo?e.isEqualTo(t):!1},restore:function(e){return e&&e.unbookmarkify?(e.unbookmarkify(a.el.rootnode),e.select(),!0):!1},deleteContents:function(e){var t,n,i;return i=a.selection.savedRange.clone(),t=o().setCaretToStart(e),n=o().setCaretToEnd(e),-1===i.compareEndPoints("StartToStart",t)&&i.setStartToRangeStart(t),1===i.compareEndPoints("EndToEnd",n)&&i.setEndToRangeEnd(n),i.deleteContents(),!0},getTextBlockNode:function(e){if(1!==e.nodeType||"textblock"!==e.getAttribute("data-ghostedit-elemtype"))for(;1!==e.nodeType||"textblock"!==e.getAttribute("data-ghostedit-elemtype");)if(e=e.parentNode,null===e)return!1;return e},getStartTextBlockNode:function(){return n.selection.getTextBlockNode(a.selection.savedRange.getStartNode())},getEndTextBlockNode:function(){return n.selection.getTextBlockNode(a.selection.savedRange.getEndNode())},isAtStartOfTextBlock:function(e){var t,i,r,s,l,d,c,u,g,f=!1;if(g=!1,!e||!e.isLassoObject){if("textblock"!==a.selection.saved.type)return!1;e=a.selection.saved.data,g=!0}if(document.createRange){if(t=e,t.isCollapsed()&&0===t.getNative().startOffset&&(f=!0,u=a.selection.savedRange.getStartNode()),!u)return f;for(;1!==u.nodeType||"textblock"!==u.getAttribute("data-ghostedit-elemtype");){if(u!==u.parentNode.childNodes[0]){if(s=!1,3===u.parentNode.childNodes[0].nodeType&&0===u.parentNode.childNodes[0].length||1===u.parentNode.childNodes[0].nodeType&&"moz_dirty"===u.parentNode.childNodes[0].className)for(r=1;u.parentNode.childNodes.length>r;r+=1){if(l=u.parentNode.childNodes[0],u===u.parentNode.childNodes[r]){s=!0;break}if(!(3===l.nodeType&&0===l.length||1===l.nodeType&&"moz_dirty"===l.className))break}if(s!==!0){f=!1;break}}u=u.parentNode}}else document.selection&&(i=e.clone().bookmarkify(),d=n.selection.getStartTextBlockNode(),c=o().selectNodeContents(d),i.unbookmarkify(),c.getHTML()===c.setStartToRangeStart(i).getHTML()&&(f=!0),g&&(a.selection.savedRange=i.select()));return f},isAtEndOfTextBlock:function(){var e,t,i,r,s,l,d=!1;return a.selection.savedRange.isCollapsed()?(s=n.selection.getEndTextBlockNode(),document.createRange?(i=document.createElement("div"),i.appendChild(a.selection.savedRange.getNative().cloneContents()),t=a.selection.savedRange.getNative(),t.setEnd(s,s.childNodes.length),r=document.createElement("div"),i.appendChild(t.cloneContents()),n.mozBrs.clear(i),n.mozBrs.clear(r),i.innerHTML===r.innerHTML&&(d=!0)):document.selection&&(e=a.selection.savedRange.clone().bookmarkify(),s.innerHTML+='<span id="range_marker">&#x200b;</span>',l=o().selectNode("range_marker"),document.getElementById("range_marker").parentNode.removeChild(document.getElementById("range_marker")),e.unbookmarkify(),0===e.compareEndPoints("EndToEnd",l)&&(d=!0),a.selection.savedRange=e.select()),d):!1},extendtoword:function(e,t){var a,i;if(e=e.clone().getNative(),document.createRange){if(a=n.selection.findwordstart(e.startContainer,e.startOffset),i=n.selection.findwordend(e.endContainer,e.endOffset),t){if(e.startContainer===a.node&&e.startOffset===a.offset)return o().setFromNative(e);if(e.endContainer===i.node&&e.endOffset===i.offset)return o().setFromNative(e)}e.setStart(a.node,a.offset),e.setEnd(i.node,i.offset)}else e.expand("word")," "===e.htmlText.split().reverse()[0]&&e.moveEnd("character",-1);return o().setFromNative(e)},findwordstart:function(e,o){var i,r,s,l,d=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(3===e.nodeType){if(i=e.nodeValue.substring(0,o),r=i.search(d),-1!==r){for(s=r+1;-1!==(r=i.substring(s).search(d));)s+=r+1;return{node:e,offset:s}}}else if(1===e.nodeType&&o>0)return n.selection.findwordstart(e.childNodes[o-1],e.childNodes[o-1].length);return n.isTextBlock(e)?{node:e,offset:o}:(l=e.previousSibling,l?3===l.nodeType?n.selection.findwordstart(l,l.nodeValue.length):1===l.nodeType?n.selection.findwordstart(l,l.childNodes.length):t:n.selection.findwordstart(e.parentNode,a.dom.getNodeOffset(e)))},findwordend:function(e,t){var o,i,r,s,l=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(3===e.nodeType){if(o=e.nodeValue.substring(t),i=o.search(l),-1!==i)return r=t+i,{node:e,offset:r}}else if(1===e.nodeType&&e.childNodes.length>t)return n.selection.findwordend(e.childNodes[t],0);return n.isTextBlock(e)?{node:e,offset:t}:(s=e.nextSibling,s?n.selection.findwordend(s,0):n.selection.findwordend(e.parentNode,a.dom.getNodeOffset(e)+1))}},n.inout={handledtags:{h1:"block",h2:"block",h3:"block",h4:"block",h5:"block",h6:"block",p:"block",b:"child",i:"child",u:"child",strong:"child",em:"child",strike:"child",br:"child",a:"contents",span:"contents"},parserules:{textnode:{clean:!0},tags:{h1:"textblock",h2:"textblock",h3:"textblock",h4:"textblock",h5:"textblock",h6:"textblock",p:"textblock",b:{},i:{},u:{},strong:{},em:{},strike:{},br:{attributes:[{name:"class",allowedvalues:["moz_dirty"]}]}},templates:{textblock:{attributes:["class"],styles:[{name:"textAlign",allowedvalues:["left","right","center","justified"]},{name:"clear",allowedvalues:["left","right"]}]}}},importHTML:function(e){var t,o,i,r,s,l,d;switch(l=n.inout.isHandleableNode(e)){case"block":return o=e.tagName.toLowerCase(),t=a.dom.parse(e,n.inout.parserules),a.blockElemId+=1,t.id="ghostedit_textblock_"+a.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","textblock"),t.setAttribute("data-ghostedit-handler","textblock"),t.ondragenter=function(){return!1},t.ondragleave=function(){return!1},t.ondragover=function(){return!1},t.ondrop=function(e){var t,n;n=e.dataTransfer.getData("Text")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),a.image.focus(t)},t.onresizestart=function(e){return a.util.cancelEvent(e)},n.mozBrs.tidy(t),t;case"child":case"contents":case"text":t=n.create("p"),t.setAttribute("data-ghostedit-importinfo","wasinline"),r=0,i=e;do d=a.dom.parse(i,n.inout.parserules),d&&(r+=1,t.appendChild(d),s=i,i=i.nextSibling,r>1&&s.parentNode.removeChild(s));while(n.inout.isHandleableNode(i)&&"block"!==n.inout.isHandleableNode(i));return n.mozBrs.tidy(t),r>0?t:!1}return!1},exportHTML:function(e){if(!e||!a.dom.isGhostBlock(e)||"textblock"!==e.getAttribute("data-ghostedit-elemtype"))return!1;var t,o="",i="";return t=e,n.mozBrs.clear(t),o+="<"+t.tagName.toLowerCase(),""!==t.style.textAlign&&(i+="text-align:"+t.style.textAlign+";"),""!==t.style.clear&&(i+="clear:"+t.style.clear+";"),i.length>0&&(o+=" style='"+i+"'"),t.className.length>0&&!/ghostedit/.test(t.className)&&(o+=" class='"+t.className+"'"),o+=">",o+=t.innerHTML,o+="</"+t.tagName.toLowerCase()+">",n.mozBrs.tidy(t),{content:o}},isHandleableNode:function(e){var t;return e&&e.nodeType?3===e.nodeType?e.nodeValue.replace(/[\n\r\t]/g,"").length>0?"text":!1:1!==e.nodeType?!1:"textblock"===e.getAttribute("data-ghostedit-elemtype")?"block":a.dom.isGhostBlock(e)?!1:(t=e.tagName.toLowerCase(),n.inout.handledtags[t]?n.inout.handledtags[t]:!1):!1}},n.paste={handle:function(e,o,r){return a.dom.isGhostBlock(e)&&a.dom.isGhostBlock(o)?(i.log(r),r.isfirst?n.paste.handleFirst(e,o,r):r.islast?n.paste.handleLast(e,o,r):(n.paste.split(e),!1)):t},handleFirst:function(e,t){return"p"===t.tagName.toLowerCase()||t.tagName===e.tagName?(i.log("paste (first):"),n.mozBrs.clear(t),o().removeDOMmarkers("ghostedit_paste_start"),t.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t1'>&#x200b;</span>",document.createRange?a.selection.saved.data.collapseToStart().getNative().insertNode(a.dom.extractContent(t)):a.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1},handleLast:function(e,t){return"p"===t.tagName.toLowerCase()||t.tagName===e.tagName?(i.log("paste (last):"),a.selection.saved.data.isCollapsed()&&(n.paste.split(e),a.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),o().isSavedRange("ghostedit_paste_end")&&a.selection.saved.data.setEndToRangeEnd(o().restoreFromDOM("ghostedit_paste_end",!1))),n.mozBrs.clear(t),o().removeDOMmarkers("ghostedit_paste_end"),t.innerHTML+="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>",document.createRange?a.selection.saved.data.collapseToEnd().getNative().insertNode(a.dom.extractContent(t)):a.selection.saved.data.collapseToEnd().getNative().pasteHTML(t.innerHTML),!0):!1},split:function(e,t){var i,r=!1;return t=t||a.selection.saved.data,t=t.clone().collapseToStart(),a.dom.isDescendant(e,document.getElementById("ghostedit_paste_start_range_start"))&&(r=!0),r&&o().removeDOMmarkers("ghostedit_paste_start"),i=n.split(e,t),r&&(i.block1.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t2'>&#x200b;</span>",n.mozBrs.tidy(i.block1)),o().removeDOMmarkers("ghostedit_paste_end"),i.block2.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+i.block2.innerHTML,n.mozBrs.tidy(i.block2),i}},n.isTextBlock=function(e){return a.dom.isGhostBlock(e)?"textblock"!==e.getAttribute("data-ghostedit-elemtype")?!1:!0:!1},n.isEmpty=function(e){var n,o,a,i;if(n=e.innerText||e.textContent,n&&n.length>1)return!1;if(a=e.getElementsByTagName("br"),o=e.getElementsByTagName("img"),0===a.length&&0===o.length)return!0;for(i=0;a.length>i;i+=1)if(a[i].MozDirty===t&&!/moz_dirty/.test(a[i].className))return!1;return!0},n.isFirst=function(e){var t,n;for(t=a.el.rootnode,n=0;t.getElementsByTagName("*").length>n;n+=1)if("textblock"===t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype"))return t.getElementsByTagName("*")[n]===e?!0:!1},n.isLast=function(e){var t,n;for(t=a.el.rootnode,n=t.getElementsByTagName("*").length-1;n>0;n-=1)if("textblock"===t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype"))return t.getElementsByTagName("*")[n]===e?!0:!1},n.count=function(){var e,t,n;for(e=a.el.rootnode,t=0,n=0;e.getElementsByTagName("*").length>n;n+=1)"textblock"===e.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")&&(t+=1);return t},n.create=function(e,t,o){var i;return o||(a.blockElemId+=1,o="ghostedit_textblock_"+a.blockElemId),t=t&&(t.length&&t.length>0||t.nodeType)?t:"",i=document.createElement(e),i.id=o,t.nodeType?(t=a.dom.parse(t,{textnode:{clean:!0},tags:{b:{},i:{},u:{},strong:{},em:{},strike:{},br:{}}}),t&&i.appendChild(t)):i.innerHTML=t,i.setAttribute("data-ghostedit-iselem","true"),i.setAttribute("data-ghostedit-elemtype","textblock"),i.setAttribute("data-ghostedit-handler","textblock"),i.ondragenter=function(){return!1},i.ondragleave=function(){return!1},i.ondragover=function(){return!1},i.ondrop=function(e){var t,n;n=e.dataTransfer.getData("Text")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),a.image.focus(t)},i.onresizestart=function(e){return a.util.cancelEvent(e)},n.mozBrs.tidy(i),i},n.remove=function(e){var i,r,s,l,d,c;for(a.selection.save(),a.history.saveUndoState(),i="",i=e.innerHTML,r=a.el.rootnode,c=r.getElementsByTagName("*"),d=!1,l=c.length-1;l>=0;l-=1){if(d===!0&&"textblock"===c[l].getAttribute("data-ghostedit-elemtype")){s=c[l];break}c[l]===e&&(d=!0)}return n.isEmpty(s)?(r.removeChild(s),o().setCaretToStart(e).select(),a.selection.save(),a.history.saveUndoState(),t):(r.removeChild(e),o().setCaretToEnd(s).select(),a.selection.save(),s.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+i,n.mozBrs.tidy(s),o().selectNode("ghostedit_marker").deleteContents().select(),document.getElementById("ghostedit_marker")&&document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),a.selection.save(),a.history.saveUndoState(),t)},n.focus=function(e){return e&&1===e.nodeType&&"textblock"===e.getAttribute("data-ghostedit-elemtype")?(o().setCaretToEnd(e).select(),a.selection.save(),!0):!1},n.merge=function(e,t,i){var r,s,l,d;return i===!1?e:e===t?e:(r=e.getAttribute("data-ghostedit-elemtype"),s=t.getAttribute("data-ghostedit-elemtype"),"textblock"!==r||"textblock"!==s?!1:(e.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t.innerHTML,l=t.parentNode,d=l.getAttribute("data-ghostedit-handler"),a.plugins[d].dom.removechild(l,t),n.mozBrs.tidy(e),o().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),e))},n.split=function(e,t){var i,r,s,l,d,c,u,g,f,p,m;if(m=!1,!t||!t.isLassoObject){if(a.selection.save(),"textblock"!==a.selection.saved.type)return!1;t=a.selection.saved.data,m=!0}return t=t.clone().collapseToStart(),r=n.selection.isAtStartOfTextBlock()===!0?!0:!1,s=n.selection.isAtEndOfTextBlock()===!0?!0:!1,i=r&&!s?"before":"after",l="before"===i||s?"p":n.selection.getStartTextBlockNode().tagName,n.mozBrs.tidy(e),r||s?d="":document.createRange?(c=o().selectNodeContents(e).setStartToRangeStart(t),d=c.getHTML(),c.deleteContents()):document.selection&&(c=o().selectNode(e),c.setStartToRangeEnd(t),d=c.getHTML(),c.getNative().text=""),(g=n.create(l,d))?(f=a.dom.getParentGhostBlock(e),p=f.getAttribute("data-ghostedit-handler"),(u=a.plugins[p].dom.addchild(f,i,e,g,{contentlength:d.length}))?(g.innerHTML="dummy",o().selectNode(g).select(),g.innerHTML=d,n.mozBrs.tidy(g),c="before"===i?o().setCaretToBlockStart(e):o().setCaretToBlockStart(g),m&&(c.select(),a.selection.save()),{block1:"before"===i?g:e,block2:"before"===i?e:g,caretposition:c}):!1):!1},n.mozBrs={checkifcontains:function(e){var n,o;for(n=e.getElementsByTagName("br"),o=0;n.length>o;o+=1)if(n[o].MozDirty!==t)return!0;return!1},insert:function(e){var t;t=document.createElement("br"),t.setAttribute("_moz_dirty",""),t.className="moz_dirty",e.appendChild(t)},clear:function(e){var n,o;for(n=e.getElementsByTagName("br"),o=0;n.length>o;o+=1)(n[o].MozDirty!==t||/moz_dirty/.test(n[o].className))&&(n[o].parentNode.removeChild(n[o]),o--)},tidy:function(e){n.mozBrs.clear(e),a.useMozBr&&n.mozBrs.insert(e)}},n.insert={character:function(e){"textblock"===a.selection.saved.type&&(a.selection.restore(),a.selection.savedRange.pasteText(e))},br:function(){var t,n,o;e.getSelection?(t=e.getSelection(),t.getRangeAt(0).collapse(!1),n=document.createElement("br"),n.id="newBr",t.getRangeAt(0).insertNode(n),t.getRangeAt(0).selectNode(n.parentNode),o=document.createRange(),o.setStartAfter(n),o.setEndAfter(n),t.removeAllRanges(),t.addRange(o),document.getElementById("newBr").removeAttribute("id")):document.selection&&(o=document.selection.createRange(),o.collapse(!1),o.pasteHTML("<br id='newBr' />"),o.moveToElementText(document.getElementById("newBr")),o.collapse(!1),o.select(),document.getElementById("newBr").removeAttribute("id"))}},n.format={init:function(){a.api.format=a.api.format||{},a.api.format.setStyle=function(e,t){n.format.formatSelected(n.format.setTagType,{tagname:e,newclass:t})},a.api.format.alignText=function(e){return/left|right|center|justify/.test(e)?(n.format.formatSelected(n.format.alignText,{alignDirection:e}),t):!1},a.api.format.bold=function(){n.format.formatSelected(n.format.bold)},a.api.format.italic=function(){n.format.formatSelected(n.format.italic)},a.api.format.underline=function(){n.format.formatSelected(n.format.underline)},a.api.format.strikethrough=function(){n.format.formatSelected(n.format.strikethrough)},a.api.format.textColor=function(e){n.format.formatSelected(n.format.textColor,{color:e})}},useCommand:function(e,t){document.execCommand(e,!1,t)},getNextNode:function(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},getNodesInRange:function(e){var t,o=e.getStartNode(),a=e.getEndNode(),i=e.getParentNode(),r=[];for(t=o.parentNode;t&&(r.push(t),t!==i);t=t.parentNode);for(r.reverse(),t=o;t&&(r.push(t),t!==a);t=n.format.getNextNode(t));return r},useCommandOnWord:function(e){var t,i;a.selection.savedRange.isCollapsed()&&n.selection.getStartTextBlockNode()&&(t=a.selection.savedRange.clone(),document.createRange&&(i=document.createElement("span"),i.id="ghostedit_marker",t.getNative().insertNode(i)),!document.createRange&&document.selection&&t.getNative().pasteHTML("<span id='ghostedit_marker'>z</span>"),t.selectNode("ghostedit_marker"),t=n.selection.extendtoword(t,!0),t.select()),n.format.useCommand(e),document.getElementById("ghostedit_marker")&&(o().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker"))),a.selection.save()},bold:function(){n.format.useCommand("bold")},italic:function(){n.format.useCommand("italic")},underline:function(){n.format.useCommand("underline")},strikethrough:function(){n.format.useCommand("strikethrough")},textColor:function(e){n.format.useCommand("foreColor",e)},formatSelected:function(e,t){var o,i,r,s,l,d,c;if(a.selection.save(),a.history.saveUndoState(),i=n.selection.getStartTextBlockNode(),r=n.selection.getEndTextBlockNode(),i&&r){for(o=i,l=!1;;){if(o===a.el.rootnode||null===o)break;if(n.isTextBlock(o)){if(o===r&&(l=!0),o=n.format.formatTextBlock(o,a.selection.saved.data.clone(),e,t),l)break;o=o.nextSibling?o.nextSibling:o.parentNode}else if(a.dom.isDescendant(o,r))o=a.dom.getFirstChildElement(o);else for(s=o,o=o.nextSibling?o.nextSibling:o.parentNode,c=s.getElementsByTagName("*"),d=0;c.length>d;d+=1)n.isTextBlock(c[d])&&n.format.formatTextBlock(c[d],a.selection.saved.data.clone(),e,t)}a.selection.save(),a.history.saveUndoState()}a.history.saveUndoState()},formatTextBlock:function(e,n,i,r){var s,l,d;return r||(r={}),r.textblock=e,n=n.clone(),s=o().setCaretToStart(e),l=o().setCaretToEnd(e),-1===n.compareEndPoints("EndToStart",s)||1===n.compareEndPoints("StartToEnd",l)?!1:(-1===n.compareEndPoints("StartToStart",s)&&n.setStartToRangeStart(s),1===n.compareEndPoints("EndToEnd",l)&&n.setEndToRangeEnd(l),a.selection.saved.data.clone().saveToDOM("ghostedit_format"),n.select(),d=i(r),o().restoreFromDOM("ghostedit_format").select(),a.selection.save(),d&&d.nodeType!==t?d:e)},alignText:function(e){for(var i=o().setToSelection().getParentElement();!a.dom.isGhostBlock(i);)if(i=i.parentNode,null===i)return!1;return n.isTextBlock(i)?(i.style.textAlign=e.alignDirection,t):!1},setTagType:function(e){var o,i,r,s,l,d;return o=e.textblock,i=e.tagname,r=e.newclass,n.isTextBlock(o)?(l="ghostedit_textblock_"+o.id.replace("ghostedit_textblock_",""),d=n.create(i),d.appendChild(a.dom.extractContent(o)),n.mozBrs.tidy(d),d.setAttribute("style",o.getAttribute("style")),r!==t&&(d.className=r),s=o.parentNode,o.id="",s.insertBefore(d,o),s.removeChild(o),d.id=l,d):!1}},a.api.plugin.register("textblock",n)}(window),function(e,t){var n={},o=e.lasso,a=e.ghostedit;n.enable=function(){return!0},n.dom={addchild:function(e,t,n,o){return"before"===t?e.insertBefore(o,n):null!==n.nextSibling?e.insertBefore(o,n.nextSibling):e.appendChild(o),!0},removechild:function(e,t){return e&&t?(e.removeChild(t),!0):!1}},n.selection={deleteContents:function(e,t){var n,i,r,s,l,d,c,u,g,f,p,m,h,v,b=!1,y=!1;if("textblock"!==a.selection.saved.type)return!1;for(h=a.selection.saved.data,p=e.childNodes,i=a.dom.getFirstChildGhostBlock(e),r=a.dom.getLastChildGhostBlock(e),s=o().setCaretToStart(i),l=o().setCaretToEnd(r),1!==h.compareEndPoints("StartToStart",s)?(b=!0,d=i):(d=h.getStartNode(),a.dom.isGhostBlock(d)||(d=a.dom.getParentGhostBlock(d))),-1!==h.compareEndPoints("EndToEnd",l)?(y=!0,c=r):(c=h.getEndNode(),a.dom.isGhostBlock(c)||(c=a.dom.getParentGhostBlock(c))),g=d;!a.dom.isChildGhostBlock(g,e);)g=a.dom.getParentGhostBlock(g);for(f=c;!a.dom.isChildGhostBlock(f,e);)f=a.dom.getParentGhostBlock(f);for(m=!1,n=0;p.length>n;n+=1)if(u=p[n],a.dom.isGhostBlock(u))if(v=u.getAttribute("data-ghostedit-handler"),u.id!==g.id){if(u.id===f.id){a.plugins[v].selection.deleteContents(u),m=!1;break}m&&(e.removeChild(p[n]),n--)}else a.plugins[v].selection.deleteContents(u),m=!0;return g.getAttribute("data-ghostedit-elemtype")===f.getAttribute("data-ghostedit-elemtype")&&(o().setToSelection().saveToDOM("ghostedit_container_deleteselection"),a.plugins[g.getAttribute("data-ghostedit-elemtype")].merge(g,f,t),o().restoreFromDOM("ghostedit_container_deleteselection").select()),a.dom.getFirstChildGhostBlock(e)||e.appendChild(a.plugins.textblock.create("p")),!0}},n.inout={importHTML:function(e){var t,o,i,r,s,l;if(!e||1>e.childNodes.length)return!1;for(t=n.create(),i=0;e.childNodes.length>i;i+=1)s=e.childNodes[i],(1===s.nodeType||3===s.nodeType)&&(l=3===s.nodeType?"#textnode":s.tagName.toLowerCase(),a.inout.importhandlers[l]?(o=a.inout.importhandlers[l].call(this,s),o&&a.dom.isGhostBlock(o)&&t.appendChild(o)):s.childNodes.length>0&&(r=s.childNodes.length,s.parentNode.insertBefore(a.dom.extractContent(s),s),s.parentNode.removeChild(s),i-=1));return a.dom.getFirstChildGhostBlock(t)||t.appendChild(a.plugins.textblock.create("p")),t},exportHTML:function(e){if(!e||!a.dom.isGhostBlock(e)||"container"!==e.getAttribute("data-ghostedit-elemtype"))return!1;var t,n,o,i,r=0,s="",l=0;for(r=0;e.childNodes.length>r;r+=1)t=a.dom.isGhostBlock(e.childNodes[r])?e.childNodes[r]:!1,t&&(i=t.getAttribute("data-ghostedit-handler"),i&&a.plugins[i]&&(n=a.plugins[i].inout.exportHTML(t),n&&(s+=n.content,l++),3>=l&&(o=s)));return{content:s,snippet:o}}},n.paste={handle:function(e,t){var i,r,s,l;if(!a.dom.isGhostBlock(e)||!a.dom.isGhostBlock(t))return!1;for(i=a.selection.saved.data,r=i.clone().collapseToStart().getParentElement(),i.saveToDOM("ghostedit_paste_start"),r===e&&(l=document.getElementById("ghostedit_paste_start_range_start"),r=a.dom.getPreviousSiblingGhostBlock(l)||l);r.parentNode!==e;)if(r=r.parentNode,null===r||!r.parentNode)return!0;return s=t.cloneNode(!0),o().removeDOMmarkers("ghostedit_paste_start"),s.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t3'>&#x200b;</span>",n.dom.addchild(e,"after",r,s),l&&l.parentNode&&l.parentNode.removeChild(l),!0}},n.isChildGhostBlock=function(e,n){var o;if(!e)return!1;if(1!==e.nodeType)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(null===e.getAttribute("data-ghostedit-elemtype"))return!1;for(o=0;n.length>o;o+=1)if(e===n[o])return!0;return!1},n.create=function(){var e;return e=document.createElement("div"),a.blockElemId+=1,e.id="ghostedit_container_"+a.blockElemId,e.setAttribute("data-ghostedit-iselem","true"),e.setAttribute("data-ghostedit-elemtype","container"),e.setAttribute("data-ghostedit-handler","container"),e},n.focus=function(e){var t,n;return e&&1===e.nodeType&&"container"===e.getAttribute("data-ghostedit-elemtype")?(t=a.dom.getFirstChildGhostBlock(e))?(n=t.getAttribute("data-ghostedit-handler"),a.plugins[n].focus(t),!0):!1:!1},a.api.plugin.register("container",n)}(window),function(e){var t={elemid:0,focusedimage:null,justResized:!1,originalMouseX:null,originalMouseY:null,buttons:[],el:{}},n=e.lasso,o=e.ghostedit;t.enable=function(){o.event.addListener("history:undo:after",function(){t.applyeventlisteners()}),o.event.addListener("history:redo:after",function(){t.applyeventlisteners()}),o.event.addListener("clipboard:paste:after",function(){t.applyeventlisteners()}),o.event.addListener("selection:change",function(){"image"===o.selection.saved.type?(n().clearSelection(),t.el.keycapture.focus()):t.ui.hide()}),o.inout.registerimporthandler(t.inout.importHTML,"img"),o.options.image||(o.options.image={}),o.options.image.disableresize||(o.options.image.disableresize=!1),o.options.image.flexibleimages||(o.options.image.flexibleimages=!1);var e=document.createElement("form");e.id="ghostedit_image_focusform",e.style.cssText="margin:0px;padding:0px;height:0px;width:0px;overflow:hidden;line-height: 0px;position: absolute;left: 0; top: 0";var a=document.createElement("textarea");a.id="ghostedit_image_keycapturearea",a.style.cssText="margin:0px;padding:0px;height:0px;width:0px;overflow:hidden;line-height: 0px",a.onkeypress=o.util.cancelEvent,a.onkeydown=t.event.keydown,t.el.keycapture=a,e.appendChild(a),o.el.uilayer.appendChild(e),o.api.image=o.api.image||{},o.api.image.updatealttext=function(e){return t.updatealttext(e)}},t.event={keydown:function(n){n=e.event?e.event:n;var a=null!==n.keyCode?n.keyCode:n.charCode;switch(a){case 8:case 46:t.remove(n);break;case 90:n.ctrlKey&&o.history.undo();break;case 89:n.ctrlKey&&o.history.redo();break;case 37:t.move.align("left",n);break;case 38:t.move.up(n);break;case 39:t.move.align("right",n);break;case 40:t.move.down(n)}return o.util.cancelEvent(n)}},t.selection={compare:function(e,t){return e&&t?e===t?!0:!1:!1},restore:function(e){return e&&e.tagName&&"img"===e.tagName.toLowerCase()?(t.focus(e),!0):!1},deleteContents:function(){return!0}},t.inout={importHTML:function(e){var n,a,i;return(n=t.create(e.src))?(e.className.length>0&&!/ghostedit/.test(e.className)&&(n.className=e.className),n.alt=e.alt,n.title=e.title,a=n.width,i=n.height,n.naturalWidth=n.naturalWidth||a,n.naturalHeight=n.naturalHeight||i,n.setAttribute("data-ghostedit-nativewidth",a),n.setAttribute("data-ghostedit-nativeheight",i),o.options.image.flexibleimages||(n.style.width=e.style.width,n.style.height=n.style.width.replace("px","")/a*i+"px"),n.style.cssFloat=e.style.cssFloat,n.style.styleFloat=e.style.styleFloat,n.style.clear=e.style.clear,"right"===e.style.cssFloat||"right"===e.style.styleFloat?(n.style.marginLeft="20px",n.style.marginRight="0px"):(n.style.marginLeft="0px",n.style.marginRight="20px"),n):!1},exportHTML:function(e){if(!e||!o.dom.isGhostBlock(e)||"image"!==e.getAttribute("data-ghostedit-elemtype"))return!1;var t,n="";return t=e,n+="<img src='"+(""+t.src)+"' alt='"+(""+t.alt)+"' title='"+(""+t.title)+"' ",n+="style='",o.options.image.flexibleimages||(n+="width:"+(""+t.offsetWidth)+"px;height; "+t.offsetHeight+"px;"),n+="left"===t.style.styleFloat||"left"===t.style.cssFloat?"float:left;clear:left;margin-right: 20px;":"float:right;clear:right;margin-left: 20px;",""!==t.style.clear&&(n+="clear:"+t.style.clear),n+="'",t.className.length>0&&!/ghostedit/.test(t.className)&&(n+=" class='"+t.className+"'"),n+=" />",{content:n}}},t.move={align:function(e,n){var a;return"left"!==e&&"right"!==e?o.util.cancelAllEvents(n):"image"!==o.selection.saved.type?o.util.cancelAllEvents(n):(o.history.saveUndoState(),a=o.selection.saved.data,a.style.styleFloat=e,a.style.cssFloat=e,a.style.marginRight="left"===e?"20px":"0px",a.style.marginLeft="left"===e?"0px":"20px",t.focus(a),o.history.saveUndoState(),o.util.cancelAllEvents(n))},up:function(e){var n,a,i,r,s,l;return o.history.saveUndoState(),null!==t.focusedimage&&(n=t.focusedimage,i=n.offsetLeft,a=n.offetTop,l=o.dom.getPreviousSiblingGhostBlock(n),l&&(r=o.dom.getParentGhostBlock(l),s=r.getAttribute("data-ghostedit-handler"),o.plugins[s].dom.addchild(r,"before",l,n)),n.style.clear=i===n.offsetLeft&&n.offsetTopBefore===n.offsetTop?"":"",t.focus(t.focusedimage)),o.history.saveUndoState(),o.util.cancelAllEvents(e)},down:function(e){var n,a,i,r,s,l;return o.history.saveUndoState(),null!==t.focusedimage&&(n=t.focusedimage,r=n.offsetLeft,s=n.offetTop,l=o.dom.getNextSiblingGhostBlock(n),l&&(a=o.dom.getParentGhostBlock(l),i=a.getAttribute("data-ghostedit-handler"),o.plugins[i].dom.addchild(a,"after",l,n)),n.style.clear=r===n.offsetLeft&&n.offsetTopBefore===n.offsetTop?"":"",t.focus(t.focusedimage)),o.history.saveUndoState(),o.util.cancelAllEvents(e)}},t.setClear=function(e){o.selection.save(),o.history.saveUndoState();var t,n,a;if(n=o.plugins.textblock.selection.getStartTextBlockNode(),a=o.plugins.textblock.selection.getEndTextBlockNode(),n&&a)for(t=n;;){if("textblock"===t.getAttribute("data-ghostedit-elemtype").toLowerCase()&&(n.style.clear=e),!t.nextSibling||t.id===a.id)break;t=t.nextSibling}for(t=n;t.previousSibling&&"image"===t.previousSibling.getAttribute("data-ghostedit-elemtype");)t=t.previousSibling,t.style.clear=e;document.getElementById("ghostedit_toolbar_clearselect").value=e,o.selection.save(),o.history.saveUndoState()},t.remove=function(n){if(o.history.saveUndoState(),null!==t.focusedimage){var a=t.focusedimage;t.unfocus(),a.parentNode&&a.parentNode.removeChild(a)}return n&&n.preventDefault?n.stopPropagation():null!==e.event.cancelBubble&&(e.event.cancelBubble=!0),o.history.saveUndoState(),!1},t.refocus=function(){var e=t.focusedimage;t.unfocus(),t.focus(e)},t.unfocus=function(){if(t.resize.end(),t.focusedimage=null,"image"!==o.selection.saved.type)return!1;var e=o.selection.saved.data;t.ui.hide(e),o.selection.clear(),o.selection.save()},t.updatealttext=function(e){t.focusedimage!==!1&&t.focusedimage.alt!==e&&(t.focusedimage.alt=e,t.focusedimage.title=e,o.event.trigger("ui:message",{message:"Image description updated to '"+e+"'",time:2,color:"success"}))},t.focus=function(e,n){var a,i,r,s,l,d,c;if(t.unfocus(),o.isEditing===!0&&null===t.focusedimage){for(c=e.id.replace("ghostedit_image_",""),s=document.getElementById("ghostedit_image_border_"+c),s&&o.el.uilayer.removeChild(s),s=document.createElement("div"),s.className="ghostedit_image_border",s.style.cssText="position: absolute;line-height: 1px;font-size: 1px;background-color: transparent;border: 3px solid #333;z-index: 100",s.id="ghostedit_image_border_"+c,s.style.top=e.offsetTop+"px",s.style.left=e.offsetLeft+"px",s.style.width=e.offsetWidth-6+"px",s.style.height=e.offsetHeight-6+"px",o.el.uilayer.appendChild(s),i=document.getElementById("ghostedit_image_resizehandle_"+c),i&&o.el.uilayer.removeChild(i),o.options.image.disableresize||(r=document.createElement("span"),r.className="ghostedit_image_resizehandle",r.style.cssText="position: absolute;width: 13px;height: 13px;line-height: 9px;font-size: 9px;background-color: transparent;z-index: 200",r.id="ghostedit_image_resizehandle_"+c,r.style.top=e.offsetTop+e.offsetHeight-13+"px","left"===e.style.cssFloat||"left"===e.style.styleFloat?(r.style.left=e.offsetLeft+e.offsetWidth-13+"px",r.style.cursor="se-resize",r.style.background="URL("+o.options.imageurl+"/image/resize-se.png)"):(r.style.left=e.offsetLeft+"px",r.style.cursor="sw-resize",r.style.background="URL("+o.options.imageurl+"/image/resize-sw.png)"),o.el.uilayer.appendChild(r),r.style.MozUserSelect="none",r.contentEditable=!1,r.unselectable="on",r.onmousedown=function(e){return t.resize.start(this,e)
},r.ondragstart=function(e){return o.util.cancelEvent(e)},r.ondraggesture=function(e){return o.util.cancelEvent(e)},r.onclick=function(e){return o.util.cancelEvent(e)},r.ondblclick=function(e){return o.util.cancelEvent(e)},r.onresizestart=function(e){return o.util.cancelEvent(e)}),l=t.ui.createbutton(c,"align",">",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+"px","left"===e.style.cssFloat||"left"===e.style.styleFloat?(t.elem.style.left=e.offsetLeft+e.offsetWidth-15+"px",t.elem.innerHTML="&gt;"):(t.elem.style.left=e.offsetLeft-15+"px",t.elem.innerHTML="&lt;")}),l.event.click="left"===e.style.cssFloat||"left"===e.style.styleFloat?function(e){return t.move.align("right",e)}:function(e){return t.move.align("left",e)},l.register(),l=t.ui.createbutton(c,"delete","&#215;",function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+"px"}),l.event.click=function(e){return t.remove(e)},l.register(),l=t.ui.createbutton(c,"up","^",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15-40+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),l.event.click=function(e){return t.move.up(e)},l=t.ui.createbutton(c,"down","&caron;",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+40+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),l.event.click=function(e){return t.move.down(e)},l=t.ui.createbutton(c,"small","Small",function(e,t){t.elem.style.top=e.offsetTop+40+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft:e.offsetLeft+e.offsetWidth-60)+"px",t.elem.style.width="60px"}),l.event.click=function(e){var n=t.focusedimage;return n.className="small",n.style.height="",n.style.width="",n.style.height=n.offsetHeight-12+"px",n.style.width=n.offsetWidth-12+"px",t.ui.setbuttonpositions(),o.util.cancelEvent(e)},l=t.ui.createbutton(c,"golden","Golden",function(e,t){t.elem.style.top=e.offsetTop+80+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),l.event.click=function(e){var n=t.focusedimage;return n.className="golden",n.style.height="",n.style.width="",n.style.height=n.offsetHeight-12+"px",n.style.width=n.offsetWidth-12+"px",t.ui.setbuttonpositions(),o.util.cancelEvent(e)},l=t.ui.createbutton(c,"medium","Medium",function(e,t){t.elem.style.top=e.offsetTop+120+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),l.event.click=function(e){var n=t.focusedimage;return n.className="medium",n.style.height="",n.style.width="",n.style.height=n.offsetHeight-12+"px",n.style.width=n.offsetWidth-12+"px",t.ui.setbuttonpositions(),o.util.cancelEvent(e)},l=t.ui.createbutton(c,"fullwidth","Full Width",function(e,t){t.elem.style.top=e.offsetTop+160+"px",t.elem.style.left=("left"===e.style.cssFloat||"left"===e.style.styleFloat?e.offsetLeft:e.offsetLeft+e.offsetWidth-100)+"px",t.elem.style.width="100px"}),l.event.click=function(e){var n=t.focusedimage;return n.className="fullwidth",n.style.height="",n.style.width="",n.style.height=n.offsetHeight-12+"px",n.style.width=n.offsetWidth-12+"px",t.ui.setbuttonpositions(),o.util.cancelEvent(e)},d="<select onclick='ghostedit.util.preventBubble()' onchange='_image.focusedimage.style.clear = this.value;_image.refocus();'>",d+="<option value='' "+(""===e.style.clear?"selected='selected' ":"")+">Clear: none</option>",d+="<option value='left' "+("left"===e.style.clear?"selected='selected' ":"")+">Clear: left</option>",d+="<option value='right' "+("right"===e.style.clear?"selected='selected' ":"")+">Clear: right</option>",d+="<option value='both' "+("both"===e.style.clear?"selected='selected' ":"")+">Clear: both</option>",d+=" </select>",l=t.ui.createbutton(c,"clear",d,function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+e.offsetWidth-100+"px",t.elem.style.width="100px",t.elem.style.cursor="default"}),l.event.click=null,l.event.mousedown=null,a=0;t.buttons.length>a;a+=1)t.buttons[a].show(e),t.buttons[a].reposition(e,t.buttons[a]);if(t.focusedimage=e,o.selection.set("image",e),n)return o.util.cancelEvent(n)}},t.resize={start:function(n,a){o.history.saveUndoState(),a=e.event?e.event:a;var i=document.getElementById("ghostedit_image_"+n.id.replace("ghostedit_image_resizehandle_",""));return t.originalMouseX=a.pageX||a.clientX+document.body.scrollLeft,t.originalMouseY=a.pageY||a.clientY+document.body.scrollTop,t.originalImageWidth=i.offsetWidth,t.originalImageHeight=i.offsetHeight,i.getAttribute("data-ghostedit-nativewidth")||i.setAttribute("data-ghostedit-nativewidth",i.offsetWidth),i.getAttribute("data-ghostedit-nativeheight")||i.setAttribute("data-ghostedit-nativeheight",i.offsetHeight),o.util.addEvent(document.body,"mousemove",t.resize.handle),o.util.addEvent(document.body,"mouseup",t.resize.end),o.util.addEvent(e,"blur",t.resize.end),!1},handle:function(n){var o,a,i,r,s,l,d,c,u,g,f,p,m;n=e.event?e.event:n,null===t.focusedimage?t.unfocus():(o=t.focusedimage,a=document.getElementById("ghostedit_image_resizehandle_"+o.id.replace("ghostedit_image_","")),i=document.getElementById("ghostedit_imagebutton_align"+o.id.replace("ghostedit_image_","")),r=n.pageX||n.clientX+document.body.scrollLeft,s=n.pageY||n.clientY+document.body.scrollTop,g=t.originalMouseX,f=t.originalMouseY,u=t.originalImageHeight,c=t.originalImageWidth,m=o.getAttribute("data-ghostedit-nativeheight"),p=o.getAttribute("data-ghostedit-nativewidth"),"left"===o.style.cssFloat||"left"===o.style.styleFloat?(l=c+(r-g),d=u+(s-f)):(l=c-(r-g),d=u+(s-f)),d/m*p>l?l=d/m*p:d=l/p*m,l>=o.parentNode.width&&(l=o.parentNode.width,d=l/p*m),o.style.width=l+"px",o.style.height=d+"px",t.ui.setbuttonpositions())},end:function(){t.justResized=!0,o.util.removeEvent(document.body,"mousemove",t.resize.handle),o.util.removeEvent(document.body,"mouseup",t.resize.end),o.util.removeEvent(e,"blur",t.resize.end),o.history.saveUndoState()}},t.ui={show:function(e){var t,n=e;n=t},hide:function(e){var n;if(e=e||t.focusedimage,!e)return!1;for(document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))&&o.el.uilayer.removeChild(document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))),!o.options.image.disableresize&&document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_",""))&&o.el.uilayer.removeChild(document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_",""))),n=0;t.buttons.length>n;n+=1)t.buttons[n].hide();t.buttons=[]},createbutton:function(e,n,a,i){var r,s;return s=document.createElement("span"),s.id="ghostedit_imagebutton_"+n+"_"+e,s.setAttribute("data-ghostedit-elemtype","ghostedit_imagebutton"),s.setAttribute("data-ghostedit-handler","image"),s.className="ghostedit_imagebutton",s.style.cssText="position: absolute;width: 30px;height: 26px;_height: 30px;color: #FFF;font-size: 16px;padding-top: 4px;font-family: Tahoma, sans-serif;text-align: center;vertical-align: middle;font-weight: bold;background-color: #FF028D;cursor: pointer !important;z-index: 200",s.innerHTML=a,r={elem:s},r.reposition=i,r.event={mousedown:function(e){return o.util.cancelEvent(e)},dragstart:function(e){return o.util.cancelEvent(e)},draggesture:function(e){return o.util.cancelEvent(e)},click:function(e){return o.util.cancelEvent(e)},dblclick:function(e){return o.util.cancelEvent(e)},resizestart:function(e){return o.util.cancelEvent(e)}},r.show=function(){o.el.uilayer.appendChild(r.elem),r.elem.style.MozUserSelect="none",r.elem.contentEditable=!1,r.elem.unselectable="on",r.elem.onmousedown=r.event.mousedown,r.elem.ondragstart=r.event.dragstart,r.elem.ondraggesture=r.event.draggesture,r.elem.onclick=r.event.click,r.elem.ondblclick=r.event.dblclick,r.elem.onresizestart=r.event.resizestart},r.hide=function(){r.elem.parentNode.removeChild(r.elem)},r.register=function(){t.buttons.push(r)},r},setbuttonpositions:function(){var e,n,a,i;if(n=t.focusedimage)for(a=document.getElementById("ghostedit_image_border_"+n.id.replace("ghostedit_image_","")),a.style.top=n.offsetTop+"px",a.style.left=n.offsetLeft+"px",a.style.width=n.offsetWidth-6+"px",a.style.height=n.offsetHeight-6+"px",o.options.image.disableresize||(i=document.getElementById("ghostedit_image_resizehandle_"+n.id.replace("ghostedit_image_","")),i.style.top=n.offsetTop+n.offsetHeight-13+"px",i.style.left="left"===n.style.cssFloat||"left"===n.style.styleFloat?n.offsetLeft+n.offsetWidth-13+"px":n.offsetLeft+"px"),e=0;t.buttons.length>e;e+=1)t.buttons[e].reposition(n,t.buttons[e])}},t.insert=function(){var e;e=document.getElementById("ghostedit_imageurlinput"),e.blur(),t.newImageBefore(null,null,!1)},t.create=function(n){var a;return a=document.createElement("img"),t.elemid+=1,a.id="ghostedit_image_"+t.elemid,a.src=n,o.options.defaultimageclass&&(a.className=o.options.defaultimageclass),a.setAttribute("data-ghostedit-elemtype","image"),a.setAttribute("data-ghostedit-handler","image"),a.contentEditable="false",a.unselectable="on",a.galleryimg="no",a.onclick=function(e){t.focus(this,e),o.util.cancelAllEvents(e)},a.ondragstart=function(t){return t=e.event?e.event:t,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",a.id)),!0},a.ondraggesture=function(e){return o.util.cancelEvent(e)},a.onresizestart=function(e){return o.util.cancelAllEvents(e)},a.oncontrolselect=function(e){return t.focus(this,e),o.util.cancelAllEvents(e)},a},t.newImageBefore=function(e,n,a,i){var r,s,l,d,c,u,g;return o.history.saveUndoState(),null===e&&(e=o.selection.savedRange.getStartNode()),e=o.plugins.textblock.selection.getTextBlockNode(e),"after"!==i&&(i="before"),null===n&&(n=document.getElementById("ghostedit_imageurlinput").value),document.getElementById("ghostedit_image_"+e.id.replace("ghostedit_textblock_",""))?undefined:(l=document.createElement("img"),t.elemid+=1,l.id="ghostedit_image_"+t.elemid,o.options.defaultimageclass&&(l.className=o.options.defaultimageclass),d=o.dom.getParentGhostBlock(e),c=d.getAttribute("data-ghostedit-handler"),(u=o.plugins[c].dom.addchild(d,i,e,l))?(s=document.getElementById("ghostedit_image_"+t.elemid),s.setAttribute("data-ghostedit-elemtype","image"),s.setAttribute("data-ghostedit-handler","image"),s.contentEditable="false",s.unselectable="on",s.galleryimg="no",g="left"===e.style.clear?"right":"left",s.style.cssFloat=g,s.style.styleFloat=g,s.style.clear=e.style.clear,s.style.marginRight="20px",r={i:s,s:a},r.callself=function(){t.onload(r.i,r.s,!0)},s.onload=r.callself,s.src=n,t.applyeventlisteners(s),o.util.addClass(s,"leftimage"),s):!1)},t.onload=function(e,n,a){if(a===!0){if(e.setAttribute("data-ghostedit-nativewidth",0),e.setAttribute("data-ghostedit-nativeheight",0),!o.options.image.disableresize&&!n&&e.offsetWidth>200){var i=200,r=i/e.offsetWidth*e.offsetHeight;e.style.width=i+"px",e.style.height=r+"px"}e.contentEditable=!1,o.history.saveUndoState()}else{var s={i:e,s:n};s.callself=function(){t.onload(s.i,s.s,!0)},setTimeout(s.callself,20)}},t.applyeventlisteners=function(){var n,a,i,r,s;for(n=o.el.rootnode.getElementsByTagName("img"),r=function(e){return t.focus(this,e),o.util.cancelAllEvents(e)},s=function(t){return t=e.event?e.event:t,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",i.id)),!0},a=0;n.length>a;a++)i=n[a],"image"===i.getAttribute("data-ghostedit-elemtype")&&(i.onclick=r,i.ondragstart=s,i.ondraggesture=o.util.cancelEvent,i.onresizestart=o.util.cancelAllEvents,i.oncontrolselect=r)},o.api.plugin.register("image",t)}(window),function(e){var t={focusedlink:!1,el:{}},n=e.lasso,o=e.ghostedit;t.enable=function(){o.event.addListener("preundo",function(){t.unfocus()}),o.event.addListener("preredo",function(){t.unfocus()}),o.event.addListener("import:after",function(){t.event.postimport()}),o.event.addListener("ui:update",function(){t.ui.update()}),o.inout.registerimporthandler(o.plugins.textblock.inout.importHTML,"a"),o.plugins.textblock.inout.parserules.tags.a={attributes:["href"]},o.api.link=o.api.link||{},o.api.link.create=function(){var e;return o.history.saveUndoState(),e=t.create(),o.history.saveUndoState(),e},o.api.link.updateurl=function(e){return t.updateurl(e)},o.api.link.open=function(){return t.open()}},t.event={postimport:function(e){var t,n;if(!e||!e.rootnode)return!1;for(n=e.rootnode.getElementsByTagName("a"),t=0;n.length>t;t+=1)n[t].setAttribute("data-ghostedit-elemtype","link"),n[t].setAttribute("data-ghostedit-handler","link");return!0}},t.selection={deleteContents:function(){return!1}},t.ui={update:function(){var e,n,a=!1;for(n=0;o.selection.nodepath.length>n;n++)e=o.selection.nodepath[n],"a"===e.tagName.toLowerCase()&&(a=e);a?a!==t.focusedlink&&t.focus(a):t.focusedlink&&t.unfocus()},show:function(e){var n,a,i;t.ui.hide(),n=document.createElement("span"),n.className="ghostedit_focusedlinkbox",n.style.cssText="position: absolute;text-align: center;font-family: Tahoma, Geneva, sans-serif;cursor: pointer;font-size: 13px;border: 1px solid #FF028D;background-color: #FF028D;padding: 3px;z-index: 100;width: 92px",n.id="ghostedit_focusedlinkbox",n.style.top=e.offsetTop+e.offsetHeight-1+"px",i=e.getClientRects()[e.getClientRects().length-1].left,n.style.left=i-o.el.rootnode.getBoundingClientRect().left+"px",a=document.createElement("a"),a.style.cursor="pointer",a.style.color="#000",a.innerHTML="<b>&#215;</b>&nbsp;remove&nbsp;link</a>",n.appendChild(a),o.el.uilayer.appendChild(n),n.style.MozUserSelect="none",n.contentEditable=!1,n.unselectable="on",n.onmousedown=function(e){return o.util.cancelEvent(e)},n.ondragstart=function(e){return o.util.cancelEvent(e)},n.ondraggesture=function(e){return o.util.cancelEvent(e)},n.onclick=function(e){return o.util.cancelEvent(e)},n.ondblclick=function(e){return o.util.cancelEvent(e)},n.onresizestart=function(e){return o.util.cancelEvent(e)},n.oncontrolselect=function(e){return o.util.cancelAllEvents(e)},o.util.addEvent(a,"click",o.util.preparefunction(t.remove,null,e)),t.el.focusedbox=n,t.el.focusedboxa=a},hide:function(){t.el.focusedbox&&(o.el.uilayer.removeChild(t.el.focusedbox),t.el.focusedbox=null,t.el.focusedboxa=null)}},t.create=function(e){var t,a,i;return e===undefined&&(e="http://"),a=o.selection.saved,"textblock"!==a.type?!1:(a.data.isCollapsed()&&(t=a.data.clone(),t=o.plugins.textblock.selection.extendtoword(t,!0),t.select(),o.selection.save()),a.data.isCollapsed()?(i=document.createElement("a"),i.id="ghostedit_link_newlink",i.innerHTML="Link Text",i.href="http://",a.data.insertNode(i),a.data.selectNodeContents("ghostedit_link_newlink").select(),document.getElementById("ghostedit_link_newlink").id="",o.selection.save()):(document.execCommand("CreateLink",!1,e),n().setToSelection().collapseToEnd().select(),o.selection.save(),i=o.plugins.link.focusedlink,i.href="http://"),o.selection.save(),!0)},t.focus=function(e){t.focusedlink=e,t.ui.show(e)},t.unfocus=function(){t.focusedlink!==!1&&(t.ui.hide(),t.focusedlink=!1)},t.remove=function(e){var n;return e=e||t.focusedlink,e.tagName&&"a"===e.tagName.toLowerCase()?(o.selection.saved.data.saveToDOM(),n=o.dom.extractContent(e),e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),o.selection.saved.data.restoreFromDOM().select(),o.selection.save(),undefined):!1},t.updateurl=function(e){t.focusedlink!==!1&&t.focusedlink.href!==e&&(t.focusedlink.href=e,t.focusedlink.title=e,o.event.trigger("ui:message",{message:"URL updated to '"+e+"'",time:2,color:"success"}))},t.open=function(){t.focusedlink!==!1&&e.open(t.focusedlink.href)},o.api.plugin.register("link",t)}(window),function(e){var t={elemid:0,itemelemid:0},n=e.lasso,o=e.ghostedit;t.enable=function(){o.event.addListener("postpaste",function(){var e,n,a,i,r;for(i=[],n=o.el.rootnode.getElementsByTagName("ul"),e=0;n.length>e;e++)i.push(n[e]);for(a=o.el.rootnode.getElementsByTagName("ol"),e=0;a.length>e;e++)i.push(a[e]);for(e=0;i.length>e;e++)r=i[e],r.parentNode&&t.tidy(r)}),o.inout.registerimporthandler(t.inout.importHTML,"ol","ul","li"),o.api.list=o.api.list||{},o.api.list.toggle=function(e){t.toggle(e)}},t.dom={addchild:function(e,n,a,i,r){var s,l,d,c,u=!1,g=!1;if(r&&r.contentlength!==!1&&(g=1>r.contentlength?!0:!1),"listitem"===e.getAttribute("data-ghostedit-elemtype")&&(e=o.dom.getParentGhostBlock(e)),"list"!==e.getAttribute("data-ghostedit-elemtype"))return!1;for(d=a;"listitem"!==d.getAttribute("data-ghostedit-elemtype");)if(d=o.dom.getParentGhostBlock(d),null===d)return!1;return g&&o.dom.getNextSiblingGhostBlock(d)===!1&&o.plugins.textblock.isEmpty(a)&&(s=o.dom.getParentGhostBlock(e),c=s.getAttribute("data-ghostedit-handler"),u=o.plugins[c].dom.addchild(s,"after",e,i)),u?(e.removeChild(d),u):("textblock"===i.getAttribute("data-ghostedit-elemtype")?(l=document.createElement("li"),t.itemelemid+=1,l.id="ghostedit_listitem_"+t.itemelemid,l.setAttribute("data-ghostedit-elemtype","listitem"),l.setAttribute("data-ghostedit-handler","list"),l.appendChild(i)):l=i,"before"===n?e.insertBefore(l,d):null!==d.nextSibling?e.insertBefore(l,d.nextSibling):e.appendChild(l),!0)},removechild:function(e,t){if(e&&"listitem"===e.getAttribute("data-ghostedit-elemtype")&&(t=e,e=o.dom.getParentGhostBlock(e)),!e||!t)return!1;if("list"!==e.getAttribute("data-ghostedit-elemtype"))return!1;for(;"listitem"!==t.getAttribute("data-ghostedit-elemtype");)if(t=o.dom.getParentGhostBlock(t),null===t)return!1;return t.parentNode!==e?!1:(e.removeChild(t),!0)},deleteevent:function(e,n,a){var i,r,s;return s=e.getAttribute("data-ghostedit-elemtype"),"list"===s?"ahead"===n||"behind"===n?(i="ahead"===n?o.dom.getLastChildGhostBlock(e):o.dom.getFirstChildGhostBlock(e),t.dom.deleteevent(i,n,a)):!1:"listitem"===s?("ahead"===n||"behind"===n?(i=o.dom.getFirstChildGhostBlock(e),r=o.plugins.textblock.dom.deleteevent(i,n,a)):"top"===n?r=o.event.sendBackwards("delete",e,a):"bottom"===n&&(r=o.event.sendForwards("delete",e,a)),r):undefined}},t.selection={deleteContents:function(e,a){var i,r,s,l,d,c,u,g,f,p,m,h,v,b,y,k;if(h=!1,v=!1,!t.isList(e))return t.isListItem(e)?o.plugins.textblock.selection.deleteContents(o.dom.getFirstChildGhostBlock(e)):!1;if("textblock"===o.selection.saved.type){for(m=o.selection.saved.data.clone(),u=e.childNodes,b=o.dom.getFirstChildGhostBlock(e),y=o.dom.getLastChildGhostBlock(e),f=n().setCaretToStart(b),p=n().setCaretToEnd(y),1!==m.compareEndPoints("StartToStart",f)?(h=!0,r=b):(r=m.getStartNode(),o.dom.isGhostBlock(r)||(r=o.dom.getParentGhostBlock(r))),-1!==m.compareEndPoints("EndToEnd",p)?(v=!0,s=y):(s=m.getEndNode(),o.dom.isGhostBlock(s)||(s=o.dom.getParentGhostBlock(s))),l=r;!o.dom.isChildGhostBlock(l,e);)l=o.dom.getParentGhostBlock(l);for(c=s;!o.dom.isChildGhostBlock(c,e);)c=o.dom.getParentGhostBlock(c);for(g=h,i=0;u.length>i;i+=1)if(d=u[i],o.dom.isGhostBlock(d))if(k=d.getAttribute("data-ghostedit-handler"),h||d.id!==l.id){if(!v&&d.id===c.id){o.plugins[k].selection.deleteContents(d),g=!1;break}g&&(m.saveToDOM("seldelete-midlist"),e.removeChild(u[i]),m.restoreFromDOM("seldelete-midlist"),i--)}else if(o.plugins[k].selection.deleteContents(d),g=!0,d.id===c.id)break;return h||v||l.getAttribute("data-ghostedit-elemtype")!==c.getAttribute("data-ghostedit-elemtype")||(o.plugins[l.getAttribute("data-ghostedit-handler")].merge(l,c,a),o.dom.getParentGhostBlock(c)||n().setToSelection().collapseToStart().select()),o.dom.getFirstChildGhostBlock(e)||e.appendChild(t.createItem("p")),!0}}},t.inout={importHTML:function(e){var n,o,a,i,r;if(!e||!e.tagName)return!1;switch(e.tagName.toLowerCase()){case"ol":case"ul":return t.inout.importList(e);case"li":n=t.create("ul"),n.setAttribute("data-ghostedit-importinfo","wasinline"),o=0,a=e;do{if(r=t.inout.importListItem(a),!r)break;o+=1,n.appendChild(r),i=a,a=a.nextSibling,o>1&&i.parentNode.removeChild(i)}while(a&&1===a.nodeType&&"li"===a.tagName.toLowerCase());return o>0?n:!1}},exportHTML:function(e){if(!e||!o.dom.isGhostBlock(e))return!1;var n,a,i,r,s="";switch(e.getAttribute("data-ghostedit-elemtype")){case"list":if(n=o.dom.getFirstChildGhostBlock(e),!n)return!1;do i=t.inout.exportHTML(n),i&&(s+=i.content),n=o.dom.getNextSiblingGhostBlock(n);while(n);return 1>s.length?!1:(a="ol"===e.tagName.toLowerCase()?"ol":"ul",s="<"+a+">"+s+"</"+a+">",{content:s});case"listitem":return(r=o.dom.getFirstChildGhostBlock(e))?(i=o.plugins.textblock.inout.exportHTML(r),i&&(s+=i.content),1>s.length?!1:(s="<li>"+s+"</li>",{content:s})):!1}},importList:function(e){var n,a,i,r,s;if(!e||!e.tagName)return!1;if(s=e.tagName.toLowerCase(),"ul"!==s&&"ol"!==s)return!1;if(a=t.create(s),e.childNodes&&e.childNodes.length)for(n=0;e.childNodes.length>n;n+=1)r=e.childNodes[n],1===r.nodeType&&"li"===r.tagName.toLowerCase()&&(i=t.inout.importListItem(r),i&&o.dom.isGhostBlock(i)&&a.appendChild(i));return o.dom.getFirstChildGhostBlock(a)||a.appendChild(t.createItem("p")),a},importListItem:function(e){var n,a,i=!1;return e&&e.tagName&&"li"===e.tagName.toLowerCase()?(n=t.createItem(),a=o.dom.getFirstChildElement(e),"block"===o.plugins.textblock.inout.isHandleableNode(a)?i=o.plugins.textblock.inout.importHTML(a):(i=document.createElement("p"),i.innerHTML=e.innerHTML,i=o.plugins.textblock.inout.importHTML(i)),i?n.appendChild(i):n.appendChild(o.plugins.textblock.create("p")),n):!1}},t.paste={handle:function(e,a,i){var r,s,l,d,c,u,g,f,p,m,h,v,b,y,k,T,E,x,N,_=!1,C=!1;if(!t.isList(e))return!1;if(!t.isList(a)||a.tagName!==e.tagName){switch(s=o.selection.saved.data.clone(),i.isfirst?s.collapseToStart():i.islast&&s.collapseToEnd(),l=t.split(e,s)){case!1:return!0;case"atverystart":f=o.dom.getPreviousSiblingGhostBlock(e),p=e;break;case"atveryend":f=e,p=o.dom.getNextSiblingGhostBlock(e);break;default:f=l.block1,p=l.block2}return n().removeDOMmarkers("ghostedit_paste_start"),n().removeDOMmarkers("ghostedit_paste_end"),f.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",p.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+p.innerHTML,!1}if(console.log("Lists same type"),console.log(i),"textblock"===o.selection.saved.type){for(y=o.selection.saved.data.clone(),k=o.dom.getFirstChildGhostBlock(e),T=o.dom.getLastChildGhostBlock(e),E=n().setCaretToStart(k),x=n().setCaretToEnd(T),1!==y.compareEndPoints("StartToStart",E)?(_=!0,m=k):m=y.getStartNode(),-1!==y.compareEndPoints("EndToEnd",x)?(C=!0,h=T):h=y.getEndNode();!o.dom.isGhostBlock(m);)m=o.dom.getParentGhostBlock(m);for(;!o.dom.isGhostBlock(h);)h=o.dom.getParentGhostBlock(h);for(i.isfirst&&(d=o.dom.getFirstChildGhostBlock(a),c=o.dom.getFirstChildGhostBlock(d),g=m,"li"===g.tagName.toLowerCase()&&(g=o.dom.getFirstChildGhostBlock(g)),u=o.dom.getParentGhostBlock(g),l=o.plugins.textblock.paste.handle(g,c,{isfirst:!0}),l&&a.removeChild(d)),o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),n().isSavedRange("ghostedit_paste_end")&&o.selection.saved.data.setEndToRangeEnd(n().restoreFromDOM("ghostedit_paste_end",!1)),i.islast&&o.dom.getLastChildGhostBlock(a)&&(d=o.dom.getLastChildGhostBlock(a),c=o.dom.getFirstChildGhostBlock(d),g=h,"li"===g.tagName.toLowerCase()&&(g=o.dom.getFirstChildGhostBlock(g)),console.log(c),console.log(g),m===h&&o.plugins.textblock.paste.split(g),l=o.plugins.textblock.paste.handle(g,c,{isfirst:!1,islast:!0}),l&&a.removeChild(d)),o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),n().isSavedRange("ghostedit_paste_end")&&o.selection.saved.data.setEndToRangeEnd(n().restoreFromDOM("ghostedit_paste_end",!1)),r=m,N=_?"before":"after",v=b=o.dom.getFirstChildGhostBlock(a);b=o.dom.getFirstChildGhostBlock(a);)t.dom.addchild(e,N,r,b),N="after",r=b;return i.isfirst||_||(n().removeDOMmarkers("ghostedit_paste_start"),r.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>","li"===r.tagName.toLowerCase()&&(r=o.dom.getFirstChildGhostBlock(r)),o.plugins.textblock.mozBrs.tidy(r)),!0}}},t.isList=function(e){var t;return o.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),"ul"!==t&&"ol"!==t?!1:!0):!1},t.isListItem=function(e){var t;return o.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),"li"!==t?!1:!0):!1},t.create=function(e){var t;return"ol"!==e.toLowerCase()&&(e="ul"),t=document.createElement(e),o.blockElemId+=1,t.id="ghostedit_list_"+o.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","list"),t.setAttribute("data-ghostedit-handler","list"),t},t.createItem=function(e){var t;return t=document.createElement("li"),o.blockElemId+=1,t.id="ghostedit_list_item_"+o.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","listitem"),t.setAttribute("data-ghostedit-handler","list"),e&&t.appendChild(o.plugins.textblock.create(e)),t},t.remove=function(e){var t,n;return t=o.dom.getParentGhostBlock(e),n=t.getAttribute("data-ghostedit-handler"),o.plugins[n].dom.removechild(t,e)},t.focus=function(e){var t,n;return e&&1===e.nodeType&&"list"===e.getAttribute("data-ghostedit-elemtype")?(t=o.dom.getFirstChildGhostBlock(e))?(t=o.dom.getFirstChildGhostBlock(t))?(n=t.getAttribute("data-ghostedit-handler"),o.plugins[n].focus(t),!0):!1:!1:!1},t.merge=function(e,n,a){var i;if(e===n)return e;if(!t.isList(e)||!t.isList(n))return t.isListItem(e)&&t.isListItem(n)?t.mergeItems(e,n,a):!1;if(e.tagName.toLowerCase()!==n.tagName.toLowerCase())return!1;for(;i=o.dom.getFirstChildGhostBlock(n);)e.appendChild(i);return t.remove(n),e},t.mergeItems=function(e,n,a){var i,r,s;return a===!1?e:e===n?e:t.isListItem(e)&&t.isListItem(n)?(i=o.dom.getFirstChildGhostBlock(e),r=o.dom.getFirstChildGhostBlock(n),i&&r?s=o.plugins.textblock.merge(i,r):!1):!1},t.split=function(e,a,i){var r,s,l,d,c,u,g,f,p,m;if("object"==typeof a&&a.isLassoObject){if(f=a.clone().collapseToStart(),p=n().setCaretToStart(o.dom.getFirstChildGhostBlock(e)),m=n().setCaretToEnd(o.dom.getLastChildGhostBlock(e)),1!==f.compareEndPoints("StartToStart",p))return"atverystart";if(-1!==f.compareEndPoints("EndToEnd",m))return"atveryend";for(i=f.getParentNode();!o.dom.isGhostBlock(i);)i=o.dom.getParentGhostBlock(i);t.isList(i)||(t.isListItem(i)?a="":o.plugins.textblock.isTextBlock(i)&&(console.log("TEST"),o.plugins.textblock.selection.isAtStartOfTextBlock(f)?a="before":o.plugins.textblock.selection.isAtEndOfTextBlock(f)?a="after":(g=o.plugins.textblock.paste.split(i,f),i=o.dom.getParentGhostBlock(g.block2),a="before")))}if(!o.dom.isGhostBlock(e)||!o.dom.isChildGhostBlock(i,e))return!1;if("before"!==a&&(a="after"),r=o.dom.getFirstChildGhostBlock(e),s=o.dom.getLastChildGhostBlock(e),"before"===a&&r===i)return"atverystart";if("after"===a&&s===i)return"atveryend";if(d=i,l=t.create(e.tagName.toLowerCase()),c=o.dom.getParentGhostBlock(e),u=c.getAttribute("data-ghostedit-handler"),"before"===a)for(d=r;d&&d!==i;)l.appendChild(d),d=o.dom.getFirstChildGhostBlock(e);else for(d=o.dom.getNextSiblingGhostBlock(i);d;)l.appendChild(d),d=o.dom.getNextSiblingGhostBlock(i);return o.plugins[u].dom.addchild(c,a,e,l),"before"===a?{block1:l,block2:e}:{block1:e,block2:l}},t.toggle=function(e){var a,i,r,s,l,d,c,u,g;for(e="ordered"===e?"ol":"ul",i=!1,g=!1,l=!1,a=0;o.selection.nodepath.length>a;a++)switch(c=o.selection.nodepath[a],c.getAttribute("data-ghostedit-elemtype")){case"list":i=!0,r=c;break;case"textblock":g=!0,s=c;break;case"container":l=!0,d=c}return o.selection.savedRange.saveToDOM().select(),g&&!i?(t.convertTextblock(s,e),u=n().restoreFromDOM(),u&&u.select(),o.selection.save(),!0):i?(t.convertList(r,e),u=n().restoreFromDOM(),u&&u.select(),o.selection.save(),!0):l?(t.convertContainerContents(d,e),u=n().restoreFromDOM(),u&&u.select(),o.selection.save(),!0):!1},t.convertTextblock=function(e,a){var i,r,s,l,d;return i=t.create(a),s=e.tagName.toLowerCase(),r=t.createItem(),i.appendChild(r),l=o.dom.getParentGhostBlock(e),d=l.getAttribute("data-ghostedit-handler"),o.plugins[d].dom.addchild(l,"before",e,i),r.appendChild(e),t.tidy(i),n().setCaretToEnd(e).select(),o.selection.save(),e},t.convertList=function(e,a){var i,r,s,l,d,c,u,g=[],f=!1,p=!1,m=[],h=[],v=[];if(r=o.dom.getFirstChildGhostBlock(e),!r)return t.remove(e),!0;o.selection.savedRange.restoreFromDOM("",!1);do d=n().setCaretToEnd(r).compareEndPoints("StartToStart",o.selection.savedRange),d=d>=0?!0:!1,c=n().setCaretToStart(r).compareEndPoints("EndToEnd",o.selection.savedRange),c=0>=c?!0:!1,d?d&&c?h.push(r):v.push(r):m.push(r);while(r=o.dom.getNextSiblingGhostBlock(r));if(s=o.dom.getParentGhostBlock(e),l=s.getAttribute("data-ghostedit-handler"),v.length>0){for(p=t.create(e.tagName),i=0;v.length>i;i++)p.appendChild(v[i]);o.plugins[l].dom.addchild(s,"after",e,p)}if(u=e,e.tagName.toLowerCase()===a)for(i=0;h.length>i;i++)r=o.dom.getFirstChildGhostBlock(h[i]),r&&(o.plugins[l].dom.addchild(s,"after",u,r),u=r),e.removeChild(h[i]);else{for(f=t.create(a),i=0;h.length>i;i++)f.appendChild(h[i]);o.plugins[l].dom.addchild(s,"after",e,f)}return 0===m.length&&(t.remove(e),e=!1),e&&(t.tidy(e),g.push(e)),f&&(t.tidy(f),g.push(f)),p&&(t.tidy(p),g.push(p)),g},t.convertContainerContents=function(e,a){var i,r,s,l,d=[];r=o.dom.getFirstChildGhostBlock(e);do if(s=n().setCaretToEnd(r).compareEndPoints("StartToStart",o.selection.savedRange),s=s>=0?!0:!1,l=n().setCaretToStart(r).compareEndPoints("EndToEnd",o.selection.savedRange),l=0>=l?!0:!1,s&&l)d.push(r);else if(!l)break;while(r=o.dom.getNextSiblingGhostBlock(r));for(i=0;d.length>i;i++)switch(r=d[i],r.getAttribute("data-ghostedit-elemtype")){case"list":r.tagName.toLowerCase()!==a&&t.convertList(r,a);break;case"textblock":t.convertTextblock(r,a)}return!0},t.tidy=function(e){var n,a,i,r;return(i=o.dom.getFirstChildGhostBlock(e))?(n=o.dom.getPreviousSiblingGhostBlock(e),(r=t.merge(n,e))?(t.focus(r),o.selection.save(),t.tidy(r),!0):(a=o.dom.getNextSiblingGhostBlock(e),r=t.merge(e,a),r?(t.focus(r),o.selection.save(),t.tidy(r),!0):!0)):(t.remove(e),!0)},t.applydropevents=function(e){e.ondragenter=function(){return!1},e.ondragleave=function(){return!1},e.ondragover=function(){return!1},e.ondrop=function(e){var t,n;n=e.dataTransfer.getData("text/plain")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),o.image.focus(t),o.util.cancelEvent(e)},e.onresizestart=function(e){return o.util.cancelEvent(e)}},o.api.plugin.register("list",t)}(window),function(e){var t={savename:"",saveurl:"",params:[]},n=e.ghostedit;t.enable=function(){var e,o,a;if(n.api.save=function(){t.save()},n.options.save&&n.options.save.params)for(o=n.options.save.params,e=0;o.length>e;e++)"string"==typeof o[e]&&(a=o[e].split("=",2),a.length>1&&t.updateparameter(a[0],a[1]))},t.save=function(){var e,o,a,i;for(o=n.api.exportHTML(),t.updateparameter("snippet",o.snippet),t.updateparameter("content",o.content),a=[],e=0;t.params.length>e;e++)a.push(t.params[e].name+"="+t.params[e].value);a=a.join("&"),i=function(e,t){var o;e&&"true"===t?n.event.trigger("ui:message",{message:"Page was successfully saved :)",time:1,color:"success"}):(o=t,n.event.trigger("ui:message",{message:o,time:1,color:"error"}))},n.util.ajax(n.options.save.url,"POST",a,i,"text")},t.updateparameter=function(e,n){var o;if("string"==typeof e&&"string"==typeof n){for(e=e.replace(/[^A-Za-z\-_0-9]/g,""),n=encodeURIComponent(n),o=0;t.params.length>o;o++)if(t.params[o].name===e)return t.params[o]={name:e,value:n},undefined;t.params.push({name:e,value:n})}},n.api.plugin.register("save",t)}(window),function(){var e={aelem:!1,context:null,enabled:!1,elemInEnglish:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",p:"Paragraph",div:"Generic Box",a:"Link",b:"Bold",strong:"Bold",i:"Italic",em:"Italic",u:"Underline",img:"Image",ul:"Bulletted list",ol:"Numbered list",li:"List Item",strike:"Strikethrough"},definition:{quickbuttons:[{label:"Save",icon:"save16.png",action:function(){t.api.save()}},{label:"Undo",icon:"undo16.png",action:function(){t.api.undo()}},{label:"Redo",icon:"redo16.png",action:function(){t.api.redo()}}],tabs:[{name:"textblock",label:"Format",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"bold",label:"Bold",icon:"format-bold.png",highlighttest:function(e){return"b"===e||"strong"===e
},action:function(){t.api.format.bold()}},{type:"button",id:"italic",label:"Italic",icon:"format-italic.png",highlighttest:function(e){return"i"===e||"em"===e},action:function(){t.api.format.italic()}},{type:"button",id:"underline",label:"Underline",icon:"format-underline.png",highlighttest:function(e){return"u"===e},action:function(){t.api.format.underline()}},{type:"button",id:"strikethrough",label:"Strikethrough",icon:"format-strikethrough.png",highlighttest:function(e){return"strike"===e},action:function(){t.api.format.strikethrough()}},{type:"br"},{type:"button",id:"align-left",label:"Align Left",icon:"align-left.png",highlighttest:function(e,t,n){return"left"===n.style.textAlign||""===n.style.textAlign},action:function(){t.api.format.alignText("left")}},{type:"button",id:"align-center",label:"Align Center",icon:"align-center.png",highlighttest:function(e,t,n){return"center"===n.style.textAlign},action:function(){t.api.format.alignText("center")}},{type:"button",id:"align-right",label:"Align Right",icon:"align-right.png",highlighttest:function(e,t,n){return"right"===n.style.textAlign},action:function(){t.api.format.alignText("right")}},{type:"button",id:"align-justify",label:"Justify",icon:"align-justified.png",highlighttest:function(e,t,n){return"justify"===n.style.textAlign},action:function(){t.api.format.alignText("justify")}}]},{type:"seperator"},{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"list-unordered",label:"Bulleted List",icon:"list-unordered.png",action:function(){t.api.list.toggle("unordered")}},{type:"button",id:"list-ordered",label:"Numbered List",icon:"list-ordered.png",action:function(){t.api.list.toggle("ordered")}}]},{type:"seperator"},{type:"group",contents:[{type:"stylebox",label:"Paragraph",tagname:"p"},{type:"stylebox",label:"LeadPara",tagname:"p",classname:"LeadingParagraph"},{type:"stylebox",label:"Heading 1",tagname:"h1"},{type:"stylebox",label:"Heading 2",tagname:"h2"},{type:"stylebox",label:"Heading 3",tagname:"h3"}]}]},{name:"insert",label:"Insert",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"insert-link",label:"Insert Link",icon:"insert-link.png",action:function(){e.toolbar.event.buttonclick.insertlink()}},{type:"button",id:"insert-image",label:"Insert Image",icon:"insert-image.png",action:function(){e.toolbar.event.buttonclick.insertimage()}}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"&#224;"},{type:"specialchar",character:"&#225;"},{type:"specialchar",character:"&#226;"},{type:"specialchar",character:"&#227;"},{type:"specialchar",character:"&#228;"},{type:"specialchar",character:"&#229;"},{type:"specialchar",character:"&#232;"},{type:"specialchar",character:"&#233;"},{type:"br"},{type:"specialchar",character:"&#234;"},{type:"specialchar",character:"&#235;"},{type:"specialchar",character:"&#236;"},{type:"specialchar",character:"&#237;"},{type:"specialchar",character:"&#238;"},{type:"specialchar",character:"&#239;"},{type:"specialchar",character:"&#242;"},{type:"specialchar",character:"&#243;"},{type:"br"},{type:"specialchar",character:"&#244;"},{type:"specialchar",character:"&#245;"},{type:"specialchar",character:"&#246;"},{type:"specialchar",character:"&#249;"},{type:"specialchar",character:"&#250;"},{type:"specialchar",character:"&#251;"},{type:"specialchar",character:"&#252;"}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"+"},{type:"specialchar",character:"&#8722;"},{type:"specialchar",character:"&#215;"},{type:"specialchar",character:"&#247;"},{type:"br"},{type:"specialchar",character:"&#8804;"},{type:"specialchar",character:"&#8805;"},{type:"specialchar",character:"&#177;"},{type:"specialchar",character:"&#8801;"},{type:"br"},{type:"specialchar",character:"&#189;"},{type:"specialchar",character:"&#188;"},{type:"specialchar",character:"&#190;"},{type:"specialchar",character:"&#960;"}]}]},{name:"save",label:"Save",enabled:!0,contents:[{type:"group",contents:[{type:"textfield",label:"Page Name",onkeyup:function(e){e=e||window.event;var n=e.target||e.srcElement;t.plugins.save.updateparameter("name",n.value)}}]},{type:"group",contents:[{type:"textfield",label:"Page Url Slug",onkeyup:function(e){e=e||window.event;var n=e.target||e.srcElement;t.plugins.save.updateparameter("url",n.value)}}]},{type:"group",contents:[{type:"button",id:"save",label:"Save",icon:"save.png",action:function(){t.api.save()}}]},{type:"seperator"},{type:"group",contents:[{type:"button",id:"about",label:"About GhostEdit & credits",icon:"about.png",action:function(){t.api.defaultui.showabout()}}]}]},{name:"link",label:"Link",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"linkurl",label:"Link URL",width:"400px",onkeyup:function(e){e=e||window.event;var n=e.target||e.srcElement;t.api.link.updateurl(n.value)}}]},{type:"group",contents:[{type:"button",label:"Open link in new tab",icon:"openlink.png",action:function(){t.api.link.open()}}]}]},{name:"image",label:"Image",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"imagealt",label:"Description / Alt text",onkeyup:function(e){e=e||window.event;var n=e.target||e.srcElement;t.api.image.updatealttext(n.value)}}]}]}]}},t=window.ghostedit;e.el={},e.enable=function(){t.event.trigger("ui:replace"),t.event.addListener("ui:update",function(){t.ready&&e.update()},"defaultui"),t.event.addListener("ui:message",function(n){t.ready&&e.message.show(n)},"defaultui"),t.event.addListener("ui:replace",function(){t.api.plugin.disable("defaultui")},"defaultui"),t.event.addListener("selection:change",function(){var e,n;if(t.ready)for(e=0;t.selection.nodepath.length>e;e++){if(n=t.selection.nodepath[e],n.tagName&&"img"===n.tagName.toLowerCase()){"image"===t.selection.saved.type&&(document.getElementById("ghostedit_defaultui_textfield_imagealt").value=t.selection.saved.data.alt),t.event.trigger("ui:newcontext",{context:"image"});break}if(n.tagName&&"a"===n.tagName.toLowerCase()){t.plugins.link.focusedlink&&(document.getElementById("ghostedit_defaultui_textfield_linkurl").value="http:"===t.plugins.link.focusedlink.href?"http://":t.plugins.link.focusedlink.href),t.event.trigger("ui:newcontext",{context:"link"});break}if(t.plugins.textblock.isTextBlock(n)){t.event.trigger("ui:newcontext",{context:"textblock"});break}}},"defaultui"),t.event.addListener("ui:newcontext",function(n){if(n.context&&t.ready){if(e.context&&!/textblock|format|insert|save/.test(e.context)&&e.toolbar.disabletab(e.context),"string"==typeof n.context&&(n.context=n.context.replace("textblock","textblock")),e.context=n.context,"image"===n.context&&"image"===t.selection.type){var o=t.selection.data;document.getElementById("ghostedit_toolbar_imagealttext").value=o.alt}e.context&&!/image|help|save/.test(e.context)&&t.plugins.image.unfocus(),e.toolbar.showtab(n.context)}},"defaultui"),t.options.defaultui||(t.options.defaultui={}),t.options.defaultui.statusbar||(t.options.defaultui.statusbar=!0),t.options.defaultui.wordcount||(t.options.defaultui.wordcount=!0),t.api.defaultui=t.api.defaultui||{},t.api.defaultui.showabout=function(){e.modal.showabout()},t.ready?e.init():e.initlistenerid=t.event.addListener("init:after",e.init,"defaultui")},e.disable=function(){var n;n=e.el.wrap,t.event.removeAllListeners("defaultui"),n.parentNode.insertBefore(t.el.uilayer,n),n.parentNode.insertBefore(t.el.rootnode,n),n.parentNode.removeChild(n),e.toolbar.quickbuttons=[],e.toolbar.tabs=[],e.toolbar.enabledtabs=[],e.toolbar.panels=[]},e.init=function(){t.event.removeListener("init:after",e.initlistenerid);var n,o,a,i,r,s,l,d,c,u,g,f;if(n=e.definition,o=t.el.rootnode,a=document.createElement("div"),a.className="ghostedit_defaultui_wrapper",o.parentNode.insertBefore(a,o),e.el.wrap=a,i=document.createElement("div"),i.className="ghostedit_defaultui_workspace",a.appendChild(i),e.el.workspace=i,i.appendChild(t.el.uilayer),i.appendChild(t.el.rootnode),r=document.createElement("div"),r.id="ghostedit_defaultui_toolbar",r.className="ghostedit_defaultui_toolbar",e.el.toolbar=r,d=document.createElement("div"),d.id="ghostedit_defaultui_messagearea",d.className="ghostedit_defaultui_messagearea",d.innerHTML="&nbsp;",r.appendChild(d),e.el.messagearea=d,s=document.createElement("div"),s.id="ghostedit_defaultui_quickbutton_insertanchor",s.style.cssText="float: left; position: relative; width: 3px;height: 16px",r.insertBefore(s,d),e.el.qbanchor=s,n.quickbuttons)for(u=0;n.quickbuttons.length>u;u++)e.toolbar.insert.quickbutton(n.quickbuttons[u]);if(l=s=document.createElement("div"),l.id="ghostedit_defaultui_tabselect",l.style.cssText="position: absolute;width: 100%;left: 0; bottom: -1px; height: 1px; line-height: 1px; font-size: 1px; background-color: #FFF",e.el.tabselect=l,n.tabs)for(u=0;n.tabs.length>u;u++)e.toolbar.insert.tab(n.tabs[u]);e.el.wrap.insertBefore(r,e.el.wrap.firstChild),t.util.addEvent(e.el.toolbar,"mouseup",function(t){e.toolbar.event.click(t)}),t.util.addEvent(e.el.toolbar,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(e.el.toolbar,"mousedown",function(e){t.util.preventBubble(e)}),c=document.createElement("div"),c.id="ghostedit_defaultui_statusbar",c.className="ghostedit_defaultui_statusbar",c.innerHTML="<b>Path:</b>",e.el.wrap.appendChild(c),e.el.statusbar=c,g=document.createElement("div"),g.id="ghostedit_defaultui_modal",g.className="ghostedit_defaultui_modal",e.el.wrap.appendChild(g),e.el.modal=g,f=document.createElement("div"),f.id="ghostedit_defaultui_modalbg",f.className="ghostedit_defaultui_modalbg",t.util.addEvent(f,"click",function(){e.modal.hide()}),e.el.wrap.appendChild(f),e.el.modalbg=f,e.toolbar.showtab("textblock")},e.update=function(){var n,o,a,i,r,s,l,d="",c="N/A";if(l=e.toolbar.highlightmap,t.ready){for(n=0;l.length>n;n++)t.util.removeClass(l[n].element,"current");for(n=0;t.selection.nodepath.length>n;n++){for(a=t.selection.nodepath[n],i=a.tagName.toLowerCase(),r=t.util.trim(a.className),o=0;l.length>o;o++)l[o].test.call(l[o].data,i,r,a)&&t.util.addClass(l[o].element,"current");n!==t.selection.nodepath.length-1&&(d=" > "+(e.elemInEnglish[a.tagName.toLowerCase()]||a.tagName.toUpperCase())+d)}e.el.statusbar.innerHTML="<b>Path</b>"+d,t.options.defaultui.wordcount&&(s=t.util.trim(t.el.rootnode.innerText||t.el.rootnode.textContent),c=s.split(/\s+/).length,e.el.statusbar.innerHTML+="<div style='position: absolute; right: 10px; top: 3px'>"+c+" words</div>")}},e.modal={show:function(n){var o,a,i;o=e.el.modal,a=e.el.modalbg,o.innerHTML=n,i=document.createElement("a"),i.className="ghostedit_defaultui_modal_closebutton",i.innerHTML="&#215",t.util.addEvent(i,"click",e.modal.hide),o.appendChild(i),o.style.display="block",a.style.display="block"},hide:function(){var n,o;n=e.el.modal,o=e.el.modalbg,n.style.display="none",o.style.display="none",n.innerHTML="",t.selection.restore()},showabout:function(){e.modal.show("<h2>About GhostEdit</h2><p>GhostEdit is a WYSIWYG editor based on the concept that the editor should be transparent to use - i.e. you do no notice that you are using it. This manifests itself in two ways:</p><ul><li>GhostEdit has an incredibly simple user interface, which is designed for maximum usability</li><li>GhostEdit restricts input to known, safe content so as to be as reliable as possible</li></ul><h3>Credits</h3>GhostEdit was designed and coded by <a href='http://nicoburns.com'>Nico Burns</a>.<br />Icons licensed from <a href='http://www.gentleface.com/free_icon_set.html'>Gentleface</a> under a <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/'>CC BY-NC-ND 3.0</a> liscense.<br />version: "+t.version)}},e.message={div:"",show:function(t){var n,o,a,i;n=t.message,o=t.time,a=t.color,i=e.el.messagearea,i.innerHTML=n,a="success"===a?"#bbff00":a,a="error"===a?"#ff4949":a,a="warn"===a?"#ffef49":a,i.style.backgroundColor=a,i.style.opacity=1,i.filters&&(i.filters.item(0).enabled=1),0!==o&&(clearTimeout(e.message.timer),e.message.timer=setTimeout(function(){e.message.clear()},1e3*o))},clear:function(){var t=e.el.messagearea;t.style.opacity>.1?(t.style.opacity=t.style.opacity-.05,t.filters&&(t.filters.item(0).Opacity=100*t.style.opacity),setTimeout(function(){e.message.clear()},20)):(t.innerHTML="&nbsp;",t.style.backgroundColor="transparent",t.opacity="1",t.filters&&(t.filters.item(0).Opacity=100))}},e.toolbar={div:"",quickbuttons:[],tabs:[],enabledtabs:["format","insert","save"],panels:[],styleboxes:[],highlightmap:[],event:{click:function(e){t.event.allowtoolbarclick||t.util.cancelAllEvents(e)},buttonclick:{insertimage:function(){t.selection.save();var n,o,a,i,r;for(i="<h2>Insert image</h2><form><p>This dialog allows you to choose an image to insert into the document. Either select one from the list of uploaded images, or enter a custom url in the box below.</p><hr /><h3 style='clear: both;'>Select uploaded image</h3><div id='ghostedit_listbox' style='height: 200px;overflow-x: hidden;overflow-y: scroll;background: white; border: 1px solid #ccc'></div><hr /><h3>Or enter URL</h3><input type='text' value='' id='ghostedit_imageurlinput' style='width: 99%' /><br /><input type='button' value='Insert' style='float: right;margin-top: 10px;' onclick='ghostedit.plugins.image.newImageBefore(null, null);ghostedit.plugins.defaultui.modal.hide();' /></form>",a=[],t.options.defaultui.uploadedimages&&(a=t.options.defaultui.uploadedimages),e.modal.show(i),r=function(){t.plugins.image.newImageBefore(null,this.getAttribute("ghostedit-listitem-value"),!1),e.modal.hide()},n=0;a.length>n;n+=1)o=document.createElement("div"),o.className="ghostedit-listbox-item",o.setAttribute("ghostedit-listitem-value",a[n].url),o.innerHTML="<img src='"+a[n].thumburl+"' style='height: 60px; float: left' /><p style='margin-left: 100px;font-size: 21px'>"+a[n].name+"</p>",o.onclick=r,document.getElementById("ghostedit_listbox").appendChild(o);document.getElementById("ghostedit_imageurlinput").focus()},insertlink:function(){t.api.link.create(),document.getElementById("ghostedit_defaultui_textfield_linkurl").focus()}}},clicktab:function(e){var n,o;"string"==typeof e&&(e=document.getElementById("ghostedit_defaultui_toolbartab_"+e.replace("ghostedit_defaultui_toolbartab_",""))),o=e.id.replace("ghostedit_defaultui_toolbartab_",""),n=document.getElementById("ghostedit_defaultui_toolbarpanel_"+o),t.selection.restore(),t.event.trigger("ui:newcontext",{context:o})},showtab:function(n){var o,a,i,r,s;for("string"==typeof n&&(n=document.getElementById("ghostedit_defaultui_toolbartab_"+n.replace("ghostedit_defaultui_toolbartab_",""))),a=n.id.replace("ghostedit_defaultui_toolbartab_",""),o=document.getElementById("ghostedit_defaultui_toolbarpanel_"+a),i=e.el.toolbar.childNodes,r=0;i.length>r;r+=1)s=i[r],1===s.nodeType&&(/tab/.test(s.className)||/panel/.test(s.className))&&t.util.removeClass(s,"active");e.toolbar.enabledtabs[a]||e.toolbar.enabletab(a),t.util.addClass(n,"active"),t.util.addClass(o,"active"),n.appendChild(e.el.tabselect)},enabletab:function(n){var o;o=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.addClass(o,"enabled"),e.toolbar.enabledtabs.push(n)},disabletab:function(n){var o;o=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.removeClass(o,"enabled"),delete e.toolbar.enabledtabs[n]},insert:{quickbutton:function(n){var o;return n&&n.label&&n.icon&&t.util.isFunction(n.action)?(o=document.createElement("img"),o.className="ghostedit_defaultui_quickbutton",o.src=t.options.imageurl+"/defaultui/"+n.icon,o.title=n.label,o.alt=n.label,e.el.toolbar.insertBefore(o,e.el.qbanchor),e.toolbar.quickbuttons.push(o),o.onclick=n.action,void 0):!1},tab:function(n){var o,a,i;if(o=document.createElement("div"),o.className=n.enabled?"ghostedit_defaultui_toolbartab enabled":"ghostedit_defaultui_toolbartab",o.id="ghostedit_defaultui_toolbartab_"+n.name,o.innerHTML=n.label,a=document.createElement("div"),t.util.addClass(a,"ghostedit_defaultui_toolbarpanel"),a.id="ghostedit_defaultui_toolbarpanel_"+n.name,n.contents)for(i=0;n.contents.length>i;i++)switch(n.contents[i].type){case"group":e.toolbar.insert.panelgroup(a,n.contents[i]);break;case"seperator":e.toolbar.insert.panelseperator(a)}e.el.toolbar.insertBefore(o,e.el.messagearea),e.el.toolbar.appendChild(a),e.toolbar.tabs.push(o),o.onclick=function(){e.toolbar.clicktab(this)}},panelseperator:function(e){var n;n=document.createElement("span"),n.className="ghostedit_defaultui_toolbarseperator",n.style.backgroundImage="URL("+t.options.imageurl+"/defaultui/toolbar_seperator.png)",e.appendChild(n)},panelgroup:function(t,n){var o,a;if(o=document.createElement("span"),o.className="ghostedit_defaultui_toolbarpanelgroup",n.style&&(o.style.cssTet=n.style),n.contents)for(a=0;n.contents.length>a;a++)switch(n.contents[a].type){case"button":e.toolbar.insert.button(o,n.contents[a]);break;case"stylebox":e.toolbar.insert.stylebox(o,n.contents[a]);break;case"specialchar":e.toolbar.insert.specialchar(o,n.contents[a]);break;case"textfield":e.toolbar.insert.textfield(o,n.contents[a]);break;case"br":o.appendChild(document.createElement("br"))}t.appendChild(o)},button:function(n,o){var a;a=document.createElement("img"),a.src=t.options.imageurl+"/defaultui/"+o.icon,a.title=o.label,a.alt=o.label,o.style&&(a.style.cssText=o.style),n.appendChild(a),o.highlighttest&&e.toolbar.highlightmap.push({element:a,test:o.highlighttest}),t.util.addEvent(a,"click",o.action)},specialchar:function(e,n){var o;o=document.createElement("a"),o.className="ghostedit_defaultui_specialchar",o.title="Insert Character",o.alt="Insert Character",o.innerHTML=n.character,e.appendChild(o),o.onclick=function(){t.api.insert.character(this.innerHTML)}},textfield:function(e,n){var o;o=document.createElement("input"),n.id&&(o.id="ghostedit_defaultui_textfield_"+n.id),o.style.width=n.width?n.width:"200px",n.label&&(e.innerHTML+=n.label+"<br />"),e.appendChild(o),t.util.addEvent(o,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keypress",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keydown",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keyup",n.onkeyup)},stylebox:function(n,o){var a,i;a=document.createElement("div"),a.className="ghostedit_defaultui_stylebox",a.id="ghostedit_defaultui_stylebox_"+o.tagname,o.classname&&(a.id=a.id+"_"+o.classname),a.innerHTML="<"+o.tagname+" class='ghostedit_defaultui_stylebox_preview'>AaBbCc</"+o.tagname+">",a.title=o.label,a.alt=o.label,i=document.createElement("div"),i.className="ghostedit_defaultui_stylebox_label",i.innerHTML=o.label,a.appendChild(i),n.appendChild(a),e.toolbar.styleboxes.push(a),e.toolbar.highlightmap.push({element:a,data:{tagname:o.tagname,classname:void 0!==o.classname?o.classname:""},test:function(e,t){return e===this.tagname&&t===this.classname}}),a.onclick=function(){t.api.format.setStyle(o.tagname,o.classname)}}}},t.api.plugin.register("defaultui",e)}(),function(){var e={aelem:!1,context:null},t=window.ghostedit;e.el={},e.enable=function(){t.event.trigger("ui:replace"),t.event.addListener("ui:update",function(){e.update()},"minimalui"),t.event.addListener("ui:replace",function(){t.api.plugin.disable("minimalui")},"minimalui");var n,o,a,i=!1,r=!1;if(n=document.createElement("div"),n.id="ghostedit_minimalui_toolbar",n.className="ghostedit_minimalui_toolbar",e.el.toolbar=n,e.insertbutton({label:"Bold",icon:"format-bold.png",action:function(){t.api.format.bold()}}),e.insertbutton({label:"Italic",icon:"format-italic.png",action:function(){t.api.format.italic()}}),e.insertbutton({label:"Underline",icon:"format-underline.png",action:function(){t.api.format.underline()}}),e.insertbutton({label:"Strikethrough",icon:"format-strikethrough.png",action:function(){t.api.format.strikethrough()}}),e.insertbutton({label:"Align Left",icon:"align-left.png",action:function(){t.api.format.alignText("left")}}),e.insertbutton({label:"Align Center",icon:"align-center.png",action:function(){t.api.format.alignText("center")}}),e.insertbutton({label:"Align Right",icon:"align-right.png",action:function(){t.api.format.alignText("right")}}),e.insertbutton({label:"Justify",icon:"align-justified.png",action:function(){t.api.format.alignText("justify")}}),o=t.options.plugins)for(a=0;o.length>a;a++)switch(o[a]){case"link":i=!0;break;case"list":r=!0}r&&(e.insertbutton({label:"Bulleted List",icon:"list-unordered.png",action:function(){t.api.list.toggle("unordered")}}),e.insertbutton({label:"Numbered List",icon:"list-ordered.png",action:function(){t.api.list.toggle("ordered")}})),e.insertbutton({label:"Undo",icon:"undo16.png",action:function(){t.api.undo()}}),e.insertbutton({label:"Redo",icon:"redo16.png",action:function(){t.api.redo()}}),t.el.uilayer.parentNode.insertBefore(n,t.el.uilayer),t.util.addEvent(e.el.toolbar,"mouseup",t.util.cancelAllEvents),t.util.addEvent(e.el.toolbar,"click",t.util.preventBubble),t.util.addEvent(e.el.toolbar,"mousedown",t.util.preventBubble)},e.disable=function(){t.event.removeAllListeners("minimalui"),e.el.toolbar.parentNode.removeChild(e.el.toolbar)},e.update=function(){var n,o,a,i,r,s;for(s=e.highlightmap,n=0;s.length>n;n++)t.util.removeClass(s[n].element,"current");for(n=0;t.selection.nodepath.length>n;n++)for(a=t.selection.nodepath[n],i=a.tagName.toLowerCase(),r=t.util.trim(a.className),o=0;s.length>o;o++)s[o].test.call(s[o].data,i,r,a)&&t.util.addClass(s[o].element,"current")},e.quickbuttons=[],e.highlightmap=[],e.insertbutton=function(n){var o;return n&&n.label&&n.icon&&t.util.isFunction(n.action)?(o=document.createElement("img"),o.src=t.options.imageurl+"/minimalui/"+n.icon,o.title=n.label,o.alt=n.label,n.style&&(o.style.cssText=n.style),o.style.marginRight="5px",e.el.toolbar.appendChild(o),n.highlighttest&&e.highlightmap.push({element:o,test:n.highlighttest}),t.util.addEvent(o,"click",n.action),void 0):!1},e.inserttextfield=function(e,n){var o;o=document.createElement("input"),n.id&&(o.id="ghostedit_minimalui_textfield_"+n.id),o.style.width=n.width?n.width:"200px",n.label&&(e.innerHTML+=n.label+"<br />"),e.appendChild(o),t.util.addEvent(o,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keypress",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keydown",function(e){t.util.preventBubble(e)}),t.util.addEvent(o,"keyup",n.onkeyup)},e.insertstylebox=function(n,o){var a;e.highlightmap.push({element:a,data:{tagname:o.tagname,classname:void 0!==o.classname?o.classname:""},test:function(e,t){return e===this.tagname&&t===this.classname}}),a.onclick=function(){t.api.format.setStyle(o.tagname,o.classname)}},t.api.plugin.register("minimalui",e)}();