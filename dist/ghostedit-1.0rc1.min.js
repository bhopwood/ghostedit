/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2012 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0rc1
Release Date:      2012-12-13
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/
(function(e,t){var n={version:"1.0rc1",enabledplugins:[],uicontext:"",active:!1,isEditing:!0,blockElemId:0,editorchrome:null,debug:!1};n.api={},n.plugins={},e.ghostedit=n})(window),function(e,t){var n={};n.init=function(){n.paste.init(),n.cut.init()},_paste={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},_paste.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"paste",function(e){_paste.handle(e)})},"clipboard")},_paste.handle=function(e){return ghostedit.history.saveUndoState(),_paste.savedundodata=ghostedit.history.undoData,_paste.savedundopoint=ghostedit.history.undoPoint,_paste.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(_paste.triedpasteimage=!0),/text\/html/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):ghostedit.editdiv.innerHTML="",_paste.waitfordata(),ghostedit.util.cancelEvent(e)):(ghostedit.editdiv.innerHTML="",_paste.waitfordata(),!0)},_paste.waitfordata=function(){var e=ghostedit.editdiv;e.childNodes&&e.childNodes.length>0?_paste.process():setTimeout(_paste.waitfordata,20)},_paste.process=function(){var e,t,n,r,i,s,o,u,a,f="",l,c,h="",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;A=document.createElement("div"),console.log("raw paste content"),console.log(ghostedit.editdiv.cloneNode(!0)),A=ghostedit.plugins.container.inout.importHTML(ghostedit.editdiv),console.log("processed content"),console.log(A.innerHTML),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),console.log(ghostedit.selection.saved),ghostedit.selection.deleteContents(),ghostedit.selection.save(),console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A);if(!E)return;ghostedit.selection.saved.data.isCollapsed()?(O=!0,ghostedit.selection.saved.data.saveToDOM("ghostedit_paste_start")):(O=!1,ghostedit.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),ghostedit.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),console.log("test--------------------------------"),w=!1,_paste.trycounter=0,ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b){M=!1;break}y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;x={isfirst:!0,islast:ghostedit.dom.getFirstChildGhostBlock(A)===E?!0:!1,collapsed:O},console.log("Call handler: (first)"+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,x),console.log("result: "+w);if(w){M=!0,E.parentNode.removeChild(E);break}w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1)}E=ghostedit.dom.getLastChildGhostBlock(A);if(E&&(O===!1||M===!1)){_paste.trycounter=0,w=!1,ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler (last): "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!0,collapsed:O}),console.log("result: "+w);if(w){E.parentNode.removeChild(E);break}w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1);if(_paste.trycounter++>20)return}}console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A),_paste.trycounter=0;while(E){w=!1;while(!w){ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),lasso().isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.setEndToRangeEnd(lasso().restoreFromDOM("ghostedit_paste_end",!1)),ghostedit.selection.saved.data.select(),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler: "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!1,collapsed:O}),console.log("result: "+w);if(_paste.trycounter++>20)return}E=ghostedit.dom.getNextSiblingGhostBlock(E)}ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),ghostedit.selection.save(),ghostedit.event.trigger("postpaste"),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.saveUndoState(),_paste.triedpasteimage&&(ghostedit.ui.message.show("You cannot paste images into the editor, please use the add image button instead",2,"warn"),ghostedit.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}))},_cut={savedcontent:null,savedundodata:null,savedundopoint:null},_cut.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"cut",function(e){_cut.handle(e)})},"clipboard")},_cut.handle=function(e){return ghostedit.history.saveUndoState(),_cut.savedundodata=ghostedit.history.undoData,_cut.savedundopoint=ghostedit.history.undoPoint,setTimeout(_cut.cleanup,20),!0},_cut.cleanup=function(){ghostedit.history.undoData=_cut.savedundodata,ghostedit.history.undoPoint=_cut.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),ghostedit.selection.deleteContents(),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.paste=_paste,n.cut=_cut,e.ghostedit.clipboard=n}(window),function(e,t){_container={},_container.ghostevent=function(e,n,r,s){var o=!1,u,a=!1;switch(e){case"deletebehind":childblocks=n.childNodes;for(i=childblocks.length-1;i>=0;i-=1)if(childblocks[i].getAttribute("data-ghostedit-elemtype")!==t&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==!1&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==null)if(o===!0){u=childblocks[i].getAttribute("data-ghostedit-elemtype");if(ghostedit.plugins[u].ghostevent("deletefromahead",childblocks[i],s)){a=!0;break}}else childblocks[i]===s.sourceblock&&(o=!0);!a;break;case"deleteahead":childblocks=n.childNodes;for(i=0;i<childblocks.length;i+=1)if(childblocks[i].getAttribute("data-ghostedit-elemtype")!==t&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==!1&&childblocks[i].getAttribute("data-ghostedit-elemtype")!==null)if(o===!0){u=childblocks[i].getAttribute("data-ghostedit-elemtype");if(ghostedit.plugins[u].ghostevent("deletefrombehind",childblocks[i],s)){a=!0;break}}else childblocks[i]===s.sourceblock&&(o=!0);!a}},_container.dom={addchild:function(e,t,n,r){return t==="before"?e.insertBefore(r,n):n.nextSibling!=null?e.insertBefore(r,n.nextSibling):e.appendChild(r),!0},removechild:function(e,t){return!e||!t?!1:(e.removeChild(t),!0)}},_container.selection={deleteContents:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=!1,k=!1,L,A,O,M,_,D,P,H;if(ghostedit.selection.saved.type!=="textblock")return!1;N=ghostedit.selection.saved.data,f=e.childNodes,L=ghostedit.dom.getFirstChildGhostBlock(e),A=ghostedit.dom.getLastChildGhostBlock(e),x=lasso().setCaretToStart(L),T=lasso().setCaretToEnd(A),N.compareEndPoints("StartToStart",x)!==1?(C=!0,s=L):(s=N.getStartNode(),ghostedit.dom.isGhostBlock(s)||(s=ghostedit.dom.getParentGhostBlock(s))),N.compareEndPoints("EndToEnd",T)!==-1?(k=!0,o=A):(o=N.getEndNode(),ghostedit.dom.isGhostBlock(o)||(o=ghostedit.dom.getParentGhostBlock(o))),u=s;while(!ghostedit.dom.isChildGhostBlock(u,e))u=ghostedit.dom.getParentGhostBlock(u);a=o;while(!ghostedit.dom.isChildGhostBlock(a,e))a=ghostedit.dom.getParentGhostBlock(a);d=!1;for(n=0;n<f.length;n+=1){cblock=f[n];if(!ghostedit.dom.isGhostBlock(cblock))continue;P=cblock.getAttribute("data-ghostedit-handler");if(cblock.id===u.id){ghostedit.plugins[P].selection.deleteContents(cblock),d=!0;continue}if(cblock.id===a.id){ghostedit.plugins[P].selection.deleteContents(cblock),d=!1;break}d&&(e.removeChild(f[n]),n--)}return u.getAttribute("data-ghostedit-elemtype")===a.getAttribute("data-ghostedit-elemtype")&&(ghostedit.plugins[u.getAttribute("data-ghostedit-elemtype")].merge(u,a,t),ghostedit.dom.getParentGhostBlock(a)||lasso().setToSelection().collapseToStart().select()),ghostedit.dom.getFirstChildGhostBlock(e)||e.appendChild(ghostedit.textblock.create("p")),!0}},_container.inout={importHTML:function(e){var t,n,r,i,s;if(!e||e.childNodes.length<1)return!1;t=_container.create();for(i=0;i<e.childNodes.length;i+=1){elem=e.childNodes[i];if(elem.nodeType!==1&&elem.nodeType!==3)continue;tagname=elem.nodeType===3?"#textnode":elem.tagName.toLowerCase(),ghostedit.inout.importhandlers[tagname]?(r=ghostedit.inout.importhandlers[tagname].call(this,elem),r&&ghostedit.dom.isGhostBlock(r)&&t.appendChild(r)):elem.childNodes.length>0&&(s=elem.childNodes.length,elem.parentNode.insertBefore(ghostedit.dom.extractContent(elem),elem),elem.parentNode.removeChild(elem),i-=1)}return ghostedit.dom.getFirstChildGhostBlock(t)||t.appendChild(ghostedit.plugins.textblock.create("p")),t},exportHTML:function(e,t){if(!e||!ghostedit.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="container")return!1;var n=0,r,i,s="",o,u,a=0,f,l,c=!1;for(n=0;n<e.childNodes.length;n+=1){r=ghostedit.dom.isGhostBlock(e.childNodes[n])?e.childNodes[n]:!1;if(!r)continue;l=r.getAttribute("data-ghostedit-handler");if(!l||!ghostedit.plugins[l])continue;blockreturn=ghostedit.plugins[l].inout.exportHTML(r),blockreturn&&(s+=blockreturn.content,a++),a<=3&&(f=s)}return{content:s,snippet:f}}},_container.paste={handle:function(e,t,n){var r,i,s,o;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isGhostBlock(t))return!0;if(n.isfirst||n.islast)return!1;r=ghostedit.selection.saved.data,i=r.clone().collapseToStart().getParentElement(),r.saveToDOM("ghostedit_paste_start"),i===e&&(o=document.getElementById("ghostedit_paste_start_range_start"),i=ghostedit.dom.getPreviousSiblingGhostBlock(o)||o);while(i.parentNode!==e){i=i.parentNode;if(i===null||!i.parentNode)return!0}return s=t.cloneNode(!0),lasso().removeDOMmarkers("ghostedit_paste_start"),s.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t3'>&#x200b;</span>",_container.dom.addchild(e,"after",i,s),o&&o.parentNode&&o.parentNode.removeChild(o),!0}},_container.isChildGhostBlock=function(e,n){if(!e)return!1;if(e.nodeType!=1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;for(i=0;i<n.length;i+=1)if(e===n[i])return!0;return!1},_container.create=function(){return newElem=document.createElement("div"),ghostedit.blockElemId+=1,newElem.id="ghostedit_container_"+ghostedit.blockElemId,newElem.setAttribute("data-ghostedit-iselem","true"),newElem.setAttribute("data-ghostedit-elemtype","container"),newElem.setAttribute("data-ghostedit-handler","container"),newElem},_container.focus=function(e){var t,n;return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="container"?!1:(t=ghostedit.dom.getFirstChildGhostBlock(e),t?(n=t.getAttribute("data-ghostedit-handler"),ghostedit.plugins[n].focus(t),!0):!1)},ghostedit.api.plugin.register("container",_container)}(window),function(e,t){var n={};n.init=function(){n.paste.init(),n.cut.init()},_paste={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},_paste.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"paste",function(e){_paste.handle(e)})},"clipboard")},_paste.handle=function(e){return ghostedit.history.saveUndoState(),_paste.savedundodata=ghostedit.history.undoData,_paste.savedundopoint=ghostedit.history.undoPoint,_paste.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(_paste.triedpasteimage=!0),/text\/html/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)?ghostedit.editdiv.innerHTML=e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):ghostedit.editdiv.innerHTML="",_paste.waitfordata(),ghostedit.util.cancelEvent(e)):(ghostedit.editdiv.innerHTML="",_paste.waitfordata(),!0)},_paste.waitfordata=function(){var e=ghostedit.editdiv;e.childNodes&&e.childNodes.length>0?_paste.process():setTimeout(_paste.waitfordata,20)},_paste.process=function(){var e,t,n,r,i,s,o,u,a,f="",l,c,h="",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;A=document.createElement("div"),console.log("raw paste content"),console.log(ghostedit.editdiv.cloneNode(!0)),A=ghostedit.plugins.container.inout.importHTML(ghostedit.editdiv),console.log("processed content"),console.log(A.innerHTML),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),console.log(ghostedit.selection.saved),ghostedit.selection.deleteContents(),ghostedit.selection.save(),console.log(A),E=ghostedit.dom.getFirstChildGhostBlock(A);if(!E)return;ghostedit.selection.saved.data.isCollapsed()?(O=!0,ghostedit.selection.saved.data.saveToDOM("ghostedit_paste_start")):(O=!1,ghostedit.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),ghostedit.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),console.log("test--------------------------------"),w=!1,_paste.trycounter=0,ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;x={isfirst:!0,islast:ghostedit.dom.getFirstChildGhostBlock(A)===E?!0:!1,collapsed:O},console.log("Call handler: (first)"+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,x),w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),console.log("result: "+w)}E.parentNode.removeChild(E),E=ghostedit.dom.getLastChildGhostBlock(A);if(E){_paste.trycounter=0,w=!1,ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),b=ghostedit.selection.saved.data.getParentNode(),ghostedit.dom.isGhostBlock(b)||(b=ghostedit.dom.getParentGhostBlock(b));while(!w){if(!b)break;y=b.getAttribute("data-ghostedit-handler");if(!ghostedit.plugins[y]||!ghostedit.plugins[y].paste)break;console.log("Call handler (last): "+y),console.log(E),w=ghostedit.plugins[y].paste.handle(b,E,{isfirst:!1,islast:!0,collapsed:O}),w||(b=ghostedit.dom.getParentGhostBlock(b)),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")?ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),console.log("result: "+w);if(_paste.trycounter++>20)return}E.parentNode.removeChild(E)}ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),ghostedit.selection.saved.data.isSavedRange("ghostedit_paste_end")&&ghostedit.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),ghostedit.selection.save(),ghostedit.event.trigger("postpaste"),ghostedit.history.undoData=_paste.savedundodata,ghostedit.history.undoPoint=_paste.savedundopoint,ghostedit.history.saveUndoState(),_paste.triedpasteimage&&(ghostedit.ui.message.show("You cannot paste images into the editor, please use the add image button instead",2,"warn"),ghostedit.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}))},_cut={savedcontent:null,savedundodata:null,savedundopoint:null},_cut.init=function(){ghostedit.event.addListener("init:after",function(){ghostedit.util.addEvent(ghostedit.editdiv,"cut",function(e){_cut.handle(e)})},"clipboard")},_cut.handle=function(e){return ghostedit.history.saveUndoState(),_cut.savedundodata=ghostedit.history.undoData,_cut.savedundopoint=ghostedit.history.undoPoint,setTimeout(_cut.cleanup,20),!0},_cut.cleanup=function(){ghostedit.history.undoData=_cut.savedundodata,ghostedit.history.undoPoint=_cut.savedundopoint,ghostedit.history.restoreUndoPoint(ghostedit.history.undoPoint),ghostedit.selection.deleteContents(),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.paste=_paste,n.cut=_cut,e.ghostedit.clipboard=n}(window),function(e,t){var n={};n.getNodeOffset=function(e){var t,n;if(!e||!e.parentNode)return;t=0,n=e.parentNode.childNodes;while(n[t]!==e)t+=1;return t},n.extractContent=function(e){var t=document.createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t},n.cloneContent=function(e){var t=document.createDocumentFragment(),n;for(i=0;i<e.childNodes.length;i++)n=e.childNodes[i],t.appendChild(n.cloneNode(!0));return t},n.parse=function(e,r){var i=!1,s,o,u,a,f,l,c,h,p,d,v;if(!e||!r||!e.nodeType)return!1;r.textnode=r.textnode||{},r.tags=r.tags||{};if(e.nodeType===3)return c=r.textnode.clean?e.nodeValue.replace(/[\n\r\t]/g,""):e.nodeValue,c.length>0?document.createTextNode(c):!1;if(e.nodeType!==1)return!1;h=e.tagName.toLowerCase(),p={contentsonly:!0};if(r.tags[h]){p=r.tags[h],typeof p.template=="string"&&(p=p.template),typeof p=="string"&&r.templates[p]&&(p=r.templates[p]);if(typeof p=="string")return!1}i=p.contentsonly?document.createDocumentFragment():document.createElement(e.tagName.toLowerCase());if(!p.ignorechildren){s=e.childNodes;for(a=0;a<s.length;a++)(o=n.parse(s[a],r))&&i.appendChild(o)}if(p.contentsonly)return i.childNodes.length>0?i:!1;if(p.attributes)for(a=0;a<p.attributes.length;a++){d=p.attributes[a],typeof d=="string"&&(d={name:d});if(typeof d.name!="string")break;l=d.value||d.name==="class"?e.className:e.getAttribute(d.name);if(l===t)break;d.copy=!0;if(d.allowedvalues){d.copy=!1;for(f=0;f<d.allowedvalues.length;f++)if(d.allowedvalues[a]===l){d.copy=!0;break}}d.copy&&(d.name==="class"?i.className=l:i.setAttribute(d.name,l))}if(p.styles)for(a=0;a<p.styles.length;a++){v=p.styles[a],typeof v=="string"&&(v={name:v});if(typeof v.name!="string")break;v.name==="float"&&(v.name=e.style.cssFloat?"cssFloat":"styleFloat"),l=v.value||e.style[v.name];if(l===t)break;v.copy=!0;if(v.allowedvalues){v.copy=!1;for(f=0;f<v.allowedvalues.length;f++)if(v.allowedvalues[f]===l){v.copy=!0;break}}v.copy&&(i.style[v.name]=l)}return i},n.isGhostBlock=function(e){if(!e||!e.nodeType||e.nodeType!==1)return!1;var n=e.getAttribute("data-ghostedit-elemtype");return n!==t&&n!==!1&&n!==null?!0:!1},n.isChildGhostBlock=function(e,n){if(!e||!n||!n.childNodes)return!1;if(e.nodeType!=1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;var r=n.childNodes;for(i=0;i<r.length;i+=1)if(e===r[i])return!0;return!1},n.isGhostToplevel=function(e){return e&&e.getAttribute("data-ghostedit-isrootnode")===!0?!0:!1},n.getParentGhostBlock=function(e){if(!e)return!1;do{e=e.parentNode;if(e==null)return!1}while(!n.isGhostBlock(e));return e},n.getFirstChildGhostBlock=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=0;i<t.length;i+=1)if(n.isGhostBlock(t[i]))return t[i];return!1},n.getLastChildGhostBlock=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=t.length-1;i>=0;i-=1)if(n.isGhostBlock(t[i]))return t[i];return!1},n.getPreviousSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)-1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r-=1}while(r>=0);return!1},n.getNextSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)+1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r+=1}while(r<i.length);return!1},n.getParentElement=function(e){if(e.nodeType!=1)while(e.nodeType!=1){e=e.parentNode;if(e==null)return null}return e},n.isDescendant=function(e,t){var n=t.parentNode;while(n!=null){if(n==e)return!0;n=n.parentNode}return!1},n.getFirstChildElement=function(e){var t;if(!e||!e.childNodes)return!1;t=e.childNodes;for(i=0;i<t.length;i+=1)if(t[i].nodeType===1)return t[i];return!1},n.getCertainParent=function(e,t){var n=[].slice.call(arguments);n.shift();if(!e.apply(this,n))while(!e.apply(this,n)){t=t.parentNode,n[0]=t;if(t==null)return!1}return t},e.ghostedit.dom=n}(window),function(e,t){var n={listeners:[],listenerid:0,eventtypes:[],cancelKeypress:!1};n.keydown=function(t,r){var i,s,o,u;ghostedit.selection.save(!1),r=(!r||!r.istest)&&e.event!=null?e.event:r,i=r.keyCode!=null?r.keyCode:r.charCode,n.trigger("input:keydown",{event:event,keycode:i});switch(i){case 8:case 46:cancelKeypress=!1;if(ghostedit.selection.savedRange.isCollapsed()===!1)return ghostedit.history.saveUndoState(),ghostedit.selection.deleteContents(i===8?"collapsetostart":"collapsetoend"),ghostedit.history.saveUndoState(),n.cancelKeypress=!0,ghostedit.util.cancelEvent(r);break;case 83:if(r.ctrlKey)return ghostedit.api.save(),ghostedit.util.cancelEvent(r);break;case 66:if(r.ctrlKey)return ghostedit.textblock.format.bold(),ghostedit.util.cancelEvent(r);break;case 73:if(r.ctrlKey&&!r.shiftKey)return ghostedit.textblock.format.italic(),ghostedit.util.cancelEvent(r);break;case 85:if(r.ctrlKey)return ghostedit.textblock.format.underline(),ghostedit.util.cancelEvent(r);break;case 90:if(r.ctrlKey)return ghostedit.history.undo(),ghostedit.util.cancelEvent(r);break;case 89:if(r.ctrlKey)return ghostedit.history.redo(),ghostedit.util.cancelEvent(r)}s=ghostedit.selection.getContainingGhostBlock();for(;;){o=s.getAttribute("data-ghostedit-handler"),u=ghostedit.plugins[o].ghostevent("keydown",s,"self",{keycode:i,event:r});if(u===!0)break;s=ghostedit.dom.getParentGhostBlock(s);if(!s)break}return ghostedit.selection.save(),!0},n.keypress=function(r,i){var s,o,u,a,f,l;ghostedit.selection.save(),f=ghostedit.editdiv.innerHTML.length,l=ghostedit.history.undoData[ghostedit.history.undoPoint]!==t?ghostedit.history.undoData[ghostedit.history.undoPoint].content.string.length:0,i=(!i||!i.istest)&&e.event!=null?e.event:i,s=i.keyCode!=null?i.keyCode:i.charCode,n.trigger("input:keydown",{event:event,keycode:s}),ghostedit.selection.saved.type!=="none"&&!ghostedit.selection.savedRange.isCollapsed()&&!i.ctrlKey&&ghostedit.selection.deleteContents();switch(s){case 8:if(n.cancelKeypress==1)return n.cancelKeypress=!1,ghostedit.util.cancelEvent(i);break;case 13:ghostedit.util.cancelEvent(i)}o=ghostedit.selection.getContainingGhostBlock();for(;;){u=o.getAttribute("data-ghostedit-handler"),a=ghostedit.plugins[u].ghostevent("keypress",o,"self",{keycode:s,event:i});if(a===!0)break;o=ghostedit.dom.getParentGhostBlock(o);if(!o)break}return ghostedit.selection.save(),!0},n.addListener=function(e,t,r){var i,s,o,u;if(typeof t!="function")return!1;i=n.listeners;if(!i[e]||!typeof i[e]==="object"||!(i[e]instanceof Array))i[e]=[];s=n.eventtypes,o=!0;for(u=0;u<s.length;u++)if(s[u]===e){o=!1;break}return o&&s.push(e),n.listenerid++,i[e].push({id:n.listenerid,callback:t,revokekey:r}),n.listenerid},n.removeListener=function(e,t){var r=n.listeners,i,s=[];if(!r[e])return;for(i=0;i<r[e].length;i++)r[e].id!==t&&s.push(r[e][i]);r[e]=s},n.removeAllListeners=function(e){var t,r,i,s,o,u=[];if(!e)return;t=n.listeners,r=n.eventtypes;for(s=0;s<r.length;s++){i=r[s];for(o=0;o<t[i].length;o++)(!t[i][o].revokekey||t[i][o].revokekey!==e)&&u.push(t[i][o]);t[i]=ghostedit.util.cloneObject(u),u=[]}},n.trigger=function(e,r){var i=n.listeners,s;r===t&&(r={});if(!i[e]||!typeof i[e]==="object"||!(i[e]instanceof Array))return;ghostedit.debug&&(console.log(e),console.log(r));for(s=0;s<i[e].length;s++)i[e][s].callback.call(this,r)},n.sendBackwards=function(e,t,r){var i=!1,s,o,u=!1,a;r||(r={});if(!ghostedit.dom.isGhostBlock(t))return!1;s=t;for(;;){if(i=ghostedit.dom.getPreviousSiblingGhostBlock(s))direction="ahead";else if(i=ghostedit.dom.getParentGhostBlock(s))direction="top";a=n.send(e,i,direction,r);if(!a)return!1;if(a.handled===!0)return!0;s=i}},n.sendForwards=function(e,t,r){var i=!1,s,o,u=!1,a,f;r||(r={});if(!ghostedit.dom.isGhostBlock(t))return!1;s=t;for(;;){if(i=ghostedit.dom.getNextSiblingGhostBlock(s))f="behind";else if(i=ghostedit.dom.getParentGhostBlock(s))f="bottom";if(!(a=n.send(e,i,f,r)))return!1;if(a.handled===!0)return!0;s=i}},n.send=function(e,t,n,r){var i,s;return t?(i=t.getAttribute("data-ghostedit-handler"),!ghostedit.plugins[i]||!ghostedit.plugins[i].ghostevent?!1:(s=ghostedit.plugins[i].ghostevent(e,t,n,r),{handled:s})):!1},e.ghostedit.event=n}(window),function(e,t){var n={};n.init=function(){n.reset(),ghostedit.event.addListener("selection:change",function(){n.selectionchanged=!0}),ghostedit.api.undo=function(){return n.undo()},ghostedit.api.redo=function(){return n.redo()}},n.reset=function(){n.undoData=[],n.undoPoint=0,n.selectionchanged=!0},n.saveUndoState=function(e){var t=null,r,i,s=ghostedit.editdiv,o,u,a,f="",l="",c,h,p,d,v;e!==!0&&(e=!1),ghostedit.event.trigger("presaveundostate"),u=n.undoPoint,a=n.undoData,v=a[u],v||(e=!0),d={selection:{type:ghostedit.selection.saved.type,data:ghostedit.selection.saved.data},content:{string:s.innerHTML}},e||(h=v.content.string!==d.content.string,p=!ghostedit.selection.isSameAs(v.selection));if(e||p||h)d.content.dom=ghostedit.dom.extractContent(s.cloneNode(!0)),e||h?(u>0&&n.undoData.splice(0,u),n.undoData.unshift(d),n.undoPoint=0):n.undoData[u]=d;ghostedit.event.trigger("postsaveundostate")},n.restoreUndoPoint=function(e){var t=n.undoData,r,i;if(!t[e]||t[e].content.string.length<1)return!1;r=t[e],ghostedit.editdiv.innerHTML="",ghostedit.editdiv.appendChild(ghostedit.dom.cloneContent(r.content.dom)),ghostedit.selection.restore(r.selection.type,r.selection.data),ghostedit.selection.save()},n.undo=function(){var e=n.undoPoint,r=n.undoData,i=ghostedit.editdiv,s,o;r[e+1]!==t&&r[e+1].content.string.length>0&&(ghostedit.event.trigger("preundo"),r[e].content.string!==i.innerHTML?(n.saveUndoState(),e=1):(e===0&&n.saveUndoState(),e=n.undoPoint,e+=1),n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=r,ghostedit.event.trigger("postundo"))},n.redo=function(){var e=n.undoPoint,r=n.undoData,i=ghostedit.editdiv,s,o;e>0&&r[e-1]!==t&&r[e-1].content.string.length>0&&(ghostedit.event.trigger("preredo"),r[e].content.string!==i.innerHTML?n.saveUndoState(!0):(e-=1,n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=r),ghostedit.event.trigger("postredo"))},e.ghostedit.history=n}(window),function(e,t){e.ghostedit.init=function(e,t){typeof e=="string"&&(e=document.getElementById(e));var n,r,i,s,o,u,a,f,l,c,h,p,d=!1,v,m,g;ghostedit.options={},ghostedit.options=t||{},ghostedit.options.debug&&(ghostedit.debug=!0),ghostedit.browserEngine=ghostedit.util.detectEngines(),ghostedit.useMozBr=ghostedit.browserEngine.gecko!==0||ghostedit.browserEngine.webkit!==0||ghostedit.browserEngine.opera!==0,e.style.display="none",ghostedit.sourceelem=e,n=document.createElement("div"),n.className="ghostedit_wrapper",e.parentNode.insertBefore(n,e),ghostedit.wrapdiv=n,r=document.createElement("div"),r.id="ghostedit_workspace",r.className="ghostedit_workspace",n.appendChild(r),ghostedit.workspace=r,i=document.createElement("div"),i.id="ghostedit_uilayer",i.className="ghostedit_uilayer",i.innerHTML="<span style='position: absolute; display: none;left: 0; top: 0;line-height: 0'>ie bug fix</span>",r.appendChild(i),ghostedit.contextuallayer=i,ghostedit.history.init(),ghostedit.inout.init(),ghostedit.clipboard.init(),ghostedit.options.plugins=ghostedit.options.plugins||[],ghostedit.options.plugins.unshift("container","textblock");if(ghostedit.options.plugins)for(u=0;u<ghostedit.options.plugins.length;u++)ghostedit.api.plugin.enable(ghostedit.options.plugins[u]);ghostedit.event.trigger("init"),ghostedit.editdiv=ghostedit.inout.importHTML(ghostedit.sourceelem),r.appendChild(ghostedit.editdiv),g=ghostedit.editdiv.getAttribute("data-ghostedit-handler"),ghostedit.plugins[g].focus(ghostedit.editdiv);try{document.execCommand("styleWithCSS",!1,!1)}catch(y){}try{document.execCommand("enableObjectResizing",!1,!1)}catch(y){}ghostedit.selection.save(),ghostedit.history.reset(),ghostedit.history.saveUndoState(),v=document.getElementsByTagName("html")[0],ghostedit.util.addEvent(v,"dragenter",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"dragleave",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"dragover",ghostedit.util.cancelEvent),ghostedit.util.addEvent(v,"drop",ghostedit.util.cancelEvent),ghostedit.util.addEvent(n,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(ghostedit.editdiv,"click",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"mouseup",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"keyup",ghostedit.selection.save),ghostedit.util.addEvent(ghostedit.editdiv,"keydown",function(e){ghostedit.event.keydown(this,e)}),ghostedit.util.addEvent(ghostedit.editdiv,"keypress",function(e){ghostedit.event.keypress(this,e)}),ghostedit.util.addEvent(ghostedit.editdiv,"dragenter",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"dragleave",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"dragover",ghostedit.util.cancelEvent),ghostedit.util.addEvent(ghostedit.editdiv,"drop",ghostedit.util.cancelEvent),ghostedit.event.addListener("ui:newcontext",function(e){ghostedit.uicontext=e.context}),ghostedit.editdiv.focus(),ghostedit.plugins.container.focus(ghostedit.editdiv),ghostedit.event.trigger("init:after")};var n=function(){ghostedit.active&&(ghostedit.active=!1,ghostedit.sourceelem.innerHTML=ghostedit.inout.exportHTML().full,ghostedit.wrapdiv.parentNode.removeChild(ghostedit.wrapdiv),ghostedit.selection.savedRange=null,ghostedit.selection.saved={type:"none",data:null},ghostedit.image.focusedimage=null,ghostedit.blockElemId=0,ghostedit.imgElemId=0,ghostedit.sourceelem.style.display="block",ghostedit.options.resetcallback&&ghostedit.options.resetcallback())}}(window),function(e,t){var n={};n.init=function(){n.reset(),ghostedit.event.addListener("selection:change",function(){ghostedit.history.selectionchanged=!0}),ghostedit.api.importHTML=function(e){return n.importHTML(e)},ghostedit.api.exportHTML=function(){return n.exportHTML()}},n.reset=function(){n.importhandlers=[]},n.importHTML=function(e){var t,n,r,i;return!e||e.childNodes.length<1?!1:(i=ghostedit.plugins.container.inout.importHTML(e),i.className="ghostedit_editdiv",i.setAttribute("data-ghostedit-isrootnode","true"),i.contentEditable="true",ghostedit.event.trigger("import:after",{editdiv:i}),i)},n.exportHTML=function(){var e=ghostedit.editdiv,t=0,n,r,i,s,o,u,a;return ghostedit.event.trigger("export:before"),e.contentEditable=!1,a=ghostedit.plugins.container.inout.exportHTML(e,!1),e.contentEditable=!0,ghostedit.event.trigger("export:after"),a},n.openPreview=function(){e.open(ghostedit.options.previewurl)},n.registerimporthandler=function(e){var t,r,i,s,o;if(typeof e!="function")return!1;if(arguments.length<2)return!1;i=Array.prototype.slice.call(arguments),i.shift();for(t=0;t<i.length;t++)s=i[t],n.importhandlers[s]=e},e.ghostedit.inout=n}(window),function(e,t){var n={};n.register=function(e,t){return ghostedit.plugins[e]?!1:(ghostedit.plugins[e]=t,!0)},n.enable=function(e){if(!ghostedit.plugins[e])return!1;ghostedit.enabledplugins[e]&&n.disable(e);var t=ghostedit.plugins[e];typeof t.enable=="function"&&t.enable(),ghostedit.enabledplugins[e]=!0},n.disable=function(e){if(!ghostedit.enabledplugins[e]||!ghostedit.plugins[e])return!1;var t=ghostedit.plugins[e];typeof t.disable=="function"&&t.disable(),ghostedit.enabledplugins[e]=!1},e.ghostedit.api.plugin=n}(window),function(e,t){var n={savedRange:null,nodepath:[],saved:{type:"none",data:null},archived:{type:"none",data:null}};n.save=function(e){var t;return e!==!1&&(e=!0),t=lasso().setToSelection(),n.isInEditdiv(t.getStartNode())?(n.saved.type="textblock",n.saved.data=t,n.savedRange=n.saved.data,ghostedit.event.trigger("selection:change"),n.updatePathInfo(),e&&ghostedit.event.trigger("ui:update"),!0):(n.saved.type="none",!1)},n.restore=function(e,t,r){if(!e||typeof e!="string")e=n.saved.type;t||(t=n.saved.data),e==="none"&&r&&(e=n.archived.type,t=n.archived.data);if(e==="none")return n.clear(),!0;if(ghostedit.plugins[e]&&ghostedit.plugins[e].selection.restore)return ghostedit.plugins[e].selection.restore(t)?!0:(n.clear(),!1)},n.restoreValid=function(e,t){return n.restore(e,t,!0)},n.deleteContents=function(e){e!=="collapsetostart"&&e!=="collapsetoend"&&(e=!1);var t,r,i;i=n.getContainingGhostBlock();for(;;){t=i.getAttribute("data-ghostedit-handler"),r=ghostedit.plugins[t].selection.deleteContents(i,e);if(r===!0)break;i=ghostedit.dom.getParentGhostBlock(i);if(!i)break}switch(e){case"collapsetostart":lasso().setToSelection().collapseToStart().select();break;case"collapsetoend":lasso().setToSelection().collapseToEnd().select()}n.save()},n.isSameAs=function(e){return!e||!e.type?!1:e.type!==n.saved.type?!1:e.type==="none"?!0:ghostedit.plugins[e.type]&&ghostedit.plugins[e.type].selection.compare?ghostedit.plugins[e.type].selection.compare(e.data,n.saved.data):!1},n.clear=function(){lasso().clearSelection(),n.saved={type:"none",data:null}},n.isInEditdiv=function(e){var e,t;if(e.nodeType!=1||e.getAttribute("data-ghostedit-isrootnode")!="true")while(e.nodeType!=1||e.getAttribute("data-ghostedit-isrootnode")!="true"){if(e==null)return!1;e=e.parentNode;if(e==null)return!1}return!0},n.updatePathInfo=function(e){var t=!1,r=!1,i=!1,s=!1,o,u;e||(e=n.savedRange.getParentNode()),n.nodepath=[];if(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!="true")while(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!="true"){if(e==null)return null;e.nodeType==1&&n.nodepath.push(e),e=e.parentNode;if(e==null)return!1}e&&e.getAttribute("data-ghostedit-isrootnode")=="true"&&n.nodepath.push(e)},n.getContainingGhostBlock=function(){var e=n.savedRange.getParentNode();if(!e)return!1;while(!ghostedit.dom.isGhostBlock(e)){e=e.parentNode;if(e==null)return!1}return e},e.ghostedit.selection=n}(window),function(e,t){var n={};n.enable=function(){return n.format.init(),ghostedit.inout.registerimporthandler(n.inout.importHTML,"p","h1","h2","h3","h4","h5","h6"),ghostedit.inout.registerimporthandler(n.inout.importHTML,"#textnode","b","strong","i","em","u","strike","span"),ghostedit.event.addListener("postsaveundostate",function(){ghostedit.selection.saved.type==="textblock"&&ghostedit.selection.saved.data.bookmarkify(ghostedit.editdiv)}),ghostedit.event.addListener("postsaveundostate",function(){ghostedit.selection.saved.type==="textblock"&&(ghostedit.selection.saved.data=ghostedit.selection.saved.data.clone())}),ghostedit.event.addListener("selection:change",function(){var e;for(i=0;i<ghostedit.selection.nodepath.length;i++)e=ghostedit.selection.nodepath[i],n.isTextBlock(e)&&ghostedit.event.trigger("ui:newcontext",{context:"textblock"})}),ghostedit.api.insert=ghostedit.api.insert||{},ghostedit.api.insert.character=function(e){return n.insert.character(e)},ghostedit.api.insert.br=function(){return n.insert.br},!0},n.ghostevent=function(e,t,r,i){var s=!1,o,u=!1;switch(e){case"delete":return n.event.textdelete(t,r,i);case"keydown":switch(i.keycode){case 8:return n.event.backspace(t,i.event);case 46:return n.event.deletekey(t,i.event)}break;case"keypress":switch(i.keycode){case 13:return n.event.enterkey(t,i.event)}}},n.event={textdelete:function(e,t,r){var i,s;switch(t){case"ahead":return ghostedit.history.saveUndoState(),n.isEmpty(e)?(i=ghostedit.dom.getParentGhostBlock(e),s=i.getAttribute("data-ghostedit-handler"),ghostedit.plugins[s].dom.removechild(i,e)):(e.innerHTML+="<span id='ghostedit_selection_marker'>&#x200b;</span>",r.merge&&r.merge.sourcecontent&&(r.merge.contenttype==="inlinehtml"||r.merge.contenttype==="text")&&(e.innerHTML+=r.merge.sourcecontent),n.mozBrs.tidy(e),r.merge.callback(),lasso().selectNode("ghostedit_selection_marker").select(),document.getElementById("ghostedit_selection_marker").parentNode.removeChild(document.getElementById("ghostedit_selection_marker")),ghostedit.selection.save()),ghostedit.history.saveUndoState(!0),!0;case"behind":var o=ghostedit.selection.getContainingGhostBlock(),r={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:ghostedit.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");ghostedit.plugins[n].dom.removechild(t,e)},!1,e)}};return ghostedit.event.sendBackwards("delete",e,r),!0}},backspace:function(e,t){if(n.selection.isAtStartOftextblock()!==!0)return!0;var r={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:ghostedit.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");ghostedit.plugins[n].dom.removechild(t,e)},!1,e)}};return ghostedit.event.sendBackwards("delete",e,r),ghostedit.event.cancelKeypress=!0,ghostedit.util.cancelEvent(t),!0},deletekey:function(e,t){return n.selection.isAtEndOftextblock()!==!0?!0:(ghostedit.event.sendForwards("delete",e),ghostedit.event.cancelKeypress=!0,ghostedit.util.cancelEvent(t),!0)},enterkey:function(e,t){var r;return ghostedit.history.saveUndoState(),t.shiftKey?(n.format.insert.br(),n.mozBrs.tidy(e)):n.split(e),ghostedit.history.saveUndoState(!0),ghostedit.util.cancelEvent(t),!0}},n.selection={compare:function(e,t){return!e||!e.isEqualTo?!1:e.isEqualTo(t)},restore:function(e){return!e||!e.unbookmarkify?!1:(e.unbookmarkify(ghostedit.editdiv),e.select(),!0)},deleteContents:function(e){var t,n,r;return r=ghostedit.selection.savedRange.clone(),t=lasso().setCaretToStart(e),n=lasso().setCaretToEnd(e),r.compareEndPoints("StartToStart",t)===-1&&r.setStartToRangeStart(t),r.compareEndPoints("EndToEnd",n)===1&&r.setEndToRangeEnd(n),r.deleteContents(),!0},getTextBlockNode:function(e){if(e.nodeType!=1||e.getAttribute("data-ghostedit-elemtype")!="textblock")while(e.nodeType!=1||e.getAttribute("data-ghostedit-elemtype")!="textblock"){e=e.parentNode;if(e==null)return!1}return e},getStartTextBlockNode:function(){return n.selection.getTextBlockNode(ghostedit.selection.savedRange.getStartNode())},getEndTextBlockNode:function(){return n.selection.getTextBlockNode(ghostedit.selection.savedRange.getEndNode())},isAtStartOftextblock:function(){var e=!1,t,r,i,s,o,u,a,f,l,c;if(document.createRange){ghostedit.selection.savedRange.isCollapsed()&&ghostedit.selection.savedRange.getNative().startOffset==0&&(e=!0,t=ghostedit.selection.savedRange.getStartNode());if(!t)return e;while(t.nodeType!==1||t.getAttribute("data-ghostedit-elemtype")!=="textblock"){if(t!==t.parentNode.childNodes[0]){u=!1;if(t.parentNode.childNodes[0].nodeType===3&&t.parentNode.childNodes[0].length===0||t.parentNode.childNodes[0].nodeType===1&&t.parentNode.childNodes[0].className==="moz_dirty")for(o=1;o<t.parentNode.childNodes.length;o+=1){if(t==t.parentNode.childNodes[o]){u=!0;break}if((t.parentNode.childNodes[0].nodeType!==3||t.parentNode.childNodes[0].length!==0)&&(t.parentNode.childNodes[0].nodeType!==1||t.parentNode.childNodes[0].className!=="moz_dirty"))break}if(u!==!0){e=!1;break}}t=t.parentNode}}else document.selection&&(i=ghostedit.selection.savedRange.clone().bookmarkify(),l=n.selection.getStartTextBlockNode(),c=lasso().selectNodeContents(l),i.unbookmarkify(),c.getHTML()===c.setStartToRangeStart(i).getHTML()&&(e=!0),ghostedit.selection.savedRange=i.select());return e},isAtEndOftextblock:function(){var e=!1,t,r,i,s,o,u,a,f,l,c,a,h,p,d;return ghostedit.selection.savedRange.isCollapsed()?(c=n.selection.getEndTextBlockNode(),document.createRange?(f=document.createElement("div"),f.appendChild(ghostedit.selection.savedRange.getNative().cloneContents()),i=ghostedit.selection.savedRange.getNative(),i.setEnd(c,c.childNodes.length),l=document.createElement("div"),f.appendChild(i.cloneContents()),n.mozBrs.clear(f),n.mozBrs.clear(l),f.innerHTML==l.innerHTML&&(e=!0)):document.selection&&(r=ghostedit.selection.savedRange.clone().bookmarkify(),c.innerHTML+='<span id="range_marker">&#x200b;</span>',p=lasso().selectNode("range_marker"),document.getElementById("range_marker").parentNode.removeChild(document.getElementById("range_marker")),r.unbookmarkify(),r.compareEndPoints("EndToEnd",p)===0&&(e=!0),ghostedit.selection.savedRange=r.select()),e):!1},extendtoword:function(e,t){var r,i;e=e.clone().getNative();if(document.createRange){r=n.selection.findwordstart(e.startContainer,e.startOffset),i=n.selection.findwordend(e.endContainer,e.endOffset);if(t){if(e.startContainer==r.node&&e.startOffset==r.offset)return e;if(e.endContainer==i.node&&e.endOffset==i.offset)return e}e.setStart(r.node,r.offset),e.setEnd(i.node,i.offset)}else e.expand("word"),e.htmlText.split().reverse()[0]==" "&&e.moveEnd("character",-1);return lasso().setFromNative(e)},findwordstart:function(e,t){var r,i,s,o,u,a,f=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){s=e.nodeValue.substring(0,t),o=s.search(f);if(o!==-1){u=o+1;while((o=s.substring(u).search(f))!==-1)u+=o+1;return{node:e,offset:u}}}else if(e.nodeType===1&&t>0)return n.selection.findwordstart(e.childNodes[t-1],e.childNodes[t-1].length);if(e.nodeType===1&&e.getAttribute("data-ghostedit-elemtype")=="textblock")return{node:e,offset:t};if(!(a=e.previousSibling))return n.selection.findwordstart(e.parentNode,ghostedit.dom.getNodeOffset(e));if(a.nodeType===3)return n.selection.findwordstart(a,a.nodeValue.length);if(a.nodeType===1)return n.selection.findwordstart(a,a.childNodes.length)},findwordend:function(e,t){var r,i,s,o,u,a,f=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){s=e.nodeValue.substring(t),o=s.search(f);if(o!==-1)return u=t+o,{node:e,offset:u}}else if(e.nodeType===1&&t<e.childNodes.length)return n.selection.findwordend(e.childNodes[t],0);return e.className&&e.getAttribute("data-ghostedit-elemtype")=="textblock"?{node:e,offset:t}:(nextnode=e.nextSibling)?n.selection.findwordend(nextnode,0):n.selection.findwordend(e.parentNode,ghostedit.dom.getNodeOffset(e)+1)}},n.inout={handledtags:{h1:"block",h2:"block",h3:"block",h4:"block",h5:"block",h6:"block",p:"block",b:"child",i:"child",u:"child",strong:"child",em:"child",strike:"child",br:"child",a:"contents",span:"contents"},parserules:{textnode:{clean:!0},tags:{h1:"textblock",h2:"textblock",h3:"textblock",h4:"textblock",h5:"textblock",h6:"textblock",p:"textblock",b:{},i:{},u:{},strong:{},em:{},strike:{},br:{attributes:[{name:"class",allowedvalues:["moz_dirty"]}]}},templates:{textblock:{attributes:["class"],styles:[{name:"textAlign",allowedvalues:["left","right","center","justified"]},{name:"clear",allowedvalues:["left","right"]}]}}},importHTML:function(e){var t,r,i,s,o,u;nodetype=n.inout.isHandleableNode(e);switch(nodetype){case"block":return r=e.tagName.toLowerCase(),t=ghostedit.dom.parse(e,n.inout.parserules),ghostedit.blockElemId+=1,t.id="ghostedit_textblock_"+ghostedit.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","textblock"),t.setAttribute("data-ghostedit-handler","textblock"),t.ondragenter=function(){return!1},t.ondragleave=function(){return!1},t.ondragover=function(){return!1},t.ondrop=function(e){elemid=e.dataTransfer.getData("Text")||e.srcElement.id,elem=document.getElementById(elemid),elem.parentNode.insertBefore(elem,this),ghostedit.image.focus(elem)},t.onresizestart=function(e){return ghostedit.util.cancelEvent(e)},n.mozBrs.tidy(t),t;case"child":case"contents":case"text":t=n.create("p"),t.setAttribute("data-ghostedit-importinfo","wasinline"),s=0,i=e;do parsednode=ghostedit.dom.parse(i,n.inout.parserules),parsednode&&(s+=1,t.appendChild(parsednode),o=i,i=i.nextSibling,s>1&&o.parentNode.removeChild(o));while(n.inout.isHandleableNode(i)&&n.inout.isHandleableNode(i)!=="block");return n.mozBrs.tidy(t),s>0?t:!1}return!1},exportHTML:function(e){if(!e||!ghostedit.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="textblock")return!1;var t="",r="",i;return i=e,n.mozBrs.clear(i),t+="<"+i.tagName.toLowerCase(),i.style.textAlign!=""&&(r+="text-align:"+i.style.textAlign+";"),i.style.clear!=""&&(r+="clear:"+i.style.clear+";"),r.length>0&&(t+=" style='"+r+"'"),i.className.length>0&&!/ghostedit/.test(i.className)&&(t+=" class='"+i.className+"'"),t+=">",t+=i.innerHTML,t+="</"+i.tagName.toLowerCase()+">",n.mozBrs.tidy(i),{content:t}},isHandleableNode:function(e){var t,r,i,s;return!e||!e.nodeType?!1:e.nodeType===3?e.nodeValue.replace(/[\n\r\t]/g,"").length>0?"text":!1:e.nodeType!==1?!1:e.getAttribute("data-ghostedit-elemtype")==="textblock"?"block":ghostedit.dom.isGhostBlock(e)?!1:(i=e.tagName.toLowerCase(),n.inout.handledtags[i]?n.inout.handledtags[i]:!1)},parse:function(e){var t=!1,r,i,s,o,u;if(!e||!e.nodeType)return!1;s=n.inout.isHandleableNode(e);switch(s){case"text":return u=e.nodeValue.replace(/[\n\r\t]/g,""),u.length>0?document.createTextNode(u):!1;case"block":case"child":t=document.createElement(e.tagName.toLowerCase());case"contents":default:t=t||document.createDocumentFragment(),r=e.childNodes;for(o=0;o<r.length;o++)(i=n.inout.parse(r[o]))&&t.appendChild(i);return t}return!1}},n.paste={handle:function(e,t,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isGhostBlock(t))return;return console.log(r),r.isfirst?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (first):"),n.mozBrs.clear(t),lasso().removeDOMmarkers("ghostedit_paste_start"),t.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t1'>&#x200b;</span>",document.createRange?ghostedit.selection.saved.data.collapseToStart().getNative().insertNode(ghostedit.dom.extractContent(t)):ghostedit.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:r.islast?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (last-noncollapsed):"),n.mozBrs.clear(t),lasso().removeDOMmarkers("ghostedit_paste_end"),t.innerHTML+="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>",document.createRange?ghostedit.selection.saved.data.collapseToStart().getNative().insertNode(ghostedit.dom.extractContent(t)):ghostedit.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:(n.mozBrs.clear(t),console.log("HEYHEYHEY"),ghostedit.selection.saved.data.collapseToStart().select(),lasso().removeDOMmarkers("ghostedit_paste_start"),p=n.split(e),p.block1.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t2'>&#x200b;</span>",n.mozBrs.tidy(p.block1),lasso().removeDOMmarkers("ghostedit_paste_end"),p.block2.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+p.block2.innerHTML,n.mozBrs.tidy(p.block2),!1)},clean:function(e){var t,r,s,o;if(!e||!e.nodeType)return!1;if(!e.childNodes)return e;s=document.createDocumentFragment();for(i=0;i<e.childNodes.length;i++)(o=n.paste.cleanChild(e.childNodes[i]))&&s.appendChild(o);return e=e.cloneNode(!1),e.appendChild(s),e},cleanNode:function(e){var t,r,s,o;if(!e||!e.nodeType)return!1;o=n.paste.isHandleableNode(e);switch(o){case"text":return e.nodeValue=e.nodeValue.replace(/[\n\r\t]/g,""),e;case"child":case"contents":t=o==="child"?e.cloneNode(!1):document.createDocumentFragment(),r=e.childNodes;for(i=0;i<r.length;i++)(s=n.paste.cleanNode(r[i]))&&t.appendChild(s);return t}return!1}},n.isTextBlock=function(e){return ghostedit.dom.isGhostBlock(e)?e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:!0:!1},n.isEmpty=function(e){var n,r,i,s;n=e.innerText||e.textContent;if(n&&n.length>1)return!1;i=e.getElementsByTagName("br"),r=e.getElementsByTagName("img");if(i.length===0&&r.length===0)return!0;for(s=0;s<i.length;s+=1)if(i[s].MozDirty===t&&!/moz_dirty/.test(i[s].className))return!1;return!0},n.isFirst=function(e){var t,n;t=ghostedit.editdiv;for(n=0;n<t.getElementsByTagName("*").length;n+=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.isLast=function(e){var t,n;t=ghostedit.editdiv;for(n=t.getElementsByTagName("*").length-1;n>0;n-=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.count=function(){var e,t,n;e=ghostedit.editdiv,t=0;for(n=0;n<e.getElementsByTagName("*").length;n+=1)e.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")=="textblock"&&(t+=1);return t},n.create=function(e,t,r){var i;return r||(ghostedit.blockElemId+=1,r="ghostedit_textblock_"+ghostedit.blockElemId),t=t&&(t.length&&t.length>0||t.nodeType)?t:"",i=document.createElement(e),i.id=r,t.nodeType?(t=ghostedit.dom.parse(t,{textnode:{clean:!0},tags:{b:{},i:{},u:{},strong:{},em:{},strike:{},br:{}}}),t&&i.appendChild(t)):i.innerHTML=t,i.setAttribute("data-ghostedit-iselem","true"),i.setAttribute("data-ghostedit-elemtype","textblock"),i.setAttribute("data-ghostedit-handler","textblock"),i.ondragenter=function(){return!1},i.ondragleave=function(){return!1},i.ondragover=function(){return!1},i.ondrop=function(e){elemid=e.dataTransfer.getData("Text")||e.srcElement.id,elem=document.getElementById(elemid),elem.parentNode.insertBefore(elem,this),ghostedit.image.focus(elem)},i.onresizestart=function(e){return ghostedit.util.cancelEvent(e)},n.mozBrs.tidy(i),i},n.remove=function(e){var t,r,i,s,o,u,a,f,l,c;ghostedit.selection.save(),ghostedit.history.saveUndoState(),t="",t=e.innerHTML,r=ghostedit.editdiv,textblockelems=r.getElementsByTagName("*"),o=!1;for(s=textblockelems.length-1;s>=0;s-=1){if(o===!0&&textblockelems[s].getAttribute("data-ghostedit-elemtype")==="textblock"){i=textblockelems[s];break}textblockelems[s]===e&&(o=!0)}if(n.isEmpty(i)){r.removeChild(i),lasso().setCaretToStart(e).select(),ghostedit.selection.save(),ghostedit.history.saveUndoState();return}r.removeChild(e),lasso().setCaretToEnd(i).select(),ghostedit.selection.save(),i.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t,n.mozBrs.tidy(i),lasso().selectNode("ghostedit_marker").deleteContents().select(),document.getElementById("ghostedit_marker")&&document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.focus=function(e){return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:(lasso().setCaretToEnd(e).select(),ghostedit.selection.save(),!0)},n.merge=function(e,t,r){var i,s,o,u;return r===!1?e:e===t?e:(i=e.getAttribute("data-ghostedit-elemtype"),s=t.getAttribute("data-ghostedit-elemtype"),i!=="textblock"||s!=="textblock"?!1:(e.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t.innerHTML,o=t.parentNode,u=o.getAttribute("data-ghostedit-handler"),ghostedit.plugins[u].dom.removechild(o,t),n.mozBrs.tidy(e),lasso().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),e))},n.split=function(e){ghostedit.selection.save();var t,r,i,s,o,u,a,f,l,c;return r=n.selection.isAtStartOftextblock()===!0?!0:!1,i=n.selection.isAtEndOftextblock()===!0?!0:!1,t=r&&!i?"before":"after",s=t=="before"||i?"p":n.selection.getStartTextBlockNode().tagName,n.mozBrs.tidy(e),!r&&!i?document.createRange?(u=lasso().selectNodeContents(e).setStartToRangeStart(ghostedit.selection.savedRange),o=u.getHTML(),u.deleteContents()):document.selection&&(u=lasso().selectNode(e),u.setStartToRangeEnd(ghostedit.selection.savedRange),o=u.getHTML(),u.getNative().text=""):o="",f=n.create(s,o),f?(l=ghostedit.dom.getParentGhostBlock(e),c=l.getAttribute("data-ghostedit-handler"),a=ghostedit.plugins[c].dom.addchild(l,t,e,f,{contentlength:o.length}),a?(f.innerHTML="dummy",lasso().selectNode(f).select(),f.innerHTML=o,n.mozBrs.tidy(f),t==="before"?lasso().setCaretToBlockStart(e).select():lasso().setCaretToBlockStart(f).select(),ghostedit.selection.save(),{block1:t==="before"?f:e,block2:t==="before"?e:f}):!1):!1},n.mozBrs={checkifcontains:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t)return!0;return!1},insert:function(e){var t;t=document.createElement("br"),t.setAttribute("_moz_dirty",""),t.className="moz_dirty",e.appendChild(t)},clear:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t||/moz_dirty/.test(n[r].className))n[r].parentNode.removeChild(n[r]),r--},tidy:function(e){n.mozBrs.clear(e),ghostedit.useMozBr&&n.mozBrs.insert(e)}},n.insert={character:function(e){ghostedit.selection.saved.type==="textblock"&&(ghostedit.selection.restore(),ghostedit.selection.savedRange.pasteText(e))},br:function(){var t,n,r;e.getSelection?(t=e.getSelection(),t.getRangeAt(0).collapse(!1),n=document.createElement("br"),n.id="newBr",t.getRangeAt(0).insertNode(n),t.getRangeAt(0).selectNode(n.parentNode),r=document.createRange(),r.setStartAfter(n),r.setEndAfter(n),t.removeAllRanges(),t.addRange(r),document.getElementById("newBr").removeAttribute("id")):document.selection&&(r=document.selection.createRange(),r.collapse(!1),r.pasteHTML("<br id='newBr' />"),r.moveToElementText(document.getElementById("newBr")),r.collapse(!1),r.select(),document.getElementById("newBr").removeAttribute("id"))}},n.format={init:function(){ghostedit.api.format=ghostedit.api.format||{},ghostedit.api.format.setStyle=function(e,t){n.format.formatSelected(n.format.setTagType,{tagname:e,newclass:t})},ghostedit.api.format.alignText=function(e){if(!/left|right|center|justify/.test(e))return!1;document.getElementById("align"+e+"Button").className="current",n.format.formatSelected(n.format.alignText,{alignDirection:e})},ghostedit.api.format.bold=function(){n.format.formatSelected(n.format.bold)},ghostedit.api.format.italic=function(){n.format.formatSelected(n.format.italic)},ghostedit.api.format.underline=function(){n.format.formatSelected(n.format.underline)},ghostedit.api.format.strikethrough=function(){n.format.formatSelected(n.format.strikethrough)},ghostedit.api.format.textColor=function(e){n.format.formatSelected(n.format.textColor,{color:e})}},useCommand:function(e,t){document.execCommand(e,!1,t)},getNextNode:function(e){if(e.firstChild)return e.firstChild;while(e){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},getNodesInRange:function(e){var t=e.getStartNode(),r=e.getEndNode(),i=e.getParentNode(),s=[],o;for(o=t.parentNode;o;o=o.parentNode){s.push(o);if(o==i)break}s.reverse();for(o=t;o;o=n.format.getNextNode(o)){s.push(o);if(o==r)break}return s},useCommandOnWord:function(e){var t,r;ghostedit.selection.savedRange.isCollapsed()&&n.selection.getStartTextBlockNode()&&(t=ghostedit.selection.savedRange.clone(),document.createRange&&(r=document.createElement("span"),r.id="ghostedit_marker",t.getNative().insertNode(r)),!document.createRange&&document.selection&&t.getNative().pasteHTML("<span id='ghostedit_marker'>z</span>"),t.selectNode("ghostedit_marker"),t=n.selection.extendtoword(t,!0),t.select()),n.format.useCommand(e),document.getElementById("ghostedit_marker")&&(lasso().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker"))),ghostedit.selection.save()},bold:function(e){n.format.useCommand("bold")},italic:function(){n.format.useCommand("italic")},underline:function(){n.format.useCommand("underline")},strikethrough:function(){n.format.useCommand("strikethrough")},textColor:function(e){n.format.useCommand("foreColor",e)},formatSelected:function(e,t){ghostedit.selection.save(),ghostedit.history.saveUndoState();var r,i,s,o,u,a,f,l;i=n.selection.getStartTextBlockNode(),s=n.selection.getEndTextBlockNode();if(i&&s){r=i,a=!1;do{if(r===ghostedit.editdiv||r===null)break;if(n.isTextBlock(r)){r===s&&(a=!0),r=n.format.formatTextBlock(r,ghostedit.selection.saved.data.clone(),e,t);if(a)break;r=r.nextSibling?r.nextSibling:r.parentNode;continue}if(ghostedit.dom.isDescendant(r,s)){r=ghostedit.dom.getFirstChildElement(r);continue}u=r,r=r.nextSibling?r.nextSibling:r.parentNode,descendantblocks=u.getElementsByTagName("*");for(f=0;f<descendantblocks.length;f+=1)n.isTextBlock(descendantblocks[f])&&n.format.formatTextBlock(descendantblocks[f],ghostedit.selection.saved.data.clone(),e,t)}while(!0);ghostedit.selection.save(),ghostedit.history.saveUndoState()}ghostedit.history.saveUndoState()},formatTextBlock:function(e,n,r,i){var s,o,u,a;return i||(i={}),i.textblock=e,n=n.clone(),s=lasso().setCaretToStart(e),o=lasso().setCaretToEnd(e),n.compareEndPoints("EndToStart",s)===-1||n.compareEndPoints("StartToEnd",o)===1?!1:(n.compareEndPoints("StartToStart",s)===-1&&n.setStartToRangeStart(s),n.compareEndPoints("EndToEnd",o)===1&&n.setEndToRangeEnd(o),ghostedit.selection.saved.data.clone().saveToDOM("ghostedit_format"),n.select(),a=r(i),lasso().restoreFromDOM("ghostedit_format").select(),ghostedit.selection.save(),a&&a.nodeType!==t?a:e)},alignText:function(e){var t=lasso().setToSelection().getParentElement();while(!ghostedit.dom.isGhostBlock(t)){t=t.parentNode;if(t==null)return!1}if(!n.isTextBlock(t))return!1;t.style.textAlign=e.alignDirection},setTagType:function(e){var r,i,s,o,u,a,f;return r=e.textblock,i=e.tagname,s=e.newclass,n.isTextBlock(r)?(a="ghostedit_textblock_"+r.id.replace("ghostedit_textblock_",""),f=n.create(i),f.appendChild(ghostedit.dom.extractContent(r)),n.mozBrs.tidy(f),f.setAttribute("style",r.getAttribute("style")),s!==t&&(f.className=s),o=r.parentNode,r.id="",o.insertBefore(f,r),o.removeChild(r),f.id=a,f):!1}},ghostedit.api.plugin.register("textblock",n)}(window),function(e,t){var n={};n.trim=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},n.preparefunction=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var r=n.concat(Array.prototype.slice.call(arguments));return e.apply(t?t:this,r)}},n.isFunction=function(e){return e?typeof e!="function"?!1:!0:!1},n.cloneObject=function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){var t=[],r,i;for(i=0,r=e.length;i<r;++i)t[i]=n.cloneObject(e[i]);return t}if(e instanceof Object){var t={},s;for(s in e)e.hasOwnProperty(s)&&(t[s]=n.cloneObject(e[s]));return t}},n.addClass=function(e,t){e.className=n.trim(e.className)+" "+t},n.removeClass=function(e,t){var r=new RegExp(t,"g");e.className=n.trim(e.className.replace(r,""))},n.cancelEvent=function(e){return e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):e&&(e.returnValue=!1),!1},n.cancelAllEvents=function(t){return t&&t.preventDefault?(t.stopPropagation(),t.preventDefault()):e.event&&(e.event.cancelBubble=!0),!1},n.preventDefault=function(e){return e&&e.preventDefault&&e.preventDefault(),!1},n.preventBubble=function(t){t&&t.preventDefault&&t.stopPropagation(),e.event.cancelBubble=!0},n.addEvent=function(e,n,r){e.addEventListener!==t?e.addEventListener(n,r,!1):e.attachEvent("on"+n,r)},n.removeEvent=function(e,n,r){e.removeEventListener!==t?e.removeEventListener(n,r,!1):e.detachEvent("on"+n,r)},n.ajax=function(t,n,r,i,s){function l(){if(e.XMLHttpRequest&&(e.location.protocol!=="file:"||!e.ActiveXObject))return new e.XMLHttpRequest;try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){try{return new e.ActiveXObject("MSXML2.XMLHTTP")}catch(t){return!1}}}var n,o,u,a,f;if(!t||!n)return!1;if(!(f=l()))return!1;n=n.toUpperCase(),o=+(new Date),u,t.indexOf("?")!=-1?t.indexOf("?")==t.length-1?u="":u="&":u="?",n==="GET"?f.open(n,t+u+o+"&IsAjaxRequest=true&ajax=true&"+r,!0):f.open(n,t+u+o+"&IsAjaxRequest=true&ajax=true",!0),f.onreadystatechange=function(){if(f.readyState==4)return f.status=="200"?(a=s=="xml"?f.responseXML:f.responseText,i!=null&&i(!0,a),!0):(i!=null&&i(!1,a),!1)},f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r!=null&&n==="POST"?f.send(r):f.send()},n.detectEngines=function(){var t={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:null},n=navigator.userAgent;return e.opera?(t.ver=e.opera.version(),t.opera=parseFloat(t.ver)):/AppleWebKit\/(\S+)/.test(n)?(t.ver=RegExp.$1,t.webkit=parseFloat(t.ver)):/KHTML\/(\S+)/.test(n)||/Konqueror\/([^;]+)/.test(n)?(t.ver=RegExp.$1,t.khtml=parseFloat(t.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(n)?(t.ver=RegExp.$1,t.gecko=parseFloat(t.ver)):/MSIE ([^;]+)/.test(n)&&(t.ver=RegExp.$1,t.ie=parseFloat(t.ver)),t},e.ghostedit.util=n}(window),function(t,n){var r={elemid:0,focusedimage:null,justResized:!1,originalMouseX:null,originalMouseY:null,buttons:[],el:{}};r.enable=function(){ghostedit.event.addListener("preundo",function(){r.unfocus()}),ghostedit.event.addListener("preredo",function(){r.unfocus()}),ghostedit.event.addListener("postundo",function(){r.applyeventlisteners()}),ghostedit.event.addListener("postredo",function(){r.applyeventlisteners()}),ghostedit.event.addListener("selection:change",function(){ghostedit.selection.saved.type!=="image"&&r.ui.hide()}),ghostedit.event.addListener("ui:newcontext",function(e){var t=e.context;switch(t){case"image":case"help":case"save":return}r.unfocus()}),ghostedit.inout.registerimporthandler(r.inout.importHTML,"img"),ghostedit.options.image||(ghostedit.options.image={}),ghostedit.options.image.disableresize||(ghostedit.options.image.disableresize=!1),ghostedit.options.image.flexibleimages||(ghostedit.options.image.flexibleimages=!1);var e=document.createElement("form");e.id="ghostedit_image_focusform",e.style.cssText="margin:0px;padding:0px;height:0px;width:0px;overflow:hidden;line-height: 0px";var t=document.createElement("textarea");t.id="ghostedit_image_keycapturearea",t.onkeypress=ghostedit.util.cancelEvent,t.onkeydown=r.event.keydown,r.el.keycapture=t,e.appendChild(t),ghostedit.wrapdiv.appendChild(e),ghostedit.api.image=ghostedit.api.image||{},ghostedit.api.image.updatealttext=function(e){return r.updatealttext(e)}},r.event={keydown:function(e){e=t.event!=null?t.event:e;var n=e.keyCode!=null?e.keyCode:e.charCode;switch(n){case 8:case 46:r.remove(e);break;case 90:e.ctrlKey&&ghostedit.history.undo();break;case 89:e.ctrlKey&&ghostedit.history.redo();break;case 37:r.move.align("left",e);break;case 38:r.move.up(e);break;case 39:r.move.align("right",e);break;case 40:r.move.down(e)}return ghostedit.util.cancelEvent(e)},insertButtonClick:function(){ghostedit.selection.save();var e,t=[],n,i,s;s="<h2>Insert image</h2><form><p>This dialog allows you to choose an image to insert into the document. Either select one from the list of uploaded images, or enter a custom url in the box below.</p><hr /><h3 style='clear: both;'>Select uploaded image</h3><div id='ghostedit_listbox' style='height: 200px;overflow-x: hidden;overflow-y: scroll;background: white; border: 1px solid #ccc'></div><hr /><h3>Or enter URL</h3><input type='text' value='' id='ghostedit_imageurlinput' style='width: 99%' /><br /><input type='button' value='Insert' style='float: right;margin-top: 10px;' onclick='_image.newImageBefore(null, null);ghostedit.ui.modal.hide();' /></form>",i=[],ghostedit.options.uploadedimages&&(i=ghostedit.options.uploadedimages),ghostedit.ui.modal.show(s);for(e=0;e<i.length;e+=1)n=document.createElement("div"),n.className="ghostedit-listbox-item",n.setAttribute("ghostedit-listitem-value",i[e].url),n.innerHTML="<img src='"+i[e].thumburl+"' style='height: 60px; float: left' /><p style='margin-left: 100px;font-size: 21px'>"+i[e].name+"</p>",n.onclick=function(){r.newImageBefore(null,this.getAttribute("ghostedit-listitem-value"),!1),ghostedit.ui.modal.hide()},document.getElementById("ghostedit_listbox").appendChild(n);document.getElementById("ghostedit_imageurlinput").focus()}},r.selection={compare:function(e,t){return!e||!t?!1:e===t},restore:function(e){return!e||!e.tagName||e.tagName.toLowerCase()!=="img"?!1:(r.focus(e),!0)},deleteContents:function(e){return!0}},r.inout={importHTML:function(e){var t,n,i,s;return t=r.create(e.src),t?(e.className.length>0&&!/ghostedit/.test(e.className)&&(t.className=e.className),t.alt=e.alt,t.title=e.title,n=t.width,i=t.height,t.naturalWidth=t.naturalWidth||n,t.naturalHeight=t.naturalHeight||i,t.setAttribute("data-ghostedit-nativewidth",n),t.setAttribute("data-ghostedit-nativeheight",i),s=ghostedit.wrapdiv.offsetWidth,ghostedit.options.image.flexibleimages||(e.style.width.replace("px","")>0&&e.style.width.replace("px","")<s?t.style.width=e.style.width:t.style.width="200px",t.style.height=t.style.width.replace("px","")/n*i),t.style.cssFloat=e.style.cssFloat,t.style.styleFloat=e.style.styleFloat,t.style.clear=e.style.clear,e.style.cssFloat=="right"||e.style.styleFloat=="right"?(t.style.marginLeft="20px",t.style.marginRight="0px"):(t.style.marginLeft="0px",t.style.marginRight="20px"),t):!1},exportHTML:function(e){if(!e||!ghostedit.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="image")return!1;var t="",n;return n=e,t+="<img src='"+n.src.toString()+"' alt='"+n.alt.toString()+"' title='"+n.title.toString()+"' ",t+="style='",ghostedit.options.image.flexibleimages||(t+="width:"+n.offsetWidth.toString()+"px;height; "+n.offsetHeight+"px;"),n.style.styleFloat=="left"||n.style.cssFloat=="left"?t+="float:left;clear:left;margin-right: 20px;":t+="float:right;clear:right;margin-left: 20px;",n.style.clear!=""&&(t+="clear:"+n.style.clear),t+="'",n.className.length>0&&!/ghostedit/.test(n.className)&&(t+=" class='"+n.className+"'"),t+=" />",{content:t}}},r.ghostevent=function(e,t,n,r){switch(e){case"delete":return!1}},r.move={align:function(e,t){var n;return e!=="left"&&e!=="right"?ghostedit.util.cancelAllEvents(t):ghostedit.selection.saved.type!=="image"?ghostedit.util.cancelAllEvents(t):(ghostedit.history.saveUndoState(),n=ghostedit.selection.saved.data,n.style.styleFloat=e,n.style.cssFloat=e,n.style.marginRight=e==="left"?"20px":"0px",n.style.marginLeft=e==="left"?"0px":"20px",r.focus(n),ghostedit.history.saveUndoState(),ghostedit.util.cancelAllEvents(t))},up:function(e){var t,n,i,s,o,u,a,f,l,c;ghostedit.history.saveUndoState();if(r.focusedimage!=null){n=r.focusedimage,f=n.offsetLeft,a=n.offetTop;if(anchor=ghostedit.dom.getPreviousSiblingGhostBlock(n))l=ghostedit.dom.getParentGhostBlock(anchor),c=l.getAttribute("data-ghostedit-handler"),ghostedit.plugins[c].dom.addchild(l,"before",anchor,n);f==n.offsetLeft&&n.offsetTopBefore==n.offsetTop?n.style.clear="":n.style.clear="",r.focus(r.focusedimage)}return ghostedit.history.saveUndoState(),ghostedit.util.cancelAllEvents(e)},down:function(e){var t,n,i,s,o,u,a=!1,f,l,c;ghostedit.history.saveUndoState();if(r.focusedimage!=null){n=r.focusedimage,offsetLeftBefore=n.offsetLeft,offsetTopBefore=n.offetTop;if(anchor=ghostedit.dom.getNextSiblingGhostBlock(n))l=ghostedit.dom.getParentGhostBlock(anchor),c=l.getAttribute("data-ghostedit-handler"),ghostedit.plugins[c].dom.addchild(l,"after",anchor,n);offsetLeftBefore==n.offsetLeft&&n.offsetTopBefore==n.offsetTop?n.style.clear="":n.style.clear="",r.focus(r.focusedimage)}return ghostedit.history.saveUndoState(),ghostedit.util.cancelAllEvents(e)}},r.setClear=function(e){ghostedit.selection.save(),ghostedit.history.saveUndoState();var t,n,r;n=ghostedit.textblock.selection.getStartTextBlockNode(),r=ghostedit.textblock.selection.getEndTextBlockNode();if(n&&r){t=n;do{t.getAttribute("data-ghostedit-elemtype").toLowerCase()=="textblock"&&(n.style.clear=e);if(!t.nextSibling||t.id==r.id)break;t=t.nextSibling}while(!0)}t=n;while(t.previousSibling&&t.previousSibling.getAttribute("data-ghostedit-elemtype")=="image")t=t.previousSibling,t.style.clear=e;document.getElementById("ghostedit_toolbar_clearselect").value=e,ghostedit.selection.save(),ghostedit.history.saveUndoState()},r.remove=function(e){ghostedit.history.saveUndoState();if(r.focusedimage!=null){var n=r.focusedimage;r.unfocus(),n.parentNode&&n.parentNode.removeChild(n)}return e&&e.preventDefault?e.stopPropagation():t.event.cancelBubble!=null&&(t.event.cancelBubble=!0),ghostedit.history.saveUndoState(),!1},r.refocus=function(){var e=r.focusedimage;r.unfocus(),r.focus(e)},r.unfocus=function(){r.resize.end(),r.focusedimage=null;if(ghostedit.selection.saved.type!=="image")return!1;var e=ghostedit.selection.saved.data;r.ui.hide(e),ghostedit.selection.clear(),ghostedit.selection.save()},r.updatealttext=function(e){r.focusedimage!=0&&r.focusedimage.alt!=e&&(r.focusedimage.alt=e,r.focusedimage.title=e,ghostedit.event.trigger("ui:message",{message:"Image description updated to '"+e+"'",time:2,color:"success"}))},r.focus=function(e,t){var n,s,o,u,a,f,l;r.unfocus();if(ghostedit.isEditing===!0&&r.focusedimage===null){f=e.id.replace("ghostedit_image_",""),o=document.createElement("div"),o.className="ghostedit_image_border",o.id="ghostedit_image_border_"+f,o.style.top=e.offsetTop+"px",o.style.left=e.offsetLeft+"px",o.style.width=e.offsetWidth-6+"px",o.style.height=e.offsetHeight-6+"px",ghostedit.contextuallayer.appendChild(o),(n=document.getElementById("ghostedit_image_resizehandle_"+f))&&ghostedit.contextuallayer.removeChild(n),ghostedit.options.image.disableresize||(s=document.createElement("span"),s.className="ghostedit_image_resizehandle",s.id="ghostedit_image_resizehandle_"+f,s.style.top=e.offsetTop+e.offsetHeight-13+"px",e.style.cssFloat=="left"||e.style.styleFloat=="left"?(s.style.left=e.offsetLeft+e.offsetWidth-13+"px",s.style.cursor="se-resize",s.style.background="URL("+ghostedit.options.imageurl+"/image/resize-se.png)"):(s.style.left=e.offsetLeft+"px",s.style.cursor="sw-resize",s.style.background="URL("+ghostedit.options.imageurl+"/image/resize-sw.png)"),ghostedit.contextuallayer.appendChild(s),s.style.MozUserSelect="none",s.contentEditable=!1,s.unselectable="on",s.onmousedown=function(e){return r.resize.start(this,e)},s.ondragstart=function(e){return ghostedit.util.cancelEvent(e)},s.ondraggesture=function(e){return ghostedit.util.cancelEvent(e)},s.onclick=function(e){return ghostedit.util.cancelEvent(e)},s.ondblclick=function(e){return ghostedit.util.cancelEvent(e)},s.onresizestart=function(e){return ghostedit.util.cancelEvent(e)}),u=r.ui.createbutton(f,"align",">",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+"px",e.style.cssFloat=="left"||e.style.styleFloat=="left"?(t.elem.style.left=e.offsetLeft+e.offsetWidth-15+"px",t.elem.innerHTML="&gt;"):(t.elem.style.left=e.offsetLeft-15+"px",t.elem.innerHTML="&lt;")}),e.style.cssFloat=="left"||e.style.styleFloat=="left"?u.event.click=function(e){return r.move.align("right",e)}:u.event.click=function(e){return r.move.align("left",e)},u.register(),u=r.ui.createbutton(f,"delete","&#215;",function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+"px"}),u.event.click=function(e){return r.remove(e)},u.register(),u=r.ui.createbutton(f,"up","^",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15-40+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),u.event.click=function(e){return r.move.up(e)},u=r.ui.createbutton(f,"down","&caron;",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+40+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),u.event.click=function(e){return r.move.down(e)},u=r.ui.createbutton(f,"small","Small",function(e,t){t.elem.style.top=e.offsetTop+40+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-60)+"px",t.elem.style.width="60px"}),u.event.click=function(e){var t=r.focusedimage;return t.className="small",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",r.ui.setbuttonpositions(),ghostedit.util.cancelEvent(e)},u=r.ui.createbutton(f,"golden","Golden",function(e,t){t.elem.style.top=e.offsetTop+80+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),u.event.click=function(e){var t=r.focusedimage;return t.className="golden",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",r.ui.setbuttonpositions(),ghostedit.util.cancelEvent(e)},u=r.ui.createbutton(f,"medium","Medium",function(e,t){t.elem.style.top=e.offsetTop+120+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),u.event.click=function(e){var t=r.focusedimage;return t.className="medium",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",r.ui.setbuttonpositions(),ghostedit.util.cancelEvent(e)},u=r.ui.createbutton(f,"fullwidth","Full Width",function(e,t){t.elem.style.top=e.offsetTop+160+"px",t.elem.style.left=(e.style.cssFloat=="left"||e.style.styleFloat=="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-100)+"px",t.elem.style.width="100px"}),u.event.click=function(e){var t=r.focusedimage;return t.className="fullwidth",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",r.ui.setbuttonpositions(),ghostedit.util.cancelEvent(e)},a="<select onclick='ghostedit.util.preventBubble()' onchange='_image.focusedimage.style.clear = this.value;_image.refocus();'>",a+="<option value='' "+(e.style.clear==""?"selected='selected' ":"")+">Clear: none</option>",a+="<option value='left' "+(e.style.clear=="left"?"selected='selected' ":"")+">Clear: left</option>",a+="<option value='right' "+(e.style.clear=="right"?"selected='selected' ":"")+">Clear: right</option>",a+="<option value='both' "+(e.style.clear=="both"?"selected='selected' ":"")+">Clear: both</option>",a+=" </select>",u=r.ui.createbutton(f,"clear",a,function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+e.offsetWidth-100+"px",t.elem.style.width="100px",t.elem.style.cursor="default"}),u.event.click=null,u.event.mousedown=null;for(i=0;i<r.buttons.length;i+=1)r.buttons[i].show(e),r.buttons[i].reposition(e,r.buttons[i]);ghostedit.selection.saved.type="image",ghostedit.selection.saved.data=e,ghostedit.selection.updatePathInfo(e),ghostedit.event.trigger("ui:update"),r.focusedimage=e,ghostedit.event.trigger("ui:newcontext",{context:"image"});if(t)return ghostedit.util.cancelEvent(t)}},r.resize={start:function(e,n){ghostedit.history.saveUndoState(),n==null&&(n=t.event);var i=document.getElementById("ghostedit_image_"+e.id.replace("ghostedit_image_resizehandle_",""));return r.originalMouseX=n.pageX||n.clientX+document.body.scrollLeft,r.originalMouseY=n.pageY||n.clientY+document.body.scrollTop,r.originalImageWidth=i.offsetWidth,r.originalImageHeight=i.offsetHeight,i.getAttribute("data-ghostedit-nativewidth")||i.setAttribute("data-ghostedit-nativewidth",i.offsetWidth),i.getAttribute("data-ghostedit-nativeheight")||i.setAttribute("data-ghostedit-nativeheight",i.offsetHeight),ghostedit.util.addEvent(document.body,"mousemove",r.resize.handle),ghostedit.util.addEvent(document.body,"mouseup",r.resize.end),ghostedit.util.addEvent(t,"blur",r.resize.end),!1},handle:function(e){var n,i,s,o,u,a,f,l,c,h,p,d,v;e=t.event!=null?t.event:e,r.focusedimage==null?r.unfocus():(n=r.focusedimage,i=document.getElementById("ghostedit_image_resizehandle_"+n.id.replace("ghostedit_image_","")),s=document.getElementById("ghostedit_imagebutton_align"+n.id.replace("ghostedit_image_","")),o=e.pageX||e.clientX+document.body.scrollLeft,u=e.pageY||e.clientY+document.body.scrollTop,h=r.originalMouseX,p=r.originalMouseY,c=r.originalImageHeight,l=r.originalImageWidth,v=n.getAttribute("data-ghostedit-nativeheight"),d=n.getAttribute("data-ghostedit-nativewidth"),n.style.cssFloat=="left"||n.style.styleFloat=="left"?(a=l+(o-h),f=c+(u-p)):(a=l-(o-h),f=c+(u-p)),f/v*d>a?a=f/v*d:f=a/d*v,a>=n.parentNode.width&&(a=n.parentNode.width,f=a/d*v),n.style.width=a+"px",n.style.height=f+"px",r.ui.setbuttonpositions())},end:function(e){r.justResized=!0,ghostedit.util.removeEvent(document.body,"mousemove",r.resize.handle),ghostedit.util.removeEvent(document.body,"mouseup",r.resize.end),ghostedit.util.removeEvent(t,"blur",r.resize.end),ghostedit.history.saveUndoState()}},r.ui={show:function(e){},hide:function(e){e=e||r.focusedimage;if(!e)return!1;document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))&&ghostedit.contextuallayer.removeChild(document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))),!ghostedit.options.image.disableresize&&document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_",""))&&ghostedit.contextuallayer.removeChild(document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_","")));for(i=0;i<r.buttons.length;i+=1)r.buttons[i].hide();r.buttons=[]},srcdialog:function(){r.focusedimage!=0&&ghostedit.ui.modal.show("<h3>Change Image Source</h3>yada yada")},createbutton:function(e,t,n,i){var s,o;return o=document.createElement("span"),o.id="ghostedit_imagebutton_"+t+"_"+e,o.setAttribute("data-ghostedit-elemtype","ghostedit_imagebutton"),o.setAttribute("data-ghostedit-handler","image"),o.className="ghostedit_imagebutton",o.innerHTML=n,"&#215;",s={elem:o},s.reposition=i,s.event={mousedown:function(e){return ghostedit.util.cancelEvent(e)},dragstart:function(e){return ghostedit.util.cancelEvent(e)},draggesture:function(e){return ghostedit.util.cancelEvent(e)},click:function(e){return ghostedit.util.cancelEvent(e)},dblclick:function(e){return ghostedit.util.cancelEvent(e)},resizestart:function(e){return ghostedit.util.cancelEvent(e)}},s.show=function(e){ghostedit.contextuallayer.appendChild(s.elem),s.elem.style.MozUserSelect="none",s.elem.contentEditable=!1,s.elem.unselectable="on",s.elem.onmousedown=s.event.mousedown,s.elem.ondragstart=s.event.dragstart,s.elem.ondraggesture=s.event.draggesture,s.elem.onclick=s.event.click,s.elem.ondblclick=s.event.dblclick,s.elem.onresizestart=s.event.resizestart},s.hide=function(){s.elem.parentNode.removeChild(s.elem)},s.register=function(){r.buttons.push(s)},s},setbuttonpositions:function(){var e,t,n,s,o,u,a;if(e=r.focusedimage){t=document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_","")),t.style.top=e.offsetTop+"px",t.style.left=e.offsetLeft+"px",t.style.width=e.offsetWidth-6+"px",t.style.height=e.offsetHeight-6+"px",ghostedit.options.image.disableresize||(n=document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_","")),n.style.top=e.offsetTop+e.offsetHeight-13+"px",e.style.cssFloat=="left"||e.style.styleFloat=="left"?n.style.left=e.offsetLeft+e.offsetWidth-13+"px":n.style.left=e.offsetLeft+"px");for(i=0;i<r.buttons.length;i+=1)r.buttons[i].reposition(e,r.buttons[i])}}},r.insert=function(){var e;e=document.getElementById("ghostedit_imageurlinput"),e.blur(),r.newImageBefore(null,null,!1),ghostedit.ui.modal.hide()},r.insertInline=function(n,i,s){ghostedit.history.saveUndoState(),ghostedit.selection.restore(),n==null&&(n=ghostedit.selection.savedRange.getStartNode()),n=ghostedit.textblock.selection.getTextBlockNode(n),i==null&&(i=document.getElementById("ghostedit_imageurlinput").value),document.createRange?(newImg=document.createElement("img"),ghostedit.imgElemId+=1,newImg.id="ghostedit_image_"+(1e3+ghostedit.imgElemId),ghostedit.selection.savedRange.getNative().insertNode(newImg)):document.selection&&ghostedit.selection.savedRange.getNative().pasteHTML("<img id='ghostedit_image_"+(1e3+ghostedit.imgElemId)+"' />");var o=document.getElementById("ghostedit_image_"+(1e3+ghostedit.imgElemId));o.setAttribute("data-ghostedit-elemtype","image"),o.setAttribute("data-ghostedit-handler","image"),o.contentEditable="false",o.unselectable="on";var u={i:o,s:s};u.callself=function(){r.onload(u.i,u.s,!0)},o.onload=u.callself,o.src=i,o.onclick=function(e){r.focus(this,e),ghostedit.util.cancelAllEvents(e)},o.ondragstart=function(e){return e=t.event?t.event:e,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",o.id)),!0},o.ondraggesture=function(){return ghostedit.util.cancelEvent(e)},o.onresizestart=function(){return ghostedit.util.cancelAllEvents(e)},o.oncontrolselect=function(e){return r.focus(this,e),ghostedit.util.cancelAllEvents(e)}},r.create=function(n){var i;return i=document.createElement("img"),r.elemid+=1,i.id="ghostedit_image_"+r.elemid,i.src=n,ghostedit.options.defaultimageclass&&(i.className=ghostedit.options.defaultimageclass),i.setAttribute("data-ghostedit-elemtype","image"),i.setAttribute("data-ghostedit-handler","image"),i.contentEditable="false",i.unselectable="on",i.galleryimg="no",i.onclick=function(e){r.focus(this,e),ghostedit.util.cancelAllEvents(e)},i.ondragstart=function(e){return e=t.event?t.event:e,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",i.id)),!0},i.ondraggesture=function(){return ghostedit.util.cancelEvent(e)},i.onresizestart=function(){return ghostedit.util.cancelAllEvents(e)},i.oncontrolselect=function(e){return r.focus(this,e),ghostedit.util.cancelAllEvents(e)},i},r.newImageBefore=function(e,t,n,i){var s,o,u,a,f;ghostedit.history.saveUndoState(),e==null&&(e=ghostedit.selection.savedRange.getStartNode()),e=ghostedit.textblock.selection.getTextBlockNode(e),i!=="after"&&(i="before"),t==null&&(t=document.getElementById("ghostedit_imageurlinput").value);if(!document.getElementById("ghostedit_image_"+e.id.replace("ghostedit_textblock_",""))){newImg=document.createElement("img"),r.elemid+=1,newImg.id="ghostedit_image_"+r.elemid,ghostedit.options.defaultimageclass&&(newImg.className=ghostedit.options.defaultimageclass),u=ghostedit.dom.getParentGhostBlock(e),a=u.getAttribute("data-ghostedit-handler"),f=ghostedit.plugins[a].dom.addchild(u,i,e,newImg);if(!f)return!1;var o=document.getElementById("ghostedit_image_"+r.elemid);o.setAttribute("data-ghostedit-elemtype","image"),o.setAttribute("data-ghostedit-handler","image"),o.contentEditable="false",o.unselectable="on",o.galleryimg="no";var l=e.style.clear=="left"?"right":"left";o.style.cssFloat=l,o.style.styleFloat=l,o.style.clear=e.style.clear,o.style.marginRight="20px";var s={i:o,s:n};return s.callself=function(){r.onload(s.i,s.s,!0)},o.onload=s.callself,o.src=t,r.applyeventlisteners(o),ghostedit.util.addClass(o,"leftimage"),o}},r.newImageFrame=function(){var n,i;ghostedit.history.saveUndoState(),elem=ghostedit.selection.savedRange.getStartNode(),elem=ghostedit.textblock.selection.getTextBlockNode(elem);if(!elem||!elem.id)return ghostedit.ui.message.show("Please select a paragraph or heading before trying to insert an image.",2,"error"),!1;if(!document.getElementById("ghostedit_image_"+elem.id.replace("ghostedit_textblock_",""))){newImg=document.createElement("div"),newImg.innerHTML="<h3>Image Uploading</h3>",newImg.id="ghostedit_image_"+elem.id.replace("ghostedit_textblock_",""),elem.parentNode!=null?(elem.parentNode.contentEditable=!1,elem.parentNode.insertBefore(newImg,elem),elem.parentNode.contentEditable=!0):ghostedit.ui.message.show("Please select a paragraph or heading before trying to insert an image.",2,"error");var i=document.getElementById("ghostedit_image_"+elem.id.replace("ghostedit_textblock_",""));return i.setAttribute("data-ghostedit-elemtype","image"),i.setAttribute("data-ghostedit-handler","image"),i.contentEditable="false",i.unselectable="on",i.style.width="240px",i.style.height="160px",i.style.backgroundColor="#EEE",i.style.cssFloat="left",i.style.styleFloat="left",i.style.marginRight="20px",i.style.overflow="hidden",i.setAttribute("data-ghostedit-nativewidth",0),i.setAttribute("data-ghostedit-nativeheight",0),i.onclick=function(e){r.focus(this,e),ghostedit.util.cancelAllEvents(e)},i.ondragstart=function(e){return e=t.event?t.event:e,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",i.id)),!0},i.ondraggesture=function(){return ghostedit.util.cancelEvent(e)},i.onresizestart=function(){return ghostedit.util.cancelAllEvents(e)},i.oncontrolselect=function(e){return r.focus(this,e),ghostedit.util.cancelAllEvents(e)},i.id}},r.onload=function(e,t,n){if(n==1){e.setAttribute("data-ghostedit-nativewidth",0),e.setAttribute("data-ghostedit-nativeheight",0);if(!ghostedit.options.image.disableresize&&!t&&e.offsetWidth>200){var i=200,s=i/e.offsetWidth*e.offsetHeight;e.style.width=i+"px",e.style.height=s+"px"}e.contentEditable=!1,ghostedit.history.saveUndoState()}else{var o={i:e,s:t};o.callself=function(){r.onload(o.i,o.s,!0)},setTimeout(o.callself,20)}},r.applyeventlisteners=function(){var n,i,s;n=ghostedit.editdiv.getElementsByTagName("img");for(i=0;i<n.length;i++){s=n[i];if(s.getAttribute("data-ghostedit-elemtype")!=="image")continue;s.onclick=function(e){r.focus(this,e),ghostedit.util.cancelAllEvents(e)},s.ondragstart=function(e){return e=t.event?t.event:e,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",addedImage.id)),!0},s.ondraggesture=function(){return ghostedit.util.cancelEvent(e)},s.onresizestart=function(){return ghostedit.util.cancelAllEvents(e)},s.oncontrolselect=function(e){return r.focus(this,e),ghostedit.util.cancelAllEvents(e)}}},ghostedit.api.plugin.register("image",r)}(window),function(e,t){var n={focusedlink:!1,el:{}};n.enable=function(){ghostedit.event.addListener("preundo",function(){n.unfocus()}),ghostedit.event.addListener("preredo",function(){n.unfocus()}),ghostedit.event.addListener("import:after",function(){n.event.postimport()}),ghostedit.event.addListener("ui:update",function(){n.ui.update()}),ghostedit.inout.registerimporthandler(ghostedit.plugins.textblock.inout.importHTML,"a"),ghostedit.plugins.textblock.inout.parserules.tags.a={attributes:["href"]},ghostedit.api.link=ghostedit.api.link||{},ghostedit.api.link.create=function(){return n.create()}},n.ghostevent=function(e,t,n,r){return!1},n.event={urlBoxKeypress:function(t){t=e.event!=null?e.event:t;var r=t.keyCode!=null?t.keyCode:t.charCode;switch(r){case 13:return n.create(),ghostedit.ui.modal.hide(),!1}return!0},postimport:function(e){if(!e||!e.editdiv)return!1;var t=e.editdiv.getElementsByTagName("a");for(i=0;i<t.length;i+=1)t[i].setAttribute("data-ghostedit-elemtype","link"),t[i].setAttribute("data-ghostedit-handler","link");return!0},insertButtonClick:function(){ghostedit.selection.savedRange.isCollapsed()&&(range=ghostedit.selection.savedRange.clone(),range=ghostedit.textblock.selection.extendtoword(range,!0),range.select(),ghostedit.selection.save()),ghostedit.selection.savedRange.isCollapsed()?document.createRange||document.selection&&(ghostedit.selection.savedRange.getNative().pasteHTML("<a id='ghostedit_newlink' href='http://'>Link Text</a>"),lasso().selectNodeContents("ghostedit_newlink").select(),document.getElementById("ghostedit_newlink").id=""):(n.create("http://"),ghostedit.selection.save(),n.focusedlink.href="http://",ghostedit.ui.toolbar.enabletab("link"),ghostedit.ui.toolbar.showtab("link"),document.getElementById("ghostedit_toolbar_linkurl").focus(),ghostedit.selection.save())}},n.selection={deleteContents:function(){return!1}},n.ui={update:function(){var e,t,r=!1;for(t=0;t<ghostedit.selection.nodepath.length;t++)e=ghostedit.selection.nodepath[t],e.tagName.toLowerCase()==="a"&&(r=e);r?r!=n.focusedlink&&n.focus(r):n.focusedlink&&n.unfocus()},show:function(e){var t,r,i;n.ui.hide(),t=document.createElement("span"),t.className="ghostedit_focusedlinkbox",t.id="ghostedit_focusedlinkbox",t.style.top=e.offsetTop+e.offsetHeight-1+"px",i=e.getClientRects()[e.getClientRects().length-1].left,t.style.left=i-ghostedit.editdiv.getBoundingClientRect().left+"px",r=document.createElement("a"),r.style.cursor="pointer",r.style.color="#333",r.innerHTML="<b>&#215;</b>&nbsp;remove&nbsp;link</a>",t.appendChild(r),ghostedit.contextuallayer.appendChild(t),t.style.MozUserSelect="none",t.contentEditable=!1,t.unselectable="on",t.onmousedown=function(e){return ghostedit.util.cancelEvent(e)},t.ondragstart=function(e){return ghostedit.util.cancelEvent(e)},t.ondraggesture=function(e){return ghostedit.util.cancelEvent(e)},t.onclick=function(e){return ghostedit.util.cancelEvent(e)},t.ondblclick=function(e){return ghostedit.util.cancelEvent(e)},t.onresizestart=function(e){return ghostedit.util.cancelEvent(e)},t.oncontrolselect=function(e){return ghostedit.util.cancelAllEvents(e)},ghostedit.util.addEvent(r,"click",ghostedit.util.preparefunction(n.remove,null,e)),n.el.focusedbox=t,n.el.focusedboxa=r},hide:function(){if(!n.el.focusedbox)return;ghostedit.contextuallayer.removeChild(n.el.focusedbox),n.el.focusedbox=null,n.el.focusedboxa=null}},n.create=function(e){ghostedit.history.saveUndoState();var t,n,r,i;typeof e=="undefined"&&(e="http://"),document.execCommand("CreateLink",!1,e),r=ghostedit.editdiv.getElementsByTagName("a");for(i=0;i<r.length;i+=1)r[i].setAttribute("data-ghostedit-elemtype","link"),r[i].setAttribute("data-ghostedit-handler","link");ghostedit.selection.save(),ghostedit.history.saveUndoState()},n.focus=function(e){var t,r,i,s,o;n.focusedlink=e,n.ui.show(e),ghostedit.event.trigger("ui:newcontext",{context:"link"})},n.unfocus=function(){if(n.focusedlink===!1)return;n.ui.hide(),n.focusedlink=!1},n.remove=function(e){var t,r;e=e||n.focusedlink;if(!ghostedit.dom.isGhostBlock(e)||e.tagName.toLowerCase()!=="a")return!1;if(ghostedit.selection.saved.type!=="textblock")return!1;console.log("test"),ghostedit.selection.saved.data.saveToDOM(),r=ghostedit.dom.extractContent(e),e.parentNode.insertBefore(r,e),e.parentNode.removeChild(e),ghostedit.selection.saved.data.restoreFromDOM().select(),ghostedit.selection.save()},n.updateurl=function(e){n.focusedlink!=0&&n.focusedlink.href!=e&&(n.focusedlink.href=e,n.focusedlink.title=e,ghostedit.ui.message.show("URL updated to '"+e+"'",2,"success"))},n.open=function(){n.focusedlink!=0&&e.open(n.focusedlink.href)},ghostedit.api.plugin.register("link",n)}(window),function(e,t){var n={elemid:0,itemelemid:0};n.enable=function(){ghostedit.event.addListener("postpaste",function(){var e,t,r,i,s;i=[],t=ghostedit.editdiv.getElementsByTagName("ul");for(e=0;e<t.length;e++)i.push(t[e]);r=ghostedit.editdiv.getElementsByTagName("ol");for(e=0;e<r.length;e++)i.push(r[e]);for(e=0;e<i.length;e++){s=i[e];if(!s.parentNode)continue;n.tidy(s)}}),ghostedit.inout.registerimporthandler(n.inout.importHTML,"ol","ul","li"),ghostedit.api.list=ghostedit.api.list||{},ghostedit.api.list.toggle=function(e){n.toggle(e)}},n.ghostevent=function(e,t,r,i){var s=!1,o,u=!1,a,f,l;switch(e){case"delete":l=t.getAttribute("data-ghostedit-elemtype");if(l==="list")return r==="ahead"||r==="behind"?(a=r==="ahead"?ghostedit.dom.getLastChildGhostBlock(t):ghostedit.dom.getFirstChildGhostBlock(t),n.ghostevent("delete",a,r,i)):!1;if(l==="listitem")return r==="ahead"||r==="behind"?(a=ghostedit.dom.getFirstChildGhostBlock(t),f=ghostedit.plugins.textblock.event.textdelete(a,r,i)):r==="top"?f=ghostedit.event.sendBackwards("delete",t,i):r==="bottom"&&(f=ghostedit.event.sendForwards("delete",t,i)),f}},n.dom={addchild:function(e,t,r,i,s){var o,u,a=!1,f=!1;s&&s.contentlength!==!1&&(f=s.contentlength<1?!0:!1),e.getAttribute("data-ghostedit-elemtype")==="listitem"&&(e=ghostedit.dom.getParentGhostBlock(e));if(e.getAttribute("data-ghostedit-elemtype")!=="list")return!1;anchorelem=r;while(anchorelem.getAttribute("data-ghostedit-elemtype")!=="listitem"){anchorelem=ghostedit.dom.getParentGhostBlock(anchorelem);if(anchorelem===null)return!1}return f&&ghostedit.dom.getNextSiblingGhostBlock(anchorelem)===!1&&ghostedit.plugins.textblock.isEmpty(r)&&(o=ghostedit.dom.getParentGhostBlock(e),handler=o.getAttribute("data-ghostedit-handler"),a=ghostedit.plugins[handler].dom.addchild(o,"after",e,i)),a?(e.removeChild(anchorelem),a):(i.getAttribute("data-ghostedit-elemtype")==="textblock"?(u=document.createElement("li"),n.itemelemid+=1,u.id="ghostedit_listitem_"+n.itemelemid,u.setAttribute("data-ghostedit-elemtype","listitem"),u.setAttribute("data-ghostedit-handler","list"),u.appendChild(i)):u=i,t==="before"?e.insertBefore(u,anchorelem):anchorelem.nextSibling!==null?e.insertBefore(u,anchorelem.nextSibling):e.appendChild(u),!0)},removechild:function(e,t){e&&e.getAttribute("data-ghostedit-elemtype")==="listitem"&&(t=e,e=ghostedit.dom.getParentGhostBlock(e));if(!e||!t)return!1;if(e.getAttribute("data-ghostedit-elemtype")!=="list")return!1;while(t.getAttribute("data-ghostedit-elemtype")!=="listitem"){t=ghostedit.dom.getParentGhostBlock(t);if(t===null)return!1}return t.parentNode!==e?!1:(e.removeChild(t),!0)}},n.selection={deleteContents:function(e,t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;k=!1,L=!1;if(!n.isList(e))return n.isListItem(e)?ghostedit.plugins.textblock.selection.deleteContents(ghostedit.dom.getFirstChildGhostBlock(e)):!1;if(ghostedit.selection.saved.type!=="textblock")return;C=ghostedit.selection.saved.data.clone(),l=e.childNodes,A=ghostedit.dom.getFirstChildGhostBlock(e),O=ghostedit.dom.getLastChildGhostBlock(e),T=lasso().setCaretToStart(A),N=lasso().setCaretToEnd(O),C.compareEndPoints("StartToStart",T)!==1?(k=!0,o=A):(o=C.getStartNode(),ghostedit.dom.isGhostBlock(o)||(o=ghostedit.dom.getParentGhostBlock(o))),C.compareEndPoints("EndToEnd",N)!==-1?(L=!0,u=O):(u=C.getEndNode(),ghostedit.dom.isGhostBlock(u)||(u=ghostedit.dom.getParentGhostBlock(u))),a=o;while(!ghostedit.dom.isChildGhostBlock(a,e))a=ghostedit.dom.getParentGhostBlock(a);f=u;while(!ghostedit.dom.isChildGhostBlock(f,e))f=ghostedit.dom.getParentGhostBlock(f);v=k;for(r=0;r<l.length;r+=1){cblock=l[r];if(!ghostedit.dom.isGhostBlock(cblock))continue;H=cblock.getAttribute("data-ghostedit-handler");if(!k&&cblock.id===a.id){ghostedit.plugins[H].selection.deleteContents(cblock),v=!0;if(cblock.id===f.id)break;continue}if(!L&&cblock.id===f.id){ghostedit.plugins[H].selection.deleteContents(cblock),v=!1;break}v&&(C.saveToDOM("seldelete-midlist"),e.removeChild(l[r]),C.restoreFromDOM("seldelete-midlist"),r--)}return!k&&!L&&a.getAttribute("data-ghostedit-elemtype")===f.getAttribute("data-ghostedit-elemtype")&&(ghostedit.plugins[a.getAttribute("data-ghostedit-handler")].merge(a,f,t),ghostedit.dom.getParentGhostBlock(f)||lasso().setToSelection().collapseToStart().select()),ghostedit.dom.getFirstChildGhostBlock(e)||e.appendChild(n.createItem("p")),!0}},n.inout={importHTML:function(e){var t,r,i,s,o;if(!e||!e.tagName)return!1;switch(e.tagName.toLowerCase()){case"ol":case"ul":return n.inout.importList(e);case"li":t=n.create("ul"),t.setAttribute("data-ghostedit-importinfo","wasinline"),r=0,i=e;do{console.log(i),o=n.inout.importListItem(i);if(!o)break;r+=1,t.appendChild(o),s=i,i=i.nextSibling,r>1&&s.parentNode.removeChild(s)}while(i&&i.nodeType===1&&i.tagName.toLowerCase()==="li");return r>0?t:!1}},exportHTML:function(e){if(!e||!ghostedit.dom.isGhostBlock(e))return!1;var t="",r,i;switch(e.getAttribute("data-ghostedit-elemtype")){case"list":r=ghostedit.dom.getFirstChildGhostBlock(e);if(!r)return!1;do result=n.inout.exportHTML(r),result&&(t+=result.content);while(r=ghostedit.dom.getNextSiblingGhostBlock(r));if(t.length<1)return!1;return i=e.tagName.toLowerCase()==="ol"?"ol":"ul",t="<"+i+">"+t+"</"+i+">",{content:t};case"listitem":elem=ghostedit.dom.getFirstChildGhostBlock(e);if(!elem)return!1;result=ghostedit.plugins.textblock.inout.exportHTML(elem),result&&(t+=result.content);if(t.length<1)return!1;return t="<li>"+t+"</li>",{content:t}}},importList:function(e){var t,r,i,s,o,u;if(!e||!e.tagName)return!1;u=e.tagName.toLowerCase();if(u!=="ul"&&u!=="ol")return!1;r=n.create(u);if(e.childNodes&&e.childNodes.length)for(t=0;t<e.childNodes.length;t+=1){o=e.childNodes[t];if(o.nodeType!==1||o.tagName.toLowerCase()!=="li")continue;s=n.inout.importListItem(o),s&&ghostedit.dom.isGhostBlock(s)&&r.appendChild(s)}return ghostedit.dom.getFirstChildGhostBlock(r)||r.appendChild(n.createItem("p")),r},importListItem:function(e){var t,r,i,s,o,u,a=!1;return!e||!e.tagName||!e.tagName.toLowerCase()==="li"?!1:(o=n.createItem(),u=ghostedit.dom.getFirstChildElement(e),ghostedit.plugins.textblock.inout.isHandleableNode(u)==="block"?a=ghostedit.plugins.textblock.inout.importHTML(u):(a=document.createElement("p"),a.innerHTML=e.innerHTML,a=ghostedit.plugins.textblock.inout.importHTML(a)),a?o.appendChild(a):o.appendChild(ghostedit.plugins.textblock.create("p")),o)}},n.paste={handle:function(e,t,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isGhostBlock(t))return;if(t.tagName.toLowerCase()!=="ol"&&t.tagName.toLowerCase()!=="ul")return!1;if(t.tagName!==e.tagName){v=ghostedit.selection.saved.data.clone().collapseToStart().getParentNode();while(!ghostedit.dom.isChildGhostBlock(v,e))v=ghostedit.dom.getParentGhostBlock(v);m=n.split(e,"after",v);switch(m){case!1:return!0;case"atverystart":node1=ghostedit.dom.getPreviousSiblingGhostBlock(e),node2=e;break;case"atveryend":node1=e,node2=ghostedit.dom.getNextSiblingGhostBlock(e);break;default:node1=m.block1,node2=m.block2}return lasso().removeDOMmarkers("ghostedit_paste_start"),lasso().removeDOMmarkers("ghostedit_paste_end"),node1.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",node2.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+node2.innerHTML,!1}startblock=ghostedit.selection.saved.data.clone().collapseToStart().getParentNode();while(!ghostedit.dom.isGhostBlock(startblock))startblock=ghostedit.dom.getParentGhostBlock(startblock);endblock=ghostedit.selection.saved.data.clone().collapseToEnd().getParentNode();while(!ghostedit.dom.isGhostBlock(startblock))startblock=ghostedit.dom.getParentGhostBlock(startblock);if(r.isfirst){g=ghostedit.dom.getFirstChildGhostBlock(t),y=ghostedit.dom.getFirstChildGhostBlock(g),w=startblock,b=ghostedit.dom.getParentGhostBlock(w);if(y.tagName===w.tagName){w.innerHTML+=y.innerHTML,ghostedit.plugins.textblock.mozBrs.tidy(w),t.removeChild(g);if(!ghostedit.dom.getLastChildGhostBlock(t))return r.islast&&(E=ghostedit.dom.getNextSiblingGhostBlock(b),E&&(lasso().removeDOMmarkers("ghostedit_paste_start"),w.innerHTML=w.innerHTML+"<span id='ghostedit_paste_start_range_start'>&#x200b;</span>"+ghostedit.dom.getFirstChildGhostBlock(E).innerHTML,ghostedit.plugins.textblock.mozBrs.tidy(w),E.parentNode.removeChild(E))),!0;lasso().removeDOMmarkers("ghostedit_paste_start"),w.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",ghostedit.plugins.textblock.mozBrs.tidy(w),startblock=b}}r.islast&&ghostedit.dom.getLastChildGhostBlock(t)&&(g=ghostedit.dom.getLastChildGhostBlock(t),y=ghostedit.dom.getFirstChildGhostBlock(g),w=endblock,y.tagName===w.tagName&&(lasso().removeDOMmarkers("ghostedit_paste_end"),w.innerHTML=y.innerHTML+"<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+w.innerHTML,t.removeChild(g),ghostedit.plugins.textblock.mozBrs.tidy(w))),v=startblock,firstitem=item=ghostedit.dom.getFirstChildGhostBlock(t);while(item=ghostedit.dom.getFirstChildGhostBlock(t))n.dom.addchild(e,"after",v,item),v=item;return r.isfirst||(lasso().removeDOMmarkers("ghostedit_paste_start"),v.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",ghostedit.plugins.textblock.mozBrs.tidy(v)),r.islast||(lasso().removeDOMmarkers("ghostedit_paste_end"),endblock.innerHTML=endblock.innerHTML+"<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"),!0}},n.isList=function(e){var t;return ghostedit.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),t!=="ul"&&t!=="ol"?!1:!0):!1},n.isListItem=function(e){var t;return ghostedit.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),t!=="li"?!1:!0):!1},n.create=function(e){return e.toLowerCase()!=="ol"&&(e="ul"),newElem=document.createElement(e),ghostedit.blockElemId+=1,newElem.id="ghostedit_list_"+ghostedit.blockElemId,newElem.setAttribute("data-ghostedit-iselem","true"),newElem.setAttribute("data-ghostedit-elemtype","list"),newElem.setAttribute("data-ghostedit-handler","list"),newElem},n.createItem=function(e){return newElem=document.createElement("li"),ghostedit.blockElemId+=1,newElem.id="ghostedit_list_item_"+ghostedit.blockElemId,newElem.setAttribute("data-ghostedit-iselem","true"),newElem.setAttribute("data-ghostedit-elemtype","listitem"),newElem.setAttribute("data-ghostedit-handler","list"),e&&newElem.appendChild(ghostedit.plugins.textblock.create(e)),newElem},n.remove=function(e){var t,n;return t=ghostedit.dom.getParentGhostBlock(e),n=t.getAttribute("data-ghostedit-handler"),ghostedit.plugins[n].dom.removechild(t,e)},n.focus=function(e){var t,n;return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="list"?!1:(t=ghostedit.dom.getFirstChildGhostBlock(e),t?(t=ghostedit.dom.getFirstChildGhostBlock(t),t?(n=t.getAttribute("data-ghostedit-handler"),ghostedit.plugins[n].focus(t),!0):!1):!1)},n.merge=function(e,t,r){if(e===t)return e;if(!n.isList(e)||!n.isList(t))return n.isListItem(e)&&n.isListItem(t)?n.mergeItems(e,t,r):!1;if(e.tagName.toLowerCase()!==t.tagName.toLowerCase())return!1;while(child=ghostedit.dom.getFirstChildGhostBlock(t))e.appendChild(child);return n.remove(t),e},n.mergeItems=function(e,t,r){var i,s;return r===!1?e:e===t?e:!n.isListItem(e)||!n.isListItem(t)?!1:(i=ghostedit.dom.getFirstChildGhostBlock(e),s=ghostedit.dom.getFirstChildGhostBlock(t),!i||!s?!1:(result=ghostedit.plugins.textblock.merge(i,s),result))},n.split=function(e,t,r){var i,s,o,u,a,f;if(!ghostedit.dom.isGhostBlock(e)||!ghostedit.dom.isChildGhostBlock(r,e))return!1;t!=="before"&&(t="after"),i=ghostedit.dom.getFirstChildGhostBlock(e),s=ghostedit.dom.getLastChildGhostBlock(e);if(t==="before"&&i===r)return"atverystart";if(t==="after"&&s===r)return"atveryend";u=r,o=n.create(e.tagName.toLowerCase()),a=ghostedit.dom.getParentGhostBlock(e),f=a.getAttribute("data-ghostedit-handler");if(t==="before"){u=i;while(u){if(u===r)break;o.appendChild(u),u=ghostedit.dom.getFirstChildGhostBlock(e)}}else{u=ghostedit.dom.getNextSiblingGhostBlock(r);while(u)o.appendChild(u),u=ghostedit.dom.getNextSiblingGhostBlock(r)}return ghostedit.plugins[f].dom.addchild(a,t,e,o),t==="before"?{block1:o,block2:e}:{block1:e,block2:o}},n.toggle=function(e){var t,r,i,s,o,u,a,f,l=!1,c=!1,h,p,d,v=[],m=[],g=[],y,b,w,E,S,x=[];e=e==="ordered"?"ol":"ul",r=!1,intextblock=!1,u=!1;for(t=0;t<ghostedit.selection.nodepath.length;t++){f=ghostedit.selection.nodepath[t];switch(f.getAttribute("data-ghostedit-elemtype")){case"list":r=!0,i=f;break;case"textblock":intextblock=!0,o=f;break;case"container":u=!0,a=f}}return ghostedit.selection.savedRange.saveToDOM().select(),intextblock&&!r?(n.convertTextblock(o,e),(b=lasso().restoreFromDOM())&&b.select(),ghostedit.selection.save(),!0):r?(n.convertList(i,e),(b=lasso().restoreFromDOM())&&b.select(),ghostedit.selection.save(),!0):u?(n.convertContainerContents(a,e),(b=lasso().restoreFromDOM())&&b.select(),ghostedit.selection.save(),!0):!1},n.convertTextblock=function(e,t){var r,i,s,o,u;return r=n.create(t),s=e.tagName.toLowerCase(),i=n.createItem(),r.appendChild(i),o=ghostedit.dom.getParentGhostBlock(e),u=o.getAttribute("data-ghostedit-handler"),ghostedit.plugins[u].dom.addchild(o,"before",e,r),i.appendChild(e),n.tidy(r),lasso().setCaretToEnd(e).select(),ghostedit.selection.save(),e},n.convertList=function(e,t){var r,i=[],s,o=!1,u=!1,a,f,l,c=[],h=[],p=[],d,v,m,g,y;s=ghostedit.dom.getFirstChildGhostBlock(e);if(!s)return n.remove(e),!0;ghostedit.selection.savedRange.restoreFromDOM("",!1);do m=lasso().setCaretToEnd(s).compareEndPoints("StartToStart",ghostedit.selection.savedRange),m=m>=0?!0:!1,g=lasso().setCaretToStart(s).compareEndPoints("EndToEnd",ghostedit.selection.savedRange),g=g<=0?!0:!1,m?m&&g?h.push(s):p.push(s):c.push(s);while(s=ghostedit.dom.getNextSiblingGhostBlock(s));f=ghostedit.dom.getParentGhostBlock(e),l=f.getAttribute("data-ghostedit-handler");if(p.length>0){u=n.create(e.tagName);for(r=0;r<p.length;r++)u.appendChild(p[r]);ghostedit.plugins[l].dom.addchild(f,"after",e,u)}y=e;if(e.tagName.toLowerCase()===t)for(r=0;r<h.length;r++)s=ghostedit.dom.getFirstChildGhostBlock(h[r]),s&&(ghostedit.plugins[l].dom.addchild(f,"after",y,s),y=s),e.removeChild(h[r]);else{o=n.create(t);for(r=0;r<h.length;r++)o.appendChild(h[r]);ghostedit.plugins[l].dom.addchild(f,"after",e,o)}return c.length===0&&(n.remove(e),e=!1),e&&(n.tidy(e),i.push(e)),o&&(n.tidy(o),i.push(o)),u&&(n.tidy(u),i.push(u)),i},n.convertContainerContents=function(e,t){var r,i,s,o,u,a,f,l=!1,c=!1,h,p,d,v=[],m=[],g=[],y,b,w,E,S,x=[];f=ghostedit.dom.getFirstChildGhostBlock(e);do{w=lasso().setCaretToEnd(f).compareEndPoints("StartToStart",ghostedit.selection.savedRange),w=w>=0?!0:!1,E=lasso().setCaretToStart(f).compareEndPoints("EndToEnd",ghostedit.selection.savedRange),E=E<=0?!0:!1;if(w&&E)m.push(f);else if(!E)break}while(f=ghostedit.dom.getNextSiblingGhostBlock(f));for(r=0;r<m.length;r++){f=m[r];switch(f.getAttribute("data-ghostedit-elemtype")){case"list":f.tagName.toLowerCase()!==t&&n.convertList(f,t);break;case"textblock":n.convertTextblock(f,t)}}return!0},n.tidy=function(e){var t,r,i,s,o,u,a;return i=ghostedit.dom.getFirstChildGhostBlock(e),i?(t=ghostedit.dom.getPreviousSiblingGhostBlock(e),a=n.merge(t,e),a?(n.focus(a),ghostedit.selection.save(),n.tidy(a),!0):(r=ghostedit.dom.getNextSiblingGhostBlock(e),a=n.merge(e,r),a?(n.focus(a),ghostedit.selection.save(),n.tidy(a),!0):!0)):(n.remove(e),!0)},n.applydropevents=function(e){e.ondragenter=function(){return!1},e.ondragleave=function(){return!1},e.ondragover=function(){return!1},e.ondrop=function(e){var t,n;n=e.dataTransfer.getData("text/plain")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),ghostedit.image.focus(t),ghostedit.util.cancelEvent(e)},e.onresizestart=function(e){return ghostedit.util.cancelEvent(e)}},ghostedit.api.plugin.register("list",n)}(window),function(e,t){var n={savename:"",saveurl:"",params:[]};n.enable=function(){var e,t,r;ghostedit.api.save=function(){n.save()};if(ghostedit.options.save&&ghostedit.options.save.params){t=ghostedit.options.save.params;for(e=0;e<t.length;e++){if(typeof t[e]!="string")continue;r=t[e].split("=",2),r.length>1&&n.updateparameter(r[0],r[1])}}},n.save=function(){var e,t,r,i;t=ghostedit.api.exportHTML(),n.updateparameter("snippet",t.snippet),n.updateparameter("content",t.content),r=[];for(e=0;e<n.params.length;e++)r.push(n.params[e].name+"="+n.params[e].value);r=r.join("&"),i=function(e,t){var n;e&&t==="true"?ghostedit.event.trigger("ui:message",{message:"Page was successfully saved :)",time:1,color:"success"}):(n=t,ghostedit.event.trigger("ui:message",{message:n,time:1,color:"error"}))},ghostedit.util.ajax(ghostedit.options.save.url,"POST",r,i,"text")},n.updateparameter=function(e,t){var r;if(typeof e!="string"||typeof t!="string")return;e=e.replace(/[^A-Za-z\-_0-9]/g,""),t=encodeURIComponent(t);for(r=0;r<n.params.length;r++)if(n.params[r].name===e){n.params[r]={name:e,value:t};return}n.params.push({name:e,value:t})},ghostedit.api.plugin.register("save",n)}(window),function(){var e={aelem:!1,context:null,elemInEnglish:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",p:"Paragraph",div:"Generic Box",a:"Link",b:"Bold",strong:"Bold",i:"Italic",em:"Italic",u:"Underline",img:"Image",ul:"Bulletted list",ol:"Numbered list",li:"List Item",strike:"Strikethrough"},definition:{quickbuttons:[{label:"Save",icon:"save16.png",action:function(){ghostedit.api.save()}},{label:"Undo",icon:"undo16.png",action:function(){ghostedit.api.undo()}},{label:"Redo",icon:"redo16.png",action:function(){ghostedit.api.redo()}}],tabs:[{name:"textblock",label:"Format",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"bold",label:"Bold",icon:"format-bold.png",highlighttest:function(e){return e==="b"||e==="strong"},action:function(){ghostedit.api.format.bold()}},{type:"button",id:"italic",label:"Italic",icon:"format-italic.png",highlighttest:function(e){return e==="i"||e=="em"},action:function(){ghostedit.api.format.italic()}},{type:"button",id:"underline",label:"Underline",icon:"format-underline.png",highlighttest:function(e){return e==="u"},action:function(){ghostedit.api.format.underline()}},{type:"button",id:"strikethrough",label:"Strikethrough",icon:"format-strikethrough.png",highlighttest:function(e){return e==="strike"},action:function(){ghostedit.api.format.strikethrough()}},{type:"br"},{type:"button",id:"align-left",label:"Align Left",icon:"align-left.png",highlighttest:function(e,t,n){return n.style.textAlign==="left"||n.style.textAlign===""},action:function(){ghostedit.api.format.alignText("left")}},{type:"button",id:"align-center",label:"Align Center",icon:"align-center.png",highlighttest:function(e,t,n){return n.style.textAlign==="center"},action:function(){ghostedit.api.format.alignText("center")}},{type:"button",id:"align-right",label:"Align Right",icon:"align-right.png",highlighttest:function(e,t,n){return n.style.textAlign==="right"},action:function(){ghostedit.api.format.alignText("right")}},{type:"button",id:"align-justify",label:"Justify",icon:"align-justified.png",highlighttest:function(e,t,n){return n.style.textAlign==="justify"},action:function(){ghostedit.api.format.alignText("justify")}}]},{type:"seperator"},{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"list-unordered",label:"Bulleted List",icon:"list-unordered.png",action:function(){ghostedit.api.list.toggle("unordered")}},{type:"button",id:"list-ordered",label:"Numbered List",icon:"list-ordered.png",action:function(){ghostedit.api.list.toggle("ordered")}}]},{type:"seperator"},{type:"group",contents:[{type:"stylebox",label:"Paragraph",tagname:"p"},{type:"stylebox",label:"LeadPara",tagname:"p",classname:"LeadingParagraph"},{type:"stylebox",label:"Heading 1",tagname:"h1"},{type:"stylebox",label:"Heading 2",tagname:"h2"},{type:"stylebox",label:"Heading 3",tagname:"h3"}]}]},{name:"insert",label:"Insert",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"insert-link",label:"Insert Link",icon:"insert-link.png",action:function(){ghostedit.api.link.create()}},{type:"button",id:"insert-image",label:"Insert Image",icon:"insert-image.png",action:function(){ghostedit.api.image.insert()}}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"&#224;"},{type:"specialchar",character:"&#225;"},{type:"specialchar",character:"&#226;"},{type:"specialchar",character:"&#227;"},{type:"specialchar",character:"&#228;"},{type:"specialchar",character:"&#229;"},{type:"specialchar",character:"&#232;"},{type:"specialchar",character:"&#233;"},{type:"br"},{type:"specialchar",character:"&#234;"},{type:"specialchar",character:"&#235;"},{type:"specialchar",character:"&#236;"},{type:"specialchar",character:"&#237;"},{type:"specialchar",character:"&#238;"},{type:"specialchar",character:"&#239;"},{type:"specialchar",character:"&#242;"},{type:"specialchar",character:"&#243;"},{type:"br"},{type:"specialchar",character:"&#244;"},{type:"specialchar",character:"&#245;"},{type:"specialchar",character:"&#246;"},{type:"specialchar",character:"&#249;"},{type:"specialchar",character:"&#250;"},{type:"specialchar",character:"&#251;"},{type:"specialchar",character:"&#252;"}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"+"},{type:"specialchar",character:"&#8722;"},{type:"specialchar",character:"&#215;"},{type:"specialchar",character:"&#247;"},{type:"br"},{type:"specialchar",character:"&#8804;"},{type:"specialchar",character:"&#8805;"},{type:"specialchar",character:"&#177;"},{type:"specialchar",character:"&#8801;"},{type:"br"},{type:"specialchar",character:"&#189;"},{type:"specialchar",character:"&#188;"},{type:"specialchar",character:"&#190;"},{type:"specialchar",character:"&#960;"}]}]},{name:"save",label:"Save",enabled:!0,contents:[{type:"group",contents:[{type:"textfield",label:"Page Name",onkeyup:function(){ghostedit.plugins.save.updateparameter("name",this.value)}}]},{type:"group",contents:[{type:"textfield",label:"Page Url Slug",onkeyup:function(){ghostedit.plugins.save.updateparameter("url",this.value)}}]},{type:"group",contents:[{type:"button",id:"save",label:"Save",icon:"save.png",action:function(){ghostedit.api.save()}}]},{type:"seperator"},{type:"group",contents:[{type:"button",id:"about",label:"About GhostEdit & credits",icon:"about.png",action:function(){ghostedit.api.defaultui.showabout()}}]}]},{name:"link",label:"Link",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"linkurl",label:"Link URL",onkeyup:function(){ghostedit.api.link.updateurl(this.value)}}]},{type:"group",contents:[{type:"button",label:"Open link in new tab",icon:"openlink.png",action:function(){ghostedit.api.link.open()}}]}]},{name:"image",label:"Image",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"imagealttext",label:"Description / Alt text",onkeyup:function(){ghostedit.api.image.updatealttext(this.value)}}]}]}]}};e.el={},e.enable=function(){ghostedit.event.trigger("ui:replace"),ghostedit.event.addListener("ui:update",function(){e.update()},"defaultui"),ghostedit.event.addListener("ui:message",function(t){e.message.show(t)},"defaultui"),ghostedit.event.addListener("ui:replace",function(){ghostedit.api.plugin.disable("defaultui")},"defaultui"),ghostedit.event.addListener("ui:newcontext",function(t){if(!t.context)return;e.context&&!/textblock|format|insert|save/.test(e.context)&&e.toolbar.disabletab(e.context),typeof t.context=="string"&&(t.context=t.context.replace("textblock","textblock")),e.context=t.context;if(t.context==="image"&&ghostedit.selection.type==="image"){var n=ghostedit.selection.data;document.getElementById("ghostedit_toolbar_imagealttext").value=n.alt}e.toolbar.showtab(t.context)},"defaultui"),ghostedit.options.defaultui||(ghostedit.options.defaultui={}),ghostedit.options.defaultui.statusbar||(ghostedit.options.defaultui.statusbar=!0),ghostedit.options.defaultui.wordcount||(ghostedit.options.defaultui.wordcount=!0);var t,n,r,i,s,o,u,a,f,l,c;t=e.definition,n=document.createElement("div"),n.id="ghostedit_defaultui_toolbar",n.className="ghostedit_defaultui_toolbar",e.el.toolbar=n,u=document.createElement("div"),u.id="ghostedit_defaultui_messagearea",u.className="ghostedit_defaultui_messagearea",u.innerHTML="&nbsp;",n.appendChild(u),e.el.messagearea=u,r=document.createElement("div"),r.id="ghostedit_defaultui_quickbutton_insertanchor",r.style.cssText="float: left; position: relative; width: 3px;height: 16px",n.insertBefore(r,u),e.el.qbanchor=r;if(t.quickbuttons)for(f=0;f<t.quickbuttons.length;f++)e.toolbar.insert.quickbutton(t.quickbuttons[f]);s=r=document.createElement("div"),s.id="ghostedit_defaultui_tabselect",s.style.cssText="position: absolute;width: 100%;left: 0; bottom: -1px; height: 1px; line-height: 1px; font-size: 1px; background-color: #FFF",e.el.tabselect=s;if(t.tabs)for(f=0;f<t.tabs.length;f++)e.toolbar.insert.tab(t.tabs[f]);ghostedit.wrapdiv.insertBefore(n,ghostedit.wrapdiv.firstChild),ghostedit.util.addEvent(e.el.toolbar,"mouseup",function(t){e.toolbar.event.click(t)}),ghostedit.util.addEvent(e.el.toolbar,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(e.el.toolbar,"mousedown",function(e){ghostedit.util.preventBubble(e)});var h=document.createElement("div");h.id="ghostedit_defaultui_statusbar",h.className="ghostedit_defaultui_statusbar",h.innerHTML="<b>Path:</b>",ghostedit.wrapdiv.appendChild(h),e.el.statusbar=h,l=document.createElement("div"),l.id="ghostedit_defaultui_modal",l.className="ghostedit_defaultui_modal",ghostedit.wrapdiv.appendChild(l),e.el.modal=l,c=document.createElement("div"),c.id="ghostedit_defaultui_modalbg",c.className="ghostedit_defaultui_modalbg",ghostedit.util.addEvent(c,"click",function(){e.modal.hide()}),ghostedit.wrapdiv.appendChild(c),e.el.modalbg=c,e.toolbar.showtab("textblock")},e.disable=function(){ghostedit.event.removeAllListeners("defaultui"),ghostedit.wrapdiv.removeChild(e.el.toolbar),ghostedit.wrapdiv.removeChild(e.el.statusbar),ghostedit.wrapdiv.removeChild(e.el.modal),ghostedit.wrapdiv.removeChild(e.el.modalbg),e.toolbar.quickbuttons=[],e.toolbar.tabs=[],e.toolbar.enabledtabs=[],e.toolbar.panels=[]},e.update=function(){var t,n=!1,r,i,s,o,u,a,f,l="",c="N/A",h,p;p=e.toolbar.highlightmap;for(r=0;r<p.length;r++)ghostedit.util.removeClass(p[r].element,"current");for(r=0;r<ghostedit.selection.nodepath.length;r++){u=ghostedit.selection.nodepath[r],a=u.tagName.toLowerCase(),f=ghostedit.util.trim(u.className),console.log();for(i=0;i<p.length;i++)p[i].test.call(p[i].data,a,f,u)&&ghostedit.util.addClass(p[i].element,"current");r!==ghostedit.selection.nodepath.length-1&&(l=" > "+(e.elemInEnglish[u.tagName.toLowerCase()]||u.tagName.toUpperCase())+l)}e.el.statusbar.innerHTML="<b>Path</b>"+l,ghostedit.options.defaultui.wordcount&&(h=ghostedit.util.trim(ghostedit.editdiv.innerText||ghostedit.editdiv.textContent),c=h.split(/\s+/).length,e.el.statusbar.innerHTML+="<div style='position: absolute; right: 10px; top: 3px'>"+c+" words</div>")},e.modal={show:function(t){var n,r,i;n=e.el.modal,r=e.el.modalbg,n.innerHTML=t,i=document.createElement("a"),i.className="ghostedit_defaultui_modal_closebutton",i.innerHTML="&#215",ghostedit.util.addEvent(i,"click",e.modal.hide),n.appendChild(i),n.style.display="block",r.style.display="block"},hide:function(){var t,n;t=e.el.modal,n=e.el.modalbg,t.style.display="none",n.style.display="none",t.innerHTML="",ghostedit.selection.restore()},showabout:function(){e.modal.show("<h2>About GhostEdit</h2><p>GhostEdit is a WYSIWYG editor based on the concept that the editor should be transparent to use - i.e. you do no notice that you are using it. This manifests itself in two ways:</p><ul><li>GhostEdit has an incredibly simple user interface, which is designed for maximum usability</li><li>GhostEdit restricts input to known, safe content so as to be as reliable as possible</li></ul><h3>Credits</h3>GhostEdit was designed and coded by <a href='http://nicoburns.com'>Nico Burns</a>.<br />Icons licensed from <a href='http://www.gentleface.com/free_icon_set.html'>Gentleface</a> under a <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/'>CC BY-NC-ND 3.0</a> liscense.<br />version: "+ghostedit.version)}},e.message={div:"",show:function(t){msg=t.message,time=t.time,color=t.color;var n=document.getElementById("ghostedit_defaultui_messagearea");n.innerHTML=msg,color=color=="success"?"#bbff00":color,color=color=="error"?"#ff4949":color,color=color=="warn"?"#ffef49":color,n.style.backgroundColor=color,n.style.opacity=1,n.filters&&(n.filters.item(0).enabled=1),time!=0&&(clearTimeout(e.message.timer),e.message.timer=setTimeout(function(){e.message.clear()},time*1e3))},clear:function(){var t=document.getElementById("ghostedit_defaultui_messagearea");t.style.opacity>.1?(t.style.opacity=t.style.opacity-.05,t.filters&&(t.filters.item(0).Opacity=t.style.opacity*100),setTimeout(function(){e.message.clear()},20)):(t.innerHTML="&nbsp;",t.style.backgroundColor="transparent",t.opacity="1",t.filters&&(t.filters.item(0).Opacity=100))}},e.toolbar={div:"",quickbuttons:[],tabs:[],enabledtabs:["format","insert","save"],panels:[],styleboxes:[],highlightmap:[],event:{click:function(e){ghostedit.event.allowtoolbarclick||ghostedit.util.cancelAllEvents(e)}},clicktab:function(e){var t,n,r,i,s;typeof e=="string"&&(e=document.getElementById("ghostedit_defaultui_toolbartab_"+e.replace("ghostedit_defaultui_toolbartab_",""))),n=e.id.replace("ghostedit_defaultui_toolbartab_",""),t=document.getElementById("ghostedit_defaultui_toolbarpanel_"+n),ghostedit.selection.restore(),ghostedit.event.trigger("ui:newcontext",{context:n})},showtab:function(t){var n,r,i,s,o;typeof t=="string"&&(t=document.getElementById("ghostedit_defaultui_toolbartab_"+t.replace("ghostedit_defaultui_toolbartab_",""))),r=t.id.replace("ghostedit_defaultui_toolbartab_",""),n=document.getElementById("ghostedit_defaultui_toolbarpanel_"+r),i=e.el.toolbar.childNodes;for(s=0;s<i.length;s+=1)o=i[s],o.nodeType===1&&(/tab/.test(o.className)||/panel/.test(o.className))&&ghostedit.util.removeClass(o,"active");e.toolbar.enabledtabs[r]||e.toolbar.enabletab(r),ghostedit.util.addClass(t,"active"),ghostedit.util.addClass(n,"active"),t.appendChild(e.el.tabselect)},enabletab:function(t){var n,r;n=document.getElementById("ghostedit_defaultui_toolbartab_"+t),ghostedit.util.addClass(n,"enabled"),e.toolbar.enabledtabs.push(t)},disabletab:function(t){var n,r;n=document.getElementById("ghostedit_defaultui_toolbartab_"+t),ghostedit.util.removeClass(n,"enabled"),delete e.toolbar.enabledtabs[t]},insert:{quickbutton:function(t){var n;if(!t||!t.label||!t.icon||!ghostedit.util.isFunction(t.action))return!1;button=document.createElement("img"),button.className="ghostedit_defaultui_quickbutton",button.src=ghostedit.options.imageurl+"/defaultui/"+t.icon,button.title=t.label,button.alt=t.label,e.el.toolbar.insertBefore(button,e.el.qbanchor),e.toolbar.quickbuttons.push(button),button.onclick=t.action},tab:function(t){var n,r,i;n=document.createElement("div"),n.className=t.enabled?"ghostedit_defaultui_toolbartab enabled":"ghostedit_defaultui_toolbartab",n.id="ghostedit_defaultui_toolbartab_"+t.name,n.innerHTML=t.label,r=document.createElement("div"),ghostedit.util.addClass(r,"ghostedit_defaultui_toolbarpanel"),r.id="ghostedit_defaultui_toolbarpanel_"+t.name;if(t.contents)for(i=0;i<t.contents.length;i++)switch(t.contents[i].type){case"group":e.toolbar.insert.panelgroup(r,t.contents[i]);break;case"seperator":e.toolbar.insert.panelseperator(r)}e.el.toolbar.insertBefore(n,e.el.messagearea),e.el.toolbar.appendChild(r),e.toolbar.tabs.push(n),n.onclick=function(){e.toolbar.clicktab(this)}},panelseperator:function(e){var t;t=document.createElement("span"),t.className="ghostedit_defaultui_toolbarseperator",t.style.backgroundImage="URL("+ghostedit.options.imageurl+"/defaultui/toolbar_seperator.png)",e.appendChild(t)},panelgroup:function(t,n){var r,i;r=document.createElement("span"),r.className="ghostedit_defaultui_toolbarpanelgroup",n.style&&(r.style.cssTet=n.style);if(n.contents)for(i=0;i<n.contents.length;i++)switch(n.contents[i].type){case"button":e.toolbar.insert.button(r,n.contents[i]);break;case"stylebox":e.toolbar.insert.stylebox(r,n.contents[i]);break;case"specialchar":e.toolbar.insert.specialchar(r,n.contents[i]);break;case"textfield":e.toolbar.insert.textfield(r,n.contents[i]);break;case"br":r.appendChild(document.createElement("br"))}t.appendChild(r)},button:function(t,n){var r,i;r=document.createElement("img"),r.src=ghostedit.options.imageurl+"/defaultui/"+n.icon,r.title=n.label,r.alt=n.label,n.style&&(r.style.cssText=n.style),t.appendChild(r),n.highlighttest&&e.toolbar.highlightmap.push({element:r,test:n.highlighttest}),ghostedit.util.addEvent(r,"click",n.action)},specialchar:function(e,t){var n,r;n=document.createElement("a"),n.className="ghostedit_defaultui_specialchar",n.title="Insert Character",n.alt="Insert Character",n.innerHTML=t.character,e.appendChild(n),n.onclick=function(){ghostedit.api.insert.character(this)}},textfield:function(e,t){var n;n=document.createElement("input"),t.id&&(n.id="ghostedit_defaultui_textfield_"+t.id),n.style.width=t.width?t.width:"200px",t.label&&(e.innerHTML+=t.label+"<br />"),e.appendChild(n),ghostedit.util.addEvent(n,"click",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keypress",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keydown",function(e){ghostedit.util.preventBubble(e)}),ghostedit.util.addEvent(n,"keyup",t.onkeyup)},stylebox:function(t,n){var r,i;r=document.createElement("div"),r.className="ghostedit_defaultui_stylebox",r.id="ghostedit_defaultui_stylebox_"+n.tagname,n.classname&&(r.id=r.id+"_"+n.classname),r.innerHTML="<"+n.tagname+" class='ghostedit_defaultui_stylebox_preview'>AaBbCc</"+n.tagname+">",r.title=n.label,r.alt=n.label,i=document.createElement("div"),i.className="ghostedit_defaultui_stylebox_label",i.innerHTML=n.label,r.appendChild(i),t.appendChild(r),e.toolbar.styleboxes.push(r),e.toolbar.highlightmap.push({element:r,data:{tagname:n.tagname,classname:n.classname!==undefined?n.classname:""},test:function(e,t,n){return e===this.tagname&&t===this.classname}}),r.onclick=function(){ghostedit.api.format.setStyle(n.tagname,n.classname)}}}},ghostedit.api.plugin.register("defaultui",e)}();