/*! GhostEdit WYSIWYG editor Copyright (c) 2010-2012 Nico Burns

Description:       An open source JavaScript WYSIWYG editor focused on usability
Homepage:          http://ghosted.it
License:           LGPL
Author:            Nico Burns <nico@nicoburns.com>
Version:           1.0rc1-pre
Release Date:      2012-12-18
Browser Support:   Internet Explorer 6+, Mozilla Firefox 3.6+, Google Chrome, Apple Safari (latest), Opera (latest)
*/
(function(e,t){var n={version:"1.0rc1",enabledplugins:[],uicontext:"",active:!1,isEditing:!0,blockElemId:0,editorchrome:null,debug:!1};n.api={},n.plugins={},e.ghostedit=n})(window),function(e,t){var n={},r,i,s=e.lasso,o=e.ghostedit;n.init=function(){n.paste.init(),n.cut.init()},r={savedcontent:null,savedundodata:null,savedundopoint:null,beforerangedata:"",afterrangedata:"",waitlength:0,postpastetidylist:[]},r.init=function(){o.event.addListener("init:after",function(){o.util.addEvent(o.editdiv,"paste",function(e){r.handle(e)})},"clipboard")},r.handle=function(e){return o.history.saveUndoState(),r.savedundodata=o.history.undoData,r.savedundopoint=o.history.undoPoint,r.triedpasteimage=!1,e.clipboardData&&e.clipboardData.getData?(/image/.test(e.clipboardData.types)&&(r.triedpasteimage=!0),/text\/html/.test(e.clipboardData.types)?o.editdiv.innerHTML=e.clipboardData.getData("text/html"):/text\/plain/.test(e.clipboardData.types)?o.editdiv.innerHTML=e.clipboardData.getData("text/plain").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):o.editdiv.innerHTML="",r.waitfordata(),o.util.cancelEvent(e)):(o.editdiv.innerHTML="",r.waitfordata(),!0)},r.waitfordata=function(){var e=o.editdiv;e.childNodes&&e.childNodes.length>0?r.process():setTimeout(r.waitfordata,20)},r.process=function(){var e,t,n,i,u,a,f,l;e=document.createElement("div"),console.log("raw paste content"),console.log(o.editdiv.cloneNode(!0)),e=o.plugins.container.inout.importHTML(o.editdiv),console.log("processed content"),console.log(e.innerHTML),o.history.undoData=r.savedundodata,o.history.undoPoint=r.savedundopoint,o.history.restoreUndoPoint(o.history.undoPoint),console.log(o.selection.saved),o.selection.deleteContents(),o.selection.save(),console.log(e),f=o.dom.getFirstChildGhostBlock(e);if(!f)return;o.selection.saved.data.isCollapsed()?(t=!0,o.selection.saved.data.saveToDOM("ghostedit_paste_start")):(t=!1,o.selection.saved.data.clone().collapseToStart().saveToDOM("ghostedit_paste_start"),o.selection.saved.data.clone().collapseToEnd().saveToDOM("ghostedit_paste_end")),console.log("test--------------------------------"),a=!1,r.trycounter=0,o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),u=o.selection.saved.data.getParentNode(),o.dom.isGhostBlock(u)||(u=o.dom.getParentGhostBlock(u));while(!a){if(!u){n=!1;break}i=u.getAttribute("data-ghostedit-handler");if(!o.plugins[i]||!o.plugins[i].paste)break;l={isfirst:!0,islast:o.dom.getFirstChildGhostBlock(e)===f?!0:!1,collapsed:t},console.log("Call handler: (first)"+i),console.log(f),a=o.plugins[i].paste.handle(u,f,l),console.log("result: "+a);if(a){n=!0,f.parentNode.removeChild(f);break}a||(u=o.dom.getParentGhostBlock(u)),o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1)}f=o.dom.getLastChildGhostBlock(e);if(f&&(t===!1||n===!1)){r.trycounter=0,a=!1,o.selection.saved.data.isSavedRange("ghostedit_paste_end")?o.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),u=o.selection.saved.data.getParentNode(),o.dom.isGhostBlock(u)||(u=o.dom.getParentGhostBlock(u));while(!a){if(!u)break;i=u.getAttribute("data-ghostedit-handler");if(!o.plugins[i]||!o.plugins[i].paste)break;console.log("Call handler (last): "+i),console.log(f),a=o.plugins[i].paste.handle(u,f,{isfirst:!1,islast:!0,collapsed:t}),console.log("result: "+a);if(a){f.parentNode.removeChild(f);break}a||(u=o.dom.getParentGhostBlock(u)),o.selection.saved.data.isSavedRange("ghostedit_paste_end")?o.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!1):o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1);if(r.trycounter++>20)return}}console.log(e),f=o.dom.getFirstChildGhostBlock(e),r.trycounter=0;while(f){a=!1;while(!a){o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!1),s().isSavedRange("ghostedit_paste_end")&&o.selection.saved.data.setEndToRangeEnd(s().restoreFromDOM("ghostedit_paste_end",!1)),o.selection.saved.data.select(),u=o.selection.saved.data.getParentNode(),o.dom.isGhostBlock(u)||(u=o.dom.getParentGhostBlock(u));if(!u)break;i=u.getAttribute("data-ghostedit-handler");if(!o.plugins[i]||!o.plugins[i].paste)break;console.log("Call handler: "+i),console.log(f),a=o.plugins[i].paste.handle(u,f,{isfirst:!1,islast:!1,collapsed:t}),console.log("result: "+a);if(r.trycounter++>20)return}f=o.dom.getNextSiblingGhostBlock(f)}o.selection.saved.data.restoreFromDOM("ghostedit_paste_start",!0).select(),o.selection.saved.data.isSavedRange("ghostedit_paste_end")&&o.selection.saved.data.restoreFromDOM("ghostedit_paste_end",!0).select(),o.selection.save(),o.history.undoData=r.savedundodata,o.history.undoPoint=r.savedundopoint,o.history.saveUndoState(),r.triedpasteimage&&o.event.trigger("ui:message",{message:"You cannot paste images into the editor, please use the add image button instead",time:2,color:"warn"}),o.event.trigger("clipboard:paste:after")},i={savedcontent:null,savedundodata:null,savedundopoint:null},i.init=function(){o.event.addListener("init:after",function(){o.util.addEvent(o.editdiv,"cut",function(e){i.handle(e)})},"clipboard")},i.handle=function(){return o.history.saveUndoState(),i.savedundodata=o.history.undoData,i.savedundopoint=o.history.undoPoint,setTimeout(i.cleanup,20),!0},i.cleanup=function(){o.history.undoData=i.savedundodata,o.history.undoPoint=i.savedundopoint,o.history.restoreUndoPoint(o.history.undoPoint),o.selection.deleteContents(),o.selection.save(),o.history.saveUndoState()},n.paste=r,n.cut=i,e.ghostedit.clipboard=n}(window),function(e,t){var n={},r=e.lasso,i=e.ghostedit;n.enable=function(){return!0},n.dom={addchild:function(e,t,n,r){return t==="before"?e.insertBefore(r,n):n.nextSibling!==null?e.insertBefore(r,n.nextSibling):e.appendChild(r),!0},removechild:function(e,t){return!e||!t?!1:(e.removeChild(t),!0)}},n.selection={deleteContents:function(e,t){var n,s,o,u,a,f=!1,l=!1,c,h,p,d,v,m,g,y,b;if(i.selection.saved.type!=="textblock")return!1;y=i.selection.saved.data,m=e.childNodes,s=i.dom.getFirstChildGhostBlock(e),o=i.dom.getLastChildGhostBlock(e),u=r().setCaretToStart(s),a=r().setCaretToEnd(o),y.compareEndPoints("StartToStart",u)!==1?(f=!0,c=s):(c=y.getStartNode(),i.dom.isGhostBlock(c)||(c=i.dom.getParentGhostBlock(c))),y.compareEndPoints("EndToEnd",a)!==-1?(l=!0,h=o):(h=y.getEndNode(),i.dom.isGhostBlock(h)||(h=i.dom.getParentGhostBlock(h))),d=c;while(!i.dom.isChildGhostBlock(d,e))d=i.dom.getParentGhostBlock(d);v=h;while(!i.dom.isChildGhostBlock(v,e))v=i.dom.getParentGhostBlock(v);g=!1;for(n=0;n<m.length;n+=1){p=m[n];if(!i.dom.isGhostBlock(p))continue;b=p.getAttribute("data-ghostedit-handler");if(p.id===d.id){i.plugins[b].selection.deleteContents(p),g=!0;continue}if(p.id===v.id){i.plugins[b].selection.deleteContents(p),g=!1;break}g&&(e.removeChild(m[n]),n--)}return d.getAttribute("data-ghostedit-elemtype")===v.getAttribute("data-ghostedit-elemtype")&&(i.plugins[d.getAttribute("data-ghostedit-elemtype")].merge(d,v,t),i.dom.getParentGhostBlock(v)||r().setToSelection().collapseToStart().select()),i.dom.getFirstChildGhostBlock(e)||e.appendChild(i.textblock.create("p")),!0}},n.inout={importHTML:function(e){var t,r,s,o,u,a;if(!e||e.childNodes.length<1)return!1;t=n.create();for(s=0;s<e.childNodes.length;s+=1){u=e.childNodes[s];if(u.nodeType!==1&&u.nodeType!==3)continue;a=u.nodeType===3?"#textnode":u.tagName.toLowerCase(),i.inout.importhandlers[a]?(r=i.inout.importhandlers[a].call(this,u),r&&i.dom.isGhostBlock(r)&&t.appendChild(r)):u.childNodes.length>0&&(o=u.childNodes.length,u.parentNode.insertBefore(i.dom.extractContent(u),u),u.parentNode.removeChild(u),s-=1)}return i.dom.getFirstChildGhostBlock(t)||t.appendChild(i.plugins.textblock.create("p")),t},exportHTML:function(e){if(!e||!i.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="container")return!1;var t=0,n,r,s="",o=0,u,a;for(t=0;t<e.childNodes.length;t+=1){n=i.dom.isGhostBlock(e.childNodes[t])?e.childNodes[t]:!1;if(!n)continue;a=n.getAttribute("data-ghostedit-handler");if(!a||!i.plugins[a])continue;r=i.plugins[a].inout.exportHTML(n),r&&(s+=r.content,o++),o<=3&&(u=s)}return{content:s,snippet:u}}},n.paste={handle:function(e,t,s){var o,u,a,f;if(!i.dom.isGhostBlock(e)||!i.dom.isGhostBlock(t))return!0;if(s.isfirst||s.islast)return!1;o=i.selection.saved.data,u=o.clone().collapseToStart().getParentElement(),o.saveToDOM("ghostedit_paste_start"),u===e&&(f=document.getElementById("ghostedit_paste_start_range_start"),u=i.dom.getPreviousSiblingGhostBlock(f)||f);while(u.parentNode!==e){u=u.parentNode;if(u===null||!u.parentNode)return!0}return a=t.cloneNode(!0),r().removeDOMmarkers("ghostedit_paste_start"),a.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t3'>&#x200b;</span>",n.dom.addchild(e,"after",u,a),f&&f.parentNode&&f.parentNode.removeChild(f),!0}},n.isChildGhostBlock=function(e,n){var r;if(!e)return!1;if(e.nodeType!==1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;for(r=0;r<n.length;r+=1)if(e===n[r])return!0;return!1},n.create=function(){var e;return e=document.createElement("div"),i.blockElemId+=1,e.id="ghostedit_container_"+i.blockElemId,e.setAttribute("data-ghostedit-iselem","true"),e.setAttribute("data-ghostedit-elemtype","container"),e.setAttribute("data-ghostedit-handler","container"),e},n.focus=function(e){var t,n;return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="container"?!1:(t=i.dom.getFirstChildGhostBlock(e),t?(n=t.getAttribute("data-ghostedit-handler"),i.plugins[n].focus(t),!0):!1)},i.api.plugin.register("container",n)}(window),function(e,t){var n={};n.getNodeOffset=function(e){var t,n;if(!e||!e.parentNode)return;t=0,n=e.parentNode.childNodes;while(n[t]!==e)t+=1;return t},n.extractContent=function(e){var t=document.createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t},n.cloneContent=function(e){var t,n,r=document.createDocumentFragment();for(n=0;n<e.childNodes.length;n++)t=e.childNodes[n],r.appendChild(t.cloneNode(!0));return r},n.parse=function(e,r){var i=!1,s,o,u,a,f,l,c,h,p,d;if(!e||!r||!e.nodeType)return!1;r.textnode=r.textnode||{},r.tags=r.tags||{};if(e.nodeType===3)return l=r.textnode.clean?e.nodeValue.replace(/[\n\r\t]/g,""):e.nodeValue,l.length>0?document.createTextNode(l):!1;if(e.nodeType!==1)return!1;c=e.tagName.toLowerCase(),h={contentsonly:!0};if(r.tags[c]){h=r.tags[c],typeof h.template=="string"&&(h=h.template),typeof h=="string"&&r.templates[h]&&(h=r.templates[h]);if(typeof h=="string")return!1}i=h.contentsonly?document.createDocumentFragment():document.createElement(e.tagName.toLowerCase());if(!h.ignorechildren){s=e.childNodes;for(u=0;u<s.length;u++)o=n.parse(s[u],r),o&&i.appendChild(o)}if(h.contentsonly)return i.childNodes.length>0?i:!1;if(h.attributes)for(u=0;u<h.attributes.length;u++){p=h.attributes[u],typeof p=="string"&&(p={name:p});if(typeof p.name!="string")break;f=p.value||p.name==="class"?e.className:e.getAttribute(p.name);if(f===t)break;p.copy=!0;if(p.allowedvalues){p.copy=!1;for(a=0;a<p.allowedvalues.length;a++)if(p.allowedvalues[u]===f){p.copy=!0;break}}p.copy&&(p.name==="class"?i.className=f:i.setAttribute(p.name,f))}if(h.styles)for(u=0;u<h.styles.length;u++){d=h.styles[u],typeof d=="string"&&(d={name:d});if(typeof d.name!="string")break;d.name==="float"&&(d.name=e.style.cssFloat?"cssFloat":"styleFloat"),f=d.value||e.style[d.name];if(f===t)break;d.copy=!0;if(d.allowedvalues){d.copy=!1;for(a=0;a<d.allowedvalues.length;a++)if(d.allowedvalues[a]===f){d.copy=!0;break}}d.copy&&(i.style[d.name]=f)}return i},n.isGhostBlock=function(e){if(!e||!e.nodeType||e.nodeType!==1)return!1;var n=e.getAttribute("data-ghostedit-elemtype");return n!==t&&n!==!1&&n!==null?!0:!1},n.isChildGhostBlock=function(e,n){var r;if(!e||!n||!n.childNodes)return!1;if(e.nodeType!==1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===t)return!1;if(e.getAttribute("data-ghostedit-elemtype")===!1)return!1;if(e.getAttribute("data-ghostedit-elemtype")===null)return!1;var i=n.childNodes;for(r=0;r<i.length;r+=1)if(e===i[r])return!0;return!1},n.isGhostToplevel=function(e){return e&&e.getAttribute("data-ghostedit-isrootnode")===!0?!0:!1},n.getParentGhostBlock=function(e){if(!e)return!1;do{e=e.parentNode;if(e===null)return!1}while(!n.isGhostBlock(e));return e},n.getFirstChildGhostBlock=function(e){var t,r;if(!e||!e.childNodes)return!1;t=e.childNodes;for(r=0;r<t.length;r+=1)if(n.isGhostBlock(t[r]))return t[r];return!1},n.getLastChildGhostBlock=function(e){var t,r;if(!e||!e.childNodes)return!1;t=e.childNodes;for(r=t.length-1;r>=0;r-=1)if(n.isGhostBlock(t[r]))return t[r];return!1},n.getPreviousSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)-1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r-=1}while(r>=0);return!1},n.getNextSiblingGhostBlock=function(e){var t,r,i;if(!e||!e.parentNode)return!1;t=e.parentNode,r=n.getNodeOffset(e)+1,i=t.childNodes;do{if(n.isGhostBlock(i[r])===!0)return i[r];r+=1}while(r<i.length);return!1},n.getParentElement=function(e){if(e.nodeType!==1)while(e.nodeType!==1){e=e.parentNode;if(e===null)return null}return e},n.isDescendant=function(e,t){var n=t.parentNode;while(n!==null){if(n===e)return!0;n=n.parentNode}return!1},n.getFirstChildElement=function(e){var t,n;if(!e||!e.childNodes)return!1;t=e.childNodes;for(n=0;n<t.length;n+=1)if(t[n].nodeType===1)return t[n];return!1},n.getCertainParent=function(e,t){var n=[].slice.call(arguments);n.shift();if(!e.apply(this,n))while(!e.apply(this,n)){t=t.parentNode,n[0]=t;if(t===null)return!1}return t},e.ghostedit.dom=n}(window),function(e,t){var n={listeners:[],listenerid:0,eventtypes:[],cancelKeypress:!1},r=e.ghostedit;n.keydown=function(t,i){var s,o,u,a;r.selection.save(!1),i=(!i||!i.istest)&&e.event!==null?e.event:i,s=i.keyCode!==null?i.keyCode:i.charCode,n.trigger("input:keydown",{event:event,keycode:s});switch(s){case 8:case 46:n.cancelKeypress=!1;if(r.selection.savedRange.isCollapsed()===!1)return r.history.saveUndoState(),r.selection.deleteContents(s===8?"collapsetostart":"collapsetoend"),r.history.saveUndoState(),n.cancelKeypress=!0,r.util.cancelEvent(i);break;case 83:if(i.ctrlKey)return r.api.save(),r.util.cancelEvent(i);break;case 66:if(i.ctrlKey)return r.textblock.format.bold(),r.util.cancelEvent(i);break;case 73:if(i.ctrlKey&&!i.shiftKey)return r.textblock.format.italic(),r.util.cancelEvent(i);break;case 85:if(i.ctrlKey)return r.textblock.format.underline(),r.util.cancelEvent(i);break;case 90:if(i.ctrlKey)return r.history.undo(),r.util.cancelEvent(i);break;case 89:if(i.ctrlKey)return r.history.redo(),r.util.cancelEvent(i)}o=r.selection.getContainingGhostBlock();for(;;){u=o.getAttribute("data-ghostedit-handler");if(r.plugins[u]&&r.plugins[u].event&&r.plugins[u].event.keydown){a=r.plugins[u].event.keydown(o,s,event);if(a===!0)break}o=r.dom.getParentGhostBlock(o);if(!o)break}return r.selection.save(),!0},n.keypress=function(i,s){var o,u,a,f,l,c;r.selection.save(),l=r.editdiv.innerHTML.length,c=r.history.undoData[r.history.undoPoint]!==t?r.history.undoData[r.history.undoPoint].content.string.length:0,s=(!s||!s.istest)&&e.event!==null?e.event:s,o=s.keyCode!==null?s.keyCode:s.charCode,n.trigger("input:keydown",{event:event,keycode:o}),r.selection.saved.type!=="none"&&!r.selection.savedRange.isCollapsed()&&!s.ctrlKey&&r.selection.deleteContents("collapsetostart");switch(o){case 8:if(n.cancelKeypress===!0)return n.cancelKeypress=!1,r.util.cancelEvent(s);break;case 13:r.util.cancelEvent(s)}u=r.selection.getContainingGhostBlock();for(;;){a=u.getAttribute("data-ghostedit-handler");if(r.plugins[a]&&r.plugins[a].event&&r.plugins[a].event.keypress){f=r.plugins[a].event.keypress(u,o,event);if(f===!0)break}u=r.dom.getParentGhostBlock(u);if(!u)break}return r.selection.save(),!0},n.addListener=function(e,t,r){var i,s,o,u;if(typeof t!="function")return!1;i=n.listeners;if(!i[e]||typeof i[e]!="object"||!(i[e]instanceof Array))i[e]=[];s=n.eventtypes,o=!0;for(u=0;u<s.length;u++)if(s[u]===e){o=!1;break}return o&&s.push(e),n.listenerid++,i[e].push({id:n.listenerid,callback:t,revokekey:r}),n.listenerid},n.removeListener=function(e,t){var r=n.listeners,i,s=[];if(!r[e])return;for(i=0;i<r[e].length;i++)r[e].id!==t&&s.push(r[e][i]);r[e]=s},n.removeAllListeners=function(e){var t,i,s,o,u,a=[];if(!e)return;t=n.listeners,i=n.eventtypes;for(o=0;o<i.length;o++){s=i[o];for(u=0;u<t[s].length;u++)(!t[s][u].revokekey||t[s][u].revokekey!==e)&&a.push(t[s][u]);t[s]=r.util.cloneObject(a),a=[]}},n.trigger=function(i,s){var o=n.listeners,u;s===t&&(s={});if(!o[i]||typeof o[i]!="object"||!(o[i]instanceof Array))return;r.debug&&(e.console.log(i),e.console.log(s));for(u=0;u<o[i].length;u++)o[i][u].callback.call(this,s)},n.sendBackwards=function(e,t,i){var s=!1,o,u,a;i||(i={});if(!r.dom.isGhostBlock(t))return!1;o=t;for(;;){if(s=r.dom.getPreviousSiblingGhostBlock(o))a="ahead";else if(s=r.dom.getParentGhostBlock(o))a="top";u=n.send(e,s,a,i);if(!u)return!1;if(u.handled===!0)return!0;o=s}},n.sendForwards=function(e,t,i){var s=!1,o,u,a;i||(i={});if(!r.dom.isGhostBlock(t))return!1;o=t;for(;;){if(s=r.dom.getNextSiblingGhostBlock(o))a="behind";else if(s=r.dom.getParentGhostBlock(o))a="bottom";u=n.send(e,s,a,i);if(!u)return!1;if(u.handled===!0)return!0;o=s}},n.send=function(e,t,n,i){var s,o;return console.log(e+" event"),console.log("direction:"+n),t?(s=t.getAttribute("data-ghostedit-handler"),console.log(s),!r.plugins[s]||!r.plugins[s].dom||!r.plugins[s].dom.deleteevent?!1:(o=r.plugins[s].dom.deleteevent(e,t,n,i),{handled:o})):!1},e.ghostedit.event=n}(window),function(e,t){var n={},r=e.ghostedit;n.init=function(){n.reset(),r.event.addListener("selection:change",function(){n.selectionchanged=!0}),r.api.undo=function(){return n.undo()},r.api.redo=function(){return n.redo()}},n.reset=function(){n.undoData=[],n.undoPoint=0,n.selectionchanged=!0},n.saveUndoState=function(e){var t,i,s,o,u,a,f=r.editdiv;e!==!0&&(e=!1),r.event.trigger("presaveundostate"),t=n.undoPoint,i=n.undoData,a=i[t],a||(e=!0),u={selection:{type:r.selection.saved.type,data:r.selection.saved.data},content:{string:f.innerHTML}},e||(s=a.content.string!==u.content.string?!0:!1,o=!r.selection.isSameAs(a.selection));if(e||o||s)u.content.dom=r.dom.extractContent(f.cloneNode(!0)),e||s?(t>0&&n.undoData.splice(0,t),n.undoData.unshift(u),n.undoPoint=0):n.undoData[t]=u;r.event.trigger("postsaveundostate")},n.restoreUndoPoint=function(e){var t=n.undoData,i=t[e];if(!i||i.content.string.length<1)return!1;r.editdiv.innerHTML="",r.editdiv.appendChild(r.dom.cloneContent(i.content.dom)),r.selection.restore(i.selection.type,i.selection.data),r.selection.save()},n.undo=function(){var e=n.undoPoint,i=n.undoData,s=r.editdiv;i[e+1]!==t&&i[e+1].content.string.length>0&&(r.event.trigger("history:undo:before"),i[e].content.string!==s.innerHTML?(n.saveUndoState(),e=1):(e===0&&n.saveUndoState(),e=n.undoPoint,e+=1),n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=i,r.event.trigger("history:undo:after"))},n.redo=function(){var e=n.undoPoint,i=n.undoData,s=r.editdiv;e>0&&i[e-1]!==t&&i[e-1].content.string.length>0&&(r.event.trigger("history:redo:before"),i[e].content.string!==s.innerHTML?n.saveUndoState(!0):(e-=1,n.restoreUndoPoint(e),n.undoPoint=e,n.undoData=i),r.event.trigger("history:redo:after"))},e.ghostedit.history=n}(window),function(e,t){e.ghostedit.init=function(t,n){typeof t=="string"&&(t=document.getElementById(t));var r,i,s=e.ghostedit,o,u,a,f;s.options={},s.options=n||{},s.options.debug&&(s.debug=!0),s.browserEngine=s.util.detectEngines(),s.useMozBr=s.browserEngine.gecko!==0||s.browserEngine.webkit!==0||s.browserEngine.opera!==0,t.style.display="none",s.sourceelem=t,o=document.createElement("div"),o.className="ghostedit_wrapper",t.parentNode.insertBefore(o,t),s.wrapdiv=o,u=document.createElement("div"),u.id="ghostedit_workspace",u.className="ghostedit_workspace",o.appendChild(u),s.workspace=u,a=document.createElement("div"),a.id="ghostedit_uilayer",a.className="ghostedit_uilayer",a.innerHTML="<span style='position: absolute; display: none;left: 0; top: 0;line-height: 0'>ie bug fix</span>",u.appendChild(a),s.contextuallayer=a,s.history.init(),s.inout.init(),s.clipboard.init(),s.options.plugins=s.options.plugins||[],s.options.plugins.unshift("container","textblock");if(s.options.plugins)for(r=0;r<s.options.plugins.length;r++)s.api.plugin.enable(s.options.plugins[r]);s.event.trigger("init"),s.editdiv=s.inout.importHTML(s.sourceelem),u.appendChild(s.editdiv),i=s.editdiv.getAttribute("data-ghostedit-handler"),s.plugins[i].focus(s.editdiv);try{document.execCommand("styleWithCSS",!1,!1)}catch(l){}try{document.execCommand("enableObjectResizing",!1,!1)}catch(l){}s.selection.save(),s.history.reset(),s.history.saveUndoState(),f=document.getElementsByTagName("html")[0],s.util.addEvent(f,"dragenter",s.util.cancelEvent),s.util.addEvent(f,"dragleave",s.util.cancelEvent),s.util.addEvent(f,"dragover",s.util.cancelEvent),s.util.addEvent(f,"drop",s.util.cancelEvent),s.util.addEvent(o,"click",function(e){s.util.preventBubble(e)}),s.util.addEvent(s.editdiv,"click",s.selection.save),s.util.addEvent(s.editdiv,"mouseup",s.selection.save),s.util.addEvent(s.editdiv,"keyup",s.selection.save),s.util.addEvent(s.editdiv,"keydown",function(e){s.event.keydown(this,e)}),s.util.addEvent(s.editdiv,"keypress",function(e){s.event.keypress(this,e)}),s.util.addEvent(s.editdiv,"dragenter",s.util.cancelEvent),s.util.addEvent(s.editdiv,"dragleave",s.util.cancelEvent),s.util.addEvent(s.editdiv,"dragover",s.util.cancelEvent),s.util.addEvent(s.editdiv,"drop",s.util.cancelEvent),s.editdiv.focus(),s.plugins.container.focus(s.editdiv),s.event.trigger("init:after")}}(window),function(e,t){var n={},r=e.ghostedit;n.init=function(){n.reset(),r.event.addListener("selection:change",function(){r.history.selectionchanged=!0}),r.api.importHTML=function(e){return n.importHTML(e)},r.api.exportHTML=function(){return n.exportHTML()}},n.reset=function(){n.importhandlers=[]},n.importHTML=function(e){var t;return!e||e.childNodes.length<1?!1:(t=r.plugins.container.inout.importHTML(e),t.className="ghostedit_editdiv",t.setAttribute("data-ghostedit-isrootnode","true"),t.contentEditable="true",r.event.trigger("import:after",{editdiv:t}),t)},n.exportHTML=function(){var e,t=r.editdiv;return r.event.trigger("export:before"),t.contentEditable=!1,e=r.plugins.container.inout.exportHTML(t,!1),t.contentEditable=!0,r.event.trigger("export:after"),e},n.openPreview=function(){e.open(r.options.previewurl)},n.registerimporthandler=function(e){var t,r,i;if(typeof e!="function")return!1;if(arguments.length<2)return!1;r=Array.prototype.slice.call(arguments),r.shift();for(t=0;t<r.length;t++)i=r[t],n.importhandlers[i]=e},e.ghostedit.inout=n}(window),function(e,t){var n={},r=e.ghostedit;n.register=function(e,t){return r.plugins[e]?!1:(r.plugins[e]=t,!0)},n.enable=function(e){if(!r.plugins[e])return!1;r.enabledplugins[e]&&n.disable(e);var t=r.plugins[e];typeof t.enable=="function"&&t.enable(),r.enabledplugins[e]=!0},n.disable=function(e){if(!r.enabledplugins[e]||!r.plugins[e])return!1;var t=r.plugins[e];typeof t.disable=="function"&&t.disable(),r.enabledplugins[e]=!1},e.ghostedit.api.plugin=n}(window),function(e,t){var n={savedRange:null,nodepath:[],saved:{type:"none",data:null},archived:{type:"none",data:null}},r=e.ghostedit,i=e.lasso;n.save=function(e){var t;return e!==!1&&(e=!0),t=i().setToSelection(),n.isInEditdiv(t.getStartNode())?(n.saved.type="textblock",n.saved.data=t,n.savedRange=n.saved.data,r.event.trigger("selection:change"),n.updatePathInfo(),e&&r.event.trigger("ui:update"),!0):(n.saved.type="none",!1)},n.set=function(e,t,i){i!==!1&&(i=!0);if(typeof e!="string")return;return n.saved.type=e,n.saved.data=t,n.savedRange=n.saved.data,n.updatePathInfo(),r.event.trigger("selection:change"),i&&r.event.trigger("ui:update"),!0},n.restore=function(e,t,i){if(!e||typeof e!="string")e=n.saved.type;t||(t=n.saved.data),e==="none"&&i&&(e=n.archived.type,t=n.archived.data);if(e==="none")return n.clear(),!0;if(r.plugins[e]&&r.plugins[e].selection.restore)return r.plugins[e].selection.restore(t)?!0:(n.clear(),!1)},n.restoreValid=function(e,t){return n.restore(e,t,!0)},n.deleteContents=function(e){e!=="collapsetostart"&&e!=="collapsetoend"&&(e=!1);var t,s,o;o=n.getContainingGhostBlock();for(;;){t=o.getAttribute("data-ghostedit-handler"),s=r.plugins[t].selection.deleteContents(o,e);if(s===!0)break;o=r.dom.getParentGhostBlock(o);if(!o)break}switch(e){case"collapsetostart":i().setToSelection().collapseToStart().select();break;case"collapsetoend":i().setToSelection().collapseToEnd().select()}n.save()},n.isSameAs=function(e){return!e||!e.type?!1:e.type!==n.saved.type?!1:e.type==="none"?!0:r.plugins[e.type]&&r.plugins[e.type].selection.compare?r.plugins[e.type].selection.compare(e.data,n.saved.data):!1},n.clear=function(){i().clearSelection(),n.saved={type:"none",data:null}},n.isInEditdiv=function(e){if(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!=="true")while(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!=="true"){if(e===null)return!1;e=e.parentNode;if(e===null)return!1}return!0},n.updatePathInfo=function(e){e||(e=n.saved.data),e.nodeType||(e=e.getParentNode()),n.nodepath=[];if(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!=="true")while(e.nodeType!==1||e.getAttribute("data-ghostedit-isrootnode")!=="true"){if(e===null)return null;e.nodeType===1&&n.nodepath.push(e),e=e.parentNode;if(e===null)return!1}e&&e.getAttribute("data-ghostedit-isrootnode")==="true"&&n.nodepath.push(e)},n.getContainingGhostBlock=function(){var e=n.saved.data;e.nodeType||(e=e.getParentNode());if(!e)return!1;while(!r.dom.isGhostBlock(e)){e=e.parentNode;if(e===null)return!1}return e},e.ghostedit.selection=n}(window),function(e,t){var n={},r=e.lasso,i=e.ghostedit;n.enable=function(){return n.format.init(),i.inout.registerimporthandler(n.inout.importHTML,"p","h1","h2","h3","h4","h5","h6"),i.inout.registerimporthandler(n.inout.importHTML,"#textnode","b","strong","i","em","u","strike","span"),i.event.addListener("postsaveundostate",function(){i.selection.saved.type==="textblock"&&i.selection.saved.data.bookmarkify(i.editdiv)}),i.event.addListener("postsaveundostate",function(){i.selection.saved.type==="textblock"&&(i.selection.saved.data=i.selection.saved.data.clone())}),i.api.insert=i.api.insert||{},i.api.insert.character=function(e){return n.insert.character(e)},i.api.insert.br=function(){return n.insert.br},!0},n.event={keydown:function(e,t,r){switch(t){case 8:return n.event.backspace(e,r);case 46:return n.event.deletekey(e,r)}},keypress:function(e,t,r){if(t===13)return n.event.enterkey(e,r)},backspace:function(e,t){if(n.selection.isAtStartOftextblock()!==!0)return!0;var r={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:i.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");i.plugins[n].dom.removechild(t,e)},!1,e)}};return i.event.sendBackwards("delete",e,r),i.event.cancelKeypress=!0,i.util.cancelEvent(t),!0},deletekey:function(e,t){return n.selection.isAtEndOftextblock()!==!0?!0:(i.event.sendForwards("delete",e),i.event.cancelKeypress=!0,i.util.cancelEvent(t),!0)},enterkey:function(e,t){return i.history.saveUndoState(),t.shiftKey?(n.format.insert.br(),n.mozBrs.tidy(e)):n.split(e),i.history.saveUndoState(!0),i.util.cancelEvent(t),!0}},n.dom={deleteevent:function(e,t,s){var o,u,a;switch(t){case"ahead":return i.history.saveUndoState(),n.isEmpty(e)?(o=i.dom.getParentGhostBlock(e),u=o.getAttribute("data-ghostedit-handler"),i.plugins[u].dom.removechild(o,e)):(e.innerHTML+="<span id='ghostedit_selection_marker'>&#x200b;</span>",s.merge&&s.merge.sourcecontent&&(s.merge.contenttype==="inlinehtml"||s.merge.contenttype==="text")&&(e.innerHTML+=s.merge.sourcecontent),n.mozBrs.tidy(e),s.merge.callback(),r().selectNode("ghostedit_selection_marker").select(),document.getElementById("ghostedit_selection_marker").parentNode.removeChild(document.getElementById("ghostedit_selection_marker")),i.selection.save()),i.history.saveUndoState(!0),!0;case"behind":return a=i.selection.getContainingGhostBlock(),s={merge:{contenttype:"inlinehtml",sourcecontent:e.innerHTML,callback:i.util.preparefunction(function(e){var t=e.parentNode,n=t.getAttribute("data-ghostedit-handler");i.plugins[n].dom.removechild(t,e)},!1,e)}},i.event.sendBackwards("delete",e,s),!0}}},n.selection={compare:function(e,t){return!e||!e.isEqualTo?!1:e.isEqualTo(t)},restore:function(e){return!e||!e.unbookmarkify?!1:(e.unbookmarkify(i.editdiv),e.select(),!0)},deleteContents:function(e){var t,n,s;return s=i.selection.savedRange.clone(),t=r().setCaretToStart(e),n=r().setCaretToEnd(e),s.compareEndPoints("StartToStart",t)===-1&&s.setStartToRangeStart(t),s.compareEndPoints("EndToEnd",n)===1&&s.setEndToRangeEnd(n),s.deleteContents(),!0},getTextBlockNode:function(e){if(e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="textblock")while(e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="textblock"){e=e.parentNode;if(e===null)return!1}return e},getStartTextBlockNode:function(){return n.selection.getTextBlockNode(i.selection.savedRange.getStartNode())},getEndTextBlockNode:function(){return n.selection.getTextBlockNode(i.selection.savedRange.getEndNode())},isAtStartOftextblock:function(){var e=!1,t,s,o,u,a,f,l,c;if(document.createRange){t=i.selection.savedRange,t.isCollapsed()&&t.getNative().startOffset===0&&(e=!0,c=i.selection.savedRange.getStartNode());if(!c)return e;while(c.nodeType!==1||c.getAttribute("data-ghostedit-elemtype")!=="textblock"){if(c!==c.parentNode.childNodes[0]){u=!1;if(c.parentNode.childNodes[0].nodeType===3&&c.parentNode.childNodes[0].length===0||c.parentNode.childNodes[0].nodeType===1&&c.parentNode.childNodes[0].className==="moz_dirty")for(o=1;o<c.parentNode.childNodes.length;o+=1){a=c.parentNode.childNodes[0];if(c===c.parentNode.childNodes[o]){u=!0;break}if((a.nodeType!==3||a.length!==0)&&(a.nodeType!==1||a.className!=="moz_dirty"))break}if(u!==!0){e=!1;break}}c=c.parentNode}}else document.selection&&(s=i.selection.savedRange.clone().bookmarkify(),f=n.selection.getStartTextBlockNode(),l=r().selectNodeContents(f),s.unbookmarkify(),l.getHTML()===l.setStartToRangeStart(s).getHTML()&&(e=!0),i.selection.savedRange=s.select());return e},isAtEndOftextblock:function(){var e=!1,t,s,o,u,a,f;return i.selection.savedRange.isCollapsed()?(a=n.selection.getEndTextBlockNode(),document.createRange?(o=document.createElement("div"),o.appendChild(i.selection.savedRange.getNative().cloneContents()),s=i.selection.savedRange.getNative(),s.setEnd(a,a.childNodes.length),u=document.createElement("div"),o.appendChild(s.cloneContents()),n.mozBrs.clear(o),n.mozBrs.clear(u),o.innerHTML===u.innerHTML&&(e=!0)):document.selection&&(t=i.selection.savedRange.clone().bookmarkify(),a.innerHTML+='<span id="range_marker">&#x200b;</span>',f=r().selectNode("range_marker"),document.getElementById("range_marker").parentNode.removeChild(document.getElementById("range_marker")),t.unbookmarkify(),t.compareEndPoints("EndToEnd",f)===0&&(e=!0),i.selection.savedRange=t.select()),e):!1},extendtoword:function(e,t){var i,s;e=e.clone().getNative();if(document.createRange){i=n.selection.findwordstart(e.startContainer,e.startOffset),s=n.selection.findwordend(e.endContainer,e.endOffset);if(t){if(e.startContainer===i.node&&e.startOffset===i.offset)return r().setFromNative(e);if(e.endContainer===s.node&&e.endOffset===s.offset)return r().setFromNative(e)}e.setStart(i.node,i.offset),e.setEnd(s.node,s.offset)}else e.expand("word"),e.htmlText.split().reverse()[0]===" "&&e.moveEnd("character",-1);return r().setFromNative(e)},findwordstart:function(e,t){var r,s,o,u,a=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){r=e.nodeValue.substring(0,t),s=r.search(a);if(s!==-1){o=s+1;while((s=r.substring(o).search(a))!==-1)o+=s+1;return{node:e,offset:o}}}else if(e.nodeType===1&&t>0)return n.selection.findwordstart(e.childNodes[t-1],e.childNodes[t-1].length);if(n.isTextBlock(e))return{node:e,offset:t};u=e.previousSibling;if(!u)return n.selection.findwordstart(e.parentNode,i.dom.getNodeOffset(e));if(u.nodeType===3)return n.selection.findwordstart(u,u.nodeValue.length);if(u.nodeType===1)return n.selection.findwordstart(u,u.childNodes.length)},findwordend:function(e,t){var r,s,o,u,a=/\s|[\!\?\.\,\:\;\"]/;if(!e||!e.nodeType)return!1;if(e.nodeType===3){r=e.nodeValue.substring(t),s=r.search(a);if(s!==-1)return o=t+s,{node:e,offset:o}}else if(e.nodeType===1&&t<e.childNodes.length)return n.selection.findwordend(e.childNodes[t],0);return n.isTextBlock(e)?{node:e,offset:t}:(u=e.nextSibling,u?n.selection.findwordend(u,0):n.selection.findwordend(e.parentNode,i.dom.getNodeOffset(e)+1))}},n.inout={handledtags:{h1:"block",h2:"block",h3:"block",h4:"block",h5:"block",h6:"block",p:"block",b:"child",i:"child",u:"child",strong:"child",em:"child",strike:"child",br:"child",a:"contents",span:"contents"},parserules:{textnode:{clean:!0},tags:{h1:"textblock",h2:"textblock",h3:"textblock",h4:"textblock",h5:"textblock",h6:"textblock",p:"textblock",b:{},i:{},u:{},strong:{},em:{},strike:{},br:{attributes:[{name:"class",allowedvalues:["moz_dirty"]}]}},templates:{textblock:{attributes:["class"],styles:[{name:"textAlign",allowedvalues:["left","right","center","justified"]},{name:"clear",allowedvalues:["left","right"]}]}}},importHTML:function(e){var t,r,s,o,u,a,f;a=n.inout.isHandleableNode(e);switch(a){case"block":return r=e.tagName.toLowerCase(),t=i.dom.parse(e,n.inout.parserules),i.blockElemId+=1,t.id="ghostedit_textblock_"+i.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","textblock"),t.setAttribute("data-ghostedit-handler","textblock"),t.ondragenter=function(){return!1},t.ondragleave=function(){return!1},t.ondragover=function(){return!1},t.ondrop=function(e){var t,n;n=e.dataTransfer.getData("Text")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),i.image.focus(t)},t.onresizestart=function(e){return i.util.cancelEvent(e)},n.mozBrs.tidy(t),t;case"child":case"contents":case"text":t=n.create("p"),t.setAttribute("data-ghostedit-importinfo","wasinline"),o=0,s=e;do f=i.dom.parse(s,n.inout.parserules),f&&(o+=1,t.appendChild(f),u=s,s=s.nextSibling,o>1&&u.parentNode.removeChild(u));while(n.inout.isHandleableNode(s)&&n.inout.isHandleableNode(s)!=="block");return n.mozBrs.tidy(t),o>0?t:!1}return!1},exportHTML:function(e){if(!e||!i.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="textblock")return!1;var t="",r="",s;return s=e,n.mozBrs.clear(s),t+="<"+s.tagName.toLowerCase(),s.style.textAlign!==""&&(r+="text-align:"+s.style.textAlign+";"),s.style.clear!==""&&(r+="clear:"+s.style.clear+";"),r.length>0&&(t+=" style='"+r+"'"),s.className.length>0&&!/ghostedit/.test(s.className)&&(t+=" class='"+s.className+"'"),t+=">",t+=s.innerHTML,t+="</"+s.tagName.toLowerCase()+">",n.mozBrs.tidy(s),{content:t}},isHandleableNode:function(e){var t;return!e||!e.nodeType?!1:e.nodeType===3?e.nodeValue.replace(/[\n\r\t]/g,"").length>0?"text":!1:e.nodeType!==1?!1:e.getAttribute("data-ghostedit-elemtype")==="textblock"?"block":i.dom.isGhostBlock(e)?!1:(t=e.tagName.toLowerCase(),n.inout.handledtags[t]?n.inout.handledtags[t]:!1)},parse:function(e){var t=!1,r,i,s,o,u;if(!e||!e.nodeType)return!1;s=n.inout.isHandleableNode(e);switch(s){case"text":return u=e.nodeValue.replace(/[\n\r\t]/g,""),u.length>0?document.createTextNode(u):!1;case"block":case"child":t=document.createElement(e.tagName.toLowerCase())}t=t||document.createDocumentFragment(),r=e.childNodes;for(o=0;o<r.length;o++)i=n.inout.parse(r[o]),i&&t.appendChild(i);return t}},n.paste={handle:function(e,t,s){var o;if(!i.dom.isGhostBlock(e)||!i.dom.isGhostBlock(t))return;return console.log(s),s.isfirst?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (first):"),n.mozBrs.clear(t),r().removeDOMmarkers("ghostedit_paste_start"),t.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t1'>&#x200b;</span>",document.createRange?i.selection.saved.data.collapseToStart().getNative().insertNode(i.dom.extractContent(t)):i.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:s.islast?t.tagName.toLowerCase()==="p"||t.tagName===e.tagName?(console.log("paste (last-noncollapsed):"),n.mozBrs.clear(t),r().removeDOMmarkers("ghostedit_paste_end"),t.innerHTML+="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>",document.createRange?i.selection.saved.data.collapseToStart().getNative().insertNode(i.dom.extractContent(t)):i.selection.saved.data.collapseToStart().getNative().pasteHTML(t.innerHTML),!0):!1:(n.mozBrs.clear(t),i.selection.saved.data.collapseToStart().select(),r().removeDOMmarkers("ghostedit_paste_start"),o=n.split(e),o.block1.innerHTML+="<span id='ghostedit_paste_start_range_start' class='t2'>&#x200b;</span>",n.mozBrs.tidy(o.block1),r().removeDOMmarkers("ghostedit_paste_end"),o.block2.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+o.block2.innerHTML,n.mozBrs.tidy(o.block2),!1)},clean:function(e){var t,r,i;if(!e||!e.nodeType)return!1;if(!e.childNodes)return e;t=document.createDocumentFragment();for(i=0;i<e.childNodes.length;i++)r=n.paste.cleanChild(e.childNodes[i]),r&&t.appendChild(r);return e=e.cloneNode(!1),e.appendChild(t),e},cleanNode:function(e){var t,r,i,s,o;if(!e||!e.nodeType)return!1;s=n.paste.isHandleableNode(e);switch(s){case"text":return e.nodeValue=e.nodeValue.replace(/[\n\r\t]/g,""),e;case"child":case"contents":t=s==="child"?e.cloneNode(!1):document.createDocumentFragment(),r=e.childNodes;for(o=0;o<r.length;o++)i=n.paste.cleanNode(r[o]),i&&t.appendChild(i);return t}return!1}},n.isTextBlock=function(e){return i.dom.isGhostBlock(e)?e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:!0:!1},n.isEmpty=function(e){var n,r,i,s;n=e.innerText||e.textContent;if(n&&n.length>1)return!1;i=e.getElementsByTagName("br"),r=e.getElementsByTagName("img");if(i.length===0&&r.length===0)return!0;for(s=0;s<i.length;s+=1)if(i[s].MozDirty===t&&!/moz_dirty/.test(i[s].className))return!1;return!0},n.isFirst=function(e){var t,n;t=i.editdiv;for(n=0;n<t.getElementsByTagName("*").length;n+=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")==="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.isLast=function(e){var t,n;t=i.editdiv;for(n=t.getElementsByTagName("*").length-1;n>0;n-=1)if(t.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")==="textblock")return t.getElementsByTagName("*")[n]===e?!0:!1},n.count=function(){var e,t,n;e=i.editdiv,t=0;for(n=0;n<e.getElementsByTagName("*").length;n+=1)e.getElementsByTagName("*")[n].getAttribute("data-ghostedit-elemtype")==="textblock"&&(t+=1);return t},n.create=function(e,t,r){var s;return r||(i.blockElemId+=1,r="ghostedit_textblock_"+i.blockElemId),t=t&&(t.length&&t.length>0||t.nodeType)?t:"",s=document.createElement(e),s.id=r,t.nodeType?(t=i.dom.parse(t,{textnode:{clean:!0},tags:{b:{},i:{},u:{},strong:{},em:{},strike:{},br:{}}}),t&&s.appendChild(t)):s.innerHTML=t,s.setAttribute("data-ghostedit-iselem","true"),s.setAttribute("data-ghostedit-elemtype","textblock"),s.setAttribute("data-ghostedit-handler","textblock"),s.ondragenter=function(){return!1},s.ondragleave=function(){return!1},s.ondragover=function(){return!1},s.ondrop=function(e){var t,n;n=e.dataTransfer.getData("Text")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),i.image.focus(t)},s.onresizestart=function(e){return i.util.cancelEvent(e)},n.mozBrs.tidy(s),s},n.remove=function(e){var t,s,o,u,a,f;i.selection.save(),i.history.saveUndoState(),t="",t=e.innerHTML,s=i.editdiv,f=s.getElementsByTagName("*"),a=!1;for(u=f.length-1;u>=0;u-=1){if(a===!0&&f[u].getAttribute("data-ghostedit-elemtype")==="textblock"){o=f[u];break}f[u]===e&&(a=!0)}if(n.isEmpty(o)){s.removeChild(o),r().setCaretToStart(e).select(),i.selection.save(),i.history.saveUndoState();return}s.removeChild(e),r().setCaretToEnd(o).select(),i.selection.save(),o.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t,n.mozBrs.tidy(o),r().selectNode("ghostedit_marker").deleteContents().select(),document.getElementById("ghostedit_marker")&&document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),i.selection.save(),i.history.saveUndoState()},n.focus=function(e){return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="textblock"?!1:(r().setCaretToEnd(e).select(),i.selection.save(),!0)},n.merge=function(e,t,s){var o,u,a,f;return s===!1?e:e===t?e:(o=e.getAttribute("data-ghostedit-elemtype"),u=t.getAttribute("data-ghostedit-elemtype"),o!=="textblock"||u!=="textblock"?!1:(e.innerHTML+="<span id='ghostedit_marker'>&#x200b;</span>"+t.innerHTML,a=t.parentNode,f=a.getAttribute("data-ghostedit-handler"),i.plugins[f].dom.removechild(a,t),n.mozBrs.tidy(e),r().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker")),e))},n.split=function(e){i.selection.save();var t,s,o,u,a,f,l,c,h,p;return s=n.selection.isAtStartOftextblock()===!0?!0:!1,o=n.selection.isAtEndOftextblock()===!0?!0:!1,t=s&&!o?"before":"after",u=t==="before"||o?"p":n.selection.getStartTextBlockNode().tagName,n.mozBrs.tidy(e),!s&&!o?document.createRange?(f=r().selectNodeContents(e).setStartToRangeStart(i.selection.savedRange),a=f.getHTML(),f.deleteContents()):document.selection&&(f=r().selectNode(e),f.setStartToRangeEnd(i.selection.savedRange),a=f.getHTML(),f.getNative().text=""):a="",c=n.create(u,a),c?(h=i.dom.getParentGhostBlock(e),p=h.getAttribute("data-ghostedit-handler"),l=i.plugins[p].dom.addchild(h,t,e,c,{contentlength:a.length}),l?(c.innerHTML="dummy",r().selectNode(c).select(),c.innerHTML=a,n.mozBrs.tidy(c),t==="before"?r().setCaretToBlockStart(e).select():r().setCaretToBlockStart(c).select(),i.selection.save(),{block1:t==="before"?c:e,block2:t==="before"?e:c}):!1):!1},n.mozBrs={checkifcontains:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t)return!0;return!1},insert:function(e){var t;t=document.createElement("br"),t.setAttribute("_moz_dirty",""),t.className="moz_dirty",e.appendChild(t)},clear:function(e){var n,r;n=e.getElementsByTagName("br");for(r=0;r<n.length;r+=1)if(n[r].MozDirty!==t||/moz_dirty/.test(n[r].className))n[r].parentNode.removeChild(n[r]),r--},tidy:function(e){n.mozBrs.clear(e),i.useMozBr&&n.mozBrs.insert(e)}},n.insert={character:function(e){i.selection.saved.type==="textblock"&&(i.selection.restore(),i.selection.savedRange.pasteText(e))},br:function(){var t,n,r;e.getSelection?(t=e.getSelection(),t.getRangeAt(0).collapse(!1),n=document.createElement("br"),n.id="newBr",t.getRangeAt(0).insertNode(n),t.getRangeAt(0).selectNode(n.parentNode),r=document.createRange(),r.setStartAfter(n),r.setEndAfter(n),t.removeAllRanges(),t.addRange(r),document.getElementById("newBr").removeAttribute("id")):document.selection&&(r=document.selection.createRange(),r.collapse(!1),r.pasteHTML("<br id='newBr' />"),r.moveToElementText(document.getElementById("newBr")),r.collapse(!1),r.select(),document.getElementById("newBr").removeAttribute("id"))}},n.format={init:function(){i.api.format=i.api.format||{},i.api.format.setStyle=function(e,t){n.format.formatSelected(n.format.setTagType,{tagname:e,newclass:t})},i.api.format.alignText=function(e){if(!/left|right|center|justify/.test(e))return!1;n.format.formatSelected(n.format.alignText,{alignDirection:e})},i.api.format.bold=function(){n.format.formatSelected(n.format.bold)},i.api.format.italic=function(){n.format.formatSelected(n.format.italic)},i.api.format.underline=function(){n.format.formatSelected(n.format.underline)},i.api.format.strikethrough=function(){n.format.formatSelected(n.format.strikethrough)},i.api.format.textColor=function(e){n.format.formatSelected(n.format.textColor,{color:e})}},useCommand:function(e,t){document.execCommand(e,!1,t)},getNextNode:function(e){if(e.firstChild)return e.firstChild;while(e){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},getNodesInRange:function(e){var t=e.getStartNode(),r=e.getEndNode(),i=e.getParentNode(),s=[],o;for(o=t.parentNode;o;o=o.parentNode){s.push(o);if(o===i)break}s.reverse();for(o=t;o;o=n.format.getNextNode(o)){s.push(o);if(o===r)break}return s},useCommandOnWord:function(e){var t,s;i.selection.savedRange.isCollapsed()&&n.selection.getStartTextBlockNode()&&(t=i.selection.savedRange.clone(),document.createRange&&(s=document.createElement("span"),s.id="ghostedit_marker",t.getNative().insertNode(s)),!document.createRange&&document.selection&&t.getNative().pasteHTML("<span id='ghostedit_marker'>z</span>"),t.selectNode("ghostedit_marker"),t=n.selection.extendtoword(t,!0),t.select()),n.format.useCommand(e),document.getElementById("ghostedit_marker")&&(r().selectNode("ghostedit_marker").select(),document.getElementById("ghostedit_marker").parentNode.removeChild(document.getElementById("ghostedit_marker"))),i.selection.save()},bold:function(){n.format.useCommand("bold")},italic:function(){n.format.useCommand("italic")},underline:function(){n.format.useCommand("underline")},strikethrough:function(){n.format.useCommand("strikethrough")},textColor:function(e){n.format.useCommand("foreColor",e)},formatSelected:function(e,t){var r,s,o,u,a,f,l;i.selection.save(),i.history.saveUndoState(),s=n.selection.getStartTextBlockNode(),o=n.selection.getEndTextBlockNode();if(s&&o){r=s,a=!1;do{if(r===i.editdiv||r===null)break;if(n.isTextBlock(r)){r===o&&(a=!0),r=n.format.formatTextBlock(r,i.selection.saved.data.clone(),e,t);if(a)break;r=r.nextSibling?r.nextSibling:r.parentNode;continue}if(i.dom.isDescendant(r,o)){r=i.dom.getFirstChildElement(r);continue}u=r,r=r.nextSibling?r.nextSibling:r.parentNode,l=u.getElementsByTagName("*");for(f=0;f<l.length;f+=1)n.isTextBlock(l[f])&&n.format.formatTextBlock(l[f],i.selection.saved.data.clone(),e,t)}while(!0);i.selection.save(),i.history.saveUndoState()}i.history.saveUndoState()},formatTextBlock:function(e,n,s,o){var u,a,f;return o||(o={}),o.textblock=e,n=n.clone(),u=r().setCaretToStart(e),a=r().setCaretToEnd(e),n.compareEndPoints("EndToStart",u)===-1||n.compareEndPoints("StartToEnd",a)===1?!1:(n.compareEndPoints("StartToStart",u)===-1&&n.setStartToRangeStart(u),n.compareEndPoints("EndToEnd",a)===1&&n.setEndToRangeEnd(a),i.selection.saved.data.clone().saveToDOM("ghostedit_format"),n.select(),f=s(o),r().restoreFromDOM("ghostedit_format").select(),i.selection.save(),f&&f.nodeType!==t?f:e)},alignText:function(e){var t=r().setToSelection().getParentElement();while(!i.dom.isGhostBlock(t)){t=t.parentNode;if(t===null)return!1}if(!n.isTextBlock(t))return!1;t.style.textAlign=e.alignDirection},setTagType:function(e){var r,s,o,u,a,f;return r=e.textblock,s=e.tagname,o=e.newclass,n.isTextBlock(r)?(a="ghostedit_textblock_"+r.id.replace("ghostedit_textblock_",""),f=n.create(s),f.appendChild(i.dom.extractContent(r)),n.mozBrs.tidy(f),f.setAttribute("style",r.getAttribute("style")),o!==t&&(f.className=o),u=r.parentNode,r.id="",u.insertBefore(f,r),u.removeChild(r),f.id=a,f):!1}},i.api.plugin.register("textblock",n)}(window),function(e,t){var n={};n.trim=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},n.preparefunction=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var r=n.concat(Array.prototype.slice.call(arguments));return e.apply(t?t:this,r)}},n.isFunction=function(e){return e?typeof e!="function"?!1:!0:!1},n.cloneObject=function(e){var t,r,i,s;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(i=0,r=e.length;i<r;++i)t[i]=n.cloneObject(e[i]);return t}if(e instanceof Object){t={};for(s in e)e.hasOwnProperty(s)&&(t[s]=n.cloneObject(e[s]));return t}},n.addClass=function(e,t){e.className=n.trim(e.className)+" "+t},n.removeClass=function(e,t){var r=new RegExp(t,"g");e.className=n.trim(e.className.replace(r,""))},n.cancelEvent=function(e){return e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):e&&(e.returnValue=!1),!1},n.cancelAllEvents=function(t){return t&&t.preventDefault?(t.stopPropagation(),t.preventDefault()):e.event&&(e.event.cancelBubble=!0),!1},n.preventDefault=function(e){return e&&e.preventDefault&&e.preventDefault(),!1},n.preventBubble=function(t){t&&t.stopPropagation&&t.stopPropagation(),e.event&&(e.event.cancelBubble=!0)},n.addEvent=function(e,n,r){e.addEventListener!==t?e.addEventListener(n,r,!1):e.attachEvent("on"+n,r)},n.removeEvent=function(e,n,r){e.removeEventListener!==t?e.removeEventListener(n,r,!1):e.detachEvent("on"+n,r)},n.ajax=function(t,n,r,i,s){var o,u,a;if(!t||!n)return!1;a=!1;if(e.XMLHttpRequest&&(e.location.protocol!=="file:"||!e.ActiveXObject))a=new e.XMLHttpRequest;else try{a=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(f){try{a=new e.ActiveXObject("MSXML2.XMLHTTP")}catch(l){}}if(!a)return!1;n=n.toUpperCase(),o=(new Date).getTime(),t=t.replace(/(\?)+$/,""),u=t.indexOf("?")===-1?"?":"&",n==="GET"?a.open(n,t+u+o+"&"+r,!0):a.open(n,t+u+o,!0),a.onreadystatechange=function(){var e;if(a.readyState===4)return a.status===200?(e=s==="xml"?a.responseXML:a.responseText,i!==null&&i(!0,e),!0):(i!==null&&i(!1,e),!1)},a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n==="POST"&&r!==null?a.send(r):a.send()},n.detectEngines=function(){var t={ie:0,gecko:0,webkit:0,khtml:0,opera:0,ver:null},n=navigator.userAgent;return e.opera?(t.ver=e.opera.version(),t.opera=parseFloat(t.ver)):/AppleWebKit\/(\S+)/.test(n)?(t.ver=RegExp.$1,t.webkit=parseFloat(t.ver)):/KHTML\/(\S+)/.test(n)||/Konqueror\/([^;]+)/.test(n)?(t.ver=RegExp.$1,t.khtml=parseFloat(t.ver)):/rv:([^\)]+)\) Gecko\/\d{8}/.test(n)?(t.ver=RegExp.$1,t.gecko=parseFloat(t.ver)):/MSIE ([^;]+)/.test(n)&&(t.ver=RegExp.$1,t.ie=parseFloat(t.ver)),t},e.ghostedit.util=n}(window),function(e,t){var n={elemid:0,focusedimage:null,justResized:!1,originalMouseX:null,originalMouseY:null,buttons:[],el:{}},r=e.ghostedit;n.enable=function(){r.event.addListener("history:undo:before",function(){n.unfocus()}),r.event.addListener("history:redo:before",function(){n.unfocus()}),r.event.addListener("history:undo:after",function(){n.applyeventlisteners()}),r.event.addListener("history:redo:after",function(){n.applyeventlisteners()}),r.event.addListener("clipboard:paste:after",function(){n.applyeventlisteners()}),r.event.addListener("selection:change",function(){r.selection.saved.type!=="image"&&n.ui.hide()}),r.inout.registerimporthandler(n.inout.importHTML,"img"),r.options.image||(r.options.image={}),r.options.image.disableresize||(r.options.image.disableresize=!1),r.options.image.flexibleimages||(r.options.image.flexibleimages=!1);var e=document.createElement("form");e.id="ghostedit_image_focusform",e.style.cssText="margin:0px;padding:0px;height:0px;width:0px;overflow:hidden;line-height: 0px";var t=document.createElement("textarea");t.id="ghostedit_image_keycapturearea",t.onkeypress=r.util.cancelEvent,t.onkeydown=n.event.keydown,n.el.keycapture=t,e.appendChild(t),r.wrapdiv.appendChild(e),r.api.image=r.api.image||{},r.api.image.updatealttext=function(e){return n.updatealttext(e)}},n.event={keydown:function(t){t=e.event!==null?e.event:t;var i=t.keyCode!==null?t.keyCode:t.charCode;switch(i){case 8:case 46:n.remove(t);break;case 90:t.ctrlKey&&r.history.undo();break;case 89:t.ctrlKey&&r.history.redo();break;case 37:n.move.align("left",t);break;case 38:n.move.up(t);break;case 39:n.move.align("right",t);break;case 40:n.move.down(t)}return r.util.cancelEvent(t)}},n.selection={compare:function(e,t){return!e||!t?!1:e===t?!0:!1},restore:function(e){return!e||!e.tagName||e.tagName.toLowerCase()!=="img"?!1:(n.focus(e),!0)},deleteContents:function(){return!0}},n.inout={importHTML:function(e){var t,i,s,o;return t=n.create(e.src),t?(e.className.length>0&&!/ghostedit/.test(e.className)&&(t.className=e.className),t.alt=e.alt,t.title=e.title,i=t.width,s=t.height,t.naturalWidth=t.naturalWidth||i,t.naturalHeight=t.naturalHeight||s,t.setAttribute("data-ghostedit-nativewidth",i),t.setAttribute("data-ghostedit-nativeheight",s),o=r.wrapdiv.offsetWidth,r.options.image.flexibleimages||(e.style.width.replace("px","")>0&&e.style.width.replace("px","")<o?t.style.width=e.style.width:t.style.width="200px",t.style.height=t.style.width.replace("px","")/i*s),t.style.cssFloat=e.style.cssFloat,t.style.styleFloat=e.style.styleFloat,t.style.clear=e.style.clear,e.style.cssFloat==="right"||e.style.styleFloat==="right"?(t.style.marginLeft="20px",t.style.marginRight="0px"):(t.style.marginLeft="0px",t.style.marginRight="20px"),t):!1},exportHTML:function(e){if(!e||!r.dom.isGhostBlock(e)||e.getAttribute("data-ghostedit-elemtype")!=="image")return!1;var t="",n;return n=e,t+="<img src='"+n.src.toString()+"' alt='"+n.alt.toString()+"' title='"+n.title.toString()+"' ",t+="style='",r.options.image.flexibleimages||(t+="width:"+n.offsetWidth.toString()+"px;height; "+n.offsetHeight+"px;"),n.style.styleFloat==="left"||n.style.cssFloat==="left"?t+="float:left;clear:left;margin-right: 20px;":t+="float:right;clear:right;margin-left: 20px;",n.style.clear!==""&&(t+="clear:"+n.style.clear),t+="'",n.className.length>0&&!/ghostedit/.test(n.className)&&(t+=" class='"+n.className+"'"),t+=" />",{content:t}}},n.move={align:function(e,t){var i;return e!=="left"&&e!=="right"?r.util.cancelAllEvents(t):r.selection.saved.type!=="image"?r.util.cancelAllEvents(t):(r.history.saveUndoState(),i=r.selection.saved.data,i.style.styleFloat=e,i.style.cssFloat=e,i.style.marginRight=e==="left"?"20px":"0px",i.style.marginLeft=e==="left"?"0px":"20px",n.focus(i),r.history.saveUndoState(),r.util.cancelAllEvents(t))},up:function(e){var t,i,s,o,u,a;return r.history.saveUndoState(),n.focusedimage!==null&&(t=n.focusedimage,s=t.offsetLeft,i=t.offetTop,a=r.dom.getPreviousSiblingGhostBlock(t),a&&(o=r.dom.getParentGhostBlock(a),u=o.getAttribute("data-ghostedit-handler"),r.plugins[u].dom.addchild(o,"before",a,t)),s===t.offsetLeft&&t.offsetTopBefore===t.offsetTop?t.style.clear="":t.style.clear="",n.focus(n.focusedimage)),r.history.saveUndoState(),r.util.cancelAllEvents(e)},down:function(e){var t,i,s,o,u,a;return r.history.saveUndoState(),n.focusedimage!==null&&(t=n.focusedimage,o=t.offsetLeft,u=t.offetTop,a=r.dom.getNextSiblingGhostBlock(t),a&&(i=r.dom.getParentGhostBlock(a),s=i.getAttribute("data-ghostedit-handler"),r.plugins[s].dom.addchild(i,"after",a,t)),o===t.offsetLeft&&t.offsetTopBefore===t.offsetTop?t.style.clear="":t.style.clear="",n.focus(n.focusedimage)),r.history.saveUndoState(),r.util.cancelAllEvents(e)}},n.setClear=function(e){r.selection.save(),r.history.saveUndoState();var t,n,i;n=r.textblock.selection.getStartTextBlockNode(),i=r.textblock.selection.getEndTextBlockNode();if(n&&i){t=n;do{t.getAttribute("data-ghostedit-elemtype").toLowerCase()==="textblock"&&(n.style.clear=e);if(!t.nextSibling||t.id===i.id)break;t=t.nextSibling}while(!0)}t=n;while(t.previousSibling&&t.previousSibling.getAttribute("data-ghostedit-elemtype")==="image")t=t.previousSibling,t.style.clear=e;document.getElementById("ghostedit_toolbar_clearselect").value=e,r.selection.save(),r.history.saveUndoState()},n.remove=function(t){r.history.saveUndoState();if(n.focusedimage!==null){var i=n.focusedimage;n.unfocus(),i.parentNode&&i.parentNode.removeChild(i)}return t&&t.preventDefault?t.stopPropagation():e.event.cancelBubble!==null&&(e.event.cancelBubble=!0),r.history.saveUndoState(),!1},n.refocus=function(){var e=n.focusedimage;n.unfocus(),n.focus(e)},n.unfocus=function(){n.resize.end(),n.focusedimage=null;if(r.selection.saved.type!=="image")return!1;var e=r.selection.saved.data;n.ui.hide(e),r.selection.clear(),r.selection.save()},n.updatealttext=function(e){n.focusedimage!==!1&&n.focusedimage.alt!==e&&(n.focusedimage.alt=e,n.focusedimage.title=e,r.event.trigger("ui:message",{message:"Image description updated to '"+e+"'",time:2,color:"success"}))},n.focus=function(e,t){var i,s,o,u,a,f,l;n.unfocus();if(r.isEditing===!0&&n.focusedimage===null){l=e.id.replace("ghostedit_image_",""),u=document.createElement("div"),u.className="ghostedit_image_border",u.id="ghostedit_image_border_"+l,u.style.top=e.offsetTop+"px",u.style.left=e.offsetLeft+"px",u.style.width=e.offsetWidth-6+"px",u.style.height=e.offsetHeight-6+"px",r.contextuallayer.appendChild(u),s=document.getElementById("ghostedit_image_resizehandle_"+l),s&&r.contextuallayer.removeChild(s),r.options.image.disableresize||(o=document.createElement("span"),o.className="ghostedit_image_resizehandle",o.id="ghostedit_image_resizehandle_"+l,o.style.top=e.offsetTop+e.offsetHeight-13+"px",e.style.cssFloat==="left"||e.style.styleFloat==="left"?(o.style.left=e.offsetLeft+e.offsetWidth-13+"px",o.style.cursor="se-resize",o.style.background="URL("+r.options.imageurl+"/image/resize-se.png)"):(o.style.left=e.offsetLeft+"px",o.style.cursor="sw-resize",o.style.background="URL("+r.options.imageurl+"/image/resize-sw.png)"),r.contextuallayer.appendChild(o),o.style.MozUserSelect="none",o.contentEditable=!1,o.unselectable="on",o.onmousedown=function(e){return n.resize.start(this,e)},o.ondragstart=function(e){return r.util.cancelEvent(e)},o.ondraggesture=function(e){return r.util.cancelEvent(e)},o.onclick=function(e){return r.util.cancelEvent(e)},o.ondblclick=function(e){return r.util.cancelEvent(e)},o.onresizestart=function(e){return r.util.cancelEvent(e)}),a=n.ui.createbutton(l,"align",">",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+"px",e.style.cssFloat==="left"||e.style.styleFloat==="left"?(t.elem.style.left=e.offsetLeft+e.offsetWidth-15+"px",t.elem.innerHTML="&gt;"):(t.elem.style.left=e.offsetLeft-15+"px",t.elem.innerHTML="&lt;")}),e.style.cssFloat==="left"||e.style.styleFloat==="left"?a.event.click=function(e){return n.move.align("right",e)}:a.event.click=function(e){return n.move.align("left",e)},a.register(),a=n.ui.createbutton(l,"delete","&#215;",function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+"px"}),a.event.click=function(e){return n.remove(e)},a.register(),a=n.ui.createbutton(l,"up","^",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15-40+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),a.event.click=function(e){return n.move.up(e)},a=n.ui.createbutton(l,"down","&caron;",function(e,t){t.elem.style.top=e.offsetTop+e.offsetHeight/2-15+40+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft+e.offsetWidth-15:e.offsetLeft-15)+"px"}),a.event.click=function(e){return n.move.down(e)},a=n.ui.createbutton(l,"small","Small",function(e,t){t.elem.style.top=e.offsetTop+40+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-60)+"px",t.elem.style.width="60px"}),a.event.click=function(e){var t=n.focusedimage;return t.className="small",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",n.ui.setbuttonpositions(),r.util.cancelEvent(e)},a=n.ui.createbutton(l,"golden","Golden",function(e,t){t.elem.style.top=e.offsetTop+80+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),a.event.click=function(e){var t=n.focusedimage;return t.className="golden",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",n.ui.setbuttonpositions(),r.util.cancelEvent(e)},a=n.ui.createbutton(l,"medium","Medium",function(e,t){t.elem.style.top=e.offsetTop+120+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-80)+"px",t.elem.style.width="80px"}),a.event.click=function(e){var t=n.focusedimage;return t.className="medium",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",n.ui.setbuttonpositions(),r.util.cancelEvent(e)},a=n.ui.createbutton(l,"fullwidth","Full Width",function(e,t){t.elem.style.top=e.offsetTop+160+"px",t.elem.style.left=(e.style.cssFloat==="left"||e.style.styleFloat==="left"?e.offsetLeft:e.offsetLeft+e.offsetWidth-100)+"px",t.elem.style.width="100px"}),a.event.click=function(e){var t=n.focusedimage;return t.className="fullwidth",t.style.height="",t.style.width="",t.style.height=t.offsetHeight-12+"px",t.style.width=t.offsetWidth-12+"px",n.ui.setbuttonpositions(),r.util.cancelEvent(e)},f="<select onclick='ghostedit.util.preventBubble()' onchange='_image.focusedimage.style.clear = this.value;_image.refocus();'>",f+="<option value='' "+(e.style.clear===""?"selected='selected' ":"")+">Clear: none</option>",f+="<option value='left' "+(e.style.clear==="left"?"selected='selected' ":"")+">Clear: left</option>",f+="<option value='right' "+(e.style.clear==="right"?"selected='selected' ":"")+">Clear: right</option>",f+="<option value='both' "+(e.style.clear==="both"?"selected='selected' ":"")+">Clear: both</option>",f+=" </select>",a=n.ui.createbutton(l,"clear",f,function(e,t){t.elem.style.top=e.offsetTop+"px",t.elem.style.left=e.offsetLeft+e.offsetWidth-100+"px",t.elem.style.width="100px",t.elem.style.cursor="default"}),a.event.click=null,a.event.mousedown=null;for(i=0;i<n.buttons.length;i+=1)n.buttons[i].show(e),n.buttons[i].reposition(e,n.buttons[i]);n.focusedimage=e,r.selection.set("image",e);if(t)return r.util.cancelEvent(t)}},n.resize={start:function(t,i){r.history.saveUndoState(),i===null&&(i=e.event);var s=document.getElementById("ghostedit_image_"+t.id.replace("ghostedit_image_resizehandle_",""));return n.originalMouseX=i.pageX||i.clientX+document.body.scrollLeft,n.originalMouseY=i.pageY||i.clientY+document.body.scrollTop,n.originalImageWidth=s.offsetWidth,n.originalImageHeight=s.offsetHeight,s.getAttribute("data-ghostedit-nativewidth")||s.setAttribute("data-ghostedit-nativewidth",s.offsetWidth),s.getAttribute("data-ghostedit-nativeheight")||s.setAttribute("data-ghostedit-nativeheight",s.offsetHeight),r.util.addEvent(document.body,"mousemove",n.resize.handle),r.util.addEvent(document.body,"mouseup",n.resize.end),r.util.addEvent(e,"blur",n.resize.end),!1},handle:function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v;t=e.event!==null?e.event:t,n.focusedimage===null?n.unfocus():(r=n.focusedimage,i=document.getElementById("ghostedit_image_resizehandle_"+r.id.replace("ghostedit_image_","")),s=document.getElementById("ghostedit_imagebutton_align"+r.id.replace("ghostedit_image_","")),o=t.pageX||t.clientX+document.body.scrollLeft,u=t.pageY||t.clientY+document.body.scrollTop,h=n.originalMouseX,p=n.originalMouseY,c=n.originalImageHeight,l=n.originalImageWidth,v=r.getAttribute("data-ghostedit-nativeheight"),d=r.getAttribute("data-ghostedit-nativewidth"),r.style.cssFloat==="left"||r.style.styleFloat==="left"?(a=l+(o-h),f=c+(u-p)):(a=l-(o-h),f=c+(u-p)),f/v*d>a?a=f/v*d:f=a/d*v,a>=r.parentNode.width&&(a=r.parentNode.width,f=a/d*v),r.style.width=a+"px",r.style.height=f+"px",n.ui.setbuttonpositions())},end:function(){n.justResized=!0,r.util.removeEvent(document.body,"mousemove",n.resize.handle),r.util.removeEvent(document.body,"mouseup",n.resize.end),r.util.removeEvent(e,"blur",n.resize.end),r.history.saveUndoState()}},n.ui={show:function(e){var t,n=e;n=t},hide:function(e){var t;e=e||n.focusedimage;if(!e)return!1;document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))&&r.contextuallayer.removeChild(document.getElementById("ghostedit_image_border_"+e.id.replace("ghostedit_image_",""))),!r.options.image.disableresize&&document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_",""))&&r.contextuallayer.removeChild(document.getElementById("ghostedit_image_resizehandle_"+e.id.replace("ghostedit_image_","")));for(t=0;t<n.buttons.length;t+=1)n.buttons[t].hide();n.buttons=[]},createbutton:function(e,t,i,s){var o,u;return u=document.createElement("span"),u.id="ghostedit_imagebutton_"+t+"_"+e,u.setAttribute("data-ghostedit-elemtype","ghostedit_imagebutton"),u.setAttribute("data-ghostedit-handler","image"),u.className="ghostedit_imagebutton",u.innerHTML=i,o={elem:u},o.reposition=s,o.event={mousedown:function(e){return r.util.cancelEvent(e)},dragstart:function(e){return r.util.cancelEvent(e)},draggesture:function(e){return r.util.cancelEvent(e)},click:function(e){return r.util.cancelEvent(e)},dblclick:function(e){return r.util.cancelEvent(e)},resizestart:function(e){return r.util.cancelEvent(e)}},o.show=function(){r.contextuallayer.appendChild(o.elem),o.elem.style.MozUserSelect="none",o.elem.contentEditable=!1,o.elem.unselectable="on",o.elem.onmousedown=o.event.mousedown,o.elem.ondragstart=o.event.dragstart,o.elem.ondraggesture=o.event.draggesture,o.elem.onclick=o.event.click,o.elem.ondblclick=o.event.dblclick,o.elem.onresizestart=o.event.resizestart},o.hide=function(){o.elem.parentNode.removeChild(o.elem)},o.register=function(){n.buttons.push(o)},o},setbuttonpositions:function(){var e,t,i,s;t=n.focusedimage;if(t){i=document.getElementById("ghostedit_image_border_"+t.id.replace("ghostedit_image_","")),i.style.top=t.offsetTop+"px",i.style.left=t.offsetLeft+"px",i.style.width=t.offsetWidth-6+"px",i.style.height=t.offsetHeight-6+"px",r.options.image.disableresize||(s=document.getElementById("ghostedit_image_resizehandle_"+t.id.replace("ghostedit_image_","")),s.style.top=t.offsetTop+t.offsetHeight-13+"px",t.style.cssFloat==="left"||t.style.styleFloat==="left"?s.style.left=t.offsetLeft+t.offsetWidth-13+"px":s.style.left=t.offsetLeft+"px");for(e=0;e<n.buttons.length;e+=1)n.buttons[e].reposition(t,n.buttons[e])}}},n.insert=function(){var e;e=document.getElementById("ghostedit_imageurlinput"),e.blur(),n.newImageBefore(null,null,!1)},n.create=function(t){var i;return i=document.createElement("img"),n.elemid+=1,i.id="ghostedit_image_"+n.elemid,i.src=t,r.options.defaultimageclass&&(i.className=r.options.defaultimageclass),i.setAttribute("data-ghostedit-elemtype","image"),i.setAttribute("data-ghostedit-handler","image"),i.contentEditable="false",i.unselectable="on",i.galleryimg="no",i.onclick=function(e){n.focus(this,e),r.util.cancelAllEvents(e)},i.ondragstart=function(t){return t=e.event?e.event:t,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",i.id)),!0},i.ondraggesture=function(e){return r.util.cancelEvent(e)},i.onresizestart=function(e){return r.util.cancelAllEvents(e)},i.oncontrolselect=function(e){return n.focus(this,e),r.util.cancelAllEvents(e)},i},n.newImageBefore=function(e,t,i,s){var o,u,a,f,l,c,h;r.history.saveUndoState(),e===null&&(e=r.selection.savedRange.getStartNode()),e=r.plugins.textblock.selection.getTextBlockNode(e),s!=="after"&&(s="before"),t===null&&(t=document.getElementById("ghostedit_imageurlinput").value);if(!document.getElementById("ghostedit_image_"+e.id.replace("ghostedit_textblock_","")))return a=document.createElement("img"),n.elemid+=1,a.id="ghostedit_image_"+n.elemid,r.options.defaultimageclass&&(a.className=r.options.defaultimageclass),f=r.dom.getParentGhostBlock(e),l=f.getAttribute("data-ghostedit-handler"),c=r.plugins[l].dom.addchild(f,s,e,a),c?(u=document.getElementById("ghostedit_image_"+n.elemid),u.setAttribute("data-ghostedit-elemtype","image"),u.setAttribute("data-ghostedit-handler","image"),u.contentEditable="false",u.unselectable="on",u.galleryimg="no",h=e.style.clear==="left"?"right":"left",u.style.cssFloat=h,u.style.styleFloat=h,u.style.clear=e.style.clear,u.style.marginRight="20px",o={i:u,s:i},o.callself=function(){n.onload(o.i,o.s,!0)},u.onload=o.callself,u.src=t,n.applyeventlisteners(u),r.util.addClass(u,"leftimage"),u):!1},n.onload=function(e,t,i){if(i===!0){e.setAttribute("data-ghostedit-nativewidth",0),e.setAttribute("data-ghostedit-nativeheight",0);if(!r.options.image.disableresize&&!t&&e.offsetWidth>200){var s=200,o=s/e.offsetWidth*e.offsetHeight;e.style.width=s+"px",e.style.height=o+"px"}e.contentEditable=!1,r.history.saveUndoState()}else{var u={i:e,s:t};u.callself=function(){n.onload(u.i,u.s,!0)},setTimeout(u.callself,20)}},n.applyeventlisteners=function(){var t,i,s,o,u;t=r.editdiv.getElementsByTagName("img"),console.log("applyimageevent"),o=function(e){return n.focus(this,e),r.util.cancelAllEvents(e)},u=function(t){return t=e.event?e.event:t,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("Text",s.id)),!0};for(i=0;i<t.length;i++){s=t[i],console.log(s);if(s.getAttribute("data-ghostedit-elemtype")!=="image")continue;console.log(s),s.onclick=o,s.ondragstart=u,s.ondraggesture=r.util.cancelEvent,s.onresizestart=r.util.cancelAllEvents,s.oncontrolselect=o}},r.api.plugin.register("image",n)}(window),function(e,t){var n={focusedlink:!1,el:{}},r=e.lasso,i=e.ghostedit;n.enable=function(){i.event.addListener("preundo",function(){n.unfocus()}),i.event.addListener("preredo",function(){n.unfocus()}),i.event.addListener("import:after",function(){n.event.postimport()}),i.event.addListener("ui:update",function(){n.ui.update()}),i.inout.registerimporthandler(i.plugins.textblock.inout.importHTML,"a"),i.plugins.textblock.inout.parserules.tags.a={attributes:["href"]},i.api.link=i.api.link||{},i.api.link.create=function(){var e;return i.history.saveUndoState(),e=n.create(),i.history.saveUndoState(),e},i.api.link.updateurl=function(e){return n.updateurl(e)},i.api.link.open=function(){return n.open()}},n.event={postimport:function(e){var t,n;if(!e||!e.editdiv)return!1;n=e.editdiv.getElementsByTagName("a");for(t=0;t<n.length;t+=1)n[t].setAttribute("data-ghostedit-elemtype","link"),n[t].setAttribute("data-ghostedit-handler","link");return!0}},n.selection={deleteContents:function(){return!1}},n.ui={update:function(){var e,t,r=!1;for(t=0;t<i.selection.nodepath.length;t++)e=i.selection.nodepath[t],e.tagName.toLowerCase()==="a"&&(r=e);r?r!==n.focusedlink&&n.focus(r):n.focusedlink&&n.unfocus()},show:function(e){var t,r,s;n.ui.hide(),t=document.createElement("span"),t.className="ghostedit_focusedlinkbox",t.id="ghostedit_focusedlinkbox",t.style.top=e.offsetTop+e.offsetHeight-1+"px",s=e.getClientRects()[e.getClientRects().length-1].left,t.style.left=s-i.editdiv.getBoundingClientRect().left+"px",r=document.createElement("a"),r.style.cursor="pointer",r.style.color="#333",r.innerHTML="<b>&#215;</b>&nbsp;remove&nbsp;link</a>",t.appendChild(r),i.contextuallayer.appendChild(t),t.style.MozUserSelect="none",t.contentEditable=!1,t.unselectable="on",t.onmousedown=function(e){return i.util.cancelEvent(e)},t.ondragstart=function(e){return i.util.cancelEvent(e)},t.ondraggesture=function(e){return i.util.cancelEvent(e)},t.onclick=function(e){return i.util.cancelEvent(e)},t.ondblclick=function(e){return i.util.cancelEvent(e)},t.onresizestart=function(e){return i.util.cancelEvent(e)},t.oncontrolselect=function(e){return i.util.cancelAllEvents(e)},i.util.addEvent(r,"click",i.util.preparefunction(n.remove,null,e)),n.el.focusedbox=t,n.el.focusedboxa=r},hide:function(){if(!n.el.focusedbox)return;i.contextuallayer.removeChild(n.el.focusedbox),n.el.focusedbox=null,n.el.focusedboxa=null}},n.create=function(e){var t,n,s;return typeof e=="undefined"&&(e="http://"),n=i.selection.saved,n.type!=="textblock"?!1:(n.data.isCollapsed()&&(t=n.data.clone(),t=i.plugins.textblock.selection.extendtoword(t,!0),t.select(),i.selection.save()),n.data.isCollapsed()?(s=document.createElement("a"),s.id="ghostedit_link_newlink",s.innerHTML="Link Text",s.href="http://",n.data.insertNode(s),n.data.selectNodeContents("ghostedit_link_newlink").select(),document.getElementById("ghostedit_link_newlink").id="",i.selection.save()):(document.execCommand("CreateLink",!1,e),r().setToSelection().collapseToEnd().select(),i.selection.save(),s=i.plugins.link.focusedlink,s.href="http://"),i.selection.save(),!0)},n.focus=function(e){n.focusedlink=e,n.ui.show(e)},n.unfocus=function(){if(n.focusedlink===!1)return;n.ui.hide(),n.focusedlink=!1},n.remove=function(e){var t;e=e||n.focusedlink;if(!i.dom.isGhostBlock(e)||e.tagName.toLowerCase()!=="a")return!1;if(i.selection.saved.type!=="textblock")return!1;i.selection.saved.data.saveToDOM(),t=i.dom.extractContent(e),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),i.selection.saved.data.restoreFromDOM().select(),i.selection.save()},n.updateurl=function(e){n.focusedlink!==!1&&n.focusedlink.href!==e&&(n.focusedlink.href=e,n.focusedlink.title=e,i.event.trigger("ui:message",{message:"URL updated to '"+e+"'",time:2,color:"success"}))},n.open=function(){n.focusedlink!==!1&&e.open(n.focusedlink.href)},i.api.plugin.register("link",n)}(window),function(e,t){var n={elemid:0,itemelemid:0},r=e.lasso,i=e.ghostedit;n.enable=function(){i.event.addListener("postpaste",function(){var e,t,r,s,o;s=[],t=i.editdiv.getElementsByTagName("ul");for(e=0;e<t.length;e++)s.push(t[e]);r=i.editdiv.getElementsByTagName("ol");for(e=0;e<r.length;e++)s.push(r[e]);for(e=0;e<s.length;e++){o=s[e];if(!o.parentNode)continue;n.tidy(o)}}),i.inout.registerimporthandler(n.inout.importHTML,"ol","ul","li"),i.api.list=i.api.list||{},i.api.list.toggle=function(e){n.toggle(e)}},n.dom={addchild:function(e,t,r,s,o){var u,a,f=!1,l=!1,c,h;o&&o.contentlength!==!1&&(l=o.contentlength<1?!0:!1),e.getAttribute("data-ghostedit-elemtype")==="listitem"&&(e=i.dom.getParentGhostBlock(e));if(e.getAttribute("data-ghostedit-elemtype")!=="list")return!1;c=r;while(c.getAttribute("data-ghostedit-elemtype")!=="listitem"){c=i.dom.getParentGhostBlock(c);if(c===null)return!1}return l&&i.dom.getNextSiblingGhostBlock(c)===!1&&i.plugins.textblock.isEmpty(r)&&(u=i.dom.getParentGhostBlock(e),h=u.getAttribute("data-ghostedit-handler"),f=i.plugins[h].dom.addchild(u,"after",e,s)),f?(e.removeChild(c),f):(s.getAttribute("data-ghostedit-elemtype")==="textblock"?(a=document.createElement("li"),n.itemelemid+=1,a.id="ghostedit_listitem_"+n.itemelemid,a.setAttribute("data-ghostedit-elemtype","listitem"),a.setAttribute("data-ghostedit-handler","list"),a.appendChild(s)):a=s,t==="before"?e.insertBefore(a,c):c.nextSibling!==null?e.insertBefore(a,c.nextSibling):e.appendChild(a),!0)},removechild:function(e,t){e&&e.getAttribute("data-ghostedit-elemtype")==="listitem"&&(t=e,e=i.dom.getParentGhostBlock(e));if(!e||!t)return!1;if(e.getAttribute("data-ghostedit-elemtype")!=="list")return!1;while(t.getAttribute("data-ghostedit-elemtype")!=="listitem"){t=i.dom.getParentGhostBlock(t);if(t===null)return!1}return t.parentNode!==e?!1:(e.removeChild(t),!0)},deleteevent:function(e,t,r){var s,o,u;u=e.getAttribute("data-ghostedit-elemtype");if(u==="list")return t==="ahead"||t==="behind"?(s=t==="ahead"?i.dom.getLastChildGhostBlock(e):i.dom.getFirstChildGhostBlock(e),n.ghostevent("delete",s,t,r)):!1;if(u==="listitem")return t==="ahead"||t==="behind"?(s=i.dom.getFirstChildGhostBlock(e),o=i.plugins.textblock.event.textdelete(s,t,r)):t==="top"?o=i.event.sendBackwards("delete",e,r):t==="bottom"&&(o=i.event.sendForwards("delete",e,r)),o}},n.selection={deleteContents:function(e,t){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;m=!1,g=!1;if(!n.isList(e))return n.isListItem(e)?i.plugins.textblock.selection.deleteContents(i.dom.getFirstChildGhostBlock(e)):!1;if(i.selection.saved.type!=="textblock")return;v=i.selection.saved.data.clone(),c=e.childNodes,y=i.dom.getFirstChildGhostBlock(e),b=i.dom.getLastChildGhostBlock(e),p=r().setCaretToStart(y),d=r().setCaretToEnd(b),v.compareEndPoints("StartToStart",p)!==1?(m=!0,o=y):(o=v.getStartNode(),i.dom.isGhostBlock(o)||(o=i.dom.getParentGhostBlock(o))),v.compareEndPoints("EndToEnd",d)!==-1?(g=!0,u=b):(u=v.getEndNode(),i.dom.isGhostBlock(u)||(u=i.dom.getParentGhostBlock(u))),a=o;while(!i.dom.isChildGhostBlock(a,e))a=i.dom.getParentGhostBlock(a);l=u;while(!i.dom.isChildGhostBlock(l,e))l=i.dom.getParentGhostBlock(l);h=m;for(s=0;s<c.length;s+=1){f=c[s];if(!i.dom.isGhostBlock(f))continue;w=f.getAttribute("data-ghostedit-handler");if(!m&&f.id===a.id){i.plugins[w].selection.deleteContents(f),h=!0;if(f.id===l.id)break;continue}if(!g&&f.id===l.id){i.plugins[w].selection.deleteContents(f),h=!1;break}h&&(v.saveToDOM("seldelete-midlist"),e.removeChild(c[s]),v.restoreFromDOM("seldelete-midlist"),s--)}return!m&&!g&&a.getAttribute("data-ghostedit-elemtype")===l.getAttribute("data-ghostedit-elemtype")&&(i.plugins[a.getAttribute("data-ghostedit-handler")].merge(a,l,t),i.dom.getParentGhostBlock(l)||r().setToSelection().collapseToStart().select()),i.dom.getFirstChildGhostBlock(e)||e.appendChild(n.createItem("p")),!0}},n.inout={importHTML:function(e){var t,r,i,s,o;if(!e||!e.tagName)return!1;switch(e.tagName.toLowerCase()){case"ol":case"ul":return n.inout.importList(e);case"li":t=n.create("ul"),t.setAttribute("data-ghostedit-importinfo","wasinline"),r=0,i=e;do{o=n.inout.importListItem(i);if(!o)break;r+=1,t.appendChild(o),s=i,i=i.nextSibling,r>1&&s.parentNode.removeChild(s)}while(i&&i.nodeType===1&&i.tagName.toLowerCase()==="li");return r>0?t:!1}},exportHTML:function(e){if(!e||!i.dom.isGhostBlock(e))return!1;var t="",r,s,o,u;switch(e.getAttribute("data-ghostedit-elemtype")){case"list":r=i.dom.getFirstChildGhostBlock(e);if(!r)return!1;do o=n.inout.exportHTML(r),o&&(t+=o.content),r=i.dom.getNextSiblingGhostBlock(r);while(r);if(t.length<1)return!1;return s=e.tagName.toLowerCase()==="ol"?"ol":"ul",t="<"+s+">"+t+"</"+s+">",{content:t};case"listitem":u=i.dom.getFirstChildGhostBlock(e);if(!u)return!1;o=i.plugins.textblock.inout.exportHTML(u),o&&(t+=o.content);if(t.length<1)return!1;return t="<li>"+t+"</li>",{content:t}}},importList:function(e){var t,r,s,o,u;if(!e||!e.tagName)return!1;u=e.tagName.toLowerCase();if(u!=="ul"&&u!=="ol")return!1;r=n.create(u);if(e.childNodes&&e.childNodes.length)for(t=0;t<e.childNodes.length;t+=1){o=e.childNodes[t];if(o.nodeType!==1||o.tagName.toLowerCase()!=="li")continue;s=n.inout.importListItem(o),s&&i.dom.isGhostBlock(s)&&r.appendChild(s)}return i.dom.getFirstChildGhostBlock(r)||r.appendChild(n.createItem("p")),r},importListItem:function(e){var t,r,s=!1;return!e||!e.tagName||e.tagName.toLowerCase()!=="li"?!1:(t=n.createItem(),r=i.dom.getFirstChildElement(e),i.plugins.textblock.inout.isHandleableNode(r)==="block"?s=i.plugins.textblock.inout.importHTML(r):(s=document.createElement("p"),s.innerHTML=e.innerHTML,s=i.plugins.textblock.inout.importHTML(s)),s?t.appendChild(s):t.appendChild(i.plugins.textblock.create("p")),t)}},n.paste={handle:function(e,t,s){var o,u,a,f,l,c,h,p,d,v,m,g,y;if(!i.dom.isGhostBlock(e)||!i.dom.isGhostBlock(t))return;if(t.tagName.toLowerCase()!=="ol"&&t.tagName.toLowerCase()!=="ul")return!1;if(t.tagName!==e.tagName){o=i.selection.saved.data.clone().collapseToStart().getParentNode();while(!i.dom.isChildGhostBlock(o,e))o=i.dom.getParentGhostBlock(o);u=n.split(e,"after",o);switch(u){case!1:return!0;case"atverystart":p=i.dom.getPreviousSiblingGhostBlock(e),d=e;break;case"atveryend":p=e,d=i.dom.getNextSiblingGhostBlock(e);break;default:p=u.block1,d=u.block2}return r().removeDOMmarkers("ghostedit_paste_start"),r().removeDOMmarkers("ghostedit_paste_end"),p.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",d.innerHTML="<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+d.innerHTML,!1}v=i.selection.saved.data.clone().collapseToStart().getParentNode();while(!i.dom.isGhostBlock(v))v=i.dom.getParentGhostBlock(v);m=i.selection.saved.data.clone().collapseToEnd().getParentNode();while(!i.dom.isGhostBlock(v))v=i.dom.getParentGhostBlock(v);if(s.isfirst){a=i.dom.getFirstChildGhostBlock(t),f=i.dom.getFirstChildGhostBlock(a),c=v,l=i.dom.getParentGhostBlock(c);if(f.tagName===c.tagName){c.innerHTML+=f.innerHTML,i.plugins.textblock.mozBrs.tidy(c),t.removeChild(a);if(!i.dom.getLastChildGhostBlock(t))return s.islast&&(h=i.dom.getNextSiblingGhostBlock(l),h&&(r().removeDOMmarkers("ghostedit_paste_start"),c.innerHTML=c.innerHTML+"<span id='ghostedit_paste_start_range_start'>&#x200b;</span>"+i.dom.getFirstChildGhostBlock(h).innerHTML,i.plugins.textblock.mozBrs.tidy(c),h.parentNode.removeChild(h))),!0;r().removeDOMmarkers("ghostedit_paste_start"),c.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",i.plugins.textblock.mozBrs.tidy(c),v=l}}s.islast&&i.dom.getLastChildGhostBlock(t)&&(a=i.dom.getLastChildGhostBlock(t),f=i.dom.getFirstChildGhostBlock(a),c=m,f.tagName===c.tagName&&(r().removeDOMmarkers("ghostedit_paste_end"),c.innerHTML=f.innerHTML+"<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"+c.innerHTML,t.removeChild(a),i.plugins.textblock.mozBrs.tidy(c))),o=v,g=y=i.dom.getFirstChildGhostBlock(t);while(y=i.dom.getFirstChildGhostBlock(t))n.dom.addchild(e,"after",o,y),o=y;return s.isfirst||(r().removeDOMmarkers("ghostedit_paste_start"),o.innerHTML+="<span id='ghostedit_paste_start_range_start'>&#x200b;</span>",i.plugins.textblock.mozBrs.tidy(o)),s.islast||(r().removeDOMmarkers("ghostedit_paste_end"),m.innerHTML=m.innerHTML+"<span id='ghostedit_paste_end_range_start'>&#x200b;</span>"),!0}},n.isList=function(e){var t;return i.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),t!=="ul"&&t!=="ol"?!1:!0):!1},n.isListItem=function(e){var t;return i.dom.isGhostBlock(e)?(t=e.tagName.toLowerCase(),t!=="li"?!1:!0):!1},n.create=function(e){var t;return e.toLowerCase()!=="ol"&&(e="ul"),t=document.createElement(e),i.blockElemId+=1,t.id="ghostedit_list_"+i.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","list"),t.setAttribute("data-ghostedit-handler","list"),t},n.createItem=function(e){var t;return t=document.createElement("li"),i.blockElemId+=1,t.id="ghostedit_list_item_"+i.blockElemId,t.setAttribute("data-ghostedit-iselem","true"),t.setAttribute("data-ghostedit-elemtype","listitem"),t.setAttribute("data-ghostedit-handler","list"),e&&t.appendChild(i.plugins.textblock.create(e)),t},n.remove=function(e){var t,n;return t=i.dom.getParentGhostBlock(e),n=t.getAttribute("data-ghostedit-handler"),i.plugins[n].dom.removechild(t,e)},n.focus=function(e){var t,n;return!e||e.nodeType!==1||e.getAttribute("data-ghostedit-elemtype")!=="list"?!1:(t=i.dom.getFirstChildGhostBlock(e),t?(t=i.dom.getFirstChildGhostBlock(t),t?(n=t.getAttribute("data-ghostedit-handler"),i.plugins[n].focus(t),!0):!1):!1)},n.merge=function(e,t,r){var s;if(e===t)return e;if(!n.isList(e)||!n.isList(t))return n.isListItem(e)&&n.isListItem(t)?n.mergeItems(e,t,r):!1;if(e.tagName.toLowerCase()!==t.tagName.toLowerCase())return!1;while(s=i.dom.getFirstChildGhostBlock(t))e.appendChild(s);return n.remove(t),e},n.mergeItems=function(e,t,r){var s,o,u;return r===!1?e:e===t?e:!n.isListItem(e)||!n.isListItem(t)?!1:(s=i.dom.getFirstChildGhostBlock(e),o=i.dom.getFirstChildGhostBlock(t),!s||!o?!1:(u=i.plugins.textblock.merge(s,o),u))},n.split=function(e,t,r){var s,o,u,a,f,l;if(!i.dom.isGhostBlock(e)||!i.dom.isChildGhostBlock(r,e))return!1;t!=="before"&&(t="after"),s=i.dom.getFirstChildGhostBlock(e),o=i.dom.getLastChildGhostBlock(e);if(t==="before"&&s===r)return"atverystart";if(t==="after"&&o===r)return"atveryend";a=r,u=n.create(e.tagName.toLowerCase()),f=i.dom.getParentGhostBlock(e),l=f.getAttribute("data-ghostedit-handler");if(t==="before"){a=s;while(a){if(a===r)break;u.appendChild(a),a=i.dom.getFirstChildGhostBlock(e)}}else{a=i.dom.getNextSiblingGhostBlock(r);while(a)u.appendChild(a),a=i.dom.getNextSiblingGhostBlock(r)}return i.plugins[l].dom.addchild(f,t,e,u),t==="before"?{block1:u,block2:e}:{block1:e,block2:u}},n.toggle=function(e){var t,s,o,u,a,f,l,c,h;e=e==="ordered"?"ol":"ul",s=!1,h=!1,a=!1;for(t=0;t<i.selection.nodepath.length;t++){l=i.selection.nodepath[t];switch(l.getAttribute("data-ghostedit-elemtype")){case"list":s=!0,o=l;break;case"textblock":h=!0,u=l;break;case"container":a=!0,f=l}}return i.selection.savedRange.saveToDOM().select(),h&&!s?(n.convertTextblock(u,e),c=r().restoreFromDOM(),c&&c.select(),i.selection.save(),!0):s?(n.convertList(o,e),c=r().restoreFromDOM(),c&&c.select(),i.selection.save(),!0):a?(n.convertContainerContents(f,e),c=r().restoreFromDOM(),c&&c.select(),i.selection.save(),!0):!1},n.convertTextblock=function(e,t){var s,o,u,a,f;return s=n.create(t),u=e.tagName.toLowerCase(),o=n.createItem(),s.appendChild(o),a=i.dom.getParentGhostBlock(e),f=a.getAttribute("data-ghostedit-handler"),i.plugins[f].dom.addchild(a,"before",e,s),o.appendChild(e),n.tidy(s),r().setCaretToEnd(e).select(),i.selection.save(),e},n.convertList=function(e,t){var s,o=[],u,a=!1,f=!1,l,c,h=[],p=[],d=[],v,m,g;u=i.dom.getFirstChildGhostBlock(e);if(!u)return n.remove(e),!0;i.selection.savedRange.restoreFromDOM("",!1);do v=r().setCaretToEnd(u).compareEndPoints("StartToStart",i.selection.savedRange),v=v>=0?!0:!1,m=r().setCaretToStart(u).compareEndPoints("EndToEnd",i.selection.savedRange),m=m<=0?!0:!1,v?v&&m?p.push(u):d.push(u):h.push(u);while(u=i.dom.getNextSiblingGhostBlock(u));l=i.dom.getParentGhostBlock(e),c=l.getAttribute("data-ghostedit-handler");if(d.length>0){f=n.create(e.tagName);for(s=0;s<d.length;s++)f.appendChild(d[s]);i.plugins[c].dom.addchild(l,"after",e,f)}g=e;if(e.tagName.toLowerCase()===t)for(s=0;s<p.length;s++)u=i.dom.getFirstChildGhostBlock(p[s]),u&&(i.plugins[c].dom.addchild(l,"after",g,u),g=u),e.removeChild(p[s]);else{a=n.create(t);for(s=0;s<p.length;s++)a.appendChild(p[s]);i.plugins[c].dom.addchild(l,"after",e,a)}return h.length===0&&(n.remove(e),e=!1),e&&(n.tidy(e),o.push(e)),a&&(n.tidy(a),o.push(a)),f&&(n.tidy(f),o.push(f)),o},n.convertContainerContents=function(e,t){var s,o,u=[],a,f;o=i.dom.getFirstChildGhostBlock(e);do{a=r().setCaretToEnd(o).compareEndPoints("StartToStart",i.selection.savedRange),a=a>=0?!0:!1,f=r().setCaretToStart(o).compareEndPoints("EndToEnd",i.selection.savedRange),f=f<=0?!0:!1;if(a&&f)u.push(o);else if(!f)break}while(o=i.dom.getNextSiblingGhostBlock(o));for(s=0;s<u.length;s++){o=u[s];switch(o.getAttribute("data-ghostedit-elemtype")){case"list":o.tagName.toLowerCase()!==t&&n.convertList(o,t);break;case"textblock":n.convertTextblock(o,t)}}return!0},n.tidy=function(e){var t,r,s,o;return s=i.dom.getFirstChildGhostBlock(e),s?(t=i.dom.getPreviousSiblingGhostBlock(e),o=n.merge(t,e),o?(n.focus(o),i.selection.save(),n.tidy(o),!0):(r=i.dom.getNextSiblingGhostBlock(e),o=n.merge(e,r),o?(n.focus(o),i.selection.save(),n.tidy(o),!0):!0)):(n.remove(e),!0)},n.applydropevents=function(e){e.ondragenter=function(){return!1},e.ondragleave=function(){return!1},e.ondragover=function(){return!1},e.ondrop=function(e){var t,n;n=e.dataTransfer.getData("text/plain")||e.srcElement.id,t=document.getElementById(n),t.parentNode.insertBefore(t,this),i.image.focus(t),i.util.cancelEvent(e)},e.onresizestart=function(e){return i.util.cancelEvent(e)}},i.api.plugin.register("list",n)}(window),function(e,t){var n={savename:"",saveurl:"",params:[]},r=e.ghostedit;n.enable=function(){var e,t,i;r.api.save=function(){n.save()};if(r.options.save&&r.options.save.params){t=r.options.save.params;for(e=0;e<t.length;e++){if(typeof t[e]!="string")continue;i=t[e].split("=",2),i.length>1&&n.updateparameter(i[0],i[1])}}},n.save=function(){var e,t,i,s;t=r.api.exportHTML(),n.updateparameter("snippet",t.snippet),n.updateparameter("content",t.content),i=[];for(e=0;e<n.params.length;e++)i.push(n.params[e].name+"="+n.params[e].value);i=i.join("&"),s=function(e,t){var n;e&&t==="true"?r.event.trigger("ui:message",{message:"Page was successfully saved :)",time:1,color:"success"}):(n=t,r.event.trigger("ui:message",{message:n,time:1,color:"error"}))},r.util.ajax(r.options.save.url,"POST",i,s,"text")},n.updateparameter=function(e,t){var r;if(typeof e!="string"||typeof t!="string")return;e=e.replace(/[^A-Za-z\-_0-9]/g,""),t=encodeURIComponent(t);for(r=0;r<n.params.length;r++)if(n.params[r].name===e){n.params[r]={name:e,value:t};return}n.params.push({name:e,value:t})},r.api.plugin.register("save",n)}(window),function(){var e={aelem:!1,context:null,elemInEnglish:{h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",p:"Paragraph",div:"Generic Box",a:"Link",b:"Bold",strong:"Bold",i:"Italic",em:"Italic",u:"Underline",img:"Image",ul:"Bulletted list",ol:"Numbered list",li:"List Item",strike:"Strikethrough"},definition:{quickbuttons:[{label:"Save",icon:"save16.png",action:function(){t.api.save()}},{label:"Undo",icon:"undo16.png",action:function(){t.api.undo()}},{label:"Redo",icon:"redo16.png",action:function(){t.api.redo()}}],tabs:[{name:"textblock",label:"Format",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"bold",label:"Bold",icon:"format-bold.png",highlighttest:function(e){return e==="b"||e==="strong"},action:function(){t.api.format.bold()}},{type:"button",id:"italic",label:"Italic",icon:"format-italic.png",highlighttest:function(e){return e==="i"||e==="em"},action:function(){t.api.format.italic()}},{type:"button",id:"underline",label:"Underline",icon:"format-underline.png",highlighttest:function(e){return e==="u"},action:function(){t.api.format.underline()}},{type:"button",id:"strikethrough",label:"Strikethrough",icon:"format-strikethrough.png",highlighttest:function(e){return e==="strike"},action:function(){t.api.format.strikethrough()}},{type:"br"},{type:"button",id:"align-left",label:"Align Left",icon:"align-left.png",highlighttest:function(e,t,n){return n.style.textAlign==="left"||n.style.textAlign===""},action:function(){t.api.format.alignText("left")}},{type:"button",id:"align-center",label:"Align Center",icon:"align-center.png",highlighttest:function(e,t,n){return n.style.textAlign==="center"},action:function(){t.api.format.alignText("center")}},{type:"button",id:"align-right",label:"Align Right",icon:"align-right.png",highlighttest:function(e,t,n){return n.style.textAlign==="right"},action:function(){t.api.format.alignText("right")}},{type:"button",id:"align-justify",label:"Justify",icon:"align-justified.png",highlighttest:function(e,t,n){return n.style.textAlign==="justify"},action:function(){t.api.format.alignText("justify")}}]},{type:"seperator"},{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"list-unordered",label:"Bulleted List",icon:"list-unordered.png",action:function(){t.api.list.toggle("unordered")}},{type:"button",id:"list-ordered",label:"Numbered List",icon:"list-ordered.png",action:function(){t.api.list.toggle("ordered")}}]},{type:"seperator"},{type:"group",contents:[{type:"stylebox",label:"Paragraph",tagname:"p"},{type:"stylebox",label:"LeadPara",tagname:"p",classname:"LeadingParagraph"},{type:"stylebox",label:"Heading 1",tagname:"h1"},{type:"stylebox",label:"Heading 2",tagname:"h2"},{type:"stylebox",label:"Heading 3",tagname:"h3"}]}]},{name:"insert",label:"Insert",enabled:!0,contents:[{type:"group",style:"padding-top: 3px",contents:[{type:"button",id:"insert-link",label:"Insert Link",icon:"insert-link.png",action:function(){e.toolbar.event.buttonclick.insertlink()}},{type:"button",id:"insert-image",label:"Insert Image",icon:"insert-image.png",action:function(){e.toolbar.event.buttonclick.insertimage()}}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"&#224;"},{type:"specialchar",character:"&#225;"},{type:"specialchar",character:"&#226;"},{type:"specialchar",character:"&#227;"},{type:"specialchar",character:"&#228;"},{type:"specialchar",character:"&#229;"},{type:"specialchar",character:"&#232;"},{type:"specialchar",character:"&#233;"},{type:"br"},{type:"specialchar",character:"&#234;"},{type:"specialchar",character:"&#235;"},{type:"specialchar",character:"&#236;"},{type:"specialchar",character:"&#237;"},{type:"specialchar",character:"&#238;"},{type:"specialchar",character:"&#239;"},{type:"specialchar",character:"&#242;"},{type:"specialchar",character:"&#243;"},{type:"br"},{type:"specialchar",character:"&#244;"},{type:"specialchar",character:"&#245;"},{type:"specialchar",character:"&#246;"},{type:"specialchar",character:"&#249;"},{type:"specialchar",character:"&#250;"},{type:"specialchar",character:"&#251;"},{type:"specialchar",character:"&#252;"}]},{type:"seperator"},{type:"group",contents:[{type:"specialchar",character:"+"},{type:"specialchar",character:"&#8722;"},{type:"specialchar",character:"&#215;"},{type:"specialchar",character:"&#247;"},{type:"br"},{type:"specialchar",character:"&#8804;"},{type:"specialchar",character:"&#8805;"},{type:"specialchar",character:"&#177;"},{type:"specialchar",character:"&#8801;"},{type:"br"},{type:"specialchar",character:"&#189;"},{type:"specialchar",character:"&#188;"},{type:"specialchar",character:"&#190;"},{type:"specialchar",character:"&#960;"}]}]},{name:"save",label:"Save",enabled:!0,contents:[{type:"group",contents:[{type:"textfield",label:"Page Name",onkeyup:function(){t.plugins.save.updateparameter("name",this.value)}}]},{type:"group",contents:[{type:"textfield",label:"Page Url Slug",onkeyup:function(){t.plugins.save.updateparameter("url",this.value)}}]},{type:"group",contents:[{type:"button",id:"save",label:"Save",icon:"save.png",action:function(){t.api.save()}}]},{type:"seperator"},{type:"group",contents:[{type:"button",id:"about",label:"About GhostEdit & credits",icon:"about.png",action:function(){t.api.defaultui.showabout()}}]}]},{name:"link",label:"Link",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"linkurl",label:"Link URL",width:"400px",onkeyup:function(){t.api.link.updateurl(this.value)}}]},{type:"group",contents:[{type:"button",label:"Open link in new tab",icon:"openlink.png",action:function(){t.api.link.open()}}]}]},{name:"image",label:"Image",enabled:!1,contents:[{type:"group",contents:[{type:"textfield",id:"imagealt",label:"Description / Alt text",onkeyup:function(){t.api.image.updatealttext(this.value)}}]}]}]}},t=window.ghostedit;e.el={},e.enable=function(){t.event.trigger("ui:replace"),t.event.addListener("ui:update",function(){e.update()},"defaultui"),t.event.addListener("ui:message",function(t){e.message.show(t)},"defaultui"),t.event.addListener("ui:replace",function(){t.api.plugin.disable("defaultui")},"defaultui"),t.event.addListener("selection:change",function(){var e;for(a=0;a<t.selection.nodepath.length;a++){e=t.selection.nodepath[a];if(e.tagName&&e.tagName.toLowerCase()==="img"){t.selection.saved.type==="image"&&(document.getElementById("ghostedit_defaultui_textfield_imagealt").value=t.selection.saved.data.alt),t.event.trigger("ui:newcontext",{context:"image"});break}if(e.tagName&&e.tagName.toLowerCase()==="a"){t.plugins.link.focusedlink&&(document.getElementById("ghostedit_defaultui_textfield_linkurl").value=t.plugins.link.focusedlink.href==="http:"?"http://":t.plugins.link.focusedlink.href),t.event.trigger("ui:newcontext",{context:"link"});break}if(t.plugins.textblock.isTextBlock(e)){t.event.trigger("ui:newcontext",{context:"textblock"});break}}},"defaultui"),t.event.addListener("ui:newcontext",function(n){if(!n.context)return;e.context&&!/textblock|format|insert|save/.test(e.context)&&e.toolbar.disabletab(e.context),typeof n.context=="string"&&(n.context=n.context.replace("textblock","textblock")),e.context=n.context;if(n.context==="image"&&t.selection.type==="image"){var r=t.selection.data;document.getElementById("ghostedit_toolbar_imagealttext").value=r.alt}e.context&&!/image|help|save/.test(e.context)&&t.plugins.image.unfocus(),e.toolbar.showtab(n.context)},"defaultui"),t.options.defaultui||(t.options.defaultui={}),t.options.defaultui.statusbar||(t.options.defaultui.statusbar=!0),t.options.defaultui.wordcount||(t.options.defaultui.wordcount=!0);var n,r,i,s,o,u,a,f,l;n=e.definition,r=document.createElement("div"),r.id="ghostedit_defaultui_toolbar",r.className="ghostedit_defaultui_toolbar",e.el.toolbar=r,o=document.createElement("div"),o.id="ghostedit_defaultui_messagearea",o.className="ghostedit_defaultui_messagearea",o.innerHTML="&nbsp;",r.appendChild(o),e.el.messagearea=o,i=document.createElement("div"),i.id="ghostedit_defaultui_quickbutton_insertanchor",i.style.cssText="float: left; position: relative; width: 3px;height: 16px",r.insertBefore(i,o),e.el.qbanchor=i;if(n.quickbuttons)for(a=0;a<n.quickbuttons.length;a++)e.toolbar.insert.quickbutton(n.quickbuttons[a]);s=i=document.createElement("div"),s.id="ghostedit_defaultui_tabselect",s.style.cssText="position: absolute;width: 100%;left: 0; bottom: -1px; height: 1px; line-height: 1px; font-size: 1px; background-color: #FFF",e.el.tabselect=s;if(n.tabs)for(a=0;a<n.tabs.length;a++)e.toolbar.insert.tab(n.tabs[a]);t.wrapdiv.insertBefore(r,t.wrapdiv.firstChild),t.util.addEvent(e.el.toolbar,"mouseup",function(t){e.toolbar.event.click(t)}),t.util.addEvent(e.el.toolbar,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(e.el.toolbar,"mousedown",function(e){t.util.preventBubble(e)}),u=document.createElement("div"),u.id="ghostedit_defaultui_statusbar",u.className="ghostedit_defaultui_statusbar",u.innerHTML="<b>Path:</b>",t.wrapdiv.appendChild(u),e.el.statusbar=u,f=document.createElement("div"),f.id="ghostedit_defaultui_modal",f.className="ghostedit_defaultui_modal",t.wrapdiv.appendChild(f),e.el.modal=f,l=document.createElement("div"),l.id="ghostedit_defaultui_modalbg",l.className="ghostedit_defaultui_modalbg",t.util.addEvent(l,"click",function(){e.modal.hide()}),t.wrapdiv.appendChild(l),e.el.modalbg=l,e.toolbar.showtab("textblock")},e.disable=function(){t.event.removeAllListeners("defaultui"),t.wrapdiv.removeChild(e.el.toolbar),t.wrapdiv.removeChild(e.el.statusbar),t.wrapdiv.removeChild(e.el.modal),t.wrapdiv.removeChild(e.el.modalbg),e.toolbar.quickbuttons=[],e.toolbar.tabs=[],e.toolbar.enabledtabs=[],e.toolbar.panels=[]},e.update=function(){var n,r,i,s,o,u="",a="N/A",f,l;l=e.toolbar.highlightmap;for(n=0;n<l.length;n++)t.util.removeClass(l[n].element,"current");for(n=0;n<t.selection.nodepath.length;n++){i=t.selection.nodepath[n],s=i.tagName.toLowerCase(),o=t.util.trim(i.className);for(r=0;r<l.length;r++)l[r].test.call(l[r].data,s,o,i)&&t.util.addClass(l[r].element,"current");n!==t.selection.nodepath.length-1&&(u=" > "+(e.elemInEnglish[i.tagName.toLowerCase()]||i.tagName.toUpperCase())+u)}e.el.statusbar.innerHTML="<b>Path</b>"+u,t.options.defaultui.wordcount&&(f=t.util.trim(t.editdiv.innerText||t.editdiv.textContent),a=f.split(/\s+/).length,e.el.statusbar.innerHTML+="<div style='position: absolute; right: 10px; top: 3px'>"+a+" words</div>")},e.modal={show:function(n){var r,i,s;r=e.el.modal,i=e.el.modalbg,r.innerHTML=n,s=document.createElement("a"),s.className="ghostedit_defaultui_modal_closebutton",s.innerHTML="&#215",t.util.addEvent(s,"click",e.modal.hide),r.appendChild(s),r.style.display="block",i.style.display="block"},hide:function(){var n,r;n=e.el.modal,r=e.el.modalbg,n.style.display="none",r.style.display="none",n.innerHTML="",t.selection.restore()},showabout:function(){e.modal.show("<h2>About GhostEdit</h2><p>GhostEdit is a WYSIWYG editor based on the concept that the editor should be transparent to use - i.e. you do no notice that you are using it. This manifests itself in two ways:</p><ul><li>GhostEdit has an incredibly simple user interface, which is designed for maximum usability</li><li>GhostEdit restricts input to known, safe content so as to be as reliable as possible</li></ul><h3>Credits</h3>GhostEdit was designed and coded by <a href='http://nicoburns.com'>Nico Burns</a>.<br />Icons licensed from <a href='http://www.gentleface.com/free_icon_set.html'>Gentleface</a> under a <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/'>CC BY-NC-ND 3.0</a> liscense.<br />version: "+t.version)}},e.message={div:"",show:function(t){var n,r,i,s;n=t.message,r=t.time,i=t.color,s=e.el.messagearea,s.innerHTML=n,i=i==="success"?"#bbff00":i,i=i==="error"?"#ff4949":i,i=i==="warn"?"#ffef49":i,s.style.backgroundColor=i,s.style.opacity=1,s.filters&&(s.filters.item(0).enabled=1),r!==0&&(clearTimeout(e.message.timer),e.message.timer=setTimeout(function(){e.message.clear()},r*1e3))},clear:function(){var t=e.el.messagearea;t.style.opacity>.1?(t.style.opacity=t.style.opacity-.05,t.filters&&(t.filters.item(0).Opacity=t.style.opacity*100),setTimeout(function(){e.message.clear()},20)):(t.innerHTML="&nbsp;",t.style.backgroundColor="transparent",t.opacity="1",t.filters&&(t.filters.item(0).Opacity=100))}},e.toolbar={div:"",quickbuttons:[],tabs:[],enabledtabs:["format","insert","save"],panels:[],styleboxes:[],highlightmap:[],event:{click:function(e){t.event.allowtoolbarclick||t.util.cancelAllEvents(e)},buttonclick:{insertimage:function(){t.selection.save();var n,r,i,s,o;s="<h2>Insert image</h2><form><p>This dialog allows you to choose an image to insert into the document. Either select one from the list of uploaded images, or enter a custom url in the box below.</p><hr /><h3 style='clear: both;'>Select uploaded image</h3><div id='ghostedit_listbox' style='height: 200px;overflow-x: hidden;overflow-y: scroll;background: white; border: 1px solid #ccc'></div><hr /><h3>Or enter URL</h3><input type='text' value='' id='ghostedit_imageurlinput' style='width: 99%' /><br /><input type='button' value='Insert' style='float: right;margin-top: 10px;' onclick='ghostedit.plugins.image.newImageBefore(null, null);ghostedit.plugins.defaultui.modal.hide();' /></form>",i=[],t.options.defaultui.uploadedimages&&(i=t.options.defaultui.uploadedimages),e.modal.show(s),o=function(){t.plugins.image.newImageBefore(null,this.getAttribute("ghostedit-listitem-value"),!1),e.modal.hide()};for(n=0;n<i.length;n+=1)r=document.createElement("div"),r.className="ghostedit-listbox-item",r.setAttribute("ghostedit-listitem-value",i[n].url),r.innerHTML="<img src='"+i[n].thumburl+"' style='height: 60px; float: left' /><p style='margin-left: 100px;font-size: 21px'>"+i[n].name+"</p>",r.onclick=o,document.getElementById("ghostedit_listbox").appendChild(r);document.getElementById("ghostedit_imageurlinput").focus()},insertlink:function(){t.api.link.create(),document.getElementById("ghostedit_defaultui_textfield_linkurl").focus()}}},clicktab:function(e){var n,r;typeof e=="string"&&(e=document.getElementById("ghostedit_defaultui_toolbartab_"+e.replace("ghostedit_defaultui_toolbartab_",""))),r=e.id.replace("ghostedit_defaultui_toolbartab_",""),n=document.getElementById("ghostedit_defaultui_toolbarpanel_"+r),t.selection.restore(),t.event.trigger("ui:newcontext",{context:r})},showtab:function(n){var r,i,s,o,u;typeof n=="string"&&(n=document.getElementById("ghostedit_defaultui_toolbartab_"+n.replace("ghostedit_defaultui_toolbartab_",""))),i=n.id.replace("ghostedit_defaultui_toolbartab_",""),r=document.getElementById("ghostedit_defaultui_toolbarpanel_"+i),s=e.el.toolbar.childNodes;for(o=0;o<s.length;o+=1)u=s[o],u.nodeType===1&&(/tab/.test(u.className)||/panel/.test(u.className))&&t.util.removeClass(u,"active");e.toolbar.enabledtabs[i]||e.toolbar.enabletab(i),t.util.addClass(n,"active"),t.util.addClass(r,"active"),n.appendChild(e.el.tabselect)},enabletab:function(n){var r;r=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.addClass(r,"enabled"),e.toolbar.enabledtabs.push(n)},disabletab:function(n){var r;r=document.getElementById("ghostedit_defaultui_toolbartab_"+n),t.util.removeClass(r,"enabled"),delete e.toolbar.enabledtabs[n]},insert:{quickbutton:function(n){var r;if(!n||!n.label||!n.icon||!t.util.isFunction(n.action))return!1;r=document.createElement("img"),r.className="ghostedit_defaultui_quickbutton",r.src=t.options.imageurl+"/defaultui/"+n.icon,r.title=n.label,r.alt=n.label,e.el.toolbar.insertBefore(r,e.el.qbanchor),e.toolbar.quickbuttons.push(r),r.onclick=n.action},tab:function(n){var r,i,s;r=document.createElement("div"),r.className=n.enabled?"ghostedit_defaultui_toolbartab enabled":"ghostedit_defaultui_toolbartab",r.id="ghostedit_defaultui_toolbartab_"+n.name,r.innerHTML=n.label,i=document.createElement("div"),t.util.addClass(i,"ghostedit_defaultui_toolbarpanel"),i.id="ghostedit_defaultui_toolbarpanel_"+n.name;if(n.contents)for(s=0;s<n.contents.length;s++)switch(n.contents[s].type){case"group":e.toolbar.insert.panelgroup(i,n.contents[s]);break;case"seperator":e.toolbar.insert.panelseperator(i)}e.el.toolbar.insertBefore(r,e.el.messagearea),e.el.toolbar.appendChild(i),e.toolbar.tabs.push(r),r.onclick=function(){e.toolbar.clicktab(this)}},panelseperator:function(e){var n;n=document.createElement("span"),n.className="ghostedit_defaultui_toolbarseperator",n.style.backgroundImage="URL("+t.options.imageurl+"/defaultui/toolbar_seperator.png)",e.appendChild(n)},panelgroup:function(t,n){var r,i;r=document.createElement("span"),r.className="ghostedit_defaultui_toolbarpanelgroup",n.style&&(r.style.cssTet=n.style);if(n.contents)for(i=0;i<n.contents.length;i++)switch(n.contents[i].type){case"button":e.toolbar.insert.button(r,n.contents[i]);break;case"stylebox":e.toolbar.insert.stylebox(r,n.contents[i]);break;case"specialchar":e.toolbar.insert.specialchar(r,n.contents[i]);break;case"textfield":e.toolbar.insert.textfield(r,n.contents[i]);break;case"br":r.appendChild(document.createElement("br"))}t.appendChild(r)},button:function(n,r){var i;i=document.createElement("img"),i.src=t.options.imageurl+"/defaultui/"+r.icon,i.title=r.label,i.alt=r.label,r.style&&(i.style.cssText=r.style),n.appendChild(i),r.highlighttest&&e.toolbar.highlightmap.push({element:i,test:r.highlighttest}),t.util.addEvent(i,"click",r.action)},specialchar:function(e,n){var r;r=document.createElement("a"),r.className="ghostedit_defaultui_specialchar",r.title="Insert Character",r.alt="Insert Character",r.innerHTML=n.character,e.appendChild(r),r.onclick=function(){t.api.insert.character(this)}},textfield:function(e,n){var r;r=document.createElement("input"),n.id&&(r.id="ghostedit_defaultui_textfield_"+n.id),r.style.width=n.width?n.width:"200px",n.label&&(e.innerHTML+=n.label+"<br />"),e.appendChild(r),t.util.addEvent(r,"click",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keypress",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keydown",function(e){t.util.preventBubble(e)}),t.util.addEvent(r,"keyup",n.onkeyup)},stylebox:function(n,r){var i,s;i=document.createElement("div"),i.className="ghostedit_defaultui_stylebox",i.id="ghostedit_defaultui_stylebox_"+r.tagname,r.classname&&(i.id=i.id+"_"+r.classname),i.innerHTML="<"+r.tagname+" class='ghostedit_defaultui_stylebox_preview'>AaBbCc</"+r.tagname+">",i.title=r.label,i.alt=r.label,s=document.createElement("div"),s.className="ghostedit_defaultui_stylebox_label",s.innerHTML=r.label,i.appendChild(s),n.appendChild(i),e.toolbar.styleboxes.push(i),e.toolbar.highlightmap.push({element:i,data:{tagname:r.tagname,classname:r.classname!==undefined?r.classname:""},test:function(e,t){return e===this.tagname&&t===this.classname}}),i.onclick=function(){t.api.format.setStyle(r.tagname,r.classname)}}}},t.api.plugin.register("defaultui",e)}();